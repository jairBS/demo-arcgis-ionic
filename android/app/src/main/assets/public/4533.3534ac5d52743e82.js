"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4533],{40856:(ee,$,l)=>{l.d($,{X_:()=>W,i1:()=>P,zx:()=>A});var m=l(69287),F=l(82663);const V=96;function W(I,U){const N=U||I.extent,w=I.width,E=(0,F.GA)(null==N?void 0:N.spatialReference);return N&&w?N.width/w*E*F.dy*V:0}function P(I,U){return I/((0,F.GA)(U)*F.dy*V)}function A(I,U,N){return function j(I,U){return 0===U||(0,m.Sp)(I,U)||I<U}(I,U)&&function Q(I,U){return 0===U||(0,m.Sp)(I,U)||I>U}(I,N)}},52593:(ee,$,l)=>{l.d($,{A:()=>A});var Y,m=l(8189),F=l(71065),V=l(77806),W=l(85211),P=l(55739),B=l(76576);let S=Y=class extends F.oY{constructor(j){super(j),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new Y({variableName:this.variableName,dimensionName:this.dimensionName,values:(0,V.o8)(this.values),isSlice:this.isSlice})}};(0,m._)([(0,W.MZ)({type:String,json:{write:!0}})],S.prototype,"variableName",void 0),(0,m._)([(0,W.MZ)({type:String,json:{write:!0}})],S.prototype,"dimensionName",void 0),(0,m._)([(0,W.MZ)({type:P.gK.array(P.gK.oneOf([P.gK.native(Number),P.gK.array(P.gK.native(Number))])),json:{write:!0}})],S.prototype,"values",void 0),(0,m._)([(0,W.MZ)({type:Boolean,json:{write:!0}})],S.prototype,"isSlice",void 0),S=Y=(0,m._)([(0,B.$)("esri.layers.support.DimensionalDefinition")],S);const A=S},20053:(ee,$,l)=>{l.d($,{DY:()=>w,NG:()=>se,QW:()=>W,Rp:()=>Q,ct:()=>U,fy:()=>N,sx:()=>j,xx:()=>P,z2:()=>E});var m=l(89952),F=l(52593);function V(h,c,y){const T=c.shift();0===y.length&&y.push({sliceId:-1,multidimensionalDefinition:[]});const f=y.length;for(let v=0;v<f;v++){var d;const _=y.shift().multidimensionalDefinition;null===(d=T.values)||void 0===d||d.forEach(x=>{y.push({sliceId:-1,multidimensionalDefinition:[..._,{variableName:h,dimensionName:T.name,values:[x]}]})})}c.length&&V(h,c,y)}function W(h,c){const y=[];let T=0;return(c?h.variables.filter(f=>f.name.toLowerCase()===c.toLowerCase()):[...h.variables].sort((f,d)=>f.name>d.name?1:-1)).forEach(f=>{const d=[],v=[...f.dimensions].sort((_,x)=>_.name>x.name?-1:1);V(f.name,v,d),d.forEach(_=>{y.push({..._,sliceId:T++})})}),y}function P(h,c,y){let T=h;if(c&&(c=[...c].sort((f,d)=>f.dimensionName<d.dimensionName?-1:1)).forEach(({dimensionName:f,values:d,isSlice:v})=>{d.length&&(T=T.filter(_=>{const x=_.multidimensionalDefinition.find(b=>b.dimensionName===f);if(null==x)return!1;const M=x.values[0];return"number"==typeof M?"number"==typeof d[0]?d.includes(M):d.some(b=>b[0]<=M&&b[1]>=M):d.some("number"==typeof d[0]?b=>M[0]<=b&&M[1]>=b:v?b=>b[0]===M[0]&&b[0]===M[1]:b=>b[0]>=M[0]&&b[0]<=M[1]||b[1]>=M[0]&&b[1]<=M[1]||b[0]<M[0]&&b[1]>M[1])}))}),T.length&&null!=(null==y?void 0:y.start)&&null!=y.end){const f=y.start.getTime(),d=y.end.getTime(),v=T[0].multidimensionalDefinition.findIndex(_=>"StdTime"===_.dimensionName);v>-1&&(T=T.filter(_=>{const x=_.multidimensionalDefinition[v].values[0];return f<=x&&d>=x}))}return T.map(f=>f.sliceId)}function B(h,c){return Array.isArray(h)?c[0]===c[1]?h[0]===c[0]||h[1]===c[0]:h[0]>=c[0]&&h[0]<=c[1]&&h[1]>=c[0]&&h[1]<=c[1]:h>=c[0]&&h<=c[1]}function Y(h,c){return h[0]<=c[0]&&h[1]>=c[0]||h[0]<=c[1]&&h[1]>=c[1]||h[0]>=c[0]&&h[1]<=c[1]}function S(h){return 1===h.length?[h[0],h[0]]:[h[0],h[h.length-1]]}function A(h,c,y){var T;if(null==c||null===(T=c.subsetDefinitions)||void 0===T||!T.length)return h;let f;if(y){var d;const{variables:x}=c;if(x.length&&!x.includes(y))return null;const M=c.subsetDefinitions.find(b=>b.dimensionName===h.name&&b.variableName===y);if(null==M||null===(d=M.values)||void 0===d||!d.length)return h;f=S(M.values)}else{const x=c.dimensions.find(({name:M})=>M===h.name);f=null==x?void 0:x.extent}const v=f;if(null==v||!v.length)return h;const _=h.values.filter(x=>B(x,v));return{...h,extent:[...v],values:_}}function j(h,c,y){var T;if(null==c||null===(T=c.subsetDefinitions)||void 0===T||!T.length)return!1;const{variables:f}=c;if(f.length&&h.some(({variableName:d})=>d&&!f.includes(d)))return!0;for(let d=0;d<h.length;d++){const v=h[d],_=c.subsetDefinitions.find(x=>(""===v.variableName||x.variableName===v.variableName)&&x.dimensionName===v.dimensionName);if(null!=_&&_.values.length){const x=S(_.values);if(v.isSlice||2!==v.values.length||Array.isArray(v.values[0])||v.values[0]===v.values[1]||!y){if(v.values.some(M=>!B(M,x)))return!0}else if(!Y(v.values,x))return!0}}return!1}function Q(h,c){if(null==h)return{isOutside:!1};const{geometry:y,timeExtent:T,multidimensionalDefinition:f}=c;let d=null;if(null!=T&&(d=function I(h,c){var y,T;const f=h.dimensions.find(({name:x})=>"StdTime"===x);if(null==f||null==c.start&&null==c.end)return c;c=c.clone();const{start:d,end:v}=c.toJSON(),_=d===v?[d]:null!=d&&null!=v?[d,v]:[null!=d?d:v];return 2===_.length&&null!=f&&f.extent.length&&(_[0]=Math.max(_[0],f.extent[0]),_[1]=Math.min(_[1],null!==(y=f.extent[1])&&void 0!==y?y:f.extent[0]),_[1]<_[0])||j([new F.A({variableName:"",dimensionName:"StdTime",isSlice:1===_.length,values:_})],h,!0)?null:(c.start=new Date(_[0]),c.end=new Date(null!==(T=_[1])&&void 0!==T?T:_[0]),c)}(h,T),null==d))return{isOutside:!0};const{areaOfInterest:v}=h;if(v&&y){const _="point"===y.type?y:"extent"===y.type?y.center:"polygon"===y.type?y.centroid:null;if(_&&!v.contains(_))return{isOutside:!0}}return null!=f&&f.length&&j(f,h,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:y,timeExtent:d,multidimensionalDefinition:f}}}function U(h,c={}){var y,T,f;const{multidimensionalInfo:d,keyProperties:v}=h;if(null==d)return null;const{variableName:_,multidimensionalSubset:x,multidimensionalDefinition:M}=c,b=null!=M?null===(y=M[0])||void 0===y?void 0:y.variableName:null,C=_||b||(null==v?void 0:v.DefaultVariable);let{variables:H}=d;return!(null==x||null===(T=x.variables)||void 0===T)&&T.length&&(H=H.filter(({name:te})=>x.variables.includes(te))),C&&null!==(f=H.find(({name:te})=>te===C))&&void 0!==f?f:H[0]}function N(h,c={}){const y=U(h,c);if(!y)return null;const T=[],{dimensions:f,name:d}=y;if(0===f.length)return[new F.A({variableName:d,dimensionName:"",values:[],isSlice:!0})];for(let _=0;_<f.length;_++){var v;const x=A(f[_],c.multidimensionalSubset,d);if(!x)return null;const{values:M,extent:b}=x;let C=null!==(v=null==M?void 0:M[0])&&void 0!==v?v:b[0];"stdz"===x.name.toLowerCase()&&!x.hasRanges&&Math.abs(b[1])<=Math.abs(b[0])&&(C=null!=M&&M.length?M[M.length-1]:b[1]),T.push(new F.A({variableName:d,dimensionName:x.name,values:[C],isSlice:!c.useRangeForRangedDimensionInfo||!!x.hasRanges}))}return T}function w(h){return!(null==h||!h.length)&&h.some(c=>{if(null==c.values)return!0;const y=c.values.length;return 0===y||y>1||!c.isSlice&&Array.isArray(c.values[0])})}function E(h,c){var y;if(null==c||null==h)return null;let T=c.variables.map(f=>({...f}));return null!=h&&null!==(y=h.variables)&&void 0!==y&&y.length&&(T=T.filter(({name:f})=>h.variables.includes(f)),T.forEach(f=>{f.dimensions=f.dimensions.map(d=>A(d,h,f.name)).filter(m.Ru)})),T}function L(h,c){var y;const{values:T}=c;if(null!=T&&T.length){const x=Array.isArray(T[0]),M=Array.isArray(h);return x!==M?-1:x&&M?T.findIndex(b=>b[0]===h[0]&&b[1]===h[1]):T.indexOf(h)}const{extent:f}=c;if(Array.isArray(h)||h<f[0]||h>f[1])return-1;const d=c.interval||1;if("ISO8601"!==c.unit)return Math.round((h-f[0])/d);const v=f[0];let _=-1;switch((null===(y=c.intervalUnit)||void 0===y?void 0:y.toLowerCase())||"seconds"){case"seconds":_=Math.round((h-v)/1e3/d);break;case"minutes":_=Math.round((h-v)/6e4/d);break;case"hours":_=Math.round((h-v)/36e5/d);break;case"days":_=Math.round((h-v)/864e5/d);break;case"months":{const x=new Date(h).getUTCFullYear()-new Date(v).getUTCFullYear(),M=new Date(v).getUTCMonth(),b=new Date(h).getUTCMonth();_=0===x?b-M:b+11-M+12*(x-1)}break;case"years":_=Math.round((new Date(h).getUTCFullYear()-new Date(v).getUTCFullYear())/d);break;case"decades":_=Math.round((new Date(h).getUTCFullYear()-new Date(v).getUTCFullYear())/10/d)}return _}function Z(h){var c,y,T;let f=null===(c=h.values)||void 0===c?void 0:c.length;if(f)return f;const{extent:d,unit:v}=h,_=h.interval||1,x=d?d[1]-d[0]:0;if("ISO8601"!==v)return Math.round(x/_);switch(null!==(y=null===(T=h.intervalUnit)||void 0===T?void 0:T.toLowerCase())&&void 0!==y?y:"seconds"){case"seconds":f=Math.round(x/1e3/_);break;case"minutes":f=Math.round(x/6e4/_);break;case"hours":f=Math.round(x/36e5/_);break;case"days":f=Math.round(x/864e5/_);break;case"months":{const M=new Date(d[1]).getUTCFullYear()-new Date(d[0]).getUTCFullYear(),b=new Date(d[0]).getUTCMonth(),C=new Date(d[1]).getUTCMonth();f=0===M?C-b+1:C+11-b+12*(M-1)+1}break;case"years":f=Math.round((new Date(d[1]).getUTCFullYear()-new Date(d[0]).getUTCFullYear())/_);break;case"decades":f=Math.round((new Date(d[1]).getUTCFullYear()-new Date(d[0]).getUTCFullYear())/10/_);break;default:f=0}return f}function se(h,c){let y=0;const T=h[0].variableName,f=[...c.variables].sort((d,v)=>d.name>v.name?1:-1);for(let d=0;d<f.length;d++){const v=f[d],_=[...v.dimensions].sort((b,C)=>b.name>C.name?-1:1);if(v.name!==T){y+=_.map(b=>Z(b)).reduce((b,C)=>b*C);continue}const x=_.map(b=>Z(b)),M=_.length;for(let b=0;b<M;b++){const C=h.find(te=>te.dimensionName===_[b].name);if(null==C)return null;const H=L(C.values[0],_[b]);if(-1===H)return null;x.shift(),y+=b===M-1?H:H*x.reduce((te,me)=>te*me)}break}return y}},48716:(ee,$,l)=>{l.d($,{j:()=>V});var m=l(82663),F=l(47258);const V={unknown:1,inches:(0,m.oU)(1,"meters","inches"),feet:(0,m.oU)(1,"meters","feet"),"us-feet":(0,m.oU)(1,"meters","us-feet"),yards:(0,m.oU)(1,"meters","yards"),miles:(0,m.oU)(1,"meters","miles"),"nautical-miles":(0,m.oU)(1,"meters","nautical-miles"),millimeters:(0,m.oU)(1,"meters","millimeters"),centimeters:(0,m.oU)(1,"meters","centimeters"),decimeters:(0,m.oU)(1,"meters","decimeters"),meters:(0,m.oU)(1,"meters","meters"),kilometers:(0,m.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,m.vl)(1,"meters",F.$O.radius)}},37188:(ee,$,l)=>{l.d($,{A:()=>Y});var m=l(3248),F=l(69473),V=l(54382),W=l(89298),P=l(99065);const B=(S,A)=>S.key.level-A.key.level!=0?S.key.level-A.key.level:S.key.row-A.key.row!=0?S.key.row-A.key.row:S.key.col-A.key.col;class Y extends V.A{constructor(A){super(),this._tileInfoView=A}renderChildren(A){this.sortChildren(B),this.setStencilReference(A),super.renderChildren(A)}createRenderParams(A){const{state:j}=A,Q=super.createRenderParams(A);return Q.requiredLevel=this._tileInfoView.getClosestInfoForScale(j.scale).level,Q.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(j.scale),Q}prepareRenderPasses(A){const j=super.prepareRenderPasses(A);return j.push(A.registerRenderPass({name:"stencil",brushes:[W.A],drawPhase:F.S5.DEBUG|F.S5.MAP|F.S5.HIGHLIGHT|F.S5.LABEL,target:()=>this.getStencilTarget()})),(0,m.A)("esri-tiles-debug")&&j.push(A.registerRenderPass({name:"tileInfo",brushes:[P.A],drawPhase:F.S5.DEBUG,target:()=>this.children})),j}getStencilTarget(){return this.children}setStencilReference(A){let j=1;for(const Q of this.children)Q.stencilRef=j++}}},43254:(ee,$,l)=>{l.r($),l.d($,{default:()=>Rs});var m=l(8189),F=l(35150),V=l(56492),W=l(48900),P=l(85211),S=(l(3248),l(40707),l(76576)),A=l(20053),j=l(89063),Q=l(29459),I=l(10467),U=l(51995),N=l(6126),w=l(11432),E=l(31610),L=l(12273),Z=l(88532),se=l(63888),h=l(50915),c=l(31071);const y={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class T extends se.q{constructor(t=null,s=null,i=null){super(),this._textureInvalidated=!0,this._colormapTextureInvalidated=!0,this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,this._colormapTexture=null,this._colormap=null,this._supportsBilinearTexture=!0,this._processedTexture=null,this.functionTextures=[],this.projected=!1,this.stencilRef=0,this.coordScale=[1,1],this._processed=!1,this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.source=t,this.transformGrid=s,this.interpolation=i}destroy(){this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(t){this._processedTexture!==t&&(this._disposeTextures(!0),this._processedTexture=t)}get rasterTexture(){return this._rasterTexture}set rasterTexture(t){var s;this._rasterTexture!==t&&(null!==(s=this._rasterTexture)&&void 0!==s&&s.dispose(),this._rasterTexture=t),null==t&&(this.projected=!1)}get processed(){return this._processed}set processed(t){this._processed=t,t||((0,w.WD)(this.processedTexture),this.invalidateTexture())}get symbolizerParameters(){return this._symbolizerParameters||y}set symbolizerParameters(t){this._symbolizerParameters!==t&&(this._symbolizerParameters=t,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}get source(){return this._source}set source(t){this._source!==t&&(this._source=t,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this.commonUniforms=null,this.projected=!1,this.invalidateTexture())}get suspended(){return this._suspended}set suspended(t){this._suspended&&!t&&this.stage&&(this.ready(),this.requestRender()),this._suspended=t}get bandIds(){return this._bandIds}set bandIds(t){this._bandIds=t,this._isBandIdsChanged(t)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){this._interpolation=t,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(t||"nearest")?h.Cj.LINEAR:h.Cj.NEAREST)}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid!==t&&(this._transformGrid=t,this._transformGridTexture=(0,w.WD)(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(t=!1){var s,i;const a=t||this.projected;return[a?this.width:(null===(s=this.source)||void 0===s?void 0:s.width)||this.width,a?this.height:(null===(i=this.source)||void 0===i?void 0:i.height)||this.height]}getRasterCellSize(){var t;const s=null===(t=this.rawPixelData)||void 0===t?void 0:t.srcPixelSize,{projected:i,resolution:a}=this;return s&&!i?[s.x,s.y]:[a,a]}_createTransforms(){return{displayViewScreenMat3:(0,L.vt)()}}setTransform(t){const s=(0,E.D_)(this.transforms.displayViewScreenMat3),[i,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.resolution/this.pixelRatio/t.resolution,u=o*this.width,p=o*this.height,g=Math.PI*this.rotation/180;(0,E.Tl)(s,s,(0,Z.fA)(i,a)),(0,E.Tl)(s,s,(0,Z.fA)(u/2,p/2)),(0,E.e$)(s,s,-g),(0,E.Tl)(s,s,(0,Z.fA)(-u/2,-p/2)),(0,E.Oe)(s,s,(0,Z.fA)(u,p)),(0,E.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,s)}getTextures({forProcessing:t=!1,useProcessedTexture:s=!1}={}){var i;const a=s&&null!==(i=this._processedTexture)&&void 0!==i?i:this._rasterTexture,o=[],u=[];return a?(this._transformGridTexture&&!this.projected&&(u.push(this._transformGridTexture),o.push("u_transformGrid")),s?(u.push(a),o.push("u_image"),this._colormapTexture&&(u.push(this._colormapTexture),o.push("u_colormap")),{names:o,textures:u}):(u.push(a),o.push("u_image"),this._colormapTexture&&!t&&(u.push(this._colormapTexture),o.push("u_colormap")),{names:o,textures:u})):{names:o,textures:u}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:t}){if(!this.stage)return void this._disposeTextures();const s=this._isValidSource(this.source);s&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(t)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(t),this._rasterTexture&&(s?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,c.kc)(t,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}updateProcessedTexture(){const{functionTextures:t}=this;0!==t.length&&(this.processedTexture=t.shift(),t.forEach(s=>null==s?void 0:s.dispose()),t.length=0)}_createOrDestroyRasterTexture(t){var s,i;const a=null===(s=this.source)||void 0===s?void 0:s.extractBands(this.bandIds);if(!this._isValidSource(a))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null));const o=!this._isBandIdsChanged(this.bandIds);if(this._rasterTexture){if(o)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}this._supportsBilinearTexture=!(null===(i=t.capabilities.textureFloat)||void 0===i||!i.textureFloatLinear);const u=this._getTextureSamplingMethod(this.interpolation);this._rasterTexture=(0,c.b4)(t,a,u,this.isRendereredSource),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}_isBandIdsChanged(t){const s=this._rasterTextureBandIds;return!(null==s&&null==t||s&&t&&s.join("")===t.join(""))}_isValidSource(t){var s;return null!=t&&(null===(s=t.pixels)||void 0===s?void 0:s.length)>0}_getTextureSamplingMethod(t){const{type:s}=this.symbolizerParameters;return!this._supportsBilinearTexture||"lut"===s||"hillshade"===s||"stretch"===s&&1===this.symbolizerParameters.bandCount||"bilinear"!==t&&"cubic"!==t?"nearest":"bilinear"}_updateColormapTexture(t){const s=this._colormap,i=this.symbolizerParameters.colormap;return i?s?i.length!==s.length||i.some((a,o)=>a!==s[o])?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=(0,c.hE)(t,i),void(this._colormap=i)):void 0:(this._colormapTexture=(0,c.hE)(t,i),void(this._colormap=i)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}_disposeTextures(t=!1){!this._transformGridTexture||t&&!this.projected||(this._transformGridTexture.dispose(),this._transformGridTexture=null),!t&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null,this._colormap=null,this._colormapTextureInvalidated=!0),!t&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}function v(r){const t=[];return r&&(t.push("applyProjection"),1===r.spacing[0]&&t.push("lookupProjection")),t}function _(r,t,s){var i;const a=!(null!==(i=s.capabilities.textureFloat)&&void 0!==i&&i.textureFloatLinear),o=[];return"cubic"===r?o.push("bicubic"):"bilinear"===r&&(t?(o.push("bilinear"),o.push("nnedge")):a&&o.push("bilinear")),o}const x={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])},C={createProgram:function M(r,t,s){const i=s?[]:v(t.transformGrid);return{defines:i,program:r.painter.materialManager.getProgram(x,i)}},bindTextureAndUniforms:function b(r,t,s,i,a=!1){const{names:o,textures:u}=s.getTextures({useProcessedTexture:a});(0,c.hB)(r.context,t,o,u),(0,c.EO)(t,i,s.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3);const{colormap:p,colormapOffset:g}=s.symbolizerParameters,R=(0,c.Pp)(p,g);(0,c.EO)(t,i,R)}},H={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ce={createProgram:function te(r,t,s){const{colormap:i}=t.symbolizerParameters,a=[...s?[]:v(t.transformGrid),..._(t.interpolation,!0,r.context)];return null!=i&&a.push("applyColormap"),{defines:a,program:r.painter.materialManager.getProgram(H,a)}},bindTextureAndUniforms:function me(r,t,s,i,a=!1){const{names:o,textures:u}=s.getTextures({useProcessedTexture:a});(0,c.hB)(r.context,t,o,u),(0,c.EO)(t,i,s.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3);const p=s.symbolizerParameters,{colormap:g,colormapOffset:R}=p;if(null!=g){const z=(0,c.Pp)(g,R);(0,c.EO)(t,i,z)}const O=(0,c.OI)(p);(0,c.EO)(t,i,O)}},Ee={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])},Oe={createProgram:function De(r,t,s){const{colormap:i,bandCount:a}=t.symbolizerParameters,o=[...s?[]:v(t.transformGrid),..._(t.interpolation,1===a,r.context)];return t.isRendereredSource&&!s?o.push("noop"):null!=i&&o.push("applyColormap"),{defines:o,program:r.painter.materialManager.getProgram(Ee,o)}},bindTextureAndUniforms:function Ae(r,t,s,i,a=!1){const{names:o,textures:u}=s.getTextures({useProcessedTexture:a});(0,c.hB)(r.context,t,o,u),(0,c.EO)(t,i,s.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3);const p=s.symbolizerParameters,{colormap:g,colormapOffset:R}=p;if(null!=g){const z=(0,c.Pp)(g,R);(0,c.EO)(t,i,z)}const O=(0,c.VC)(p);(0,c.EO)(t,i,O)}},ce=new Map;ce.set("lut",C),ce.set("hillshade",Ce),ce.set("stretch",Oe);const Be=[1,1],Le=[2,0,0,0,2,0,-1,-1,0];function X(r,t,s){var i,a;const{context:o,rasterFunction:u,hasBranches:p}=r,{raster:g}=u.parameters,R=p?null!==(i=null==g?void 0:g.id)&&void 0!==i?i:-1:0,O=null!==(a=s.functionTextures[R])&&void 0!==a?a:s.rasterTexture;(0,c.hB)(o,t,["u_image"],[O])}function ve(r,t,s){const{rasters:i}=r.rasterFunction.parameters;if(!i)return;if(i.length<2)return X(r,t,s);const a=i.filter(o=>"Constant"!==o.name).map(o=>null!=o.id&&"Identity"!==o.name?s.functionTextures[o.id]:s.rasterTexture);if((0,c.hB)(r.context,t,["u_image","u_image1","u_image2"].slice(0,a.length),a),a.length!==i.length)if(2===i.length){const o=i.findIndex(g=>"Constant"===g.name),u=0===o?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],{value:p}=i[o].parameters;t.setUniform1f("u_image1Const",p),t.setUniformMatrix3fv("u_imageSwap",u)}else if(3===i.length){const o=[];if(i.forEach((u,p)=>"Constant"===u.name&&o.push(p)),1===o.length){const{value:u}=i[o[0]].parameters;t.setUniform1f("u_image1Const",u),t.setUniformMatrix3fv("u_imageSwap",0===o[0]?[0,1,0,0,0,1,1,0,0]:1===o[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1])}else if(2===o.length){const{value:u}=i[o[0]].parameters;t.setUniform1f("u_image1Const",u);const{value:p}=i[o[1]].parameters;t.setUniform1f("u_image2Const",p);const g=i.findIndex(O=>"Constant"!==O.name);t.setUniformMatrix3fv("u_imageSwap",0===g?[1,0,0,0,1,0,0,0,1]:1===g?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0])}}}function J(r){r.setUniform2fv("u_coordScale",Be),r.setUniformMatrix3fv("u_dvsMat3",Le)}const Ve={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ge={createProgram:function ze(r,t){return r.painter.materialManager.getProgram(Ve,[])},bindTextureAndUniforms:function je(r,t,s){X(r,t,s),J(t);const i=s.getRasterTextureSize();t.setUniform2fv("u_srcImageSize",i);const a=s.getRasterCellSize();t.setUniform2fv("u_cellSize",a)}},We={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ze={createProgram:function Ne(r,t){const{painter:s,rasterFunction:i}=r,{indexType:a}=i.parameters;return s.materialManager.getProgram(We,[a])},bindTextureAndUniforms:function $e(r,t,s){X(r,t,s),J(t);const{bandIndexMat3:i}=r.rasterFunction.parameters;t.setUniformMatrix3fv("u_bandIndexMat3",i)}},Ke={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])},ke={createProgram:function He(r,t){const s=r.rasterFunction.parameters.rasters.filter(a=>"Constant"===a.name),i=[];return s.length&&(i.push("oneConstant"),2===s.length&&i.push("twoConstant")),r.painter.materialManager.getProgram(Ke,i)},bindTextureAndUniforms:function Qe(r,t,s){ve(r,t,s),J(t)}},Ye={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/contrast",attributes:new Map([["a_position",0],["a_texcoord",1]])},qe={createProgram:function Je(r,t){return r.painter.materialManager.getProgram(Ye,[])},bindTextureAndUniforms:function Xe(r,t,s){X(r,t,s),J(t);const{contrastOffset:i,brightnessOffset:a}=r.rasterFunction.parameters;t.setUniform1f("u_contrastOffset",i),t.setUniform1f("u_brightnessOffset",a)}},et={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])},rt={createProgram:function tt(r,t){const{painter:s,rasterFunction:i}=r,{kernelRows:a,kernelCols:o}=i.parameters;return s.materialManager.getProgram(et,[{name:"rows",value:a},{name:"cols",value:o}])},bindTextureAndUniforms:function st(r,t,s){X(r,t,s),J(t),t.setUniform2fv("u_srcImageSize",[s.width,s.height]);const{kernel:i,clampRange:a}=r.rasterFunction.parameters;t.setUniform1fv("u_kernel",i),t.setUniform2fv("u_clampRange",a)}},it={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",0],["a_texcoord",1]])},ot={createProgram:function nt(r,t){const{painter:s,rasterFunction:i}=r,{curvatureType:a}=i.parameters;return s.materialManager.getProgram(it,[a])},bindTextureAndUniforms:function at(r,t,s){X(r,t,s),J(t);const i=s.getRasterTextureSize();t.setUniform2fv("u_srcImageSize",i);const{zFactor:a}=r.rasterFunction.parameters,o=s.getRasterCellSize();t.setUniform1f("u_zlFactor",200*a/o[0]/o[1])}},lt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])},dt={createProgram:function ut(r,t){return r.painter.materialManager.getProgram(lt,[])},bindTextureAndUniforms:function ct(r,t,s){X(r,t,s),J(t);const{bandIndexMat3:i}=r.rasterFunction.parameters;t.setUniformMatrix3fv("u_bandIndexMat3",i)}},ht={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/focalstatistics",attributes:new Map([["a_position",0],["a_texcoord",1]])},ft={createProgram:function pt(r,t){const{painter:s,rasterFunction:i}=r,{kernelRows:a,kernelCols:o,fillNoDataOnly:u,statisticsType:p}=i.parameters,g=[{name:"rows",value:a},{name:"cols",value:o},p];return u&&g.push("fill"),s.materialManager.getProgram(ht,g)},bindTextureAndUniforms:function mt(r,t,s){X(r,t,s),J(t),t.setUniform2fv("u_srcImageSize",[s.width,s.height]);const{clampRange:i}=r.rasterFunction.parameters;t.setUniform2fv("u_clampRange",i)}},vt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/grayscale",attributes:new Map([["a_position",0],["a_texcoord",1]])},yt={createProgram:function gt(r,t){return r.painter.materialManager.getProgram(vt,[])},bindTextureAndUniforms:function _t(r,t,s){X(r,t,s),J(t);const{weights:i}=r.rasterFunction.parameters;t.setUniform3fv("u_weights",i)}},Pt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])},ge={createProgram:function xt(r){const{painter:t,rasterFunction:s}=r,{imageCount:i,operationName:a,rasters:o,isOutputRounded:u}=s.parameters,p=[a.toLowerCase()];2===i&&p.push("twoImages");const g=o.filter(R=>"Constant"===R.name);return g.length&&(p.push("oneConstant"),2===g.length&&p.push("twoConstant")),u&&p.push("roundOutput"),t.materialManager.getProgram(Pt,p)},bindTextureAndUniforms:function Tt(r,t,s){ve(r,t,s),J(t);const{domainRange:i}=r.rasterFunction.parameters;t.setUniform2fv("u_domainRange",i)}},bt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])},Rt={createProgram:function wt(r,t){const{painter:s,rasterFunction:i}=r;return s.materialManager.getProgram(bt,i.parameters.bandCount>1?["multiBand"]:[])},bindTextureAndUniforms:function Mt(r,t,s){X(r,t,s),J(t);const{includedRanges:i,noDataValues:a}=r.rasterFunction.parameters;t.setUniform1fv("u_includedRanges",i),t.setUniform1fv("u_noDataValues",a)}},St={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ct={createProgram:function Ut(r,t){const{painter:s,rasterFunction:i}=r;return s.materialManager.getProgram(St,i.parameters.scaled?["scaled"]:[])},bindTextureAndUniforms:function It(r,t,s){X(r,t,s),J(t);const{bandIndexMat3:i}=r.rasterFunction.parameters;t.setUniformMatrix3fv("u_bandIndexMat3",i)}},Et={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ot={createProgram:function Dt(r,t){return r.painter.materialManager.getProgram(Et,[])},bindTextureAndUniforms:function At(r,t,s){X(r,t,s),J(t);const{noDataRanges:i,rangeMaps:a,allowUnmatched:o,clampRange:u}=r.rasterFunction.parameters;t.setUniform1fv("u_noDataRanges",i),t.setUniform1fv("u_rangeMaps",a),t.setUniform1f("u_unmatchMask",o?1:0),t.setUniform2fv("u_clampRange",u)}};var _e=l(45475);const Ft={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])},Vt={createProgram:function Bt(r,t){var s;const{painter:i}=r,a=[],{interpolation:o,transformGrid:u}=t,p=null===(s=r.rasterFunction)||void 0===s?void 0:s.parameters;return"cubic"===o?a.push("bicubic"):"bilinear"===o&&(a.push("bilinear"),null!=p&&p.requireNNEdge&&a.push("nnedge")),u&&(a.push("applyProjection"),1===u.spacing[0]&&a.push("lookupProjection")),i.materialManager.getProgram(Ft,a)},bindTextureAndUniforms:function Lt(r,t,s){const{names:i,textures:a}=s.getTextures({forProcessing:!0});(0,c.hB)(r.context,t,i,a),t.setUniform1f("u_scale",1),t.setUniform2fv("u_offset",[0,0]),t.setUniform2fv("u_coordScale",[1,1]),t.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]),t.setUniform1i("u_flipY",0),t.setUniform1f("u_opacity",1);const{width:o,height:u,source:p,transformGrid:g}=s;t.setUniform2fv("u_srcImageSize",[p.width,p.height]),t.setUniform2fv("u_targetImageSize",[o,u]),t.setUniform2fv("u_transformSpacing",g?g.spacing:_e.uY),t.setUniform2fv("u_transformGridSize",g?g.size:_e.uY)}},zt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])},Wt={createProgram:function jt(r,t){const{painter:s,rasterFunction:i}=r,{slopeType:a}=i.parameters;return s.materialManager.getProgram(zt,"percent-rise"===a?["percentRise"]:[])},bindTextureAndUniforms:function Gt(r,t,s){X(r,t,s),J(t);const i=s.getRasterTextureSize();t.setUniform2fv("u_srcImageSize",i);const a=s.getRasterCellSize();t.setUniform2fv("u_cellSize",a);const{zFactor:o,slopeType:u,pixelSizePower:p,pixelSizeFactor:g}=r.rasterFunction.parameters;t.setUniform1f("u_zFactor",o),t.setUniform1f("u_pixelSizePower","adjusted"===u?p:0),t.setUniform1f("u_pixelSizeFactor","adjusted"===u?g:0)}},Nt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])},Kt={createProgram:function $t(r,t){const{useGamma:s,bandCount:i,isOutputRounded:a}=r.rasterFunction.parameters,o=[];return s&&o.push("useGamma"),i>1&&o.push("multiBand"),a&&o.push("roundOutput"),r.painter.materialManager.getProgram(Nt,o)},bindTextureAndUniforms:function Zt(r,t,s){X(r,t,s),J(t);const{width:i,height:a}=s,o=r.rasterFunction.parameters;t.setUniform2fv("u_srcImageSize",[i,a]),t.setUniform1f("u_minOutput",o.outMin),t.setUniform1f("u_maxOutput",o.outMax),t.setUniform1fv("u_factor",o.factor),t.setUniform1fv("u_minCutOff",o.minCutOff),t.setUniform1fv("u_maxCutOff",o.maxCutOff),t.setUniform1fv("u_gamma",o.gamma),t.setUniform1fv("u_gammaCorrection",o.gammaCorrection)}};var Ht=l(26136),Qt=l(4931);const k=new Map;function ye(r,t){const s=new Qt.R;return s.width=r,s.height=t,s.internalFormat=h.H0.RGBA32F,s.samplingMode=h.Cj.NEAREST,s.dataType=h.ld.FLOAT,s.isImmutable=!0,s.wrapMode=h.pF.CLAMP_TO_EDGE,s}k.set("arithmetic",ge),k.set("aspect",Ge),k.set("bandarithmetic",Ze),k.set("compositeband",ke),k.set("convolution",rt),k.set("contrastbrightness",qe),k.set("curvature",ot),k.set("extractband",dt),k.set("statistics",ft),k.set("grayscale",yt),k.set("local",ge),k.set("mask",Rt),k.set("ndvi",Ct),k.set("remap",Ot),k.set("slope",Wt),k.set("stretch",Kt);var le=l(47669),Pe=l(91837),Xt=l(67448),qt=l(79061);class es extends Xt.A{constructor(){super(...arguments),this.name="raster",this._quad=null,this._rendererUniformInfos=new Map,this._fbo=null}dispose(){(0,w.WD)(this._quad),(0,w.WD)(this._fbo)}prepareState(t){const{context:s,renderPass:i}=t,a="raster"===i;s.setBlendingEnabled(!a),s.setBlendFunctionSeparate(h.dn.ONE,h.dn.ONE_MINUS_SRC_ALPHA,h.dn.ONE,h.dn.ONE_MINUS_SRC_ALPHA),s.setColorMask(!0,!0,!0,!0),s.setStencilWriteMask(0),s.setStencilTestEnabled(!a)}draw(t,s){if(!function d(r){return null!=r.source}(s)||s.suspended)return;const{renderPass:i}=t;if("raster-bitmap"!==i)return"raster"===i?this._process(t,s):void this._drawBitmap(t,s,!0);this._drawBitmap(t,s)}_process(t,s){const{rasterFunction:i}=t,a="Reproject"===i.name;if(!(a?!s.rasterTexture||!s.projected:!s.processed))return;const{timeline:o,context:u}=t;o.begin(this.name);const p=u.getBoundFramebufferObject(),g=u.getViewport();a||(s.processedTexture=(0,w.WD)(s.processedTexture)),u.setStencilFunction(h.MT.EQUAL,s.stencilRef,255),s.updateTexture(t),this._initQuad(u);const[R,O]=s.getRasterTextureSize(a),{isStandardRasterTileSize:z,fbo:D}=this._getRasterFBO(u,R,O);(function Jt(r,t,s,i){const a=r.rasterFunction.name.toLowerCase(),o="reproject"===a?Vt:function Yt(r){return k.get(r.toLowerCase())}(a);if(null==o)return;const u=function kt(r,t,s,i){const{context:a,requestRender:o,allowDelayedRender:u}=r,p=i.createProgram(r,s);return u&&null!=o&&!p.compiled?(o(),null):(a.bindFramebuffer(t),a.setViewport(0,0,t.width,t.height),a.useProgram(p),p)}(r,s,i,o);if(!u)return;o.bindTextureAndUniforms(r,u,i);const{interpolation:p}=i;"reproject"===a&&(i.interpolation="nearest"),t.draw();const[g,R]=i.getRasterTextureSize("reproject"===a),O=ye(g,R),z=new Ht.g(r.context,O);s.copyToTexture(0,0,g,R,0,0,z),"reproject"===a?(i.rasterTexture=z,i.projected=!0,i.interpolation=p):i.functionTextures[r.hasBranches?r.rasterFunction.id:0]=z})(t,this._quad,D,s),z||D.dispose(),u.bindFramebuffer(p),u.setViewport(g.x,g.y,g.width,g.height),o.end(this.name)}_drawBitmap(t,s,i=!1){const{timeline:a,context:o}=t;if(a.begin(this.name),o.setStencilFunction(h.MT.EQUAL,s.stencilRef,255),s.updateTexture(t),i&&!s.processedTexture){if(s.updateProcessedTexture(),!s.processedTexture)return void a.end(this.name);s.processed=!0}this._initBitmapCommonUniforms(s);const u=s.symbolizerParameters.type,p=function Fe(r){return ce.get(r)}(u),{requestRender:g,allowDelayedRender:R}=t,{defines:O,program:z}=p.createProgram(t,s,s.projected&&i);if(R&&null!=g&&!z.compiled)return void g();o.useProgram(z);const D=this._getUniformInfos(u,o,z,O);this._quad||(this._quad=new Pe.A(o,[0,0,1,0,0,1,1,1])),p.bindTextureAndUniforms(t,z,s,D,i),this._quad.draw(),a.end(this.name)}_initBitmapCommonUniforms(t){if(!t.commonUniforms){const s=(0,c.Qg)(1,[0,0]),{transformGrid:i,width:a,height:o}=t,u=(0,c.xV)(i,[a,o],[t.source.width,t.source.height],1,!1);t.commonUniforms={...s,...u,u_coordScale:t.coordScale}}}_getRasterFBO(t,s,i){const a=s===le.CQ&&i===le.CQ;return a?(this._fbo||(this._fbo=this._createNewFBO(t,s,i)),{isStandardRasterTileSize:a,fbo:this._fbo}):{isStandardRasterTileSize:a,fbo:this._createNewFBO(t,s,i)}}_createNewFBO(t,s,i){const a=ye(s,i);return new qt.H(t,a)}_initQuad(t){this._quad||(this._quad=new Pe.A(t,[0,0,1,0,0,1,1,1]))}_getUniformInfos(t,s,i,a){const o=a.length>0?t+"-"+a.join("-"):t;if(this._rendererUniformInfos.has(o))return this._rendererUniformInfos.get(o);const u=(0,c.z)(s,i);return this._rendererUniformInfos.set(o,u),u}}var xe=l(15442);class ts extends xe.Y{constructor(t,s,i,a,o,u,p=null){super(t,s,i,a,o,u),this.bitmap=null,this.bitmap=new T(p,null,null),this.bitmap.coordScale=[o,u],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(t){this.bitmap.stencilRef=t}get stencilRef(){return this.bitmap.stencilRef}setTransform(t){super.setTransform(t),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}_createTransforms(){return{displayViewScreenMat3:(0,L.vt)(),tileMat3:(0,L.vt)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var de=l(69473),Te=l(37188);class ss extends Te.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(t){const s=this._getTileBounds(t),[i,a]=this._tileInfoView.tileInfo.size,o=this._tileInfoView.getTileResolution(t.level);return new ts(t,o,s[0],s[3],i,a)}prepareRenderPasses(t){const s=t.registerRenderPass({name:"imagery (tile)",brushes:[es],target:()=>this.children.map(i=>i.bitmap),drawPhase:de.S5.MAP});return[...super.prepareRenderPasses(t),s]}doRender(t){if(!this.visible||t.drawPhase!==de.S5.MAP)return;const{rasterFunctionChain:s}=this;if(!s)return t.renderPass="raster-bitmap",void super.doRender(t);if(!s.hasFocalFunction){const[i,a]=this._tileInfoView.tileInfo.size;t.renderPass="raster",t.rasterFunction={name:"Reproject",parameters:{targetImageSize:[i,a],requireNNEdge:s.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1},super.doRender(t)}if(null!=s&&s.functions.length){const{functions:i,hasBranches:a}=s;for(let o=0;o<i.length;o++){const u=i[o];"Constant"!==u.name&&"Identity"!==u.name&&(t.renderPass="raster",t.rasterFunction=u,t.hasBranches=a,super.doRender(t))}}t.rasterFunction=null,t.renderPass="bitmap",super.doRender(t)}_getTileBounds(t){const s=this._tileInfoView.getTileBounds((0,U.vt)(),t);if(this.isCustomTilingScheme&&t.world){const{tileInfo:i}=this._tileInfoView,a=(0,N.FT)(i.spatialReference);if(a){const o=i.lodAt(t.level);if(!o)return s;const{resolution:u}=o,p=a/u%i.size[0],g=p?(i.size[0]-p)*u:0;s[0]-=g*t.world,s[2]-=g*t.world}}return s}}l(21152);var rs=l(98877),is=l(56985),ns=l(13303),as=l(66234),be=l(11333),ne=l(62619),ue=l(40018),os=l(54290),ls=(l(74847),l(67347)),we=l(77031),us=l(54551),cs=l(28067);const ds=[0,0];let q=class extends rs.A{constructor(){var r;super(...arguments),r=this,this._updatingHandles=new is.U,this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=[],this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._maxIndexedColormapSize=0,this._rasterFunctionState="na",this._globalUpdateRequested=!1,this.attached=!1,this.timeExtent=null,this.redrawOrRefetch=(0,V.sg)((0,I.A)(function*(t={}){const s=r._rasterFunctionState;if(t.reprocess&&(yield r._updatingHandles.addPromise(r.layer.updateRasterFunction()),r.updateRasterFunctionParameters()),!r.previousLOD||r.layerView.suspended)return;const i=r._rasterFunctionState,{type:a}=r;return r._updatingHandles.addPromise(t.refetch||"raster"!==a&&t.reprocess||"cpu"===i||"cpu"===s?r.doRefresh():r._redrawImage(t.signal))}))}destroy(){this._updatingHandles.destroy()}get useWebGLForProcessing(){var r;return null===(r=this._get("useWebGLForProcessing"))||void 0===r||r}set useWebGLForProcessing(r){this._set("useWebGLForProcessing",r)}get useProgressiveUpdate(){var r;return null===(r=this._get("useProgressiveUpdate"))||void 0===r||r}set useProgressiveUpdate(r){if(this._tileStrategy&&this.useProgressiveUpdate!==r){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(r);this._tileStrategy=new we.A({cachePolicy:"purge",acquireTile:s=>this.acquireTile(s),releaseTile:s=>this.releaseTile(s),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",r),this.layerView.requestUpdate()}}update(r){this._fetchQueue.pause(),this._fetchQueue.state=r.state,this._tileStrategy.update(r),this._fetchQueue.resume();const{extent:t,resolution:s,scale:i}=r.state,a=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){var o;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const u=this._srcResolutions[a.level],p=t.toJSON?t:cs.A.fromJSON(t);(0,ne.yo)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,p,s,u,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null===(o=this.previousLOD)||void 0===o?void 0:o.level)!==a.level&&(this.previousLOD=a,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()}));const r=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(r),this.layerView.requestUpdate()}get updating(){var r;return this._globalUpdateRequested||(null===(r=this._updatingHandles)||void 0===r?void 0:r.updating)}attach(){const r=(0,us.C)();this._maxIndexedColormapSize=4*(r.maxTextureSize||4096),this._initializeTileInfo(),this._tileInfoView=new os.A(this.layerView.tileInfo,this.layerView.fullExtent);const t=this._computeFetchConcurrency();this._fetchQueue=new ls.A({tileInfoView:this._tileInfoView,concurrency:t,process:(i,a)=>this._fetchTile(i,a)});const s=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new we.A({cachePolicy:"purge",acquireTile:i=>this.acquireTile(i),releaseTile:i=>this.releaseTile(i),cacheSize:s,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,ne.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(r){const t=this.container.createTile(r);return this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(r){this._fetchQueue.abort(r.key.id),this.container.removeChild(r),r.once("detach",()=>{r.destroy(),this.layerView.requestUpdate()}),this.layerView.requestUpdate()}createEmptyTilePixelBlock(r=null){const t=null==r||r.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;r=r||this._tileInfoView.tileInfo.size;const[s,i]=r,a=new as.A({width:s,height:i,pixels:[new Uint8Array(s*i)],mask:new Uint8Array(s*i),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=a),a}_getBandIds(){if(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;const{bandIds:r,raster:t}=this.layer,s="rasterFunction"in t?t.rasterFunction.rawInputBandIds:null;return null!=r&&r.length&&null!=s&&s.length&&1!==t.rasterInfo.bandCount?r.map(i=>s[Math.min(i,s.length-1)]):r||s}updateRasterFunctionParameters(){}_fetchTile(r,t){const s=null!=t?t.signal:null,i=this.canUseWebGLForProcessing(),{layerView:a}=this,{tileInfo:o}=a,u=!o.isWrappable&&null!=(0,ue.FT)(a.view.spatialReference);return this.fetchTile(r,{allowPartialFill:!0,datumTransformation:a.datumTransformation,interpolation:i?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:i&&this.layer.raster.hasUniqueSourceStorageInfo,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:s,srcResolution:this._srcResolutions[r.level],timeExtent:a.timeExtent,tileInfo:o,disableWrapAround:u})}_getCacheSize(r){return r?40:0}_initializeTileInfo(){const{layerView:r}=this,t=r.view.spatialReference;if(this._canUseLayerLODs()){const{origin:R,lods:O}=this.layer.tileInfo,z=O.map(({scale:G})=>G),D=be.A.create({spatialReference:t,size:le.CQ,scales:z,origin:R});return r.set("tileInfo",D),void(this._srcResolutions=O.map(({resolution:G})=>({x:G,y:G})))}const{scales:s,srcResolutions:i,isCustomTilingScheme:a}=(0,ue.dK)(this.layer.serviceRasterInfo,t,{tileSize:le.CQ,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1}),o=be.A.create({spatialReference:t,size:le.CQ,scales:s}),u=0===o.origin.x,{xmin:p,ymax:g}=r.fullExtent;(u||a&&o.origin.x>p)&&(o.origin=new ns.A({x:p,y:g,spatialReference:t})),this._isCustomTilingScheme=a,r.set("tileInfo",o),this._srcResolutions=null!=i?i:[]}_canUseLayerLODs(){var r;const{layer:t,layerView:s}=this;if("Map"!==t.raster.tileType)return!1;const{lods:i}=t.tileInfo,a=null===(r=s.view.constraints)||void 0===r?void 0:r.effectiveLODs;return(null==a?void 0:a.length)===i.length&&a.every(({scale:o},u)=>Math.abs(o-i[u].scale)<.001)}_computeFetchConcurrency(){const{blockBoundary:r}=this.layer.serviceRasterInfo.storageInfo,t=r[r.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}_enqueueTileFetch(r,t){var s=this;return(0,I.A)(function*(){if(!s._fetchQueue.has(r.key.id)){try{const a=yield s._fetchQueue.push(r.key),o=s._getBandIds();let u=!s.useProgressiveUpdate||s.layerView.hasTilingEffects&&!s._globalSymbolizerParams;if(s._globalUpdateRequested&&!s.layerView.moving&&0===s._fetchQueue.length){u=!1;try{var i;yield s._redrawImage(null===(i=s._abortController)||void 0===i?void 0:i.signal)}catch(R){(0,V.zf)(R)&&F.A.getLogger(s).error(R)}s._globalUpdateRequested=!1}!s.canUseWebGLForProcessing()&&"rasterVF"!==s.type||s.layerView.hasTilingEffects||null!=s._symbolizerParams||s._updateSymbolizerParams();const p=s._tileInfoView.getTileCoords(ds,r.key),g=s._tileInfoView.getTileResolution(r.key);yield s.updateTileSource(r,{source:a,symbolizerParams:s._symbolizerParams,globalSymbolizerParams:s._globalSymbolizerParams,suspended:u,bandIds:o,coords:p,resolution:g}),r.once("attach",()=>s.layerView.requestUpdate()),s.container.addChild(r)}catch(a){(0,V.zf)(a)||F.A.getLogger(s).error(a)}s.layerView.requestUpdate()}})()}_redrawImage(r){var t=this;return(0,I.A)(function*(){if(0===t.container.children.length)return;yield t.layer.updateRenderer(),t.layerView.hasTilingEffects?yield t._updateGlobalSymbolizerParams(r):(t._updateSymbolizerParams(),t._globalSymbolizerParams=null);const s=t.container.children.map(function(){var i=(0,I.A)(function*(a){return t.updateTileSymbolizerParameters(a,{local:t._symbolizerParams,global:t._globalSymbolizerParams})});return function(a){return i.apply(this,arguments)}}());yield Promise.allSettled(s),t.container.requestRender()})()}_updateGlobalSymbolizerParams(r){var t=this;return(0,I.A)(function*(){const s={srcResolution:t._srcResolutions[t.previousLOD.level],registryId:t._blockCacheRegistryId,signal:r},i=yield t.layer.fetchPixels(t.layerView.view.extent,t.layerView.view.width,t.layerView.view.height,s);if(null==i||!i.pixelBlock)return;const{resolution:a}=t.previousLOD,o=t._getBandIds(),u=t.layer.symbolizer.generateWebGLParameters({pixelBlock:i.pixelBlock.extractBands(o),isGCS:t.layerView.view.spatialReference.isGeographic,resolution:{x:a,y:a},bandIds:o});!t.canUseWebGLForProcessing()&&u&&"stretch"===u.type&&t.layer.renderer&&"raster-stretch"===t.layer.renderer.type&&(u.factor=u.factor.map(p=>255*p),u.outMin=Math.round(255*u.outMin),u.outMax=Math.round(255*u.outMax)),t._globalSymbolizerParams=u})()}_updateSymbolizerParams(){const{resolution:r}=this.previousLOD,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:r,y:r},bandIds:t})}_updateBlockCacheRegistry(r=!1){const{layer:t,layerView:s}=this,{raster:i}=t,{multidimensionalDefinition:a}=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:s.timeExtent}),o=i.rasterInfo.multidimensionalInfo?i.getSliceIndex(a):null,u=(0,ne.ph)(i.rasterId,o);if(u!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,ne.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,ne.kz)(u,i.rasterInfo),r){const{view:p}=s,g=this._tileInfoView.getClosestInfoForScale(p.scale);(0,ne.yo)(u,this._blockCacheRegistryId,p.extent,p.resolution,this._srcResolutions[g.level],i.ioConfig.sampling)}this._blockCacheRegistryUrl=u}}doRefresh(){var r=this;return(0,I.A)(function*(){if(!r.attached||!r.previousLOD||r.layerView.suspended)return;yield r.layer.updateRenderer(),r.layerView.hasTilingEffects||r._updateSymbolizerParams(),r._updateBlockCacheRegistry(!0),r._fetchQueue.reset();const t=[];r._globalUpdateRequested=r.layerView.hasTilingEffects||!r.useProgressiveUpdate,r._tileStrategy.refresh(s=>t.push(r._enqueueTileFetch(s))),yield r._updatingHandles.addPromise(Promise.allSettled(t))})()}};(0,m._)([(0,P.MZ)()],q.prototype,"_globalUpdateRequested",void 0),(0,m._)([(0,P.MZ)()],q.prototype,"attached",void 0),(0,m._)([(0,P.MZ)()],q.prototype,"container",void 0),(0,m._)([(0,P.MZ)()],q.prototype,"layer",void 0),(0,m._)([(0,P.MZ)()],q.prototype,"layerView",void 0),(0,m._)([(0,P.MZ)()],q.prototype,"type",void 0),(0,m._)([(0,P.MZ)()],q.prototype,"useWebGLForProcessing",null),(0,m._)([(0,P.MZ)()],q.prototype,"useProgressiveUpdate",null),(0,m._)([(0,P.MZ)()],q.prototype,"timeExtent",void 0),(0,m._)([(0,P.MZ)()],q.prototype,"updating",null),q=(0,m._)([(0,S.$)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],q);var Me=l(62931),hs=l(75644);let ae=class extends q{constructor(){super(...arguments),this.type="raster"}attach(){super.attach(),this.container=new ss(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}canUseWebGLForProcessing(){var r;const{symbolizer:t}=this.layer,s=null===(r=t.lookup)||void 0===r||null===(r=r.colormapLut)||void 0===r?void 0:r.indexedColormap;return this.useWebGLForProcessing&&t.canRenderInWebGL&&!(s&&s.length>this._maxIndexedColormapSize)&&!("majority"===this.layer.interpolation&&(0,Me.H_)(this.layer))}fetchTile(r,t){return this.layer.fetchTile(r.level,r.row,r.col,t)}updateRasterFunctionParameters(){const{clips:r,view:t}=this.layerView;null!=this._geometry&&r.remove(this._geometry);const{raster:s,type:i}=this.layer;if("Function"===s.datasetFormat){const G=s.getClippingGeometry(t.spatialReference);if(G){const K=new hs.A({geometry:G});r.add(K),this._geometry=K}}const{container:a}=this;if("Function"!==s.datasetFormat||"wcs"===i)return a.rasterFunctionChain=null,a.children.forEach(G=>{const{bitmap:K}=G;K&&(K.suspended=!0,K.processed=!1,K.projected&&(K.invalidateTexture(),K.rasterTexture=null))}),void(this._rasterFunctionState="na");const o=this._rasterFunctionState,{rasterFunction:u,primaryRasters:p}=s,g=u.supportsGPU&&(!p||p.rasters.length<=1),R=g?u.flatWebGLFunctionChain:null,{renderer:O}=this.layer,z=!g||!(null!=R&&R.functions.length)||"raster-stretch"===(null==O?void 0:O.type)&&O.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();a.rasterFunctionChain=z?null:R;const D=null==u?"na":a.rasterFunctionChain?"gpu":"cpu";a.children.forEach(G=>{const{bitmap:K}=G;K&&(K.suspended=o!==D,K.processed=!1,K.processedTexture=null)}),this._rasterFunctionState=D}updateTileSource(r,t){var s=this;return(0,I.A)(function*(){const i=s._getBandIds(),a=s._getLayerInterpolation(),o=s.canUseWebGLForProcessing(),{source:u,globalSymbolizerParams:p,suspended:g,coords:R,resolution:O}=t,z=s.layerView.hasTilingEffects?p:t.symbolizerParams,{bitmap:D}=r;if([D.x,D.y]=R,D.resolution=O,null!=(null==u?void 0:u.pixelBlock)){const G={extent:u.extent,pixelBlock:u.pixelBlock,srcPixelSize:u.srcTilePixelSize};if(D.rawPixelData=G,o)D.source=u.pixelBlock,D.isRendereredSource=!1;else{const K=yield s.layer.applyRenderer(G,"stretch"===(null==p?void 0:p.type)?p:void 0);D.source=K,D.isRendereredSource=!0}D.symbolizerParameters=o?z:null,D.transformGrid=o?u.transformGrid:null}else{const G=s.createEmptyTilePixelBlock();D.source=G,D.symbolizerParameters=o?z:null,D.transformGrid=null}D.bandIds=o?i:null,D.width=s._tileInfoView.tileInfo.size[0],D.height=s._tileInfoView.tileInfo.size[1],D.interpolation=a,D.suspended=g,D.invalidateTexture()})()}updateTileSymbolizerParameters(r,t){var s=this;return(0,I.A)(function*(){const{local:i,global:a}=t,o=s._getBandIds(),u=s._getLayerInterpolation(),p=s.canUseWebGLForProcessing(),{bitmap:g}=r,{rawPixelData:R}=g;p||null==R?(g.isRendereredSource&&null!=R&&(g.source=R.pixelBlock),g.isRendereredSource=!1):(g.source=yield s.layer.applyRenderer(R,"stretch"===(null==a?void 0:a.type)?a:void 0),g.isRendereredSource=!0),g.symbolizerParameters=p?s.layerView.hasTilingEffects?a:i:null,g.bandIds=p?o:null,g.interpolation=u,g.suspended=!1})()}_getLayerInterpolation(){const{interpolation:r,renderer:t}=this.layer;if(!t)return r;const s=t.type;return"raster-colormap"===s||"unique-value"===s||"class-breaks"===s?"nearest":"raster-stretch"===t.type&&null!=t.colorRamp?"bilinear"===r||"cubic"===r?"bilinear":"nearest":r}};(0,m._)([(0,P.MZ)()],ae.prototype,"container",void 0),(0,m._)([(0,P.MZ)()],ae.prototype,"layer",void 0),(0,m._)([(0,P.MZ)()],ae.prototype,"type",void 0),ae=(0,m._)([(0,S.$)("esri.views.2d.layers.imagery.ImageryTileView2D")],ae);const ps=ae;var ms=l(50444),fs=l(21941),vs=l(74856);class gs extends xe.Y{constructor(t,s,i,a,o,u,p=null){super(t,s,i,a,o,u),this.tileData=new vs.X(p),this.tileData.coordScale=[o,u],this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(t){this.tileData.stencilRef=t}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:(0,L.vt)(),tileMat3:(0,L.vt)()}}setTransform(t){super.setTransform(t);const s=this.resolution/(t.resolution*t.pixelRatio),i=this.transforms.tileMat3,[a,o]=this.tileData.offset,u=[this.x+a*this.resolution,this.y-o*this.resolution],[p,g]=t.toScreenNoRotation([0,0],u),{symbolTileSize:R}=this.tileData.symbolizerParameters,O=Math.round((this.width-this.tileData.offset[0])/R)*R,z=Math.round((this.height-this.tileData.offset[1])/R)*R;(0,E.hZ)(i,O/this.rangeX*s,0,0,0,z/this.rangeY*s,0,p,g,1),(0,E.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,i),this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}class _s extends Te.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(t){const s=this._tileInfoView.getTileBounds((0,U.vt)(),t),[i,a]=this._tileInfoView.tileInfo.size,o=this._tileInfoView.getTileResolution(t.level);return new gs(t,o,s[0],s[3],i,a)}prepareRenderPasses(t){const s=t.registerRenderPass({name:"imagery (vf tile)",brushes:[fs.A],target:()=>this.children.map(i=>i.tileData),drawPhase:de.S5.MAP});return[...super.prepareRenderPasses(t),s]}doRender(t){this.visible&&t.drawPhase===de.S5.MAP&&this.symbolTypes.forEach(s=>{t.renderPass=s,super.doRender(t)})}}let oe=class extends q{constructor(){super(...arguments),this._handle=null,this.type="rasterVF"}canUseWebGLForProcessing(){return!1}fetchTile(r,t){var s=this;return(0,I.A)(function*(){t={...t,interpolation:"nearest",requestProjectedLocalDirections:!0};const i=yield s.layer.fetchTile(r.level,r.row,r.col,t);return"vector-magdir"===s.layer.serviceRasterInfo.dataType&&null!=i&&i.pixelBlock&&(i.pixelBlock=yield s.layer.convertVectorFieldData(i.pixelBlock,t)),i})()}updateTileSource(r,t){const s=t.symbolizerParams,{tileData:i}=r;i.key=r.key,i.width=this._tileInfoView.tileInfo.size[0],i.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:a}=s,{source:o}=t;if(i.offset=this._getTileSymbolOffset(i.key,a),null!=(null==o?void 0:o.pixelBlock))i.rawPixelData={extent:o.extent,pixelBlock:o.pixelBlock},i.symbolizerParameters=s,i.source=this._sampleVectorFieldData(o.pixelBlock,s,i.offset);else{const u=[Math.round((this._tileInfoView.tileInfo.size[0]-i.offset[0])/a),Math.round((this._tileInfoView.tileInfo.size[1]-i.offset[1])/a)],p=this.createEmptyTilePixelBlock(u);i.source=p,i.symbolizerParameters=s}return i.invalidateVAO(),Promise.resolve()}updateTileSymbolizerParameters(r,t){var s;const i=t.local,{symbolTileSize:a}=i,{tileData:o}=r;o.offset=this._getTileSymbolOffset(o.key,a);const u=o.symbolizerParameters.symbolTileSize;o.symbolizerParameters=i;const p=null===(s=o.rawPixelData)||void 0===s?void 0:s.pixelBlock;return null!=p&&u!==a&&(o.source=this._sampleVectorFieldData(p,o.symbolizerParameters,o.offset)),Promise.resolve()}attach(){super.attach(),this.container=new _s(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,W.wB)(()=>this.layer.renderer,r=>this._updateSymbolType(r))}detach(){var r;super.detach(),this.container.removeAllChildren(),null!==(r=this._handle)&&void 0!==r&&r.remove(),this._handle=null,this.container=null}_getTileSymbolOffset(r,t){const s=r.col*this._tileInfoView.tileInfo.size[0]%t,i=r.row*this._tileInfoView.tileInfo.size[1]%t;return[s>t/2?t-s:-s,i>t/2?t-i:-i]}_sampleVectorFieldData(r,t,s){const{symbolTileSize:i}=t;return(0,ms.Wu)(r,"vector-uv",i,s)}_updateSymbolType(r){"vector-field"===r.type&&(this.container.symbolTypes="wind-barb"===r.style?["scalar","triangle"]:"simple-scalar"===r.style?["scalar"]:["triangle"])}};(0,m._)([(0,P.MZ)()],oe.prototype,"container",void 0),(0,m._)([(0,P.MZ)()],oe.prototype,"layer",void 0),(0,m._)([(0,P.MZ)()],oe.prototype,"type",void 0),oe=(0,m._)([(0,S.$)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],oe);const ys=oe;var Ps=l(81098),Re=l(5922),xs=l(81687),Ts=l(64935);const bs=r=>{let t=class extends r{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return(0,ue.eh)(this.layer.serviceRasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return(0,ue.vI)(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(s){return!!(0,ue.eh)(this.layer.serviceRasterInfo,s)}fetchPopupFeaturesAtLocation(s,i){var a=this;return(0,I.A)(function*(){const{layer:o}=a;if(!s)throw new Re.A("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:o});const{popupEnabled:u}=o,p=(0,Ts.D8)(o,i);if(!u||null==p)throw new Re.A("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:u,popupTemplate:p});const g=[],{value:R,magdirValue:O,processedValue:z}=yield o.identify(s,{timeExtent:a.timeExtent,signal:null==i?void 0:i.signal});let D="";if(R&&R.length){D="imagery-tile"===o.type&&o.hasStandardTime()&&null!=R[0]?R.map(fe=>o.getStandardTimeValue(fe)).join(", "):R.join(", ");const G={ObjectId:0},K="Raster.ServicePixelValue";G[K]="imagery-tile"===o.type&&"Function"===o.raster.datasetFormat?null==z?void 0:z.join(", "):D,G[K+".Raw"]=D;const Se=o.serviceRasterInfo.attributeTable;if(null!=Se){const{fields:fe,features:Ss}=Se,Ie=fe.find(({name:ie})=>"value"===ie.toLowerCase()),pe=Ie?Ss.find(ie=>String(ie.attributes[Ie.name])===D):null;if(pe)for(const ie in pe.attributes)pe.attributes.hasOwnProperty(ie)&&(G[a._rasterFieldPrefix+ie]=pe.attributes[ie])}const Ue=o.serviceRasterInfo.dataType;"vector-magdir"!==Ue&&"vector-uv"!==Ue||(G["Raster.Magnitude"]=null==O?void 0:O[0],G["Raster.Direction"]=null==O?void 0:O[1]);const he=new Ps.A(a.fullExtent.clone(),null,G);he.layer=o,he.sourceLayer=he.layer,g.push(he)}return g})()}};return(0,m._)([(0,P.MZ)()],t.prototype,"layer",void 0),(0,m._)([(0,P.MZ)(xs.ui)],t.prototype,"timeExtent",void 0),(0,m._)([(0,P.MZ)()],t.prototype,"view",void 0),(0,m._)([(0,P.MZ)()],t.prototype,"fullExtent",null),(0,m._)([(0,P.MZ)()],t.prototype,"tileInfo",void 0),(0,m._)([(0,P.MZ)({readOnly:!0})],t.prototype,"hasTilingEffects",null),(0,m._)([(0,P.MZ)()],t.prototype,"datumTransformation",null),t=(0,m._)([(0,S.$)("esri.views.layers.ImageryTileLayerView")],t),t};var ws=l(41474),Ms=l(96081);let re=class extends(bs((0,Ms.A)((0,Q.e)(ws.A)))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(r){this._useWebGLForProcessing=r,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=r)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(r){this._useProgressiveUpdate=r,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=r)}get displayParameters(){const{layer:r}=this,t=this._get("displayParameters");return r.renderer?{bandIds:r.bandIds,renderer:r.renderer,interpolation:r.interpolation,multidimensionalDefinition:r.multidimensionalDefinition,rasterFunction:"imagery-tile"===r.type?r.rasterFunction:null}:t}update(r){var t;null!==(t=this.subview)&&void 0!==t&&t.update(r),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([(0,W.wB)(()=>this.displayParameters,(r,t)=>{const s=r.interpolation!==(null==t?void 0:t.interpolation)&&("majority"===r.interpolation||"majority"===(null==t?void 0:t.interpolation))&&(0,Me.H_)(this.layer),i=r.renderer!==(null==t?void 0:t.renderer)&&this._getSubviewType(null==t?void 0:t.renderer)!==this._getSubviewType(r.renderer);i&&this._updateSubview();const o=r.rasterFunction!==(null==t?void 0:t.rasterFunction);this.subview.redrawOrRefetch({refetch:r.multidimensionalDefinition!==(null==t?void 0:t.multidimensionalDefinition)||s||i||o&&!this._useWebGLForProcessing,reprocess:o}).catch(g=>{(0,V.zf)(g)||F.A.getLogger(this).error(g)}),this.notifyChange("updating")}),(0,W.wB)(()=>{var r;return null!==(r=this.layer.multidimensionalSubset)&&void 0!==r?r:null},(r,t)=>{const{multidimensionalDefinition:s}=this.layer;null!=s&&(0,A.sx)(s,r)!==(0,A.sx)(s,t)&&(this.subview.redrawOrRefetch({refetch:!0}).catch(i=>{(0,V.zf)(i)||F.A.getLogger(this).error(i)}),this.notifyChange("updating"))},W.OH),(0,W.wB)(()=>this.timeExtent,()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch({refetch:!0}).catch(r=>{(0,V.zf)(r)||F.A.getLogger(this).error(r)})},W.Vh)])}detach(){var r;this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null!==(r=this.subview)&&void 0!==r&&r.destroy(),this.subview=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}doRefresh(){return this.subview?this.subview.doRefresh():Promise.resolve()}_updateSubview(){const{renderer:r}=this.layer;if(!r)return;const t=this._getSubviewType(r);if(this.subview){var s;if(this.subview.type===t)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null!==(s=this.subview)&&void 0!==s&&s.destroy(),this.subview=null}const{layer:i}=this;let a;if(a="rasterVF"===t?new ys({layer:i,layerView:this}):"flow"===t?new j.A({layer:i,layerView:this}):new ps({layer:i,layerView:this}),"useWebGLForProcessing"in a&&(a.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in a&&(a.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in a){const{subview:o}=this;a.previousLOD=o&&"previousLOD"in o?o.previousLOD:null}this._attachSubview(a),this.subview=a,this.requestUpdate()}_attachSubview(r){r&&!r.attached&&(r.attach(),r.attached=!0,this.container.addChildAt(r.container,0))}_detachSubview(r){null!=r&&r.attached&&(this.container.removeChild(r.container),r.detach(),r.attached=!1)}_getSubviewType(r){const t=null==r?void 0:r.type;return"vector-field"===t?"rasterVF":"flow"===t?"flow":"raster"}};(0,m._)([(0,P.MZ)()],re.prototype,"subview",void 0),(0,m._)([(0,P.MZ)()],re.prototype,"useWebGLForProcessing",null),(0,m._)([(0,P.MZ)()],re.prototype,"useProgressiveUpdate",null),(0,m._)([(0,P.MZ)({readOnly:!0})],re.prototype,"displayParameters",null),re=(0,m._)([(0,S.$)("esri.views.2d.layers.ImageryTileLayerView2D")],re);const Rs=re},29459:(ee,$,l)=>{l.d($,{e:()=>y});var w,m=l(8189),F=l(31178),V=l(5605),W=l(5922),P=l(48900),B=l(85211),j=(l(3248),l(35150),l(40707),l(76576)),Q=l(40856),I=l(88766),U=l(60746),N=l(66727);let E=w=class extends N.A{constructor(T){super(T),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new w({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,m._)([(0,B.MZ)({type:[Number,String],json:{write:!0}})],E.prototype,"left",void 0),(0,m._)([(0,B.MZ)({type:[Number,String],json:{write:!0}})],E.prototype,"right",void 0),(0,m._)([(0,B.MZ)({type:[Number,String],json:{write:!0}})],E.prototype,"top",void 0),(0,m._)([(0,B.MZ)({type:[Number,String],json:{write:!0}})],E.prototype,"bottom",void 0),E=w=(0,m._)([(0,j.$)("esri.views.layers.support.ClipRect")],E);const L=E;var Z=l(75644);let se=class extends N.A{constructor(T){super(T),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,m._)([(0,B.MZ)({type:[[[Number]]],json:{write:!0}})],se.prototype,"path",void 0),se=(0,m._)([(0,j.$)("esri.views.layers.support.Path")],se);const c=F.A.ofType({key:"type",base:null,typeMap:{rect:L,path:se,geometry:Z.A}}),y=T=>{let f=class extends T{constructor(){super(...arguments),this.attached=!1,this.clips=new c,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this.visibleAtCurrentScale=!1,this.highlightOptions=null}initialize(){var d,v,_,x;const M=null===(d=null===(v=this.view)||void 0===v?void 0:v.spatialReferenceLocked)||void 0===d||d;(null===(_=this.view)||void 0===_?void 0:_.spatialReference)&&M&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new W.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new I.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,P.wB)(()=>this.suspended,C=>{this.container&&(this.container.visible=!C)},P.pc),(0,P.wB)(()=>this.updateSuspended,C=>{this.view&&!C&&this.updateRequested&&this.view.requestUpdate()},P.pc),(0,P.wB)(()=>{var C,H;return null!==(C=null===(H=this.layer)||void 0===H?void 0:H.opacity)&&void 0!==C?C:1},C=>{this.container&&(this.container.opacity=C)},P.pc),(0,P.wB)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",C=>{this.container&&(this.container.blendMode=C)},P.pc),(0,P.wB)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,C=>{this.container&&(this.container.effect=C)},P.pc),(0,P.wB)(()=>this.highlightOptions,C=>this.container.highlightOptions=C,P.pc),(0,P.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},P.pc),(0,P.wB)(()=>{var C;return{scale:null===(C=this.view)||void 0===C?void 0:C.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}},({scale:C})=>{const H=null!=C&&this.isVisibleAtScale(C);H!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",H)},P.pc)],"constructor"),null!==(x=this.view)&&void 0!==x&&x.whenLayerView?this.view.whenLayerView(this.layer).then(C=>{C===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var d;const v=null===(d=this.view)||void 0===d?void 0:d.spatialReference;return null==v||this.supportsSpatialReference(v)}get updateSuspended(){return this.suspended}get updating(){var d;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(d=this._updatingHandles)||void 0===d||!d.updating))}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(d){const v=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!v)return!0;const{minScale:_,maxScale:x}=v;return(0,Q.zx)(d,_,x)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(d){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",d),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(d))):this.updateRequested=!1}hitTest(d,v){return Promise.resolve(null)}supportsSpatialReference(d){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const d=super.getSuspendInfo(),v=!this.spatialReferenceSupported,_=this.visibleAtCurrentScale;return v&&(d.spatialReferenceNotSupported=v),_&&(d.outsideScaleRange=_),d}addAttachHandles(d){this.addHandles(d,"attach")}};return(0,m._)([(0,B.MZ)()],f.prototype,"attached",void 0),(0,m._)([(0,B.MZ)({type:c,set(d){const v=(0,V.V)(d,this._get("clips"),c);this._set("clips",v)}})],f.prototype,"clips",void 0),(0,m._)([(0,B.MZ)()],f.prototype,"container",void 0),(0,m._)([(0,B.MZ)()],f.prototype,"moving",void 0),(0,m._)([(0,B.MZ)({readOnly:!0})],f.prototype,"spatialReferenceSupported",null),(0,m._)([(0,B.MZ)({readOnly:!0})],f.prototype,"updateParameters",void 0),(0,m._)([(0,B.MZ)()],f.prototype,"updateRequested",void 0),(0,m._)([(0,B.MZ)()],f.prototype,"updateSuspended",null),(0,m._)([(0,B.MZ)()],f.prototype,"updating",null),(0,m._)([(0,B.MZ)()],f.prototype,"view",void 0),(0,m._)([(0,B.MZ)({readOnly:!0})],f.prototype,"visibleAtCurrentScale",void 0),(0,m._)([(0,B.MZ)({type:U.A})],f.prototype,"highlightOptions",void 0),f=(0,m._)([(0,j.$)("esri.views.2d.layers.LayerView2D")],f),f}},41474:(ee,$,l)=>{l.d($,{A:()=>N});var m=l(8189),F=l(98877),V=l(42425),W=l(3046),P=l(35150),B=l(11432),Y=l(64261),S=l(85211),Q=(l(3248),l(40707),l(76576)),I=l(56985);let U=class extends((0,W.sA)((0,Y.g)(V.A.EventedMixin(F.A)))){constructor(w){super(w),this._updatingHandles=new I.U,this.layer=null,this.parent=null}initialize(){this.when().catch(w=>{if("layerview:create-error"!==w.name){var E;const L=this.layer&&this.layer.id||"no id",Z=(null===(E=this.layer)||void 0===E?void 0:E.title)||"no title";P.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${Z}', id: '${L}')`,w)}})}destroy(){this._updatingHandles=(0,B.pR)(this._updatingHandles)}get fullOpacity(){var w,E,L,Z;return(null!==(w=null===(E=this.layer)||void 0===E?void 0:E.opacity)&&void 0!==w?w:1)*(null!==(L=null===(Z=this.parent)||void 0===Z?void 0:Z.fullOpacity)&&void 0!==L?L:1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var w;return!this.suspended&&!0===(null===(w=this.layer)||void 0===w?void 0:w.legendEnabled)}get updating(){var w;return!!(null!==(w=this._updatingHandles)&&void 0!==w&&w.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var w;return!0===(null===(w=this.layer)||void 0===w?void 0:w.visible)}set visible(w){this._overrideIfSome("visible",w)}canResume(){var w,E,L;return this.visible&&(null===(w=this.layer)||void 0===w?void 0:w.loaded)&&!(null!==(E=this.parent)&&void 0!==E&&E.suspended)&&(null===(L=this.view)||void 0===L?void 0:L.ready)||!1}getSuspendInfo(){var w,E;const L=null!==(w=this.parent)&&void 0!==w&&w.suspended?this.parent.suspendInfo:{};return null!==(E=this.view)&&void 0!==E&&E.ready||(L.viewNotReady=!0),this.layer&&this.layer.loaded||(L.layerNotLoaded=!0),this.visible||(L.layerInvisible=!0),L}isUpdating(){return!1}};(0,m._)([(0,S.MZ)()],U.prototype,"fullOpacity",null),(0,m._)([(0,S.MZ)()],U.prototype,"layer",void 0),(0,m._)([(0,S.MZ)()],U.prototype,"parent",void 0),(0,m._)([(0,S.MZ)({readOnly:!0})],U.prototype,"suspended",null),(0,m._)([(0,S.MZ)({readOnly:!0})],U.prototype,"suspendInfo",null),(0,m._)([(0,S.MZ)({readOnly:!0})],U.prototype,"legendEnabled",null),(0,m._)([(0,S.MZ)({type:Boolean,readOnly:!0})],U.prototype,"updating",null),(0,m._)([(0,S.MZ)({readOnly:!0})],U.prototype,"updatingProgress",null),(0,m._)([(0,S.MZ)()],U.prototype,"visible",null),(0,m._)([(0,S.MZ)()],U.prototype,"view",void 0),U=(0,m._)([(0,Q.$)("esri.views.layers.LayerView")],U);const N=U},66727:(ee,$,l)=>{l.d($,{A:()=>A});var m=l(8189),F=l(71065),V=l(85211),Y=(l(3248),l(35150),l(40707),l(76576));let S=class extends F.oY{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,m._)([(0,V.MZ)({readOnly:!0})],S.prototype,"version",null),S=(0,m._)([(0,Y.$)("esri.views.layers.support.ClipArea")],S);const A=S},75644:(ee,$,l)=>{l.d($,{A:()=>E});var U,m=l(8189),V=(l(21152),l(85211)),Y=(l(3248),l(35150),l(40707),l(76576)),S=l(68643),A=l(61320),j=l(66727),Q=l(28067),I=l(55861);const N={base:S.A,key:"type",typeMap:{extent:Q.A,polygon:I.A}};let w=U=class extends j.A{constructor(L){super(L),this.type="geometry",this.geometry=null}clone(){var L,Z;return new U({geometry:null!==(L=null===(Z=this.geometry)||void 0===Z?void 0:Z.clone())&&void 0!==L?L:null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,m._)([(0,V.MZ)({types:N,json:{read:A.rS,write:!0}})],w.prototype,"geometry",void 0),w=U=(0,m._)([(0,Y.$)("esri.views.layers.support.Geometry")],w);const E=w}}]);