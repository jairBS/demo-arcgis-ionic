"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8295],{13869:(P,I,_)=>{function m(w,d){const v=w.count;d||(d=new w.TypedArrayConstructor(v));for(let g=0;g<v;g++)d[g]=w.get(g);return d}_.d(I,{m:()=>m}),Object.freeze(Object.defineProperty({__proto__:null,makeDense:m},Symbol.toStringTag,{value:"Module"}))},23225:(P,I,_)=>{_.d(I,{a:()=>O,f:()=>d,n:()=>w});var m=_(79139);function O(g,u){w(g.typedBuffer,u.typedBuffer,g.typedBufferStride,u.typedBufferStride)}function w(g,u,p=2,c=p){const s=u.length/2;let n=0,l=0;if((0,m.cy)(u)||(0,m.dk)(u)){for(let h=0;h<s;++h)g[n]=u[l],g[n+1]=u[l+1],n+=p,l+=c;return}const f=(0,m.a3)(u);if((0,m.JI)(u))for(let h=0;h<s;++h)g[n]=Math.max(u[l]/f,-1),g[n+1]=Math.max(u[l+1]/f,-1),n+=p,l+=c;else for(let h=0;h<s;++h)g[n]=u[l]/f,g[n+1]=u[l+1]/f,n+=p,l+=c}function d(g,u,p,c){var s,n;const l=g.typedBuffer,f=g.typedBufferStride,h=null!==(s=null==c?void 0:c.count)&&void 0!==s?s:g.count;let y=(null!==(n=null==c?void 0:c.dstIndex)&&void 0!==n?n:0)*f;for(let A=0;A<h;++A)l[y]=u,l[y+1]=p,y+=f}Object.freeze(Object.defineProperty({__proto__:null,fill:d,normalizeIntegerBuffer:w,normalizeIntegerBufferView:O},Symbol.toStringTag,{value:"Module"}))},18201:(P,I,_)=>{function m(v,g){O(v.typedBuffer,g.typedBuffer,v.typedBufferStride,g.typedBufferStride)}function O(v,g,u=3,p=u){const c=g.length/p;let s=0,n=0;for(let l=0;l<c;++l)v[s]=g[n],v[s+1]=g[n+1],v[s+2]=g[n+2],s+=u,n+=p}function w(v,g,u,p,c){var s,n;const l=v.typedBuffer,f=v.typedBufferStride,h=null!==(s=null==c?void 0:c.count)&&void 0!==s?s:v.count;let y=(null!==(n=null==c?void 0:c.dstIndex)&&void 0!==n?n:0)*f;for(let A=0;A<h;++A)l[y]=g,l[y+1]=u,l[y+2]=p,y+=f}_.d(I,{a:()=>m,c:()=>O,f:()=>w}),Object.freeze(Object.defineProperty({__proto__:null,copy:O,copyView:m,fill:w},Symbol.toStringTag,{value:"Module"}))},30483:(P,I,_)=>{_.d(I,{a:()=>w,b:()=>g,n:()=>v,s:()=>u,t:()=>d});var m=_(96196);function w(c,s,n){d(c.typedBuffer,s.typedBuffer,n,c.typedBufferStride,s.typedBufferStride)}function d(c,s,n,l=4,f=l){if(c.length/l!=s.length/f)return void(0,m.j)().error("source and destination buffers need to have the same number of elements");const h=c.length/l,y=n[0],A=n[1],C=n[2],B=n[3],L=n[4],U=n[5],G=n[6],K=n[7],V=n[8];let H=0,F=0;for(let Q=0;Q<h;Q++){const X=s[H],Y=s[H+1],j=s[H+2],J=s[H+3];c[F]=y*X+B*Y+G*j,c[F+1]=A*X+L*Y+K*j,c[F+2]=C*X+U*Y+V*j,c[F+3]=J,H+=f,F+=l}}function v(c,s){const n=Math.min(c.count,s.count),l=c.typedBuffer,f=c.typedBufferStride,h=s.typedBuffer,y=s.typedBufferStride;for(let A=0;A<n;A++){const C=A*f,B=A*y,L=h[B],U=h[B+1],G=h[B+2],K=L*L+U*U+G*G;if(K>0){const V=1/Math.sqrt(K);l[C]=V*L,l[C+1]=V*U,l[C+2]=V*G}}}function g(c,s,n){u(c.typedBuffer,s,n,c.typedBufferStride)}function u(c,s,n,l=4){const f=Math.min(c.length/l,s.count),h=s.typedBuffer,y=s.typedBufferStride;let A=0,C=0;for(let B=0;B<f;B++)c[C]=n*h[A],c[C+1]=n*h[A+1],c[C+2]=n*h[A+2],c[C+3]=n*h[A+3],A+=y,C+=l}Object.freeze(Object.defineProperty({__proto__:null,normalize:v,scale:u,scaleView:g,transformMat3:d,transformMat3View:w,transformMat4:function O(c,s,n){if(c.count!==s.count)return void(0,m.j)().error("source and destination buffers need to have the same number of elements");const l=c.count,f=n[0],h=n[1],y=n[2],A=n[3],C=n[4],B=n[5],L=n[6],U=n[7],G=n[8],K=n[9],V=n[10],H=n[11],F=n[12],Q=n[13],X=n[14],Y=n[15],j=c.typedBuffer,J=c.typedBufferStride,W=s.typedBuffer,D=s.typedBufferStride;for(let $=0;$<l;$++){const Z=$*J,z=$*D,q=W[z],ee=W[z+1],te=W[z+2],re=W[z+3];j[Z]=f*q+C*ee+G*te+F*re,j[Z+1]=h*q+B*ee+K*te+Q*re,j[Z+2]=y*q+L*ee+V*te+X*re,j[Z+3]=A*q+U*ee+H*te+Y*re}}},Symbol.toStringTag,{value:"Module"}))},25590:(P,I,_)=>{function m(v,g){O(v.typedBuffer,g,v.typedBufferStride)}function O(v,g,u=4){const p=g.typedBuffer,c=g.typedBufferStride,s=g.count;let n=0,l=0;for(let f=0;f<s;++f)v[n]=p[l],v[n+1]=p[l+1],v[n+2]=p[l+2],v[n+3]=p[l+3],n+=u,l+=c}function w(v,g,u,p,c,s){var n,l;const f=v.typedBuffer,h=v.typedBufferStride,y=null!==(n=null==s?void 0:s.count)&&void 0!==n?n:v.count;let A=(null!==(l=null==s?void 0:s.dstIndex)&&void 0!==l?l:0)*h;for(let C=0;C<y;++C)f[A]=g,f[A+1]=u,f[A+2]=p,f[A+3]=c,A+=h}_.d(I,{a:()=>m,c:()=>O,f:()=>w}),Object.freeze(Object.defineProperty({__proto__:null,copy:O,copyView:m,fill:w},Symbol.toStringTag,{value:"Module"}))},44703:(P,I,_)=>{function m(v){switch(v){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}_.d(I,{GJ:()=>m})},85303:(P,I,_)=>{_.d(I,{R:()=>u});var m=_(10467),O=_(89563),w=_(89447),d=_(5922),v=_(56492),g=_(45272);class u{constructor(s){this._streamDataRequester=s}loadJSON(s,n){var l=this;return(0,m.A)(function*(){return l._load("json",s,n)})()}loadBinary(s,n){var l=this;return(0,m.A)(function*(){return(0,g.DB)(s)?((0,v.Te)(n),(0,g.lJ)(s)):l._load("binary",s,n)})()}loadImage(s,n){var l=this;return(0,m.A)(function*(){return l._load("image",s,n)})()}_load(s,n,l){var f=this;return(0,m.A)(function*(){if(null==f._streamDataRequester)return(yield(0,O.A)(n,{responseType:p[s]})).data;const h=yield(0,w.Ke)(f._streamDataRequester.request(n,s,l));if(!0===h.ok)return h.value;throw(0,v.QP)(h.error),new d.A("",`Request for resource failed: ${h.error}`)})()}}const p={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},61362:(P,I,_)=>{_.d(I,{x:()=>d});var m=_(79139),O=_(83034),w=_(50915);function d(p,c){switch(c){case w.WR.TRIANGLES:return function v(p){return"number"==typeof p?(0,O.tM)(p):(0,m.mg)(p)?new Uint16Array(p):p}(p);case w.WR.TRIANGLE_STRIP:return function g(p){const c="number"==typeof p?p:p.length;if(c<3)return[];const s=c-2,n=(0,O.my)(3*s);if("number"==typeof p){let l=0;for(let f=0;f<s;f+=1)f%2==0?(n[l++]=f,n[l++]=f+1,n[l++]=f+2):(n[l++]=f+1,n[l++]=f,n[l++]=f+2)}else{let l=0;for(let f=0;f<s;f+=1)f%2==0?(n[l++]=p[f],n[l++]=p[f+1],n[l++]=p[f+2]):(n[l++]=p[f+1],n[l++]=p[f],n[l++]=p[f+2])}return n}(p);case w.WR.TRIANGLE_FAN:return function u(p){const c="number"==typeof p?p:p.length;if(c<3)return new Uint16Array(0);const s=c-2,n=s<=65536?new Uint16Array(3*s):new Uint32Array(3*s);if("number"==typeof p){let y=0;for(let A=0;A<s;++A)n[y++]=0,n[y++]=A+1,n[y++]=A+2;return n}const l=p[0];let f=p[1],h=0;for(let y=0;y<s;++y){const A=p[y+2];n[h++]=l,n[h++]=f,n[h++]=A,f=A}return n}(p)}}},39690:(P,I,_)=>{_.d(I,{KB:()=>g,Xi:()=>d,pn:()=>p,x3:()=>v});var m=_(10467),O=_(3248),w=_(67496);class d{constructor(n){this.data=n,this.type="encoded-mesh-texture",this.encoding=w.JS.KTX2_ENCODING}}function v(s){return"encoded-mesh-texture"===(null==s?void 0:s.type)}function g(s){return u.apply(this,arguments)}function u(){return(u=(0,m.A)(function*(s){const n=new Blob([s]),l=yield n.text();return JSON.parse(l)})).apply(this,arguments)}function p(s,n){return c.apply(this,arguments)}function c(){return(c=(0,m.A)(function*(s,n){if(n===w.JS.KTX2_ENCODING)return new d(s);const l=new Blob([s],{type:n}),f=URL.createObjectURL(l),h=new Image;if((0,O.A)("esri-iPhone"))return new Promise((y,A)=>{const C=()=>{L(),y(h)},B=U=>{L(),A(U)},L=()=>{URL.revokeObjectURL(f),h.removeEventListener("load",C),h.removeEventListener("error",B)};h.addEventListener("load",C),h.addEventListener("error",B),h.src=f});try{h.src=f,yield h.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(f),h})).apply(this,arguments)}},52867:(P,I,_)=>{_.d(I,{y:()=>Te});var L,U,i,m=_(10467),O=_(35150),w=_(62789),d=_(50915),u=_(5922),p=_(60797),c=_(56492),s=_(45272),n=_(43420),l=_(92771),f=_(19890),h=_(14214),y=_(45434),A=_(13869);_(3248);class B{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}}(i=L||(L={})).SCALAR="SCALAR",i.VEC2="VEC2",i.VEC3="VEC3",i.VEC4="VEC4",i.MAT2="MAT2",i.MAT3="MAT3",i.MAT4="MAT4",function(i){i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(U||(U={}));var G=_(69690);const K={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},V={pbrMetallicRoughness:K,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},H={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},F=(i={})=>{const e={...K,...i.pbrMetallicRoughness},r=function Q(i){switch(i.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,G.Xb)(i.ESRI_externalColorMixMode),i.ESRI_externalColorMixMode="tint"}return i}({...H,...i.extras});return{...V,...i,pbrMetallicRoughness:e,extras:r}},X={magFilter:d.Cj.LINEAR,minFilter:d.Cj.LINEAR_MIPMAP_LINEAR,wrapS:d.pF.REPEAT,wrapT:d.pF.REPEAT};var J=_(39690);class D{constructor(e,r,o,t){if(this._context=e,this.uri=r,this.json=o,this._glbBuffer=t,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=function j(i){let e,r;return i.replace(/^(.*\/)?([^/]*)$/,(o,t,a)=>(e=t||"",r=a||"","")),{dirPart:e,filePart:r}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),null==o.scenes)throw new u.A("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==o.meshes)throw new u.A("gltf-loader-unsupported-feature","Meshes must be defined");if(null==o.nodes)throw new u.A("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static load(e,r,o){var t=this;return(0,m.A)(function*(){if((0,s.DB)(r)){const b=(0,s.r$)(r);if(b&&"model/gltf-binary"!==b.mediaType)try{const E=JSON.parse(b.isBase64?atob(b.data):b.data);return new D(e,r,E)}catch{}const x=(0,s.lJ)(r);if(D._isGLBData(x))return t._fromGLBData(e,r,x)}if(re.test(r)||"gltf"===(null==o?void 0:o.expectedType)){const b=yield e.loadJSON(r,o);return new D(e,r,b)}const a=yield e.loadBinary(r,o);if(D._isGLBData(a))return t._fromGLBData(e,r,a);if(ye.test(r)||"glb"===(null==o?void 0:o.expectedType))throw new u.A("gltf-loader-invalid-glb","This is not a valid glb file.");const T=yield e.loadJSON(r,o);return new D(e,r,T)})()}static _isGLBData(e){if(null==e)return!1;const r=new B(e);return r.remainingBytes()>=4&&1179937895===r.readUint32()}static _fromGLBData(e,r,o){return(0,m.A)(function*(){const t=yield D._parseGLBData(o);return new D(e,r,t.json,t.binaryData)})()}static _parseGLBData(e){return(0,m.A)(function*(){const r=new B(e);if(r.remainingBytes()<12)throw new u.A("gltf-loader-error","glb binary data is insufficiently large.");const o=r.readUint32(),t=r.readUint32(),a=r.readUint32();if(1179937895!==o)throw new u.A("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<a)throw new u.A("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==t)throw new u.A("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let T,b,x=0;for(;r.remainingBytes()>=8;){const E=r.readUint32(),R=r.readUint32();if(0===x){if(1313821514!==R)throw new u.A("gltf-loader-error","First glb chunk must be JSON.");if(E<0)throw new u.A("gltf-loader-error","No JSON data found.");T=yield(0,J.KB)(r.readUint8Array(E))}else if(1===x){if(5130562!==R)throw new u.A("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");b=r.readUint8Array(E)}else O.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");x+=1}if(!T)throw new u.A("gltf-loader-error","No glb JSON chunk detected.");return{json:T,binaryData:b}})()}getBuffer(e,r){var o=this;return(0,m.A)(function*(){const t=o.json.buffers[e];if(null==t.uri){if(null==o._glbBuffer)throw new u.A("gltf-loader-error","glb buffer not present");return o._glbBuffer}const a=yield o._getBufferLoader(e,r);if(a.byteLength!==t.byteLength)throw new u.A("gltf-loader-error","Buffer byte lengths should match.");return a})()}_getBufferLoader(e,r){var o=this;return(0,m.A)(function*(){const t=o._bufferLoaders.get(e);if(t)return t;const T=o._context.loadBinary(o._resolveUri(o.json.buffers[e].uri),r).then(b=>new Uint8Array(b));return o._bufferLoaders.set(e,T),T})()}getAccessor(e,r){var o=this;return(0,m.A)(function*(){if(!o.json.accessors)throw new u.A("gltf-loader-unsupported-feature","Accessors missing.");const t=o.json.accessors[e];if(null==(null==t?void 0:t.bufferView))throw new u.A("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(t.type in[L.MAT2,L.MAT3,L.MAT4])throw new u.A("gltf-loader-unsupported-feature",`AttributeType ${t.type} is not supported`);const a=o.json.bufferViews[t.bufferView],T=yield o.getBuffer(a.buffer,r),b=q[t.type],x=ee[t.componentType],E=b*x,R=a.byteStride||E;return{raw:T.buffer,byteStride:R,byteOffset:T.byteOffset+(a.byteOffset||0)+(t.byteOffset||0),entryCount:t.count,isDenselyPacked:R===E,componentCount:b,componentByteSize:x,componentType:t.componentType,min:t.min,max:t.max,normalized:!!t.normalized}})()}getIndexData(e,r){var o=this;return(0,m.A)(function*(){if(null==e.indices)return;const t=yield o.getAccessor(e.indices,r);if(t.isDenselyPacked)switch(t.componentType){case d.pe.UNSIGNED_BYTE:return new Uint8Array(t.raw,t.byteOffset,t.entryCount);case d.pe.UNSIGNED_SHORT:return new Uint16Array(t.raw,t.byteOffset,t.entryCount);case d.pe.UNSIGNED_INT:return new Uint32Array(t.raw,t.byteOffset,t.entryCount)}else switch(t.componentType){case d.pe.UNSIGNED_BYTE:return(0,A.m)(o._wrapAccessor(y.SL,t));case d.pe.UNSIGNED_SHORT:return(0,A.m)(o._wrapAccessor(y.h,t));case d.pe.UNSIGNED_INT:return(0,A.m)(o._wrapAccessor(y.P,t))}})()}getPositionData(e,r){var o=this;return(0,m.A)(function*(){if(null==e.attributes.POSITION)throw new u.A("gltf-loader-unsupported-feature","No POSITION vertex data found.");const t=yield o.getAccessor(e.attributes.POSITION,r);if(t.componentType!==d.pe.FLOAT)throw new u.A("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+d.pe[t.componentType]);if(3!==t.componentCount)throw new u.A("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+t.componentCount.toFixed());return o._wrapAccessor(y.xs,t)})()}getNormalData(e,r){var o=this;return(0,m.A)(function*(){if(null==e.attributes.NORMAL)throw new u.A("gltf-loader-error","No NORMAL vertex data found.");const t=yield o.getAccessor(e.attributes.NORMAL,r);if(t.componentType!==d.pe.FLOAT)throw new u.A("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+d.pe[t.componentType]);if(3!==t.componentCount)throw new u.A("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+t.componentCount.toFixed());return o._wrapAccessor(y.xs,t)})()}getTangentData(e,r){var o=this;return(0,m.A)(function*(){if(null==e.attributes.TANGENT)throw new u.A("gltf-loader-error","No TANGENT vertex data found.");const t=yield o.getAccessor(e.attributes.TANGENT,r);if(t.componentType!==d.pe.FLOAT)throw new u.A("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+d.pe[t.componentType]);if(4!==t.componentCount)throw new u.A("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+t.componentCount.toFixed());return new y.Eq(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)})()}getTextureCoordinates(e,r){var o=this;return(0,m.A)(function*(){if(null==e.attributes.TEXCOORD_0)throw new u.A("gltf-loader-error","No TEXCOORD_0 vertex data found.");const t=yield o.getAccessor(e.attributes.TEXCOORD_0,r);if(2!==t.componentCount)throw new u.A("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+t.componentCount.toFixed());if(t.componentType===d.pe.FLOAT)return o._wrapAccessor(y.gH,t);if(!t.normalized)throw new u.A("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return function te(i){switch(i.componentType){case d.pe.BYTE:return new y.D6(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case d.pe.UNSIGNED_BYTE:return new y.LC(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case d.pe.SHORT:return new y.mJ(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case d.pe.UNSIGNED_SHORT:return new y.Yi(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case d.pe.UNSIGNED_INT:return new y.An(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case d.pe.FLOAT:return new y.gH(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}}(t)})()}getVertexColors(e,r){var o=this;return(0,m.A)(function*(){if(null==e.attributes.COLOR_0)throw new u.A("gltf-loader-error","No COLOR_0 vertex data found.");const t=yield o.getAccessor(e.attributes.COLOR_0,r);if(4!==t.componentCount&&3!==t.componentCount)throw new u.A("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+t.componentCount.toFixed());if(4===t.componentCount){if(t.componentType===d.pe.FLOAT)return o._wrapAccessor(y.Eq,t);if(t.componentType===d.pe.UNSIGNED_BYTE)return o._wrapAccessor(y.XP,t);if(t.componentType===d.pe.UNSIGNED_SHORT)return o._wrapAccessor(y.Uz,t)}else if(3===t.componentCount){if(t.componentType===d.pe.FLOAT)return o._wrapAccessor(y.xs,t);if(t.componentType===d.pe.UNSIGNED_BYTE)return o._wrapAccessor(y.eI,t);if(t.componentType===d.pe.UNSIGNED_SHORT)return o._wrapAccessor(y.nS,t)}throw new u.A("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+d.pe[t.componentType])})()}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}getMaterial(e,r,o){var t=this;return(0,m.A)(function*(){let a=e.material?t._materialCache.get(e.material):void 0;if(!a){var T,b,x,E,R;const M=null!=e.material?F(t.json.materials[e.material]):F(),S=M.pbrMetallicRoughness,N=t.hasVertexColors(e),ae=t.getTexture(S.baseColorTexture,r),k=t.getTexture(M.normalTexture,r),ne=o?t.getTexture(M.occlusionTexture,r):void 0,oe=o?t.getTexture(M.emissiveTexture,r):void 0,se=o?t.getTexture(S.metallicRoughnessTexture,r):void 0,ue=null!=e.material?e.material:-1;a={alphaMode:M.alphaMode,alphaCutoff:M.alphaCutoff,color:S.baseColorFactor,doubleSided:!!M.doubleSided,colorTexture:yield ae,normalTexture:yield k,name:M.name,id:ue,occlusionTexture:yield ne,emissiveTexture:yield oe,emissiveFactor:M.emissiveFactor,metallicFactor:S.metallicFactor,roughnessFactor:S.roughnessFactor,metallicRoughnessTexture:yield se,hasVertexColors:N,ESRI_externalColorMixMode:M.extras.ESRI_externalColorMixMode,colorTextureTransform:null==S||null===(T=S.baseColorTexture)||void 0===T||null===(T=T.extensions)||void 0===T?void 0:T.KHR_texture_transform,normalTextureTransform:null===(b=M.normalTexture)||void 0===b||null===(b=b.extensions)||void 0===b?void 0:b.KHR_texture_transform,occlusionTextureTransform:null===(x=M.occlusionTexture)||void 0===x||null===(x=x.extensions)||void 0===x?void 0:x.KHR_texture_transform,emissiveTextureTransform:null===(E=M.emissiveTexture)||void 0===E||null===(E=E.extensions)||void 0===E?void 0:E.KHR_texture_transform,metallicRoughnessTextureTransform:null==S||null===(R=S.metallicRoughnessTexture)||void 0===R||null===(R=R.extensions)||void 0===R?void 0:R.KHR_texture_transform,receiveAmbientOcclusion:M.extras.ESRI_receiveAmbientOcclusion,receiveShadows:M.extras.ESRI_receiveShadows}}return a})()}getTexture(e,r){var o=this;return(0,m.A)(function*(){if(!e)return;if(0!==(e.texCoord||0))throw new u.A("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const t=e.index,a=o.json.textures[t],T=(i=>({...X,...i}))(null!=a.sampler?o.json.samplers[a.sampler]:{}),b=o._getTextureSourceId(a),x=o.json.images[b],E=yield o._loadTextureImageData(t,a,r);return(0,p.tE)(o._textureCache,t,()=>{const R=S=>33071===S||33648===S||10497===S,M=S=>{throw new u.A("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${S}`)};return{data:E,wrapS:R(T.wrapS)?T.wrapS:M(T.wrapS),wrapT:R(T.wrapT)?T.wrapT:M(T.wrapT),minFilter:T.minFilter,name:x.name,id:t}})})()}getNodeTransform(e){if(void 0===e)return $;let r=this._nodeTransformCache.get(e);if(!r){const o=this.getNodeTransform(this._getNodeParent(e)),t=this.json.nodes[e];t.matrix?r=(0,l.lw)((0,w.vt)(),o,t.matrix):t.translation||t.rotation||t.scale?(r=(0,w.o8)(o),t.translation&&(0,l.Tl)(r,r,t.translation),t.rotation&&(z[3]=(0,f.Xd)(z,t.rotation),(0,l.e$)(r,r,z[3],z)),t.scale&&(0,l.hs)(r,r,t.scale)):r=(0,w.o8)(o),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return(0,s.s2)(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=n.R.parse(this.json.asset.version,"glTF");Z.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new u.A("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(o=>{this._nodeParentMap.set(o,r)})})}_loadTextureImageData(e,r,o){var t=this;return(0,m.A)(function*(){const a=t._textureLoaders.get(e);if(a)return a;const T=t._createTextureLoader(r,o);return t._textureLoaders.set(e,T),T})()}_getTextureSourceId(e){if(void 0!==e.extensions&&null!==e.extensions.KHR_texture_basisu)return e.extensions.KHR_texture_basisu.source;if(null!==e.source)return e.source;throw new u.A("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}_createTextureLoader(e,r){var o=this;return(0,m.A)(function*(){const t=o._getTextureSourceId(e),a=o.json.images[t];if(a.uri){if(a.uri.endsWith(".ktx2")){const E=yield o._context.loadBinary(o._resolveUri(a.uri),r);return new J.Xi(new Uint8Array(E))}return o._context.loadImage(o._resolveUri(a.uri),r)}if(null==a.bufferView)throw new u.A("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==a.mimeType)throw new u.A("gltf-loader-unsupported-feature","Image mimeType must be defined.");const T=o.json.bufferViews[a.bufferView],b=yield o.getBuffer(T.buffer,r);if(null!=T.byteStride)throw new u.A("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return(0,J.pn)(new Uint8Array(b.buffer,b.byteOffset+(T.byteOffset||0),T.byteLength),a.mimeType)})()}getLoadedBuffersSize(){var e=this;return(0,m.A)(function*(){if(e._glbBuffer)return e._glbBuffer.byteLength;const r=yield(0,c.nA)(Array.from(e._bufferLoaders.values())),o=yield(0,c.nA)(Array.from(e._textureLoaders.values()));return r.reduce((t,a)=>{var T;return t+(null!==(T=null==a?void 0:a.byteLength)&&void 0!==T?T:0)},0)+o.reduce((t,a)=>t+(a?(0,J.x3)(a)?a.data.byteLength:a.width*a.height*4:0),0)})()}}const $=(0,l.hM)((0,w.vt)(),Math.PI/2),Z=new n.R(2,0,"glTF"),z=(0,h.vt)(),q={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ee={[d.pe.BYTE]:1,[d.pe.UNSIGNED_BYTE]:1,[d.pe.SHORT]:2,[d.pe.UNSIGNED_SHORT]:2,[d.pe.FLOAT]:4,[d.pe.INT]:4,[d.pe.UNSIGNED_INT]:4},re=/\.gltf$/i,ye=/\.glb$/i;let ge=0;function Te(i,e){return le.apply(this,arguments)}function le(){return le=(0,m.A)(function*(i,e,r={},o=!0){var t;const a=yield D.load(i,e,r),T="gltf_"+ge++,b={lods:[],materials:new Map,textures:new Map,meta:ve(a)},x=!(!a.json.asset.extras||"symbolResource"!==a.json.asset.extras.ESRI_type),E=null===(t=a.json.asset.extras)||void 0===t||null===(t=t.ESRI_webstyleSymbol)||void 0===t?void 0:t.webstyle,R=new Map;yield function be(i,e){return de.apply(this,arguments)}(a,function(){var S=(0,m.A)(function*(N,ae,k,ne){var oe,se;const ue=null!==(oe=R.get(k))&&void 0!==oe?oe:0;R.set(k,ue+1);const ie=void 0!==N.mode?N.mode:d.WR.TRIANGLES,ce=ie===d.WR.TRIANGLES||ie===d.WR.TRIANGLE_STRIP||ie===d.WR.TRIANGLE_FAN?ie:null;if(null==ce)return void O.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+d.WR[ie]+"). Skipping primitive.");if(!a.hasPositions(N))return void O.A.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const Ee=a.getPositionData(N,r),Se=a.getMaterial(N,r,o),fe=a.hasNormals(N)?a.getNormalData(N,r):null,pe=a.hasTangents(N)?a.getTangentData(N,r):null,_e=a.hasTextureCoordinates(N)?a.getTextureCoordinates(N,r):null,me=a.hasVertexColors(N)?a.getVertexColors(N,r):null,Oe=a.getIndexData(N,r),Re={name:ne,transform:(0,w.o8)(ae),attributes:{position:yield Ee,normal:fe?yield fe:null,texCoord0:_e?yield _e:null,color:me?yield me:null,tangent:pe?yield pe:null},indices:yield Oe,primitiveType:ce,material:we(b,yield Se,T)};let he=null;null!=(null===(se=b.meta)||void 0===se?void 0:se.ESRI_lod)&&"screenSpaceRadius"===b.meta.ESRI_lod.metric&&(he=b.meta.ESRI_lod.thresholds[k]),b.lods[k]=b.lods[k]||{parts:[],name:ne,lodThreshold:he},b.lods[k].parts[ue]=Re});return function(N,ae,k,ne){return S.apply(this,arguments)}}());for(const S of b.lods)S.parts=S.parts.filter(N=>!!N);const M=yield a.getLoadedBuffersSize();return{model:b,meta:{isEsriSymbolResource:x,uri:a.uri,ESRI_webstyle:E},customMeta:{},size:M}}),le.apply(this,arguments)}function ve(i){let r=null;return i.json.nodes.forEach(o=>{const t=o.extras;null!=t&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(r=t)}),r}function de(){return de=(0,m.A)(function*(i,e){const r=i.json,o=r.scenes[r.scene||0].nodes,t=o.length>1,a=[];for(const x of o){const E=r.nodes[x];a.push(T(x,0)),Ae(E)&&!t&&E.extensions.MSFT_lod.ids.forEach((R,M)=>T(R,M+1))}function T(x,E){return b.apply(this,arguments)}function b(){return(b=(0,m.A)(function*(x,E){const R=r.nodes[x],M=i.getNodeTransform(x);if(null!=R.weights&&O.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),null!=R.mesh){const S=r.meshes[R.mesh];for(const N of S.primitives)a.push(e(N,M,E,S.name))}for(const S of R.children||[])a.push(T(S,E))})).apply(this,arguments)}yield Promise.all(a)}),de.apply(this,arguments)}function Ae(i){var e;return(null===(e=i.extensions)||void 0===e?void 0:e.MSFT_lod)&&Array.isArray(i.extensions.MSFT_lod.ids)}function we(i,e,r){const o=a=>{const T=`${r}_tex_${a&&a.id}${null!=a&&a.name?"_"+a.name:""}`;if(a&&!i.textures.has(T)){const b=function g(i,e={}){return{data:i,parameters:{wrap:{s:d.pF.REPEAT,t:d.pF.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}(a.data,{wrap:{s:a.wrapS,t:a.wrapT},mipmap:xe.has(a.minFilter),noUnpackFlip:!0});i.textures.set(T,b)}return T},t=`${r}_mat_${e.id}_${e.name}`;if(!i.materials.has(t)){const a=function v(i={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...i}}({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?o(e.colorTexture):void 0,textureNormal:e.normalTexture?o(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?o(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?o(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?o(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});i.materials.set(t,a)}return t}const xe=new Set([d.Cj.LINEAR_MIPMAP_LINEAR,d.Cj.LINEAR_MIPMAP_NEAREST])},61605:(P,I,_)=>{_.d(I,{T:()=>m});const m=2.1}}]);