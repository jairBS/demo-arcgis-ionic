"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[482,9927],{39693:(H,T,e)=>{e.d(T,{P:()=>d,L:()=>c});var h=e(8189),P=e(98877),B=e(29529),M=e(77806),p=e(26514);class L{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(p.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(r){const t=new L,s=this._originStores[p.Gr.DEFAULTS];s&&s.forEach((n,_)=>{t.set(_,(0,M.o8)(n),p.Gr.DEFAULTS)});for(let n=p.Gr.SERVICE;n<p.AU;n++){const _=this._originStores[n];_&&_.forEach((O,E)=>{r&&r.has(E)||t.set(E,(0,M.o8)(O),n)})}return t}get(r,t){const s=void 0===t?this._values:this._originStores[t];return s?s.get(r):void 0}keys(r){const t=null==r?this._values:this._originStores[r];return t?[...t.keys()]:[]}set(r,t,s=p.Gr.USER){let n=this._originStores[s];if(n||(n=new Map,this._originStores[s]=n),n.set(r,t),!this._values.has(r)||this._propertyOriginMap.get(r)<=s){const _=this._values.get(r);return this._values.set(r,t),this._propertyOriginMap.set(r,s),_!==t}return!1}delete(r,t=p.Gr.USER){const s=this._originStores[t];if(!s)return;const n=s.get(r);if(s.delete(r),this._values.has(r)&&this._propertyOriginMap.get(r)===t){this._values.delete(r);for(let _=t-1;_>=0;_--){const O=this._originStores[_];if(O&&O.has(r)){this._values.set(r,O.get(r)),this._propertyOriginMap.set(r,_);break}}}return n}has(r,t){const s=void 0===t?this._values:this._originStores[t];return!!s&&s.has(r)}revert(r,t){for(;t>0&&!this.has(r,t);)--t;const s=this._originStores[t],n=null==s?void 0:s.get(r),_=this._values.get(r);return this._values.set(r,n),this._propertyOriginMap.set(r,t),_!==n}originOf(r){return this._propertyOriginMap.get(r)||p.Gr.DEFAULTS}forEach(r){this._values.forEach(r)}}var K=e(34813),m=e(74220),A=e(76576);const y=v=>{let r=class extends v{constructor(...t){super(...t);const s=(0,m.oY)(this),n=s.store,_=new L;s.store=_,(0,B.k)(s,n,_)}read(t,s){(0,K.L)(this,t,s)}getAtOrigin(t,s){const n=D(this),_=(0,p.aB)(s);if("string"==typeof t)return n.get(t,_);const O={};return t.forEach(E=>{O[E]=n.get(E,_)}),O}originOf(t){return(0,p.OL)(this.originIdOf(t))}originIdOf(t){return D(this).originOf(t)}revert(t,s){const n=D(this),_=(0,p.aB)(s),O=(0,m.oY)(this);let E;E="string"==typeof t?"*"===t?n.keys(_):[t]:t,E.forEach(l=>{O.invalidate(l),n.revert(l,_),O.commit(l)})}};return r=(0,h._)([(0,A.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],r),r};function D(v){return(0,m.oY)(v).store}let g=class extends(y(P.A)){};g=(0,h._)([(0,A.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],g);var C=e(92073),U=e(56558);const S=v=>{let r=class extends v{constructor(...t){super(...t)}clear(t,s="user"){return u(this).delete(t,(0,p.aB)(s))}write(t,s){return(0,U.M)(this,t=t||{},s),t}setAtOrigin(t,s,n){(0,m.oY)(this).setAtOrigin(t,s,(0,p.aB)(n))}removeOrigin(t){const s=u(this),n=(0,p.aB)(t),_=s.keys(n);for(const O of _)s.originOf(O)===n&&s.set(O,s.get(O,n),p.Gr.USER)}updateOrigin(t,s){const n=u(this),_=(0,p.aB)(s),O=(0,C.Jt)(this,t);for(let E=_+1;E<p.AU;++E)n.delete(t,E);n.set(t,O,_)}toJSON(t){return this.write({},t)}};return r=(0,h._)([(0,A.$)("esri.core.WriteableMultiOriginJSONSupport")],r),r.prototype.toJSON.isDefaultToJSON=!0,r};function u(v){return(0,m.oY)(v).store}const d=v=>{let r=class extends(S(y(v))){constructor(...t){super(...t)}};return r=(0,h._)([(0,A.$)("esri.core.MultiOriginJSONSupport")],r),r};let c=class extends(d(P.A)){};c=(0,h._)([(0,A.$)("esri.core.MultiOriginJSONSupport")],c)},30482:(H,T,e)=>{e.r(T),e.d(T,{default:()=>C});var h=e(8189),P=e(5922),B=e(39693),M=e(3804),p=e(85211),A=(e(3248),e(35150),e(40707),e(76576)),y=e(95478),D=e(85551);let g=class extends((0,D.A)((0,B.P)(y.A))){constructor(U){super(U),this.resourceInfo=null,this.type="unknown"}initialize(){this.addResolvingPromise(new Promise((U,S)=>{(0,M._)(()=>{const u=this.resourceInfo&&(this.resourceInfo.layerType||this.resourceInfo.type);let d="Unknown layer type";u&&(d+=" "+u),S(new P.A("layer:unknown-layer-type",d,{layerType:u}))})}))}read(U,S){super.read({resourceInfo:U},S)}write(U,S){return null}};(0,h._)([(0,p.MZ)({readOnly:!0})],g.prototype,"resourceInfo",void 0),(0,h._)([(0,p.MZ)({type:["show","hide"]})],g.prototype,"listMode",void 0),(0,h._)([(0,p.MZ)({json:{read:!1},readOnly:!0,value:"unknown"})],g.prototype,"type",void 0),g=(0,h._)([(0,A.$)("esri.layers.UnknownLayer")],g);const C=g},85551:(H,T,e)=>{e.d(T,{A:()=>n});var h=e(10467),P=e(8189),B=e(23098),M=e(77469),p=e(89563),L=e(89447),K=e(5922),m=e(35150),A=e(11432),y=e(56492),D=e(45272),g=e(85211),S=(e(3248),e(40707),e(17221)),u=e(76576),d=e(50305),c=e(58443),v=e(73874),r=e(46577),t=e(52606),s=e(69927);const n=O=>{let E=class extends O{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,A.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(l){l!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",l))}readPortalItem(l,i,o){if(i.itemId)return new r.default({id:i.itemId,portal:null==o?void 0:o.portal})}writePortalItem(l,i){null!=l&&l.id&&(i.itemId=l.id)}loadFromPortal(l,i){var o=this;return(0,h.A)(function*(){var a;if(null!==(a=o.portalItem)&&void 0!==a&&a.id)try{const{load:f}=yield Promise.all([e.e(5565),e.e(2076),e.e(6180)]).then(e.bind(e,56180));return(0,y.Te)(i),yield f({instance:o,supportedTypes:l.supportedTypes,validateItem:l.validateItem,supportsData:l.supportsData,layerModuleTypeMap:l.layerModuleTypeMap},i)}catch(f){throw(0,y.zf)(f)||m.A.getLogger(o).warn(`Failed to load layer (${o.title}, ${o.id}) portal item (${o.portalItem.id})\n  ${f}`),f}})()}finishLoadEditablePortalLayer(l){var i=this;return(0,h.A)(function*(){i._set("userHasEditingPrivileges",yield i._fetchUserHasEditingPrivileges(l).catch(o=>((0,y.QP)(o),!0)))})()}setUserPrivileges(l,i){var o=this;return(0,h.A)(function*(){if(!B.A.userPrivilegesApplied)return o.finishLoadEditablePortalLayer(i);if(o.url)try{const{features:{edit:a,fullEdit:f},content:{updateItem:I}}=yield o._fetchUserPrivileges(l,i);o._set("userHasEditingPrivileges",a),o._set("userHasFullEditingPrivileges",f),o._set("userHasUpdateItemPrivileges",I)}catch(a){(0,y.QP)(a)}})()}_fetchUserPrivileges(l,i){var o=this;return(0,h.A)(function*(){let a=o.portalItem;if(!l||!a||!a.loaded||a.sourceUrl)return o._fetchFallbackUserPrivileges(i);const f=l===a.id;if(f&&a.portal.user)return(0,s.It)(a);let I,W;if(f)I=a.portal.url;else try{I=yield(0,c.wI)(o.url,i)}catch(R){(0,y.QP)(R)}if(!I||!(0,D.b8)(I,a.portal.url))return o._fetchFallbackUserPrivileges(i);try{const R=null!=i?i.signal:null;W=yield null==M.id?void 0:M.id.getCredential(`${I}/sharing`,{prompt:!1,signal:R})}catch(R){(0,y.QP)(R)}if(!W)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(f?yield a.reload():(a=new r.default({id:l,portal:{url:I}}),yield a.load(i)),a.portal.user)return(0,s.It)(a)}catch(R){(0,y.QP)(R)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(l){var i=this;return(0,h.A)(function*(){let o=!0;try{o=yield i._fetchUserHasEditingPrivileges(l)}catch(a){(0,y.QP)(a)}return{features:{edit:o,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(l){var i=this;return(0,h.A)(function*(){const o=i.url?null==M.id?void 0:M.id.findCredential(i.url):null;if(!o)return!0;const a=_.credential===o?_.user:yield i._fetchEditingUser(l);return _.credential=o,_.user=a,null==(null==a?void 0:a.privileges)||a.privileges.includes("features:user:edit")})()}_fetchEditingUser(l){var i=this;return(0,h.A)(function*(){var o,a;const f=null===(o=i.portalItem)||void 0===o||null===(o=o.portal)||void 0===o?void 0:o.user;if(f)return f;const I=M.id.findServerInfo(null!==(a=i.url)&&void 0!==a?a:"");if(null==I||!I.owningSystemUrl)return null;const W=`${I.owningSystemUrl}/sharing/rest`,j=v.A.getDefault();if(j&&j.loaded&&(0,D.S8)(j.restUrl)===(0,D.S8)(W))return j.user;const $=`${W}/community/self`,G=null!=l?l.signal:null,R=yield(0,L.Ke)((0,p.A)($,{authMode:"no-prompt",query:{f:"json"},signal:G}));return R.ok?t.A.fromJSON(R.value.data):null})()}read(l,i){i&&(i.layer=this),super.read(l,i)}write(l,i){var o;const a=null==i?void 0:i.portal,f=(null===(o=this.portalItem)||void 0===o?void 0:o.id)&&(this.portalItem.portal||v.A.getDefault());return a&&f&&!(0,D.ut)(f.restUrl,a.restUrl)?(i.messages&&i.messages.push(new K.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(l,{...i,layer:this})}};return(0,P._)([(0,g.MZ)({type:r.default})],E.prototype,"portalItem",null),(0,P._)([(0,S.w)("web-document","portalItem",["itemId"])],E.prototype,"readPortalItem",null),(0,P._)([(0,d.K)("web-document","portalItem",{itemId:{type:String}})],E.prototype,"writePortalItem",null),(0,P._)([(0,g.MZ)({clonable:!1})],E.prototype,"resourceReferences",void 0),(0,P._)([(0,g.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasEditingPrivileges",void 0),(0,P._)([(0,g.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasFullEditingPrivileges",void 0),(0,P._)([(0,g.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasUpdateItemPrivileges",void 0),E=(0,P._)([(0,u.$)("esri.layers.mixins.PortalLayer")],E),E},_={credential:null,user:null}},69927:(H,T,e)=>{e.d(T,{It:()=>S,LG:()=>K,OM:()=>y,Sm:()=>D,Y:()=>m,bK:()=>A,mm:()=>U,sQ:()=>g});var h=e(10467),P=e(11817),B=e(32034),M=e(55039);function L(){return(L=(0,h.A)(function*(u){const d=u.spatialReference;if(d.isWGS84)return u.clone();if(d.isWebMercator)return(0,M.ci)(u);const c=B.A.WGS84;return yield(0,P.initializeProjection)(d,c),(0,P.project)(u,c)})).apply(this,arguments)}function K(u,d){if(!m(u,d)){const c=u.typeKeywords;c?c.push(d):u.typeKeywords=[d]}}function m(u,d){var c;return!(null===(c=u.typeKeywords)||void 0===c||!c.includes(d))}function A(u){return m(u,U.HOSTED_SERVICE)}function y(u,d){const c=u.typeKeywords;if(c){const v=c.indexOf(d);v>-1&&c.splice(v,1)}}function D(u,d,c){c?K(u,d):y(u,d)}function g(u){return C.apply(this,arguments)}function C(){return C=(0,h.A)(function*(u){const d=u.clone().normalize();let c;if(d.length>1)for(const v of d)c?v.width>c.width&&(c=v):c=v;else c=d[0];return function p(u){return L.apply(this,arguments)}(c)}),C.apply(this,arguments)}const U={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function S(u){var d;const{portal:c,isOrgItem:v,itemControl:r}=u,t=null===(d=c.user)||void 0===d?void 0:d.privileges;let s=!t||t.includes("features:user:edit"),n=!!v&&!(null==t||!t.includes("features:user:fullEdit"));const _="update"===r||"admin"===r;return _?n=s=!0:n&&(s=!0),{features:{edit:s,fullEdit:n},content:{updateItem:_}}}}}]);