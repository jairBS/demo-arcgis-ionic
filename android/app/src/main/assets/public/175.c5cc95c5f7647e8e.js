"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[175,4098,3258,8846],{63583:(ke,we,w)=>{var V,F;w.d(we,{u:()=>V}),(F=V||(V={}))[F.KILOBYTES=1024]="KILOBYTES",F[F.MEGABYTES=1048576]="MEGABYTES",F[F.GIGABYTES=1073741824]="GIGABYTES"},33087:(ke,we,w)=>{w.d(we,{q:()=>F});var V=w(60611);class F{constructor(ie,S){this._storage=new V.F,this.id="",this.name="",this.size=0,this._storage.maxSize=ie,this._storage.register(this),S&&this._storage.registerRemoveFunc("",S)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(ie,S,I=1){this._storage.put(this,ie,S,I,1)}pop(ie){return this._storage.pop(this,ie)}get(ie){return this._storage.get(this,ie)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(ie){this._storage.maxSize=ie}resetHitRate(){}}},60611:(ke,we,w)=>{w.d(we,{F:()=>I,Mn:()=>S});var ie,ce,V=w(12438);(ce=ie||(ie={}))[ce.ALL=0]="ALL",ce[ce.SOME=1]="SOME";class S{constructor(J,k,z){this.name=J,this._storage=k,this.id=fe+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),z&&(this._storage.registerRemoveFunc(this.id,z),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(J){return this._storage.getSize(this,J)}resetHitRate(){this._hit=this._miss=0}put(J,k,z,q=0){this._storage.put(this,J,k,z,q)}pop(J){const k=this._storage.pop(this,J);return void 0===k?++this._miss:++this._hit,k}get(J){const k=this._storage.get(this,J);return void 0===k?++this._miss:++this._hit,k}peek(J){return this._storage.peek(this,J)}updateSize(J,k,z){this._storage.updateSize(this,J,k,z)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class I{get size(){return this._size}constructor(J=10485760){this._maxSize=J,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new V.A,this._users=new V.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(J){this._users.push(J)}deregister(J){this._users.removeUnordered(J)}registerRemoveFunc(J,k){this._removeFuncs.push([J,k])}deregisterRemoveFunc(J){this._removeFuncs.filterInPlace(k=>k[0]!==J)}get maxSize(){return this._maxSize}set maxSize(J){this._maxSize=Math.max(J,-1),this._checkSize()}getSize(J,k){var z;const q=this._db.get(J.id+k);return null!==(z=null==q?void 0:q.size)&&void 0!==z?z:0}put(J,k,z,q,X){const B=this._db.get(k=J.id+k);if(B&&(this._size-=B.size,J.size-=B.size,this._db.delete(k),B.entry!==z&&this._notifyRemove(k,B.entry,B.size,ie.ALL)),q>this._maxSize)return void this._notifyRemove(k,z,q,ie.ALL);if(void 0===z)return void console.warn("Refusing to cache undefined entry ");if(!q||q<0)return console.warn(`Refusing to cache entry with size ${q} for key ${k}`),void this._notifyRemove(k,z,0,ie.ALL);const D=1+Math.max(X,-4)- -3;this._db.set(k,new de(z,q,D)),this._size+=q,J.size+=q,this._checkSize()}updateSize(J,k,z,q){const X=this._db.get(k=J.id+k);if(X&&X.entry===z){for(this._size-=X.size,J.size-=X.size;q>this._maxSize;){const B=this._notifyRemove(k,z,q,ie.SOME);if(!(null!=B&&B>0))return void this._db.delete(k);q=B}X.size=q,this._size+=q,J.size+=q,this._checkSize()}}pop(J,k){const z=this._db.get(k=J.id+k);if(z)return this._size-=z.size,J.size-=z.size,this._db.delete(k),++this._hit,z.entry;++this._miss}get(J,k){const z=this._db.get(k=J.id+k);if(void 0!==z)return this._db.delete(k),z.lives=z.lifetime,this._db.set(k,z),++this._hit,z.entry;++this._miss}peek(J,k){const z=this._db.get(J.id+k);return z?++this._hit:++this._miss,null==z?void 0:z.entry}get performanceInfo(){const J={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},k={},z=new Array;this._db.forEach((B,D)=>{const N=B.lifetime;z[N]=(z[N]||0)+B.size,this._users.forAll(j=>{const{id:U,name:P}=j;D.startsWith(U)&&(k[P]=(k[P]||0)+B.size)})});const q={};this._users.forAll(B=>{const D=B.name;"hitRate"in B&&"number"==typeof B.hitRate&&!isNaN(B.hitRate)&&B.hitRate>0?(k[D]=k[D]||0,q[D]=Math.round(100*B.hitRate)+"%"):q[D]="0%"});const X=Object.keys(k);X.sort((B,D)=>k[D]-k[B]),X.forEach(B=>J[B]=Math.round(k[B]/2**20)+"MB / "+q[B]);for(let B=z.length-1;B>=0;--B){const D=z[B];D&&(J["Priority "+(B+-3-1)]=Math.round(D/this._size*100)+"%")}return J}resetStats(){this._hit=this._miss=0,this._users.forAll(J=>J.resetHitRate())}clear(J){const k=J.id;this._db.forEach((z,q)=>{q.startsWith(k)&&(this._size-=z.size,this._db.delete(q),this._notifyRemove(q,z.entry,z.size,ie.ALL))}),J.size=0}clearAll(){this._db.forEach((J,k)=>this._notifyRemove(k,J.entry,J.size,ie.ALL)),this._users.forAll(J=>J.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(J,k,z,q){let X;return this._removeFuncs.some(B=>{if(J.startsWith(B[0])){const D=B[1](k,q,z);return"number"==typeof D&&(X=D),!0}return!1}),X}_checkSize(){this._users.forAll(J=>this._checkSizeLimits(J)),this._checkSizeLimits()}_checkSizeLimits(J){const k=null!=J?J:this;if(k.maxSize<0||k.size<=k.maxSize)return;const z=null==J?void 0:J.id;let q=!0;for(;q;){q=!1;for(const[X,B]of this._db)if(0===B.lifetime&&(!z||X.startsWith(z))){if(this._purgeItem(X,B,J),k.size<=.9*k.maxSize)return;q||(q=this._db.has(X))}}for(const[X,B]of this._db)if((!z||X.startsWith(z))&&(this._purgeItem(X,B,J),k.size<=.9*k.maxSize))return}_purgeItem(J,k,z=this._users.find(q=>J.startsWith(q.id))){if(this._db.delete(J),k.lives<=1){this._size-=k.size,z&&(z.size-=k.size);const q=this._notifyRemove(J,k.entry,k.size,ie.SOME);null!=q&&q>0&&(this._size+=q,z&&(z.size+=q),k.lives=k.lifetime,k.size=q,this._db.set(J,k))}else--k.lives,this._db.set(J,k)}}let fe=0;class de{constructor(J,k,z){this.entry=J,this.size=k,this.lifetime=z,this.lives=z}}},24098:(ke,we,w)=>{w.d(we,{GB:()=>F,Qo:()=>ie,Y4:()=>G});var V=w(44549);class F{}function G(I){return I instanceof V.bo?I===F.instance:"unknown"===(null==I?void 0:I.toString().toLowerCase())}function ie(I){return G(I)?F.instance:I}F.instance=new V.oh("Etc/UTC")},721:(ke,we,w)=>{w.d(we,{$X:()=>st,Gy:()=>ge,P5:()=>Pt,SW:()=>ut,Tr:()=>ft,VV:()=>I}),w(61320);const G=(te,L,O)=>[L,O],ie=(te,L,O)=>[L,O,te[2]],S=(te,L,O)=>[L,O,te[2],te[3]];function I(te){return te?{originPosition:"upper-left"===te.originPosition?"upperLeft":"lower-left"===te.originPosition?"lowerLeft":te.originPosition,scale:te.tolerance?[te.tolerance,te.tolerance]:[1,1],translate:null!=te.extent?[te.extent.xmin,te.extent.ymax]:[0,0]}:null}function B({scale:te,translate:L},O){return O*te[0]+L[0]}function D({scale:te,translate:L},O){return L[1]-O*te[1]}function N(te,L,O){const C=new Array(O.length);if(!O.length)return C;const[T,se]=te.scale;let re=B(te,O[0][0]),pe=D(te,O[0][1]);C[0]=L(O[0],re,pe);for(let Ae=1;Ae<O.length;Ae++){const Me=O[Ae];re+=Me[0]*T,pe-=Me[1]*se,C[Ae]=L(Me,re,pe)}return C}function j(te,L,O){const C=new Array(O.length);for(let T=0;T<O.length;T++)C[T]=N(te,L,O[T]);return C}function ge(te,L,O,C,T){return L.x=function de({scale:te,translate:L},O){return Math.round((O-L[0])/te[0])}(te,O.x),L.y=function ce({scale:te,translate:L},O){return Math.round((L[1]-O)/te[1])}(te,O.y),L!==O&&(C&&(L.z=O.z),T&&(L.m=O.m)),L}function ut(te,L,O,C,T){return null!=O&&(L.points=function P(te,L,O,C){return N(te,O?C?S:ie:C?ie:G,L)}(te,O.points,C,T)),L}function ft(te,L,O,C,T){return null==O||(L.x=B(te,O.x),L.y=D(te,O.y),L!==O&&(C&&(L.z=O.z),T&&(L.m=O.m))),L}function st(te,L,O,C,T){return null!=O&&(L.rings=function ne(te,L,O,C){return j(te,O?C?S:ie:C?ie:G,L)}(te,O.rings,C,T)),L}function Pt(te,L,O,C,T){return null!=O&&(L.paths=function W(te,L,O,C){return j(te,O?C?S:ie:C?ie:G,L)}(te,O.paths,C,T)),L}},40856:(ke,we,w)=>{w.d(we,{X_:()=>ie,i1:()=>S,zx:()=>ce});var V=w(69287),F=w(82663);const G=96;function ie(z,q){const X=q||z.extent,B=z.width,D=(0,F.GA)(null==X?void 0:X.spatialReference);return X&&B?X.width/B*D*F.dy*G:0}function S(z,q){return z/((0,F.GA)(q)*F.dy*G)}function ce(z,q,X){return function J(z,q){return 0===q||(0,V.Sp)(z,q)||z<q}(z,q)&&function k(z,q){return 0===q||(0,V.Sp)(z,q)||z>q}(z,X)}},42086:(ke,we,w)=>{w.d(we,{N3:()=>F,Om:()=>V});class V{constructor(S=null,I={},fe,de){this.geometry=S,this.attributes=I,this.centroid=fe,this.objectId=de,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const S=new V(this.geometry,this.attributes,this.centroid,this.objectId);return S.displayId=this.displayId,S.geohashX=this.geohashX,S.geohashY=this.geohashY,S}clone(){var S,I;const fe=null===(S=this.geometry)||void 0===S?void 0:S.clone(),de=new V(fe,{...this.attributes},null===(I=this.centroid)||void 0===I?void 0:I.clone(),this.objectId);return de.displayId=this.displayId,de.geohashX=this.geohashX,de.geohashY=this.geohashY,de}}function F(ie){var S;return!(null===(S=ie.geometry)||void 0===S||null===(S=S.coords)||void 0===S||!S.length)}},61808:(ke,we,w)=>{w.d(we,{A:()=>V});class V{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const G=new V;return G.objectIdFieldName=this.objectIdFieldName,G.globalIdFieldName=this.globalIdFieldName,G.geohashFieldName=this.geohashFieldName,G.geometryProperties=this.geometryProperties,G.geometryType=this.geometryType,G.spatialReference=this.spatialReference,G.hasZ=this.hasZ,G.hasM=this.hasM,G.features=this.features,G.fields=this.fields,G.transform=this.transform,G.exceededTransferLimit=this.exceededTransferLimit,G.uniqueIdField=this.uniqueIdField,G.queryGeometry=this.queryGeometry,G.queryGeometryType=this.queryGeometryType,G}}},13682:(ke,we,w)=>{w.d(we,{A:()=>F});class F{constructor(ie=[],S=[],I=!1){this.lengths=null!=ie?ie:[],this.coords=null!=S?S:[],this.hasIndeterminateRingOrder=I}static fromRect(ie){const[S,I,fe,de]=ie,ce=fe-S,J=de-I;return new F([5],[S,I,ce,0,0,J,-ce,0,0,-J])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((ie,S)=>ie+S)}forEachVertex(ie){let S=0;this.lengths.length||ie(this.coords[0],this.coords[1]);for(let I=0;I<this.lengths.length;I++){const fe=this.lengths[I];for(let de=0;de<fe;de++)ie(this.coords[2*(de+S)],this.coords[2*(de+S)+1]);S+=fe}}deltaDecode(){const ie=this.clone(),{coords:S,lengths:I}=ie;let fe=0;for(const de of I){for(let ce=1;ce<de;ce++)S[2*(fe+ce)]+=S[2*(fe+ce)-2],S[2*(fe+ce)+1]+=S[2*(fe+ce)-1];fe+=de}return ie}clone(ie){if(0===this.lengths.length)return new F([],[this.coords[0],this.coords[1]]);const S=2*(0===this.lengths.length?1:this.lengths.reduce((fe,de)=>fe+de)),I=this.coords.slice(0,S);return ie?(ie.set(I),new F(this.lengths,ie,this.hasIndeterminateRingOrder)):new F(Array.from(this.lengths),Array.from(I),this.hasIndeterminateRingOrder)}}},94376:(ke,we,w)=>{w.d(we,{p:()=>de});var V=w(8189),F=w(85211),I=(w(3248),w(35150),w(40707),w(76576));const de=ce=>{let J=class extends ce{get apiKey(){var k;return this._isOverridden("apiKey")?this._get("apiKey"):function fe(ce){return"portalItem"in ce}(this)?null===(k=this.portalItem)||void 0===k?void 0:k.apiKey:null}set apiKey(k){null!=k?this._override("apiKey",k):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,V._)([(0,F.MZ)({type:String})],J.prototype,"apiKey",null),J=(0,V._)([(0,I.$)("esri.layers.mixins.APIKeyMixin")],J),J}},25936:(ke,we,w)=>{w.d(we,{b:()=>de});var V=w(8189),F=w(35150),G=w(85211),I=(w(3248),w(40707),w(76576)),fe=w(68438);const de=ce=>{let J=class extends ce{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const k=(0,fe.qg)(this.url);if(null!=k&&k.title)return k.title}return this._get("title")||""}set title(k){this._set("title",k)}set url(k){this._set("url",(0,fe.Jf)(k,F.A.getLogger(this)))}};return(0,V._)([(0,G.MZ)()],J.prototype,"title",null),(0,V._)([(0,G.MZ)({type:String})],J.prototype,"url",null),J=(0,V._)([(0,I.$)("esri.layers.mixins.ArcGISService")],J),J}},47063:(ke,we,w)=>{w.d(we,{A:()=>X});var V=w(8189),F=w(90660),G=w(71065),ie=w(85211),de=(w(3248),w(35150),w(40707),w(17221)),ce=w(76576),J=w(50305),k=w(84546),z=w(69741);let q=class extends((0,F.O)(G.oY)){constructor(B){super(B),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(B){const D={};for(const N of Object.keys(B))D[N]=(0,k.rS)(B[N]);return D}writeDomains(B,D){const N={};for(const U of Object.keys(B)){var j;B[U]&&(N[U]=null===(j=B[U])||void 0===j?void 0:j.toJSON())}D.domains=N}};(0,V._)([(0,ie.MZ)({json:{write:!0}})],q.prototype,"id",void 0),(0,V._)([(0,ie.MZ)({json:{write:!0}})],q.prototype,"name",void 0),(0,V._)([(0,ie.MZ)({json:{write:!0}})],q.prototype,"domains",void 0),(0,V._)([(0,de.w)("domains")],q.prototype,"readDomains",null),(0,V._)([(0,J.K)("domains")],q.prototype,"writeDomains",null),(0,V._)([(0,ie.MZ)({type:[z.A],json:{write:!0}})],q.prototype,"templates",void 0),q=(0,V._)([(0,ce.$)("esri.layers.support.FeatureType")],q);const X=q},73258:(ke,we,w)=>{w.d(we,{A:()=>q});var V=w(5922),F=w(71065),G=w(35150),ie=w(60797),S=w(24098),I=w(86300),fe=w(22639),de=w(44549);const z=new Map;class q{static fromJSON(U){return new q(U.fields,U.timeZoneByFieldName)}static fromLayer(U){var P;return new q(null!==(P=U.fields)&&void 0!==P?P:[],N(U))}static fromLayerJSON(U){var P;return new q(null!==(P=U.fields)&&void 0!==P?P:[],N(U))}constructor(U=[],P){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=U||[],this._timeZoneByFieldName=P?new Map(P):null;const W=[];for(const $ of this.fields){const ee=null==$?void 0:$.name,le=B(ee);if(ee&&le){var ne;const ue=X(ee);this._fieldsMap.set(ee,$),this._fieldsMap.set(ue,$),this._normalizedFieldsMap.set(le,$),W.push(`${ue}:${$.type}:${null===(ne=this._timeZoneByFieldName)||void 0===ne?void 0:ne.get(ee)}`),(0,I.vE)($)?(this.dateFields.push($),this._dateFieldsSet.add($)):(0,I.WA)($)&&(this._numericFieldsSet.add($),this.numericFields.push($)),(0,I.te)($)||(0,I.Xz)($)||($.editable=null==$.editable||!!$.editable,$.nullable=null==$.nullable||!!$.nullable)}}W.sort(),this.uid=W.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const U of this.fields)(0,I.te)(U)||(0,I.Xz)(U)||U.nullable||void 0!==(0,I.lD)(U)||this._requiredFields.push(U)}return this._requiredFields}equals(U){return this.uid===(null==U?void 0:U.uid)}has(U){return null!=this.get(U)}get(U){var P;if(!U)return;let W=this._fieldsMap.get(U);return W||(W=null!==(P=this._fieldsMap.get(X(U)))&&void 0!==P?P:this._normalizedFieldsMap.get(B(U)),W&&this._fieldsMap.set(U,W),W)}getTimeZone(U){const P=this.get(U&&"string"!=typeof U?U.name:U);return P?this._timeZoneByFieldName?this._timeZoneByFieldName.get(P.name):"date"===P.type||"esriFieldTypeDate"===P.type?(G.A.getLogger("esri.layers.support.FieldsIndex").error(new V.A("getTimeZone:no-timezone-information",`no time zone information for field '${P.name}'`)),fe.n$):D.has(P.type)?fe.L5:null:null}getLuxonTimeZone(U){const P=this.getTimeZone(U);return P?P===fe.L5?S.GB.instance:P===fe.n$?de.mQ.utcInstance:(0,ie.tE)(z,P,()=>de.oh.create(P)):null}isDateField(U){return this._dateFieldsSet.has(this.get(U))}isTimeOnlyField(U){return(0,I.OH)(this.get(U))}isNumericField(U){return this._numericFieldsSet.has(this.get(U))}normalizeFieldName(U){var P,W;return null!==(P=null===(W=this.get(U))||void 0===W?void 0:W.name)&&void 0!==P?P:void 0}toJSON(){return{fields:this.fields.map(U=>(0,F.Wj)(U)?U.toJSON():U),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function X(j){return j.trim().toLowerCase()}function B(j){var U,P;return null!==(U=null===(P=(0,I.rS)(j))||void 0===P?void 0:P.toLowerCase())&&void 0!==U?U:""}const D=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function N(j){var U,P,W,ne,$,ee,le;const ue=new Map;if(!j.fields)return ue;const oe=!0===j.datesInUnknownTimezone,{timeInfo:he,editFieldsInfo:Y}=j,ge=null!==(U=he?"startField"in he?he.startField:he.startTimeField:"")&&void 0!==U?U:"",Fe=null!==(P=he?"endField"in he?he.endField:he.endTimeField:"")&&void 0!==P?P:"",Le=function k(j){return"dateFieldsTimeZone"in j}(j)?null!==(W=j.dateFieldsTimeZone)&&void 0!==W?W:null:j.dateFieldsTimeReference?(0,fe.ZS)(j.dateFieldsTimeReference):null,Be=Y?function ce(j){return"timeZone"in j}(Y)?null!==(ne=Y.timeZone)&&void 0!==ne?ne:Le:Y.dateFieldsTimeReference?(0,fe.ZS)(Y.dateFieldsTimeReference):null!=Le?Le:fe.n$:null,Ne=he?function J(j){return"timeZone"in j}(he)?null!==($=he.timeZone)&&void 0!==$?$:Le:he.timeReference?(0,fe.ZS)(he.timeReference):Le:null,ut=new Map([[X(null!==(ee=null==Y?void 0:Y.creationDateField)&&void 0!==ee?ee:""),Be],[X(null!==(le=null==Y?void 0:Y.editDateField)&&void 0!==le?le:""),Be],[X(ge),Ne],[X(Fe),Ne]]);for(const{name:st,type:Pt}of j.fields)if(D.has(Pt))ue.set(st,fe.L5);else if("date"!==Pt&&"esriFieldTypeDate"!==Pt)ue.set(st,null);else if(oe)ue.set(st,fe.L5);else{var ft;const te=null!==(ft=ut.get(X(null!=st?st:"")))&&void 0!==ft?ft:Le;ue.set(st,te)}return ue}},64584:(ke,we,w)=>{w.d(we,{A:()=>k});var ce,V=w(8189),F=w(31178),G=w(71065),ie=w(85211),de=(w(3248),w(35150),w(40707),w(76576));let J=ce=class extends G.oY{constructor(z){super(z),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new F.A}clone(){return new ce({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,V._)([(0,ie.MZ)({type:String,json:{write:!0}})],J.prototype,"floorField",void 0),(0,V._)([(0,ie.MZ)({json:{read:!1,write:!1}})],J.prototype,"viewAllMode",void 0),(0,V._)([(0,ie.MZ)({json:{read:!1,write:!1}})],J.prototype,"viewAllLevelIds",void 0),J=ce=(0,V._)([(0,de.$)("esri.layers.support.LayerFloorInfo")],J);const k=J},4858:(ke,we,w)=>{w.d(we,{BI:()=>X,D3:()=>z,XJ:()=>q,lc:()=>k,mX:()=>D,rU:()=>B,tH:()=>ne});var V=w(1119);const F="__begin__",G="__end__",ie=new RegExp(F,"ig"),S=new RegExp(G,"ig"),I=new RegExp("^"+F,"i"),fe=new RegExp(G+"$","i"),de='"',ce=de+" + ",J=" + "+de;function k($){return $.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function z($){return $.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function q($){const ee={expression:"",type:"none"};return $.labelExpressionInfo?$.labelExpressionInfo.value?(ee.expression=$.labelExpressionInfo.value,ee.type="conventional"):$.labelExpressionInfo.expression&&(ee.expression=$.labelExpressionInfo.expression,ee.type="arcade"):null!=$.labelExpression&&(ee.expression=k($.labelExpression),ee.type="conventional"),ee}function X($){const ee=q($);if(!ee)return null;switch(ee.type){case"conventional":return D(ee.expression);case"arcade":return ee.expression}return null}function B($){const ee=q($);if(!ee)return null;switch(ee.type){case"conventional":return function j($){const ee=null==$?void 0:$.match(N);return(null==ee?void 0:ee[1].trim())||null}(ee.expression);case"arcade":return ne(ee.expression)}return null}function D($){let ee;return $?(ee=(0,V.HC)($,le=>F+'$feature["'+le+'"]'+G),ee=I.test(ee)?ee.replace(I,""):de+ee,ee=fe.test(ee)?ee.replace(fe,""):ee+de,ee=ee.replaceAll(ie,ce).replaceAll(S,J)):ee='""',ee}const N=/^\s*\{([^}]+)\}\s*$/i,U=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,P=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,W=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function ne($){if(!$)return null;let ee=U.exec($)||P.exec($);return ee?ee[1]||ee[3]:(ee=W.exec($),ee?ee[2]:null)}},90543:(ke,we,w)=>{w.d(we,{S:()=>ce});var V=w(3248),F=w(68438);function G(P,W,ne){return!!S(P,W,ne)}function ie(P,W,ne){return S(P,W,ne)}function S(P,W,ne){return P&&P.hasOwnProperty(W)?P[W]:ne}const I={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function fe(P){var W;const ne=null==P||null===(W=P.supportedSpatialAggregationStatistics)||void 0===W?void 0:W.map($=>$.toLowerCase());return{envelope:!(null==ne||!ne.includes("envelopeaggregate")),centroid:!(null==ne||!ne.includes("centroidaggregate")),convexHull:!(null==ne||!ne.includes("convexhullaggregate"))}}function de(P,W){var ne;const $=null==P||null===(ne=P.supportedOperationsWithCacheHint)||void 0===ne?void 0:ne.map(ee=>ee.toLowerCase());return!(null==$||!$.includes(W.toLowerCase()))}function ce(P,W){return{analytics:J(P),attachment:k(P),data:z(P),metadata:q(P),operations:X(P.capabilities,P,W),query:B(P,W),queryRelated:D(P),queryTopFeatures:N(P),editing:j(P)}}function J(P){return{supportsCacheHint:de(P.advancedQueryCapabilities,"queryAnalytics")}}function k(P){const W=P.attachmentProperties,ne={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:de(P.advancedQueryCapabilities,"queryAttachments"),supportsResize:G(P,"supportsAttachmentsResizing",!1)};return W&&Array.isArray(W)&&W.forEach($=>{const ee=I[$.name];ee&&(ne[ee]=!!$.isEnabled)}),ne}function z(P){return{isVersioned:G(P,"isDataVersioned",!1),supportsAttachment:G(P,"hasAttachments",!1),supportsM:G(P,"hasM",!1),supportsZ:G(P,"hasZ",!1)}}function q(P){return{supportsAdvancedFieldProperties:G(P,"supportsFieldDescriptionProperty",!1)}}function X(P,W,ne){const $=P?P.toLowerCase().split(",").map(Le=>Le.trim()):[],ee=ne?(0,F.qg)(ne):null,le=$.includes(null!=ee&&"MapServer"===ee.serverType?"data":"query"),ue=$.includes("editing")&&!W.datesInUnknownTimezone;let oe=ue&&$.includes("create"),he=ue&&$.includes("delete"),Y=ue&&$.includes("update");const ge=$.includes("changetracking"),Fe=W.advancedQueryCapabilities;return ue&&!(oe||he||Y)&&(oe=he=Y=!0),{supportsCalculate:G(W,"supportsCalculate",!1),supportsTruncate:G(W,"supportsTruncate",!1),supportsValidateSql:G(W,"supportsValidateSql",!1),supportsAdd:oe,supportsDelete:he,supportsEditing:ue,supportsChangeTracking:ge,supportsQuery:le,supportsQueryAnalytics:G(Fe,"supportsQueryAnalytic",!1),supportsQueryAttachments:G(Fe,"supportsQueryAttachments",!1),supportsQueryTopFeatures:G(Fe,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:G(W,"supportsAttachmentsResizing",!1),supportsSync:$.includes("sync"),supportsUpdate:Y,supportsExceedsLimitStatistics:G(W,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:G(W,"supportsAsyncConvert3D",!1)}}function B(P,W){var ne;const $=P.advancedQueryCapabilities,ee=P.ownershipBasedAccessControlForFeatures,le=P.archivingInfo,ue=P.currentVersion,he=!(null==W?void 0:W.includes("MapServer"))||ue>=(0,V.A)("mapserver-pbf-version-support"),Y=(0,F.Wo)(W),ge=new Set((null!==(ne=P.supportedQueryFormats)&&void 0!==ne?ne:"").split(",").map(Fe=>Fe.toLowerCase().trim()));return{supportsStatistics:G($,"supportsStatistics",P.supportsStatistics),supportsPercentileStatistics:G($,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:G($,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:fe($),supportsCentroid:G($,"supportsReturningGeometryCentroid",!1),supportsDistance:G($,"supportsQueryWithDistance",!1),supportsDistinct:G($,"supportsDistinct",P.supportsAdvancedQueries),supportsExtent:G($,"supportsReturningQueryExtent",!1),supportsGeometryProperties:G($,"supportsReturningGeometryProperties",!1),supportsHavingClause:G($,"supportsHavingClause",!1),supportsOrderBy:G($,"supportsOrderBy",P.supportsAdvancedQueries),supportsPagination:G($,"supportsPagination",!1),supportsQuantization:G(P,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:G(P,"supportsQuantizationEditMode",!1),supportsQueryGeometry:G(P,"supportsReturningQueryGeometry",!1),supportsResultType:G($,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:G($,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:G($,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:G(P,"useStandardizedQueries",!1),supportsTopFeaturesQuery:G($,"supportsTopFeaturesQuery",!1),supportsQueryByAnonymous:G(ee,"allowAnonymousToQuery",!0),supportsQueryByOthers:G(ee,"allowOthersToQuery",!0),supportsHistoricMoment:G(le,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:he&&ge.has("pbf"),supportsDisjointSpatialRelationship:G($,"supportsDisjointSpatialRel",!1),supportsCacheHint:G($,"supportsQueryWithCacheHint",!1)||de($,"query"),supportsDefaultSpatialReference:G($,"supportsDefaultSR",!1),supportsCompactGeometry:Y,supportsFullTextSearch:G($,"supportsFullTextSearch",!1),maxRecordCountFactor:ie(P,"maxRecordCountFactor",void 0),maxRecordCount:ie(P,"maxRecordCount",void 0),standardMaxRecordCount:ie(P,"standardMaxRecordCount",void 0),tileMaxRecordCount:ie(P,"tileMaxRecordCount",void 0)}}function D(P){const W=P.advancedQueryCapabilities,ne=G(W,"supportsAdvancedQueryRelated",!1);return{supportsPagination:G(W,"supportsQueryRelatedPagination",!1),supportsCount:ne,supportsOrderBy:ne,supportsCacheHint:de(W,"queryRelated")}}function N(P){return{supportsCacheHint:de(P.advancedQueryCapabilities,"queryTopFilter")}}function j(P){const W=P.ownershipBasedAccessControlForFeatures,ne=P?P.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:G(P,"allowGeometryUpdates",!0),supportsGlobalId:G(P,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:G(P,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:G(P,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:G(P,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:G(P,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:G(W,"allowAnonymousToDelete",!0),supportsDeleteByOthers:G(W,"allowOthersToDelete",!0),supportsUpdateByAnonymous:G(W,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:G(W,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:G(ne,"supportsAsyncApplyEdits",!1),zDefault:ie(P,"zDefault",void 0)}}},78592:(ke,we,w)=>{w.d(we,{O3:()=>ce,PU:()=>fe,YW:()=>k,ex:()=>S,hv:()=>J,zp:()=>I});var V=w(69287),F=w(67685),G=w(53781),ie=w(89141);const S=2.4;function I(z){return(0,F.PN)(z*S)}function fe(z){return(0,F.Lz)(z)/S}function de(z,q,X,B){let{color:D,ratio:N}=q,{color:j,ratio:U}=X;U===N&&(1===U?N-=1e-6:U+=1e-6);const P=(0,V.qE)((B-N)/(U-N),0,1);(0,G.l)(z,D.toArray(),j.toArray(),P)}function ce(z){const X=new Uint8ClampedArray(2048);if((z=z.filter(({ratio:U})=>U>=0&&U<=1).sort((U,P)=>U.ratio-P.ratio).map(({color:U,ratio:P})=>({color:U,ratio:Math.max(P,.001)}))).length<1)return X;let B=z[0],D=z[0],N=1;const j=(0,ie.vt)();for(let U=0;U<512;U++){const P=(U+.5)/512;for(;P>D.ratio&&N<z.length;)B=D,D=z[N++];de(j,B,D,P),X.set(j,4*U)}return X}function J(z,q,X){const B=Math.sqrt(z**2+q**2)/X;return B>1?0:3/(Math.PI*X**2)*(1-B**2)**2}function k(z){return"function"==typeof z?z:z?q=>+q[z]:()=>1}},91515:(ke,we,w)=>{w.d(we,{GP:()=>k,LI:()=>ce,lc:()=>fe,u5:()=>de}),w(13242);var F=w(68479);const G=/^-?(\d+)(\.(\d+))?$/i;function ie(z,q){return z-q}function S(z,q){let X,B;return X=Number(z.toFixed(q)),X<z?B=X+1/10**q:(B=X,X-=1/10**q),X=Number(X.toFixed(q)),B=Number(B.toFixed(q)),[X,B]}function I(z,q,X,B,D){const N=de(z,q,X,B);return(null==N.previous||N.previous<=D)&&(null==N.next||N.next<=D)||N.previous+N.next<=2*D}function fe(z){const q=String(z),X=q.match(G);if(X&&X[1])return{integer:X[1].split("").length,fractional:X[3]?X[3].split("").length:0};if(q.toLowerCase().includes("e")){const B=q.split("e"),D=B[0],N=B[1];if(D&&N){const j=Number(D);let U=Number(N);const P=U>0;P||(U=Math.abs(U));const W=fe(j);return P?(W.integer+=U,U>W.fractional?W.fractional=0:W.fractional-=U):(W.fractional+=U,U>W.integer?W.integer=1:W.integer-=U),W}}return{integer:0,fractional:0}}function de(z,q,X,B){const D={previous:null,next:null};if(null!=X){const N=z-X;D.previous=Math.floor(Math.abs(100*(q-X-N)/N))}if(null!=B){const N=B-z;D.next=Math.floor(Math.abs(100*(B-q-N)/N))}return D}function ce(z,q={}){const X=z.slice(0),{tolerance:B=2,strictBounds:D=!1,indexes:N=X.map((j,U)=>U)}=q;N.sort(ie);for(let j=0;j<N.length;j++){const U=N[j],P=X[U],W=0===U?null:X[U-1],ne=U===X.length-1?null:X[U+1],$=fe(P).fractional;if($){let ee,le=0,ue=!1;for(;le<=$&&!ue;){const oe=S(P,le);ee=D&&0===j?oe[1]:oe[0],ue=I(P,ee,W,ne,B),le++}ue&&(X[U]=ee)}}return X}const J={maximumFractionDigits:20};function k(z){return(0,F.ZV)(z,J)}},1832:(ke,we,w)=>{function V(F){const G={};for(const ie in F){if("declaredClass"===ie)continue;const S=F[ie];if(null!=S&&"function"!=typeof S)if(Array.isArray(S)){G[ie]=[];for(let I=0;I<S.length;I++)G[ie][I]=V(S[I])}else"object"==typeof S?S.toJSON&&(G[ie]=JSON.stringify(S)):G[ie]=S}return G}w.d(we,{z:()=>V})},34687:(ke,we,w)=>{w.d(we,{e:()=>de,s:()=>I});var V=w(10467),F=w(68800),G=w(1277),ie=w(93327),S=w(87086);function I(J,k,z){return fe.apply(this,arguments)}function fe(){return(fe=(0,V.A)(function*(J,k,z){const q=yield de(J,k,z);return ie.A.fromJSON(q)})).apply(this,arguments)}function de(J,k,z){return ce.apply(this,arguments)}function ce(){return(ce=(0,V.A)(function*(J,k,z){const q=(0,F.Dl)(J),X={...z},B=S.A.from(k),{data:D}=yield(0,G.eW)(q,B,B.sourceSpatialReference,X);return D})).apply(this,arguments)}},1277:(ke,we,w)=>{w.d(we,{IJ:()=>B,Jf:()=>P,Pk:()=>j,eW:()=>q,gW:()=>U,kS:()=>N});var V=w(10467),F=w(89563),G=w(45272),ie=w(61320),S=w(77098),I=w(58701),fe=w(1832),de=w(78304),ce=w(98789);const J="Layer does not support extent calculation.";function z(le,ue){var oe;const he=le.geometry,Y=le.toJSON();delete Y.compactGeometryEnabled,delete Y.defaultSpatialReferenceEnabled;const ge=Y;let Fe,Le,Be;if(null!=he&&(Le=he.spatialReference,Be=(0,I.YX)(Le),ge.geometryType=(0,ie.$B)(he),ge.geometry=function k(le,ue){if(ue&&"extent"===le.type)return`${le.xmin},${le.ymin},${le.xmax},${le.ymax}`;if(ue&&"point"===le.type)return`${le.x},${le.y}`;const oe=le.toJSON();return delete oe.spatialReference,JSON.stringify(oe)}(he,le.compactGeometryEnabled),ge.inSR=Be),Y.groupByFieldsForStatistics&&(ge.groupByFieldsForStatistics=Y.groupByFieldsForStatistics.join(",")),Y.objectIds&&(ge.objectIds=Y.objectIds.join(",")),Y.orderByFields&&(ge.orderByFields=Y.orderByFields.join(",")),!Y.outFields||!Y.returnDistinctValues&&(null!=ue&&ue.returnCountOnly||null!=ue&&ue.returnExtentOnly||null!=ue&&ue.returnIdsOnly)?delete ge.outFields:ge.outFields=Y.outFields.includes("*")?"*":Y.outFields.join(","),Y.outSR?(ge.outSR=(0,I.YX)(Y.outSR),Fe=le.outSpatialReference):he&&(Y.returnGeometry||Y.returnCentroid)&&(ge.outSR=ge.inSR,Fe=Le),Y.returnGeometry&&delete Y.returnGeometry,Y.outStatistics&&(ge.outStatistics=JSON.stringify(Y.outStatistics)),Y.fullText&&(ge.fullText=JSON.stringify(Y.fullText)),Y.pixelSize&&(ge.pixelSize=JSON.stringify(Y.pixelSize)),Y.quantizationParameters&&(le.defaultSpatialReferenceEnabled&&null!=Le&&null!=(null===(oe=le.quantizationParameters)||void 0===oe?void 0:oe.extent)&&Le.equals(le.quantizationParameters.extent.spatialReference)&&delete Y.quantizationParameters.extent.spatialReference,ge.quantizationParameters=JSON.stringify(Y.quantizationParameters)),Y.parameterValues&&(ge.parameterValues=JSON.stringify(Y.parameterValues)),Y.rangeValues&&(ge.rangeValues=JSON.stringify(Y.rangeValues)),Y.dynamicDataSource&&(ge.layer=JSON.stringify({source:Y.dynamicDataSource}),delete Y.dynamicDataSource),Y.timeExtent){const Ne=Y.timeExtent,{start:ut,end:ft}=Ne;null==ut&&null==ft||(ge.time=ut===ft?ut:`${null!=ut?ut:"null"},${null!=ft?ft:"null"}`),delete Y.timeExtent}return le.defaultSpatialReferenceEnabled&&null!=Le&&null!=Fe&&Le.equals(Fe)&&(ge.defaultSR=ge.inSR,delete ge.inSR,delete ge.outSR),ge}function q(le,ue,oe,he){return X.apply(this,arguments)}function X(){return(X=(0,V.A)(function*(le,ue,oe,he){const Y=null!=ue.timeExtent&&ue.timeExtent.isEmpty?{data:{features:[]}}:yield ne(le,ue,"json",he);return(0,ce.q)(ue,oe,Y.data),Y})).apply(this,arguments)}function B(le,ue,oe,he){return D.apply(this,arguments)}function D(){return(D=(0,V.A)(function*(le,ue,oe,he){if(null!=ue.timeExtent&&ue.timeExtent.isEmpty)return{data:oe.createFeatureResult()};const Y=yield N(le,ue,he),ge=Y;return ge.data=(0,de.m)(Y.data,oe),ge})).apply(this,arguments)}function N(le,ue,oe){return ne(le,ue,"pbf",oe)}function j(le,ue,oe){return null!=ue.timeExtent&&ue.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):ne(le,ue,"json",oe,{returnIdsOnly:!0})}function U(le,ue,oe){return null!=ue.timeExtent&&ue.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):ne(le,ue,"json",oe,{returnIdsOnly:!0,returnCountOnly:!0})}function P(le,ue,oe){return W.apply(this,arguments)}function W(){return(W=(0,V.A)(function*(le,ue,oe){if(null!=ue.timeExtent&&ue.timeExtent.isEmpty)return{data:{count:0,extent:null}};const he=yield ne(le,ue,"json",oe,{returnExtentOnly:!0,returnCountOnly:!0}),Y=he.data;if(Y.hasOwnProperty("extent"))return he;if(Y.features)throw new Error(J);if(Y.hasOwnProperty("count"))throw new Error(J);return he})).apply(this,arguments)}function ne(le,ue,oe){return $.apply(this,arguments)}function $(){return($=(0,V.A)(function*(le,ue,oe,he={},Y={}){const ge="string"==typeof le?(0,G.An)(le):le,Fe=ue.geometry?[ue.geometry]:[],Le=yield(0,S.el)(Fe,null,{signal:he.signal}),Be=null==Le?void 0:Le[0];null!=Be&&((ue=ue.clone()).geometry=Be);const Ne=(0,fe.z)({...ge.query,f:oe,...Y,...z(ue,Y)});return(0,F.A)((0,G.fj)(ge.path,function ee(le,ue){return null!=le.formatOf3DObjects&&!(ue.returnCountOnly||ue.returnExtentOnly||ue.returnIdsOnly)}(ue,Y)?"query3d":"query"),{...he,responseType:"pbf"===oe?"array-buffer":"json",query:{...Ne,...he.query}})})).apply(this,arguments)}},98789:(ke,we,w)=>{w.d(we,{q:()=>F});var V=w(23743);function F(G,ie,S){if(null==S||!S.features||!S.hasZ)return;const I=(0,V.N)(S.geometryType,ie,G.outSpatialReference);if(null!=I)for(const fe of S.features)I(fe.geometry)}},70994:(ke,we,w)=>{w.d(we,{A:()=>q});var J,V=w(8189),F=w(71065),G=w(85211),ie=w(55739),fe=(w(40707),w(3248),w(76576));const k={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let z=J=class extends F.oY{constructor(X){super(X),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:X}=this,B=function de(X){const{exifInfo:B,exifName:D,tagName:N}=X;if(!B||!D||!N)return null;const j=B.find(U=>U.name===D);return j?function ce(X){const{tagName:B,tags:D}=X;if(!D||!B)return null;const N=D.find(j=>j.name===B);return(null==N?void 0:N.value)||null}({tagName:N,tags:j.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:X});return k[B]||null}clone(){return new J({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,V._)([(0,G.MZ)({type:String})],z.prototype,"contentType",void 0),(0,V._)([(0,G.MZ)()],z.prototype,"exifInfo",void 0),(0,V._)([(0,G.MZ)({readOnly:!0})],z.prototype,"orientationInfo",null),(0,V._)([(0,G.MZ)({type:ie.jz})],z.prototype,"id",void 0),(0,V._)([(0,G.MZ)({type:String})],z.prototype,"globalId",void 0),(0,V._)([(0,G.MZ)({type:String})],z.prototype,"keywords",void 0),(0,V._)([(0,G.MZ)({type:String})],z.prototype,"name",void 0),(0,V._)([(0,G.MZ)({json:{read:!1}})],z.prototype,"parentGlobalId",void 0),(0,V._)([(0,G.MZ)({json:{read:!1}})],z.prototype,"parentObjectId",void 0),(0,V._)([(0,G.MZ)({type:ie.jz})],z.prototype,"size",void 0),(0,V._)([(0,G.MZ)({json:{read:!1}})],z.prototype,"url",void 0),z=J=(0,V._)([(0,fe.$)("esri.layers.support.AttachmentInfo")],z);const q=z},43039:(ke,we,w)=>{w.d(we,{fs:()=>X,i0:()=>ue});var V=w(48266),F=w(86300),S=(w(48218),w(71470),w(22639));function X(oe){return(0,F.vE)(oe)||(0,F.zD)(oe)||(0,F.Ah)(oe)}function ue(oe,he){const{format:Y,timeZoneOptions:ge,fieldType:Fe}=null!=he?he:{};let Le,Be;if(ge&&({timeZone:Le,timeZoneName:Be}=(0,S.hv)(ge.layerTimeZone,ge.datesInUnknownTimezone,ge.viewTimeZone,(0,V.J2)(Y||"short-date-short-time"),Fe)),"string"==typeof oe&&isNaN(Date.parse("time-only"===Fe?`1970-01-01T${oe}Z`:oe)))return oe;switch(Fe){case"date-only":{const Ne=(0,V.J2)(Y||"short-date");return"string"==typeof oe?(0,V.iS)(oe,{...Ne}):(0,V.Yq)(oe,{...Ne,timeZone:S.n$})}case"time-only":{const Ne=(0,V.J2)(Y||"short-time");return"string"==typeof oe?(0,V.F8)(oe,Ne):(0,V.Yq)(oe,{...Ne,timeZone:S.n$})}case"timestamp-offset":{if(!Le&&"string"==typeof oe&&new Date(oe).toISOString()!==oe)return oe;const Ne=Y||ge?(0,V.J2)(Y||"short-date-short-time"):void 0,ut=Ne?{...Ne,timeZone:Le,timeZoneName:Be}:void 0;return"string"==typeof oe?(0,V.Ey)(oe,ut):(0,V.Yq)(oe,ut)}default:{const Ne=Y||ge?(0,V.J2)(Y||"short-date-short-time"):void 0;return(0,V.Yq)("string"==typeof oe?new Date(oe):oe,Ne?{...Ne,timeZone:Le,timeZoneName:Be}:void 0)}}}},91644:(ke,we,w)=>{w.d(we,{A7:()=>de,Cx:()=>ce,Hk:()=>J,JJ:()=>X,UK:()=>fe,jM:()=>z,x3:()=>q}),w(3248);var F=w(88521),G=w(55417),ie=w(46602),S=w(47705),I=w(48254);const fe=ie.A.fromJSON(I.Cb),de=G.A.fromJSON(I.yM),ce=F.A.fromJSON(I.WR),J=S.A.fromJSON(I.JZ),z=ie.A.fromJSON(I.nC),q=G.A.fromJSON(I.HW),X=F.A.fromJSON(I.b6)},48254:(ke,we,w)=>{w.d(we,{Cb:()=>G,HW:()=>de,JZ:()=>I,WR:()=>S,b6:()=>ce,nC:()=>fe,yM:()=>ie});const V=[252,146,31,255],G={type:"esriSMS",style:"esriSMSCircle",size:6,color:V,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},ie={type:"esriSLS",style:"esriSLSSolid",width:.75,color:V},S={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},I={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},fe={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},de={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},ce={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},20175:(ke,we,w)=>{w.r(we),w.d(we,{getPatternDescriptor:()=>ue,getSizeFromOptions:()=>Ne,getSymbolLayerFill:()=>le,previewSymbol3D:()=>O});var V=w(10467),F=w(90261),G=w(29430),S=(w(3248),w(5922)),I=w(35150),fe=w(67685),de=w(8134),ce=w(28831),J=w(15225),k=w(22079),z=w(16633),q=w(83393),X=w(58964);const B=k.CB.size,D=k.CB.maxSize,N=k.CB.maxOutlineSize,j=k.CB.lineWidth,U=k.CB.tallSymbolWidth;function P(C){const T=C.outline,se=null!=C.material?C.material.color:null,re=null!=se?se.toHex():null;if(null==T||"pattern"in T&&null!=T.pattern&&"style"===T.pattern.type&&"none"===T.pattern.style)return"fill"===C.type&&"#ffffff"===re?{color:"#bdc3c7",width:.75}:null;const pe=(0,fe.Lz)(T.size)||0;return{color:"rgba("+(null!=T.color?T.color.toRgba():"255,255,255,1")+")",width:Math.min(pe,N),style:"pattern"in T&&null!=T.pattern&&"style"===T.pattern.type?(0,de.O1)(T.pattern.style):null,join:"butt",cap:"patternCap"in T?T.patternCap:"butt"}}function ne(){return(ne=(0,V.A)(function*(C,T){var se,re;if(null!==(se=C.thumbnail)&&void 0!==se&&se.url)return C.thumbnail.url;if("icon"===T.type&&(null==T||null===(re=T.resource)||void 0===re?void 0:re.href))return(0,q.N7)(T);const pe=(0,F.s)("esri/images/Legend/legend3dsymboldefault.png");if(C.styleOrigin&&(C.styleOrigin.styleName||C.styleOrigin.styleUrl)){var Ae;const Me=yield(0,X.resolveWebStyleSymbol)(C.styleOrigin,{portal:C.styleOrigin.portal},"webRef").catch(()=>null);if(Me&&"thumbnail"in Me&&null!==(Ae=Me.thumbnail)&&void 0!==Ae&&Ae.url)return Me.thumbnail.url}return pe})).apply(this,arguments)}function $(C,T=1){const se=C.a,re=(0,G.N2)(C),pe=re.h,Ae=re.s/T,Me=100-(100-re.v)/T,{r:Oe,g:Ue,b:Ce}=(0,G.$)({h:pe,s:Ae,v:Me});return[Oe,Ue,Ce,se]}function ee(C){var T;return"water"===C.type?null==C.color?null:C.color:null==(null===(T=C.material)||void 0===T?void 0:T.color)?null:C.material.color}function le(C,T=0){const se=ee(C);if(!se){if("fill"===C.type)return null;const Ae=(0,k.dr)(de.Sw.r,T);return[Ae,Ae,Ae,100]}const re=se.toRgba();for(let pe=0;pe<3;pe++)re[pe]=(0,k.dr)(re[pe],T);return re}function ue(C,T){return oe.apply(this,arguments)}function oe(){return(oe=(0,V.A)(function*(C,T){const se=C.style;return"none"===se?null:{type:"pattern",x:0,y:0,src:yield(0,de.rc)((0,F.s)(`esri/symbols/patterns/${se}.png`),T.toCss(!0)),width:5,height:5}})).apply(this,arguments)}function he(C){return C.outline?P(C):{color:"rgba(0, 0, 0, 1)",width:1.5}}function Y(C,T){const se=ee(C);if(!se)return null;let re="rgba(";return re+=(0,k.dr)(se.r,T)+",",re+=(0,k.dr)(se.g,T)+",",re+=(0,k.dr)(se.b,T)+",",re+se.a+");"}function ge(C,T){const se=Y(C,T);return se?"pattern"in C&&null!=C.pattern&&"style"===C.pattern.type&&"none"===C.pattern.style?null:{color:se,width:Math.min(C.size?(0,fe.Lz)(C.size):.75,N),style:"pattern"in C&&null!=C.pattern&&"style"===C.pattern.type?(0,de.O1)(C.pattern.style):null,cap:"cap"in C?C.cap:null,join:"join"in C?"miter"===C.join?(0,fe.Lz)(2):C.join:null}:{}}function Fe(C,T,se){const re=null!=se?.75*se:0;return{type:"linear",x1:re?.25*re:0,y1:re?.5*re:0,x2:re||4,y2:re?.5*re:4,colors:[{color:C,offset:0},{color:T,offset:1}]}}function Ne(C){const T="number"==typeof(null==C?void 0:C.size)?null==C?void 0:C.size:null;return T?(0,fe.Lz)(T):null}function st(){return st=(0,V.A)(function*(C,T){var se;const re=Ne(T),pe=null!=T&&T.maxSize?(0,fe.Lz)(T.maxSize):null,Ae=null!==(se=null==T?void 0:T.disableUpsampling)&&void 0!==se&&se,Me=C.symbolLayers,Oe=[];let Ue=0,Ce=0;const Se=Me.at(-1);let Xe;Se&&"icon"===Se.type&&(Xe=Se.size&&(0,fe.Lz)(Se.size)),Me.forEach(Ie=>{var We;if("icon"!==Ie.type&&"object"!==Ie.type)return;const Ze="icon"===Ie.type?Ie.size&&(0,fe.Lz)(Ie.size):0,ze=re||Ze?Math.ceil(Math.min(re||Ze,pe||D)):B;if(null!=Ie&&null!==(We=Ie.resource)&&void 0!==We&&We.href){const it=function W(C,T){return ne.apply(this,arguments)}(C,Ie).then(rt=>{var ct;const Gt=null==Ie||null===(ct=Ie.material)||void 0===ct?void 0:ct.color,Qt=function ut(C){return"icon"===C.type?"multiply":"tint"}(Ie);return(0,z.UB)(rt,ze,Gt,Qt,Ae)}).then(rt=>{const ct=rt.width,Gt=rt.height;return Ue=Math.max(Ue,ct),Ce=Math.max(Ce,Gt),[{shape:{type:"image",x:0,y:0,width:ct,height:Gt,src:rt.url},fill:null,stroke:null}]});Oe.push(it)}else{var tt;let it=ze;"icon"===Ie.type&&Xe&&re&&(it=ze*(Ze/Xe));const rt="tall"===(null==T?void 0:T.symbolConfig)||(null==T||null===(tt=T.symbolConfig)||void 0===tt?void 0:tt.isTall)||"object"===Ie.type&&function Le(C){const T=C.depth,se=C.height,re=C.width;return 0!==re&&0!==T&&0!==se&&re===T&&null!=re&&null!=se&&re<se}(Ie);Ue=Math.max(Ue,rt?U:it),Ce=Math.max(Ce,it),Oe.push(Promise.resolve(function Be(C,T,se){const re=[];if(!C)return re;switch(C.type){case"icon":{const Me=T,Oe=T;switch(C.resource&&C.resource.primitive||ce.r){case"circle":re.push({shape:{type:"circle",cx:0,cy:0,r:.5*T},fill:le(C,0),stroke:P(C)});break;case"square":re.push({shape:{type:"path",path:[{command:"M",values:[0,Oe]},{command:"L",values:[0,0]},{command:"L",values:[Me,0]},{command:"L",values:[Me,Oe]},{command:"Z",values:[]}]},fill:le(C,0),stroke:P(C)});break;case"triangle":re.push({shape:{type:"path",path:[{command:"M",values:[0,Oe]},{command:"L",values:[.5*Me,0]},{command:"L",values:[Me,Oe]},{command:"Z",values:[]}]},fill:le(C,0),stroke:P(C)});break;case"cross":re.push({shape:{type:"path",path:[{command:"M",values:[.5*Me,0]},{command:"L",values:[.5*Me,Oe]},{command:"M",values:[0,.5*Oe]},{command:"L",values:[Me,.5*Oe]}]},stroke:he(C)});break;case"x":re.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[Me,Oe]},{command:"M",values:[Me,0]},{command:"L",values:[0,Oe]}]},stroke:he(C)});break;case"kite":re.push({shape:{type:"path",path:[{command:"M",values:[0,.5*Oe]},{command:"L",values:[.5*Me,0]},{command:"L",values:[Me,.5*Oe]},{command:"L",values:[.5*Me,Oe]},{command:"Z",values:[]}]},fill:le(C,0),stroke:P(C)})}break}case"object":switch(C.resource&&C.resource.primitive||J.r){case"cone":{const pe=Fe(le(C,0),le(C,-.6),se?U:T),Ae=(0,k.mN)(T,se);re.push({shape:Ae[0],fill:pe},{shape:Ae[1],fill:pe});break}case"inverted-cone":{const pe=le(C,0),Ae=Fe(pe,le(C,-.6),T),Me=(0,k.Pc)(T);re.push({shape:Me[0],fill:Ae},{shape:Me[1],fill:pe});break}case"cube":{const pe=(0,k.cZ)(T,se);re.push({shape:pe[0],fill:le(C,0)},{shape:pe[1],fill:le(C,-.3)},{shape:pe[2],fill:le(C,-.5)});break}case"cylinder":{const pe=Fe(le(C,0),le(C,-.6),se?U:T),Ae=(0,k.dt)(T,se);re.push({shape:Ae[0],fill:pe},{shape:Ae[1],fill:pe},{shape:Ae[2],fill:le(C,0)});break}case"diamond":{const pe=(0,k.D)(T);re.push({shape:pe[0],fill:le(C,-.3)},{shape:pe[1],fill:le(C,0)},{shape:pe[2],fill:le(C,-.3)},{shape:pe[3],fill:le(C,-.7)});break}case"sphere":{const pe=Fe(le(C,0),le(C,-.6));pe.x1=0,pe.y1=0,pe.x2=.25*T,pe.y2=.25*T,re.push({shape:{type:"circle",cx:0,cy:0,r:.5*T},fill:pe});break}case"tetrahedron":{const pe=(0,k.Nz)(T);re.push({shape:pe[0],fill:le(C,-.3)},{shape:pe[1],fill:le(C,0)},{shape:pe[2],fill:le(C,-.6)});break}}}return re}(Ie,it,rt)))}});const xe=yield Promise.allSettled(Oe),Ge=[];return xe.forEach(Ie=>{"fulfilled"===Ie.status?Ge.push(Ie.value):Ie.reason&&I.A.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",Ie.reason)}),(0,z.fz)(Ge,[Ue,Ce],{node:null==T?void 0:T.node,scale:!1,opacity:null==T?void 0:T.opacity,ariaLabel:null==T?void 0:T.ariaLabel})}),st.apply(this,arguments)}function L(){return(L=(0,V.A)(function*(C,T){const se="mesh-3d"===C.type,re=C.symbolLayers,pe=Ne(T),Ae=null!=T&&T.maxSize?(0,fe.Lz)(T.maxSize):null,Me=pe||B,Oe=[];let Ue=0,Ce=0,Se=!1;for(let Xe=0;Xe<re.length;Xe++){const xe=re.at(Xe),Ge=[];if(!se||"fill"===xe.type){switch(xe.type){case"fill":{const Ie=Math.min(Me,Ae||D);if(Ue=Math.max(Ue,Ie),Ce=Math.max(Ce,Ie),Se=!0,se){const We=k.nq.meshSymbol3DFill,Ze=Y(xe,-.4),ze=Ze?{color:Ze,width:1,join:"round"}:{};Ge.push({shape:We[0],fill:le(xe,0),stroke:ze},{shape:We[1],fill:le(xe,-.2),stroke:ze},{shape:We[2],fill:le(xe,-.6),stroke:ze})}else{let We=le(xe,0);const Ze="pattern"in xe?xe.pattern:null,ze=P(xe),tt=ee(xe);null!=Ze&&"style"===Ze.type&&"solid"!==Ze.style&&tt&&(We=yield ue(Ze,tt)),Ge.push({shape:k.nq.fill[0],fill:We,stroke:ze})}break}case"line":{const Ie=ge(xe,0);if(null==Ie)break;const We={stroke:Ie,shape:k.nq.fill[0]};Ue=Math.max(Ue,B),Ce=Math.max(Ce,B),Ge.push(We);break}case"extrude":{const Ie={join:"round",width:1,...ge(xe,-.4)},We=le(xe,0),Ze=le(xe,-.2),ze=Math.min(Me,Ae||D),tt=(0,k.sU)(ze);Ie.width=1,Ge.push({shape:tt[0],fill:Ze,stroke:Ie},{shape:tt[1],fill:Ze,stroke:Ie},{shape:tt[2],fill:We,stroke:Ie});const rt=.7*B+.5*ze;Ue=Math.max(Ue,B),Ce=Math.max(Ce,rt);break}case"water":{const Ie=ee(xe),We=$(Ie),Ze=$(Ie,2),ze=$(Ie,3),tt=(0,k.cP)();Se=!0,Ge.push({shape:tt[0],fill:We},{shape:tt[1],fill:Ze},{shape:tt[2],fill:ze});const it=Math.min(Me,Ae||D);Ue=Math.max(Ue,it),Ce=Math.max(Ce,it);break}}Oe.push(Ge)}}return(0,z.fz)(Oe,[Ue,Ce],{node:null==T?void 0:T.node,scale:Se,opacity:null==T?void 0:T.opacity,ariaLabel:null==T?void 0:T.ariaLabel})})).apply(this,arguments)}function O(C,T){if(0===C.symbolLayers.length)return Promise.reject(new S.A("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(C.type){case"point-3d":return function ft(C,T){return st.apply(this,arguments)}(C,T);case"line-3d":return function Pt(C,T){const se=C.symbolLayers,re=[],pe=(0,q.$d)(C),Ae=Ne(T),Me=(null!=T&&T.maxSize?(0,fe.Lz)(T.maxSize):null)||N;let Oe,Ue=0,Ce=0;return se.forEach((Se,Xe)=>{if(!Se||"line"!==Se.type&&"path"!==Se.type)return;const xe=[];switch(Se.type){case"line":{const Ge=ge(Se,0);if(null==Ge)break;const Ie=(null==Ge?void 0:Ge.width)||0;0===Xe&&(Oe=Ie);const We=Math.min(Ae||Ie,Me),Ze=0===Xe?We:Ae?We*(Ie/Oe):We,ze=Ze>j/2?2*Ze:j;Ce=Math.max(Ce,Ze),Ue=Math.max(Ue,ze),Ge.width=Ze,xe.push({shape:{type:"path",path:[{command:"M",values:[0,.5*Ce]},{command:"L",values:[Ue,.5*Ce]}]},stroke:Ge});break}case"path":{const Ge=Math.min(Ae||B,Me),Ie=le(Se,0),We=le(Se,-.2),Ze=Y(Se,-.4),ze=Ze?{color:Ze,width:1}:{};if("quad"===Se.profile){const tt=Se.width,it=Se.height,rt=(0,k.KX)(tt&&it?tt/it:1,0===it,0===tt),ct={...ze,join:"bevel"};xe.push({shape:rt[0],fill:We,stroke:ct},{shape:rt[1],fill:We,stroke:ct},{shape:rt[2],fill:Ie,stroke:ct})}else xe.push({shape:k.nq.pathSymbol3DLayer[0],fill:We,stroke:ze},{shape:k.nq.pathSymbol3DLayer[1],fill:Ie,stroke:ze});Ce=Math.max(Ce,Ge),Ue=Ce}}re.push(xe)}),Promise.resolve((0,z.fz)(re,[Ue,Ce],{node:null==T?void 0:T.node,scale:pe,opacity:null==T?void 0:T.opacity,ariaLabel:null==T?void 0:T.ariaLabel}))}(C,T);case"polygon-3d":case"mesh-3d":return function te(C,T){return L.apply(this,arguments)}(C,T)}return Promise.reject(new S.A("symbolPreview: swatchInfo3D","symbol not supported."))}},22079:(ke,we,w)=>{w.d(we,{CB:()=>F,D:()=>k,KX:()=>ie,Nz:()=>z,Pc:()=>J,QC:()=>X,cP:()=>I,cZ:()=>fe,dr:()=>q,dt:()=>de,mN:()=>ce,nq:()=>G,sU:()=>S});var F,B,V=w(68677);(B=F||(F={}))[B.size=22]="size",B[B.lineWidth=50]="lineWidth",B[B.maxSize=120]="maxSize",B[B.maxOutlineSize=80]="maxOutlineSize",B[B.tallSymbolWidth=20]="tallSymbolWidth";const G={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function ie(B,D,N){const j=F.size;let U=j,P=j;B<1?U*=.75:B>1&&(P*=1.25);let $=j,ee=j;return D&&N&&(U=P=$=ee=0),[{type:"path",path:[{command:"M",values:[$,0]},{command:"L",values:[N?$:.875*$,0]},{command:"L",values:[N?U-.5*$:0,P-.5*ee]},{command:"L",values:[U-.5*$,P-.5*ee]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[$,0]},{command:"L",values:[$,D?0:.125*ee]},{command:"L",values:[U-.5*$,D?P-.5*ee:ee]},{command:"L",values:[U-.5*$,P-.5*ee]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[U-.5*$,P-.5*ee]},{command:"L",values:[N?U-.5*$:0,P-.5*ee]},{command:"L",values:[N?U-.5*$:0,D?P-.5*ee:ee]},{command:"L",values:[U-.5*$,D?P-.5*ee:ee]},{command:"Z",values:[]}]}]}function S(B){const D=F.size,N=.5*B;return[{type:"path",path:[{command:"M",values:[0,.7*D*.5]},{command:"L",values:[.3*D,.7*D]},{command:"L",values:[.3*D,.7*D+N]},{command:"L",values:[0,.7*D+N-.7*D*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*D,.7*D]},{command:"L",values:[.3*D,.7*D+N]},{command:"L",values:[D,N]},{command:"L",values:[D,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*D,0]},{command:"L",values:[D,0]},{command:"L",values:[.3*D,.7*D]},{command:"L",values:[0,.7*D*.5]},{command:"Z",values:[]}]}]}function I(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function fe(B,D){let N=D?F.tallSymbolWidth:B;const U=D?4:6;N-=N<=F.size?.5*U:U;const ne=D?.35*N:.5*N;return[{type:"path",path:[{command:"M",values:[.5*N,0]},{command:"L",values:[N,.5*ne]},{command:"L",values:[.5*N,ne]},{command:"L",values:[0,.5*ne]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*ne]},{command:"L",values:[.5*N,ne]},{command:"L",values:[.5*N,B]},{command:"L",values:[0,B-.5*ne]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*N,ne]},{command:"L",values:[.5*N,B]},{command:"L",values:[N,B-.5*ne]},{command:"L",values:[N,.5*ne]},{command:"Z",values:[]}]}]}function de(B,D){let N=D?F.tallSymbolWidth:B;const U=D?4:6;N-=N<=F.size?.5*U:U;const P=.5*N,W=.15*N,$=B-W;return[{type:"ellipse",cx:.5*N,cy:$,rx:P,ry:W},{type:"path",path:[{command:"M",values:[0,W]},{command:"L",values:[0,$]},{command:"L",values:[N,$]},{command:"L",values:[N,W]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*N,cy:W,rx:P,ry:W}]}function ce(B,D){let N=D?F.tallSymbolWidth:B;const U=D?4:6;N-=N<=F.size?.5*U:U;const P=.15*N,W=B-P;return[{type:"ellipse",cx:.5*N,cy:W,rx:.5*N,ry:P},{type:"path",path:[{command:"M",values:[.5*N,0]},{command:"L",values:[N,W]},{command:"L",values:[0,W]},{command:"Z",values:[]}]}]}function J(B){let D=B;D-=D<F.size?3:6;const U=.15*D;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[D,0]},{command:"L",values:[.5*D,B-U]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*D,cy:0,rx:.5*D,ry:U}]}function k(B){let D=B;const N=B;D-=D<F.size?2:4;const W=D,ne=N,$=Math.floor(B/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*W,0]},{command:"L",values:[W,.5*ne-$]},{command:"L",values:[.45*W-$,.5*ne+$]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*W,0]},{command:"L",values:[.45*W-$,.5*ne+$]},{command:"L",values:[0,.5*ne-$]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*ne-$]},{command:"L",values:[.45*W-$,.5*ne+$]},{command:"L",values:[.45*W,N]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*W,N]},{command:"L",values:[W,.5*ne-$]},{command:"L",values:[.45*W-$,.5*ne+$]},{command:"Z",values:[]}]}]}function z(B){let j=B;return j-=j<F.size?1:2,[{type:"path",path:[{command:"M",values:[.45*B,0]},{command:"L",values:[B,j]},{command:"L",values:[.45*B,.6*j]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*B,0]},{command:"L",values:[.45*B,.6*j]},{command:"L",values:[0,j]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,j]},{command:"L",values:[.45*B,.6*j]},{command:"L",values:[B,j]},{command:"Z",values:[]}]}]}function q(B,D){return Math.round(Math.min(Math.max(B+255*D*.75,0),255))}function X(B,D){if(null==B)return new V.A;if("type"in B&&("linear"===B.type||"pattern"===B.type))return B;const N=new V.A(B);return new V.A([q(N.r,D),q(N.g,D),q(N.b,D),N.a])}},16633:(ke,we,w)=>{w.d(we,{UB:()=>N,fz:()=>z});var V=w(77469),F=w(89563),G=w(29430),ie=w(5922),S=w(3248),fe=(w(92129),w(76062)),de=w(94013),ce=w(83393);const J=(0,fe.F)();function z(j,U,P){const W=Math.ceil(U[0]),ne=Math.ceil(U[1]);if(!j.some(ee=>!!ee.length))return null;const $=(null==P?void 0:P.node)||document.createElement("div");return null!=P.opacity&&($.style.opacity=P.opacity.toString()),null!=P.effectView&&($.style.filter=(0,ce.di)(P.effectView)),function k(j,U){J.append(j,U),J.detach(U)}($,()=>(0,de.d8)(j,W,ne,P)),$}function D(j,U,P,W,ne){switch(ne){case"multiply":j[U]*=P[0],j[U+1]*=P[1],j[U+2]*=P[2],j[U+3]*=P[3];break;default:{const $=(0,G.N2)({r:j[U],g:j[U+1],b:j[U+2]});$.h=W.h,$.s=W.s,$.v=$.v/100*W.v;const ee=(0,G.$)($);j[U]=ee.r,j[U+1]=ee.g,j[U+2]=ee.b,j[U+3]*=P[3];break}}}function N(j,U,P,W,ne){return function X(j,U,P){return j?(0,F.A)(j,{responseType:"image"}).then(W=>{const ne=W.data,$=ne.width,ee=ne.height,le=$/ee;let ue=U;if(P){const oe=Math.max($,ee);ue=Math.min(ue,oe)}return{image:ne,width:le<=1?Math.ceil(ue*le):ue,height:le<=1?ue:Math.ceil(ue/le)}}):Promise.reject(new ie.A("renderUtils: imageDataSize","href not provided."))}(j,U,ne).then($=>{var ee,le;const ue=null!==(ee=$.width)&&void 0!==ee?ee:U,oe=null!==(le=$.height)&&void 0!==le?le:U;if($.image&&function B(j,U){return!(!j||"ignore"===U||"multiply"===U&&255===j.r&&255===j.g&&255===j.b&&1===j.a)}(P,W)){let he=$.image.width,Y=$.image.height;(0,S.A)("edge")&&/\.svg$/i.test(j)&&(he-=1,Y-=1);const ge=function q(j,U){j=Math.ceil(j),U=Math.ceil(U);const P=document.createElement("canvas");P.width=j,P.height=U,P.style.width=j+"px",P.style.height=U+"px";const W=P.getContext("2d");return W.clearRect(0,0,j,U),W}(ue,oe);ge.drawImage($.image,0,0,he,Y,0,0,ue,oe);const Fe=ge.getImageData(0,0,ue,oe),Le=[P.r/255,P.g/255,P.b/255,P.a],Be=(0,G.N2)(P);for(let Ne=0;Ne<Fe.data.length;Ne+=4)D(Fe.data,Ne,Le,Be,W);ge.putImageData(Fe,0,0),j=ge.canvas.toDataURL("image/png")}else{const he=null==V.id?void 0:V.id.findCredential(j);if(null!=he&&he.token){const Y=j.includes("?")?"&":"?";j=`${j}${Y}token=${he.token}`}}return{url:j,width:ue,height:oe}}).catch(()=>({url:j,width:U,height:U}))}},94013:(ke,we,w)=>{w.d(we,{d8:()=>te});var V=w(68677),F=w(3248),G=w(11432),ie=w(3672),S=w(76329),I=w(8134),de=(w(60421),w(56295));const ce="http://www.w3.org/2000/svg";let J=0,k=0;const z=(0,F.A)("android"),q=(0,F.A)("chrome")||z&&z>=4?"auto":"optimizeLegibility",X={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},B=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let D={},N={};const j=Math.PI;let U=1;function P(L,O){const C=L*(j/180);return Math.abs(O*Math.sin(C))+Math.abs(O*Math.cos(C))}function W(L){return L.map(O=>`${O.command} ${O.values.join(" ")}`).join(" ").trim()}function ne(L,O,C,T,se){if(L){if("circle"===L.type)return(0,de.K)("circle",{cx:L.cx,cy:L.cy,fill:O,"fill-rule":"evenodd",r:L.r,stroke:C.color,"stroke-dasharray":C.dashArray,"stroke-dashoffset":C.dashOffset,"stroke-linecap":C.cap,"stroke-linejoin":C.join,"stroke-miterlimit":"4","stroke-width":C.width});if("ellipse"===L.type)return(0,de.K)("ellipse",{cx:L.cx,cy:L.cy,fill:O,"fill-rule":"evenodd",rx:L.rx,ry:L.ry,stroke:C.color,"stroke-dasharray":C.dashArray,"stroke-linecap":C.cap,"stroke-linejoin":C.join,"stroke-miterlimit":"4","stroke-width":C.width});if("rect"===L.type)return(0,de.K)("rect",{fill:O,"fill-rule":"evenodd",height:L.height,stroke:C.color,"stroke-dasharray":C.dashArray,"stroke-linecap":C.cap,"stroke-linejoin":C.join,"stroke-miterlimit":"4","stroke-width":C.width,width:L.width,x:L.x,y:L.y});if("image"===L.type)return(0,de.K)("image",{alt:se||"image",height:L.height,href:L.src,preserveAspectRatio:"none",width:L.width,x:L.x,y:L.y});if("path"===L.type){const re="string"!=typeof L.path?W(L.path):L.path;return(0,de.K)("path",{d:re,fill:O,"fill-rule":"evenodd",stroke:C.color,"stroke-dasharray":C.dashArray,"stroke-linecap":C.cap,"stroke-linejoin":C.join,"stroke-miterlimit":"4","stroke-width":C.width})}if("text"===L.type)return(0,G.Lw)(T),(0,de.K)("text",{"dominant-baseline":T.dominantBaseline,fill:O,"fill-rule":"evenodd","font-family":T.font.family,"font-size":T.font.size,"font-style":T.font.style,"font-variant":T.font.variant,"font-weight":T.font.weight,kerning:T.kerning,rotate:T.rotate,stroke:C.color,"stroke-dasharray":C.dashArray,"stroke-linecap":C.cap,"stroke-linejoin":C.join,"stroke-miterlimit":"4","stroke-width":C.width,"text-anchor":T.align,"text-decoration":T.decoration,"text-rendering":q,x:L.x,y:L.y},L.text)}return null}function $(L){const O={fill:"none",pattern:null,linearGradient:null};if(L)if("type"in L&&"pattern"===L.type){const C="patternId-"+ ++J;O.fill=`url(#${C})`,O.pattern={id:C,x:L.x,y:L.y,width:L.width,height:L.height,image:{x:0,y:0,width:L.width,height:L.height,href:L.src}}}else if("type"in L&&"linear"===L.type){const C="linearGradientId-"+ ++k;O.fill=`url(#${C})`,O.linearGradient={id:C,x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,stops:L.colors.map(T=>({offset:T.offset,color:T.color&&new V.A(T.color).toString()}))}}else if(L){const C=new V.A(L);O.fill=C.toString()}return O}function ee(L){const O={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};return L&&(null!=L.width&&(O.width=L.width),L.cap&&(O.cap=L.cap),L.join&&(O.join=L.join.toString()),L.color&&(O.color=new V.A(L.color).toString()),L.dashArray&&(O.dashArray=L.dashArray),L.dashoffset&&(O.dashOffset=L.dashoffset),L.style&&!L.dashArray&&(O.dashArray=(0,I.O0)(L).join(",")||"none")),O}function le(L,O){const C={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(L){const T=L.alignBaseline,se="baseline"===T?"auto":"top"===T?"text-top":"bottom"===T?"hanging":T;C.align=L.align,C.dominantBaseline=se,C.decoration=L.decoration,C.kerning=L.kerning?"auto":"0",C.rotate=L.rotated?"90":"0",(0,G.Lw)(O),C.font.style=O.style||"normal",C.font.variant=O.variant||"normal",C.font.weight=O.weight||"normal",C.font.size=O.size&&O.size.toString()||"10pt",C.font.family=O.family||"serif"}return C}function ue(L){const{pattern:O,linearGradient:C}=L;if(O)return(0,de.K)("pattern",{height:O.height,id:O.id,patternUnits:"userSpaceOnUse",width:O.width,x:O.x,y:O.y},(0,de.K)("image",{height:O.image.height,href:O.image.href,width:O.image.width,x:O.image.x,y:O.image.y}));if(C){const T=C.stops.map((se,re)=>(0,de.K)("stop",{key:`${re}-stop`,offset:se.offset,"stop-color":se.color}));return(0,de.K)("linearGradient",{gradientUnits:"userSpaceOnUse",id:C.id,x1:C.x1,x2:C.x2,y1:C.y1,y2:C.y2},T)}return null}function oe(L,O){if(!L||0===L.length)return null;const C=[];for(const T of L){const{shape:se,fill:re,stroke:pe,font:Ae}=T,Me=$(re),Oe=ee(pe),Ue="text"===se.type?le(se,Ae):null,Ce=ne(se,Me.fill,Oe,Ue);Ce&&C.push(Ce)}return(0,de.K)("mask",{id:O,maskUnits:"userSpaceOnUse"},(0,de.K)("g",null,C))}function he(L,O,C){return(0,S.Tl)(L,(0,S.D_)(L),[O,C])}function Y(L,O,C,T,se){return(0,S.hs)(L,(0,S.D_)(L),[O,C]),L[4]=L[4]*O-T*O+T,L[5]=L[5]*C-se*C+se,L}function Fe(L,O){D&&"left"in D?(null!=D.left&&D.left>L&&(D.left=L),(null==D.right||D.right<L)&&(D.right=L),(null==D.top||D.top>O)&&(D.top=O),(null==D.bottom||D.bottom<O)&&(D.bottom=O)):D={left:L,bottom:O,right:L,top:O}}function Le(L){const O=L.args,C=O.length;let T;switch(L.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(T=0;T<C;T+=2)Fe(O[T],O[T+1]);N.x=O[C-2],N.y=O[C-1];break;case"H":for(T=0;T<C;++T)Fe(O[T],N.y);N.x=O[C-1];break;case"V":for(T=0;T<C;++T)Fe(N.x,O[T]);N.y=O[C-1];break;case"m":{let se=0;for(("x"in N||(Fe(N.x=O[0],N.y=O[1]),se=2),T=se);T<C;T+=2)Fe(N.x+=O[T],N.y+=O[T+1]);break}case"l":case"t":for(T=0;T<C;T+=2)Fe(N.x+=O[T],N.y+=O[T+1]);break;case"h":for(T=0;T<C;++T)Fe(N.x+=O[T],N.y);break;case"v":for(T=0;T<C;++T)Fe(N.x,N.y+=O[T]);break;case"c":for(T=0;T<C;T+=6)Fe(N.x+O[T],N.y+O[T+1]),Fe(N.x+O[T+2],N.y+O[T+3]),Fe(N.x+=O[T+4],N.y+=O[T+5]);break;case"s":case"q":for(T=0;T<C;T+=4)Fe(N.x+O[T],N.y+O[T+1]),Fe(N.x+=O[T+2],N.y+=O[T+3]);break;case"A":for(T=0;T<C;T+=7)Fe(O[T+5],O[T+6]);N.x=O[C-2],N.y=O[C-1];break;case"a":for(T=0;T<C;T+=7)Fe(N.x+=O[T+5],N.y+=O[T+6])}}function Be(L,O,C){const T=X[L.toLowerCase()];let se;"number"==typeof T&&(T?O.length>=T&&(se={action:L,args:O.slice(0,O.length-O.length%T)},C.push(se),Le(se)):(se={action:L,args:[]},C.push(se),Le(se)))}function ut(L){const O={x:0,y:0,width:0,height:0};if("circle"===L.type)O.x=L.cx-L.r,O.y=L.cy-L.r,O.width=2*L.r,O.height=2*L.r;else if("ellipse"===L.type)O.x=L.cx-L.rx,O.y=L.cy-L.ry,O.width=2*L.rx,O.height=2*L.ry;else if("image"===L.type||"rect"===L.type)O.x=L.x,O.y=L.y,O.width=L.width,O.height=L.height;else if("path"===L.type){const C=function Ne(L){const O=("string"!=typeof L.path?W(L.path):L.path).match(B),C=[];if(D={},N={},!O)return null;let T="",se=[];const re=O.length;for(let Ae=0;Ae<re;++Ae){const Me=O[Ae],Oe=parseFloat(Me);isNaN(Oe)?(T&&Be(T,se,C),se=[],T=Me):se.push(Oe)}Be(T,se,C);const pe={x:0,y:0,width:0,height:0};return D&&"left"in D&&(pe.x=D.left,pe.y=D.top,pe.width=D.right-D.left,pe.height=D.bottom-D.top),pe}(L);O.x=C.x,O.y=C.y,O.width=C.width,O.height=C.height}return O}function ft(L){const O={x:0,y:0,width:0,height:0};let C=null,T=Number.NEGATIVE_INFINITY,se=Number.NEGATIVE_INFINITY;for(const re of L)C?(C.x=Math.min(C.x,re.x),C.y=Math.min(C.y,re.y),T=Math.max(T,re.x+re.width),se=Math.max(se,re.y+re.height)):(C=O,C.x=re.x,C.y=re.y,T=re.x+re.width,se=re.y+re.height);return C&&(C.width=T-C.x,C.height=se-C.y),C}function st(L,O,C,T,se,re,pe,Ae,Me){let Oe=(pe&&re?P(re,O):O)/2,Ue=(pe&&re?P(re,C):C)/2;if(Me){const Ze=Me[0],ze=Me[1];Oe=(pe&&re?P(re,Ze):Ze)/2,Ue=(pe&&re?P(re,ze):ze)/2}const Ce=L.width+T,Se=L.height+T,Xe=(0,ie.vt)(),xe=(0,ie.vt)();let Ge=!1;if(se&&0!==Ce&&0!==Se){const Ze=O!==C?O/C:Ce/Se,ze=O>C?O:C;let tt=1,it=1;isNaN(ze)||(Ze>1?(tt=ze/Ce,it=ze/Ze/Se):(it=ze/Se,tt=ze*Ze/Ce)),(0,S.lw)(xe,xe,Y(Xe,tt,it,Oe,Ue)),Ge=!0}const Ie=L.x+(Ce-T)/2,We=L.y+(Se-T)/2;if((0,S.lw)(xe,xe,he(Xe,Oe-Ie,Ue-We)),!Ge&&(Ce>O||Se>C)){const Ze=Ce/O>Se/C,ze=(Ze?O:C)/(Ze?Ce:Se);(0,S.lw)(xe,xe,Y(Xe,ze,ze,Ie,We))}return re&&(0,S.lw)(xe,xe,function ge(L,O,C,T){const se=O%360*Math.PI/180;(0,S.e$)(L,(0,S.D_)(L),se);const re=Math.cos(se),pe=Math.sin(se),Ae=L[4],Me=L[5];return L[4]=Ae*re-Me*pe+T*pe-C*re+C,L[5]=Me*re+Ae*pe-C*pe-T*re+T,L}(Xe,re,Ie,We)),Ae&&(0,S.lw)(xe,xe,he(Xe,Ae[0],Ae[1])),`matrix(${xe[0]},${xe[1]},${xe[2]},${xe[3]},${xe[4]},${xe[5]})`}function te(L,O,C,T={}){const se=[],re=[],pe=++U,Ae=function Pt(L,O,C){const T=null==L?void 0:L.effects.find(Oe=>"bloom"===Oe.type);if(!T)return null;const{strength:se,radius:re}=T,pe=se>0?re:0,Ae=(se+pe)*O,Me=4*se+1;return(0,de.K)("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${C}`,width:"300%",x:"-100%",y:"-100%"},(0,de.K)("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:(se+.5*pe)*(5**(O/100)*(.4+O/100)),result:"dilate"}),(0,de.K)("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:Ae/25}),(0,de.K)("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:Ae/50}),(0,de.K)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,de.K)("feFuncR",{slope:Me,type:"linear"}),(0,de.K)("feFuncG",{slope:Me,type:"linear"}),(0,de.K)("feFuncB",{slope:Me,type:"linear"})),(0,de.K)("feMerge",null,(0,de.K)("feMergeNode",{in:"intensityBlur"}),(0,de.K)("feMergeNode",{in:"intensityBrightness"}),(0,de.K)("feGaussianBlur",{stdDeviation:se/10})))}(T.effectView,O,pe);let Me=null;if(Ae){var Oe;const Xe=null===(Oe=T.effectView)||void 0===Oe?void 0:Oe.effects.find(We=>"bloom"===We.type),xe=(Xe.strength?Xe.strength+Xe.radius/2:0)/3,Ie=C+C*xe;Me=[Math.max(O+O*xe,10),Math.max(Ie,10)]}for(let Xe=0;Xe<L.length;Xe++){var Ue,Ce;const xe=L[Xe],Ge=[],Ie=[];let We=0,Ze=0,ze=0;for(const rt of xe){const{shape:ct,fill:Gt,stroke:Qt,font:io,offset:Ii}=rt;T.ignoreStrokeWidth||"text"===ct.type||(We+=(null==Qt?void 0:Qt.width)||0);const Ki=$(Gt),Ei=ee(Qt),xi="text"===ct.type?le(ct,io):null;se.push(ue(Ki)),Ge.push(ne(ct,Ki.fill,Ei,xi,T.ariaLabel)),Ie.push(ut(ct)),Ii&&(Ze+=Ii[0],ze+=Ii[1])}const tt=st(ft(Ie),O,C,We,null!==(Ue=T.scale)&&void 0!==Ue&&Ue,T.rotation,null!==(Ce=T.useRotationSize)&&void 0!==Ce&&Ce,[Ze,ze],Me);let it=null;if(T.masking){const rt=`mask-${Xe}`;se.push(oe(T.masking[Xe],rt)),it=`url(#${rt})`}re.push(it?(0,de.K)("g",{mask:it},(0,de.K)("g",{transform:tt},Ge)):(0,de.K)("g",{transform:tt},Ge))}return T.useRotationSize&&T.rotation&&(O=P(T.rotation,O),C=P(T.rotation,C)),Ae&&((0,G.Lw)(Me),O=Me[0],C=Me[1]),(0,de.K)("svg",{"aria-labelledby":T.ariaLabel,focusable:!1,height:C,role:"img",style:"display: block;",width:O,xmlns:ce},Ae,(0,de.K)("defs",null,se),Ae?(0,de.K)("g",{filter:`url(#bloom${pe})`},re):re)}},36634:(ke,we,w)=>{w.r(we),w.d(we,{getColorFromPointCloudStops:()=>k,getRampStops:()=>I,getRampStopsForPointCloud:()=>J,getStretchRampStops:()=>q});var V=w(10467),F=w(68677),G=w(54501);const ie=new F.A([64,64,64]);function S(X,B){const D=[],N=X.length-1;return 5===X.length?D.push(0,2,4):D.push(0,N),X.map((j,U)=>D.includes(U)?(0,G.createStopLabel)(j,U,N,B):null)}function I(X,B,D){return fe.apply(this,arguments)}function fe(){return fe=(0,V.A)(function*(X,B,D){let N=!1,j=[],U=[];if(X.stops){const $=X.stops;j=$.map(ee=>ee.value),N=$.some(ee=>!!ee.label),N&&(U=$.map(ee=>ee.label))}if(null==j[0]&&null==j[j.length-1])return null;const ne=N?null:S(j,D);return(yield Promise.all(j.map(function(){var $=(0,V.A)(function*(ee,le){var ue;return{value:ee,color:"opacity"===X.type?yield de(ee,X,B):(yield Promise.resolve().then(w.bind(w,77522))).getColor(X,ee),label:N?U[le]:null!==(ue=null==ne?void 0:ne[le])&&void 0!==ue?ue:""}});return function(ee,le){return $.apply(this,arguments)}}()))).reverse()}),fe.apply(this,arguments)}function de(X,B,D){return ce.apply(this,arguments)}function ce(){return(ce=(0,V.A)(function*(X,B,D){const N=new F.A(null!=D?D:ie),j=(yield Promise.resolve().then(w.bind(w,77522))).getOpacity(B,X);return null!=j&&(N.a=j),N})).apply(this,arguments)}function J(X){let B=!1,D=[],N=[];if(D=X.map(W=>W.value),B=X.some(W=>!!W.label),B&&(N=X.map(W=>{var ne;return null!==(ne=W.label)&&void 0!==ne?ne:""})),null==D[0]&&null==D[D.length-1])return null;const P=B?null:S(D);return D.map((W,ne)=>{var $;return{value:W,color:k(W,X),label:B?N[ne]:null!==($=null==P?void 0:P[ne])&&void 0!==$?$:""}}).reverse()}function k(X,B){const{startIndex:D,endIndex:N,weight:j}=function z(X,B){let D=0,N=B.length-1;return B.some((j,U)=>X<j.value?(N=U,!0):(D=U,!1)),{startIndex:D,endIndex:N,weight:(X-B[D].value)/(B[N].value-B[D].value)}}(X,B);if(D===N)return B[D].color;const U=F.A.blendColors(B[D].color,B[N].color,j);return new F.A(U)}function q(X,B){let D=[];if(X&&"multipart"===X.type)X.colorRamps.reverse().forEach((N,j)=>{D.push(0===j?{value:B.max,color:new F.A(N.toColor),label:"high"}:{value:null,color:new F.A(N.toColor),label:""}),D.push(j===X.colorRamps.length-1?{value:B.min,color:new F.A(N.fromColor),label:"low"}:{value:null,color:new F.A(N.fromColor),label:""})});else{let N,j;X&&"algorithmic"===X.type?(N=X.fromColor,j=X.toColor):(N=[0,0,0,1],j=[255,255,255,1]),D=[{value:B.max,color:new F.A(j),label:"high"},{value:B.min,color:new F.A(N),label:"low"}]}return D}},54501:(ke,we,w)=>{w.r(we),w.d(we,{createStopLabel:()=>J,getDateFormatOptions:()=>U,getMedianColor:()=>z,getSymbolForFlowRenderer:()=>X,isRasterBandStatistics:()=>D,rgbImgSource:()=>k,specialCharsGreaterThan:()=>ce,specialCharsLessThan:()=>de});var V=w(10467),G=(w(47280),w(97442)),ie=w(86300),S=w(91515),I=w(43039),fe=w(55417);const de="<",ce=">";function J(P,W,ne,$){let ee="";return 0===W?ee=`${de} `:W===ne&&(ee=`${ce} `),ee+($?(0,I.i0)(P,$):(0,S.GP)(P))}const k=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];function z(P){return q.apply(this,arguments)}function q(){return(q=(0,V.A)(function*(P){var W;if(!("visualVariables"in P)||!P.visualVariables)return null;const ne=P.visualVariables.find(oe=>"color"===oe.type);if(!ne)return null;let $=null,ee=null;if(ne.stops){if(1===ne.stops.length)return ne.stops[0].color;$=ne.stops[0].value,ee=ne.stops[ne.stops.length-1].value}const le=null!=$&&null!=ee?$+(ee-$)/2:0,{getColor:ue}=yield Promise.resolve().then(w.bind(w,77522));return null!==(W=ue(ne,le))&&void 0!==W?W:null})).apply(this,arguments)}function X(P,W){return B.apply(this,arguments)}function B(){return(B=(0,V.A)(function*(P,W){const ne=P.trailCap,$=P.trailWidth||1,ee=W||(yield z(P))||P.color;return new fe.A({cap:ne,color:ee,width:$})})).apply(this,arguments)}function D(P){return null!=P&&"object"==typeof P&&"min"in P&&"max"in P}function U(P,W,ne){const $=function N(P,W){var ne,$;if(!W.field)return null;if("featureReduction"in P)switch(null===(ne=P.featureReduction)||void 0===ne?void 0:ne.type){case"cluster":case"binning":{const ee=P.featureReduction.fields.find(({name:le})=>le.toLowerCase()===W.field.toLowerCase());return ee&&"getField"in P?P.getField(ee.onStatisticField):null}}return"getField"in P?null===($=P.getField)||void 0===$?void 0:$.call(P,W.field):null}(P,W);if(!$||!(0,I.fs)($)&&!(0,ie.OH)($))return null;let ee=function j(P,W){var ne,$;const ee="popupTemplate"in P?null===(ne=P.popupTemplate)||void 0===ne?void 0:ne.fieldInfos:null;if(null!=ee&&ee.length&&W)return null===($=ee.find(le=>{var ue;return(null===(ue=le.fieldName)||void 0===ue?void 0:ue.toLowerCase())===W.toLowerCase()}))||void 0===$||null===($=$.format)||void 0===$?void 0:$.dateFormat}(P,$.name);if(!ee&&"date"===$.type){var le,ue,oe,he,Y,ge;let Fe=0,Le=0;W.stops?(Fe=null!==(le=null===(ue=W.stops)||void 0===ue||null===(ue=ue.at(0))||void 0===ue?void 0:ue.value)&&void 0!==le?le:Fe,Le=null!==(oe=null===(he=W.stops)||void 0===he||null===(he=he.at(-1))||void 0===he?void 0:he.value)&&void 0!==oe?oe:Le):"minDataValue"in W&&"maxDataValue"in W&&(Fe=null!==(Y=W.minDataValue)&&void 0!==Y?Y:Fe,Le=null!==(ge=W.maxDataValue)&&void 0!==ge?ge:Le),ee=Le-Fe>2*G.vf.days?"short-date":"short-date-short-time"}return{fieldType:$.type,format:ee,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in P?P.preferredTimeZone:null,viewTimeZone:ne,datesInUnknownTimezone:"datesInUnknownTimezone"in P&&P.datesInUnknownTimezone}}}},83680:(ke,we,w)=>{w.r(we),w.d(we,{default:()=>ta});var V=w(10467),F=w(8189),G=w(23159),ie=w(35150),S=w(48900),I=w(85211),ce=(w(3248),w(40707),w(76576)),J=w(11342),z=(w(13242),w(31178));function q(v,y,g,_){let M=null,b=1e3;"number"==typeof y?(b=y,_=g):(M=null!=y?y:null,b=g);let A,E=0;const x=()=>{E=0,v.apply(_,A)},R=(...Z)=>{M&&M.apply(_,Z),A=Z,b?E||(E=setTimeout(x,b)):x()};return R.remove=()=>{E&&(clearTimeout(E),E=0)},R.forceUpdate=()=>{E&&(clearTimeout(E),x())},R.hasPendingUpdates=()=>!!E,R}function N(v){var y;switch(null==v?void 0:v.type){case"point":return v;case"extent":return v.center;case"polygon":return v.centroid;case"multipoint":case"polyline":return null===(y=v.extent)||void 0===y?void 0:y.center;default:return null}}w(21152),w(40856),w(28067);var $=w(46186);function le(v){return v?{backgroundImage:`url(${v})`}:{}}var oe=w(48669),he=w(2188),Y=w(5922),ge=w(63583),Le=(w(73596),w(69287)),Be=w(82663);function st(v,y,g="arithmetic"){return{type:(0,Be.t$)(y),value:v,unit:y,rotationType:g}}(function ut(v,y){(0,Be.t$)(y)})(0,"meters"),function ft(v,y){(0,Be.t$)(y)}(0,"square-meters"),st(0,"radians"),st(0,"degrees"),st(0,"degrees","geographic");var Ce=w(1119),Se=w(68479);const no=["B","kB","MB","GB","TB"];var li=w(81098),$t=w(98877),Es=w(70994),oo=w(52466),Ci=w(48266),mi=w(86300),xs=w(58443),ji=w(43039),so=w(48218),ro=w(22639);const lo=()=>ie.A.getLogger("esri.widgets.Feature.support.featureUtils"),Ls=/href=(""|'')/gi,Ts=/(\{([^\{\r\n]+)\})/g,Os=/\'/g,ao=/^\s*expression\//i,Ps=/(\n)/gi,Rs=/[\u00A0-\u9999<>\&]/gim,Ss=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,$s=/^(?:mailto:|tel:)/,uo="relationships/",co=(0,Ci.J2)("short-date-short-time");function ho(v){var y;if(null!=v)return null!==(y=v.sourceLayer||v.layer)&&void 0!==y?y:void 0}function Li(v,y){return Wi.apply(this,arguments)}function Wi(){return(Wi=(0,V.A)(function*(v,y){return"function"==typeof v?v(y):v})).apply(this,arguments)}function po(v=""){if(v)return!$s.test(v.trim().toLowerCase())}function Hi(v){return!!v&&ao.test(v)}function mo(v,y){const g=function Ds(v,y){if(!Hi(y)||!v)return;const g=y.replace(ao,"").toLowerCase();return v.find(({name:_})=>_.toLowerCase()===g)}(y,null==v?void 0:v.fieldName);return g?g.title||null:v?v.label||v.fieldName:null}function vi(v,y){const g=ki(y,v);return g?g.name:v}function ki(v,y){var g;return v&&"function"==typeof v.getField&&y&&null!==(g=v.getField(y))&&void 0!==g?g:null}function vo(v){return`${v}`.trim()}function Yt({attributes:v,globalAttributes:y,layer:g,text:_,expressionAttributes:M,fieldInfoMap:b}){return _?Gi({formattedAttributes:y,template:Ks(_,{...y,...M,...v},g),fieldInfoMap:b}):""}function Gi({formattedAttributes:v,template:y,fieldInfoMap:g}){return vo(function Zs(v){return v.replaceAll(Ls,"")}((0,Ce.HC)((0,Ce.HC)(y,_=>function Us(v,y){const g=y.get(v.toLowerCase());return`{${(null==g?void 0:g.fieldName)||v}}`}(_,g)),v)))}function Qi(v,y){return v.replaceAll(Ts,(g,_,M)=>{const b=ki(y,M);return b?`{${b.name}}`:_})}function Ks(v,y,g){const _=Qi(v,g);return _&&_.replaceAll(Ss,(M,b,A)=>function zs(v,y,g){const _=(y=vo(y))&&"{"!==y[0];return(0,Ce.HC)(v,function Vs(v,y=!1){const g={...v};return Object.keys(g).forEach(_=>function Ns(v,y,g=!1){const _=y[v];if("string"==typeof _){const M="%27",b=(g?encodeURIComponent(_):_).replaceAll(Os,M);y[v]=b}}(_,g,y)),g}(g,_||!1))}(M,b||A,y))}function Yi(v){return function Ws(v){return null!=v&&"object"==typeof v&&"fieldsIndex"in v&&"geometryType"in v&&"getField"in v&&"load"in v&&"loaded"in v&&"objectIdField"in v&&"spatialReference"in v&&"type"in v&&("feature"===v.type||"scene"===v.type)&&"when"in v}(v)&&function Hs(v){return null!=v&&"object"==typeof v&&"createQuery"in v&&"queryFeatureCount"in v&&"queryObjectIds"in v&&"queryRelatedFeatures"in v&&"queryRelatedFeaturesCount"in v&&"relationships"in v}(v)}function Ji(v,y,g,_){return v.trim().split(y).map(M=>(0,Se.ZV)(Number(M),(0,Se.yx)(_))).join(g)}function fo(v,y){if(null!=v&&v.length&&y)return v.find(g=>{var _;return(null===(_=g.fieldName)||void 0===_?void 0:_.toLowerCase())===y.toLowerCase()})}function yo(v){const y=[];if(!v)return y;const{fieldInfos:g,content:_}=v;return g&&y.push(...g),_&&Array.isArray(_)&&_.forEach(M=>{if("fields"===M.type){const b=null==M?void 0:M.fieldInfos;b&&y.push(...b)}}),y}function Xi(v){return v.replaceAll(Rs,y=>`&#${y.charCodeAt(0)};`)}function fi(v){return"string"==typeof v?v.replaceAll(Ps,'<br class="esri-text-new-line" />'):v}function go(v){var y;const{value:g,fieldName:_,fieldInfos:M,fieldInfoMap:b,layer:A,graphic:E,timeZone:x}=v;if(null==g)return"";const R=function Ys({fieldName:v,value:y,graphic:g,layer:_}){if(Dt(v)||!_||"function"!=typeof _.getFieldDomain)return null;const M=g&&_.getFieldDomain(v,{feature:g});return M&&"coded-value"===M.type?M.getName(y):null}({fieldName:_,value:g,graphic:E,layer:A});if(R)return R;const Z=function Qs({fieldName:v,graphic:y,layer:g}){if(Dt(v)||!g||"function"!=typeof g.getFeatureType)return null;const{typeIdField:_}=g;if(!_||v!==_)return null;const M=g.getFeatureType(y);return M?M.name:null}({fieldName:_,graphic:E,layer:A});if(Z)return Z;if(b.get(_.toLowerCase()))return function ks(v,y){const{fieldInfos:g,fieldName:_,preventPlacesFormatting:M,layer:b,timeZone:A}=y,E=fo(g,_),x=ki(b,_);if(E&&!(0,mi.JL)(_)){var R;const K=null==x?void 0:x.type,H=null===(R=E.format)||void 0===R?void 0:R.dateFormat;if("date"===K||"date-only"===K||"time-only"===K||"timestamp-offset"===K||H)return(0,ji.i0)(v,{format:H,fieldType:K,timeZoneOptions:{layerTimeZone:b&&"preferredTimeZone"in b?b.preferredTimeZone:null,viewTimeZone:A,datesInUnknownTimezone:!(!b||!("datesInUnknownTimezone"in b)||!b.datesInUnknownTimezone)}})}const Z=null==E?void 0:E.format;return"string"==typeof v&&(0,mi.JL)(_)&&Z?function Gs(v,y){return v=v.trim(),/\d{2}-\d{2}/.test(v)?v:v.includes(",")?Ji(v,",",", ",y):v.includes(";")?Ji(v,";","; ",y):v.includes(" ")?Ji(v," "," ",y):(0,Se.ZV)(Number(v),(0,Se.yx)(y))}(v,Z):"string"==typeof(v=function js(v,y){if("string"==typeof v&&y&&null==y.dateFormat&&(null!=y.places||null!=y.digitSeparator)){const g=Number(v);if(!isNaN(g))return g}return v}(v,Z))||null==v||null==Z?fi(v):(0,Se.ZV)(v,M?{...(0,Se.yx)(Z),minimumFractionDigits:0,maximumFractionDigits:20}:(0,Se.yx)(Z))}(g,{fieldInfos:M||Array.from(b.values()),fieldName:_,layer:A,timeZone:x});const K=null==A||null===(y=A.fieldsIndex)||void 0===y?void 0:y.get(_);return K&&((0,ji.fs)(K)||(0,mi.OH)(K))?(0,ji.i0)(g,{fieldType:K.type,timeZoneOptions:{layerTimeZone:A&&"preferredTimeZone"in A?A.preferredTimeZone:null,viewTimeZone:x,datesInUnknownTimezone:!(!A||!("datesInUnknownTimezone"in A)||!A.datesInUnknownTimezone)}}):fi(g)}function qi({fieldInfos:v,attributes:y,layer:g,graphic:_,fieldInfoMap:M,relatedInfos:b,timeZone:A}){const E={};return null!=b&&b.forEach(x=>function ir({attributes:v,relatedInfo:y,fieldInfoMap:g,fieldInfos:_,layer:M,timeZone:b}){var A,E;v&&y&&(null!==(A=y.relatedFeatures)&&void 0!==A&&A.forEach(x=>Mo({attributes:v,graphic:x,relatedInfo:y,fieldInfoMap:g,fieldInfos:_,layer:M,timeZone:b})),null===(E=y.relatedStatsFeatures)||void 0===E||E.forEach(x=>Mo({attributes:v,graphic:x,relatedInfo:y,fieldInfoMap:g,fieldInfos:_,layer:M,timeZone:b})))}({attributes:E,relatedInfo:x,fieldInfoMap:M,fieldInfos:v,layer:g,timeZone:A})),y&&Object.keys(y).forEach(x=>{E[x]=go({fieldName:x,fieldInfos:v,fieldInfoMap:M,layer:g,value:y[x],graphic:_,timeZone:A})}),E}function _o(v,y){return en.apply(this,arguments)}function en(){return(en=(0,V.A)(function*(v,y){var g;const{layer:_,graphic:M,outFields:b,objectIds:A,returnGeometry:E,spatialReference:x}=v,R=A[0];if("number"!=typeof R&&"string"!=typeof R){const K="Could not query required fields for the specified feature. The feature's ID is invalid.",H={layer:_,graphic:M,objectId:R,requiredFields:b};return lo().warn(K,H),null}if(null===(g=(0,xs.BR)(_))||void 0===g||null===(g=g.operations)||void 0===g||!g.supportsQuery){const K="The specified layer cannot be queried. The following fields will not be available.",H={layer:_,graphic:M,requiredFields:b,returnGeometry:E};return lo().warn(K,H),null}const Z=_.createQuery();return Z.objectIds=A,Z.outFields=null!=b&&b.length?b:[_.objectIdField],Z.returnGeometry=!!E,Z.returnZ=!!E,Z.returnM=!!E,Z.outSpatialReference=x,(yield _.queryFeatures(Z,y)).features[0]})).apply(this,arguments)}function tn(){return(tn=(0,V.A)(function*(v){var y;if(null===(y=v.expressionInfos)||void 0===y||!y.length)return!1;const g=yield(0,so.lw)(),{arcadeUtils:{hasGeometryFunctions:_}}=g;return _(v)})).apply(this,arguments)}function nn(){return nn=(0,V.A)(function*({graphic:v,popupTemplate:y,layer:g,spatialReference:_},M){if(!g||!y||("function"==typeof g.load&&(yield g.load(M)),!v.attributes))return;const b=v.attributes[g.objectIdField];if(null==b)return;const A=[b],E=yield y.getRequiredFields(g.fieldsIndex),x=(0,mi.Kl)(E,v),R=x?[]:E,Z=y.returnGeometry||(yield function qs(v){return tn.apply(this,arguments)}(y));if(x&&!Z)return;const K=yield _o({layer:g,graphic:v,outFields:R,objectIds:A,returnGeometry:Z,spatialReference:_},M);K&&(K.geometry&&(v.geometry=K.geometry),K.attributes&&(v.attributes={...v.attributes,...K.attributes}))}),nn.apply(this,arguments)}function Dt(v=""){return!!v&&v.includes(uo)}function Mo({attributes:v,graphic:y,relatedInfo:g,fieldInfos:_,fieldInfoMap:M,layer:b,timeZone:A}){v&&y&&g&&Object.keys(y.attributes).forEach(E=>{const x=function tr(v){return v?`${uo}${v.layerId}/${v.fieldName}`:""}({layerId:g.relation.id.toString(),fieldName:E});v[x]=go({fieldName:x,fieldInfos:_,fieldInfoMap:M,layer:b,value:y.attributes[E],graphic:y,timeZone:A})})}const bo=v=>{if(!v)return!1;const y=v.toUpperCase();return y.includes("CURRENT_TIMESTAMP")||y.includes("CURRENT_DATE")||y.includes("CURRENT_TIME")},wo=({layer:v,method:y,query:g,definitionExpression:_})=>{var M;if(null===(M=v.capabilities)||void 0===M||null===(M=M.query)||void 0===M||!M.supportsCacheHint||"attachments"===y)return;const b=null!=g.where?g.where:null,A=null!=g.geometry?g.geometry:null;bo(_)||bo(b)||"extent"===(null==A?void 0:A.type)||"tile"===g.resultType||(g.cacheHint=!0)};function Ao(v,y,{relatedTableId:g}){const _="scene"===y.type&&y.associatedLayer?y.associatedLayer.url:y.url;return v.filter(Yi).find(M=>M!==y&&M.url===_&&M.layerId===g)}const Fo={editing:!1,operations:{add:!0,update:!0,delete:!0}},Io=z.A.ofType(Es.A);let wt=class extends $t.A{constructor(v){super(v),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...Fo},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new Io,this.fileInfos=new z.A,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,S.wB)(()=>this.graphic,()=>this._graphicChanged(),S.Vh))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(v){return{...Fo,...v}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:v}=this;if(!v)return!1;const y=v.layer||v.sourceLayer;return(null==y?void 0:y.loaded)&&"capabilities"in y&&y.capabilities&&"operations"in y.capabilities&&"supportsResizeAttachments"in y.capabilities.operations&&y.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){var v=this;return(0,V.A)(function*(){const{_attachmentLayer:y,attachmentInfos:g}=v;if(!y||"function"!=typeof y.queryAttachments)throw new Y.A("invalid-layer","getAttachments(): A valid layer is required.");const _=v._getObjectId(),M=new oo.A({objectIds:[_],returnMetadata:!0}),b=[],A=y.queryAttachments(M).then(x=>x[_]||b).catch(()=>b);v._getAttachmentsPromise=A,v.notifyChange("state");const E=yield A;return g.removeAll(),E.length&&g.addMany(E),v._getAttachmentsPromise=null,v.notifyChange("state"),E})()}addAttachment(v,y=this.graphic){var g=this;return(0,V.A)(function*(){var _;const{_attachmentLayer:M,attachmentInfos:b,capabilities:A}=g;if(!y)throw new Y.A("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:y});if(!v)throw new Y.A("invalid-attachment","addAttachment(): An attachment is required.",{attachment:v});if(null===(_=A.operations)||void 0===_||!_.add)throw new Y.A("invalid-capabilities","addAttachment(): add capabilities are required.");if(!M||"function"!=typeof M.addAttachment)throw new Y.A("invalid-layer","addAttachment(): A valid layer is required.");const E=M.addAttachment(y,v).then(R=>g._queryAttachment(R.objectId,y)),x=yield E;return b.add(x),x})()}deleteAttachment(v){var y=this;return(0,V.A)(function*(){var g;const{_attachmentLayer:_,attachmentInfos:M,graphic:b,capabilities:A}=y;if(!v)throw new Y.A("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:v});if(null===(g=A.operations)||void 0===g||!g.delete)throw new Y.A("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!_||"function"!=typeof _.deleteAttachments)throw new Y.A("invalid-layer","deleteAttachment(): A valid layer is required.");if(!b)throw new Y.A("invalid-graphic","deleteAttachment(): A graphic is required.");const E=_.deleteAttachments(b,[v.id]).then(()=>v),x=yield E;return M.remove(x),x})()}updateAttachment(v,y=this.activeAttachmentInfo){var g=this;return(0,V.A)(function*(){var _;const{_attachmentLayer:M,attachmentInfos:b,graphic:A,capabilities:E}=g;if(!v)throw new Y.A("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:v});if(!y)throw new Y.A("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:y});if(null===(_=E.operations)||void 0===_||!_.update)throw new Y.A("invalid-capabilities","updateAttachment(): Update capabilities are required.");const x=b.indexOf(y);if(!M||"function"!=typeof M.updateAttachment)throw new Y.A("invalid-layer","updateAttachment(): A valid layer is required.");if(!A)throw new Y.A("invalid-graphic","updateAttachment(): A graphic is required.");const R=M.updateAttachment(A,y.id,v).then(K=>g._queryAttachment(K.objectId)),Z=yield R;return b.splice(x,1,Z),Z})()}commitFiles(){var v=this;return(0,V.A)(function*(){return yield Promise.all(v.fileInfos.items.map(y=>v.addAttachment(y.form))),v.fileInfos.removeAll(),v.getAttachments()})()}addFile(v,y){if(!v||!y)return null;const g={file:v,form:y};return this.fileInfos.add(g),g}updateFile(v,y,g=this.activeFileInfo){if(!v||!y||!g)return null;const _=this.fileInfos.indexOf(g);return _>-1&&this.fileInfos.splice(_,1,{file:v,form:y}),this.fileInfos.items[_]}deleteFile(v){const y=this.fileInfos.find(g=>g.file===v);return y?(this.fileInfos.remove(y),y):null}_queryAttachment(v,y){var g=this;return(0,V.A)(function*(){const{_attachmentLayer:_}=g;if(!v||null==_||!_.queryAttachments)throw new Y.A("invalid-attachment-id","Could not query attachment.");const M=g._getObjectId(y),b=new oo.A({objectIds:[M],attachmentsWhere:`AttachmentId=${v}`,returnMetadata:!0});return _.queryAttachments(b).then(A=>A[M][0])})()}_getObjectId(v=this.graphic){var y;return null!==(y=null==v?void 0:v.getObjectId())&&void 0!==y?y:null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:v}=this,y=ho(v);this._attachmentLayer=y?"scene"===y.type&&null!=y.associatedLayer?y.associatedLayer:y:null}};(0,F._)([(0,I.MZ)()],wt.prototype,"capabilities",void 0),(0,F._)([(0,oe.w)("capabilities")],wt.prototype,"castCapabilities",null),(0,F._)([(0,I.MZ)()],wt.prototype,"activeAttachmentInfo",void 0),(0,F._)([(0,I.MZ)()],wt.prototype,"activeFileInfo",void 0),(0,F._)([(0,I.MZ)({readOnly:!0,type:Io})],wt.prototype,"attachmentInfos",void 0),(0,F._)([(0,I.MZ)()],wt.prototype,"fileInfos",void 0),(0,F._)([(0,I.MZ)({type:li.A})],wt.prototype,"graphic",void 0),(0,F._)([(0,I.MZ)()],wt.prototype,"mode",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],wt.prototype,"state",null),(0,F._)([(0,I.MZ)()],wt.prototype,"filesEnabled",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],wt.prototype,"supportsResizeAttachments",null),wt=(0,F._)([(0,ce.$)("esri.widgets.Attachments.AttachmentsViewModel")],wt);const on=wt;var rr=w(90261);function Eo(v){const y=v.toLowerCase();return"image/bmp"===y||"image/emf"===y||"image/exif"===y||"image/gif"===y||"image/x-icon"===y||"image/jpeg"===y||"image/png"===y||"image/tiff"===y||"image/x-wmf"===y}var ai=w(98091),Pe=w(92190),Et=w(37360),xt=w(60421),Ft=w(5668),Q=w(56295);const xo={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},je="esri-attachments",Te={base:je,loaderContainer:`${je}__loader-container`,loader:`${je}__loader`,fadeIn:`${je}--fade-in`,container:`${je}__container`,containerList:`${je}__container--list`,containerPreview:`${je}__container--preview`,actions:`${je}__actions`,deleteButton:`${je}__delete-button`,addAttachmentButton:`${je}__add-attachment-button`,errorMessage:`${je}__error-message`,items:`${je}__items`,item:`${je}__item`,itemButton:`${je}__item-button`,itemMask:`${je}__item-mask`,itemMaskIcon:`${je}__item-mask--icon`,itemImage:`${je}__image`,itemImageResizable:`${je}__image--resizable`,itemLabel:`${je}__label`,itemFilename:`${je}__filename`,itemChevronIcon:`${je}__item-chevron-icon`,itemLink:`${je}__item-link`,itemLinkOverlay:`${je}__item-link-overlay`,itemLinkOverlayIcon:`${je}__item-link-overlay-icon`,itemEditIcon:`${je}__item-edit-icon`,itemAddIcon:`${je}__item-add-icon`,itemAddButton:`${je}__item-add-button`,formNode:`${je}__form-node`,fileFieldset:`${je}__file-fieldset`,fileLabel:`${je}__file-label`,fileName:`${je}__file-name`,fileInput:`${je}__file-input`,metadata:`${je}__metadata`,metadataFieldset:`${je}__metadata-fieldset`,progressBar:`${je}__progress-bar`},sn=window.CSS;let yt=class extends he.A{constructor(v,y){super(v,y),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...xo},this._supportsImageOrientation=sn&&sn.supports&&sn.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(v){var y;return null!==(y=v)&&void 0!==y&&y.viewModel||(v={viewModel:new on,...v}),v}initialize(){this.addHandles([(0,S.on)(()=>{var v;return null===(v=this.viewModel)||void 0===v?void 0:v.attachmentInfos},"change",()=>this.scheduleRender()),(0,S.on)(()=>{var v;return null===(v=this.viewModel)||void 0===v?void 0:v.fileInfos},"change",()=>this.scheduleRender()),(0,S.wB)(()=>{var v;return null===(v=this.viewModel)||void 0===v?void 0:v.mode},()=>this._modeChanged(),S.Vh)])}loadDependencies(){return(0,ai.W)({icon:()=>Promise.all([w.e(2597),w.e(8278)]).then(w.bind(w,8278))})}get capabilities(){return this.viewModel.capabilities}set capabilities(v){this.viewModel.capabilities=v}get effectiveDisplayType(){const{displayType:v}=this;return v&&"auto"!==v?v:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(v){this.viewModel.graphic=v}get label(){var v,y;return null!==(v=null===(y=this.messages)||void 0===y?void 0:y.widgetLabel)&&void 0!==v?v:""}set label(v){this._overrideIfSome("label",v)}castVisibleElements(v){return{...xo,...v}}addAttachment(){const{_addAttachmentForm:v,viewModel:y}=this;return this._set("submitting",!0),this._set("error",null),y.addAttachment(v).then(g=>(this._set("submitting",!1),this._set("error",null),y.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new Y.A("attachments:add-attachment",this.messages.addErrorMessage,g)),g})}deleteAttachment(v){const{viewModel:y}=this;return this._set("submitting",!0),this._set("error",null),y.deleteAttachment(v).then(g=>(this._set("submitting",!1),this._set("error",null),y.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new Y.A("attachments:delete-attachment",this.messages.deleteErrorMessage,g)),g})}updateAttachment(){const{viewModel:v}=this,{_updateAttachmentForm:y}=this;return this._set("submitting",!0),this._set("error",null),v.updateAttachment(y).then(g=>(this._set("submitting",!1),this._set("error",null),v.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new Y.A("attachments:update-attachment",this.messages.updateErrorMessage,g)),g})}addFile(){const v=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",v}updateFile(){const{viewModel:v}=this,y=v.updateFile(this.selectedFile,this._updateAttachmentForm,v.activeFileInfo);return v.mode="view",y}deleteFile(v){var y;const g=this.viewModel.deleteFile(v||(null===(y=this.viewModel.activeFileInfo)||void 0===y?void 0:y.file));return this.viewModel.mode="view",g}render(){const{submitting:v,viewModel:y}=this,{state:g}=y;return(0,Q.K)("div",{class:this.classes(Te.base,Pe.D.widget)},v?this._renderProgressBar():null,"loading"===g?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:v,visibleElements:y}=this;return v&&y.errorMessage?(0,Q.K)("div",{class:Te.errorMessage,key:"error-message"},v.message):null}_renderAttachments(){const{activeFileInfo:v,mode:y,activeAttachmentInfo:g}=this.viewModel;return"add"===y?this._renderAddForm():"edit"===y?this._renderDetailsForm(g||v):this._renderAttachmentContainer()}_renderLoading(){return(0,Q.K)("div",{class:Te.loaderContainer,key:"loader"},(0,Q.K)("div",{class:Te.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,Q.K)("div",{class:Te.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:v,selectedFile:y}=this,g=v||!y,_=this.visibleElements.cancelAddButton?(0,Q.K)("button",{bind:this,class:this.classes(Pe.D.button,Pe.D.buttonTertiary,Pe.D.buttonSmall,Pe.D.buttonHalf,v&&Pe.D.buttonDisabled),disabled:v,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,M=this.visibleElements.addSubmitButton?(0,Q.K)("button",{class:this.classes(Pe.D.button,Pe.D.buttonSecondary,Pe.D.buttonSmall,Pe.D.buttonHalf,{[Pe.D.buttonDisabled]:g}),disabled:g,type:"submit"},this.messages.add):null,b=y?(0,Q.K)("span",{class:Te.fileName,key:"file-name"},y.name):null,A=(0,Q.K)("form",{afterCreate:xt.cA,afterRemoved:xt.N_,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,Q.K)("fieldset",{class:Te.fileFieldset},b,(0,Q.K)("label",{class:this.classes(Te.fileLabel,Pe.D.button,Pe.D.buttonSecondary)},y?this.messages.changeFile:this.messages.selectFile,(0,Q.K)("input",{bind:this,class:Te.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),M,_);return(0,Q.K)("div",{class:Te.formNode,key:"add-form-container"},A)}_renderDetailsForm(v){var y,g,_,M;const{visibleElements:b,viewModel:A,selectedFile:E,submitting:x}=this,{capabilities:R}=A,Z=x||!E;let K,H,ae,me;E?(K=E.type,H=E.name,ae=E.size):v&&"file"in v?(K=v.file.type,H=v.file.name,ae=v.file.size):v&&"contentType"in v&&(K=v.contentType,H=v.name,ae=v.size,me=v.url);const ve=R.editing&&null!==(y=R.operations)&&void 0!==y&&y.delete&&b.deleteButton?(0,Q.K)("button",{bind:this,class:this.classes(Pe.D.button,Pe.D.buttonSmall,Pe.D.buttonTertiary,Te.deleteButton,{[Pe.D.buttonDisabled]:x}),disabled:x,key:"delete-button",onclick:Je=>this._submitDeleteAttachment(Je,v),type:"button"},this.messages.delete):void 0,ye=R.editing&&null!==(g=R.operations)&&void 0!==g&&g.update&&b.updateButton?(0,Q.K)("button",{class:this.classes(Pe.D.button,Pe.D.buttonSmall,Pe.D.buttonThird,{[Pe.D.buttonDisabled]:Z}),disabled:Z,key:"update-button",type:"submit"},this.messages.update):void 0,_e=this.visibleElements.cancelUpdateButton?(0,Q.K)("button",{bind:this,class:this.classes(Pe.D.button,Pe.D.buttonSmall,Pe.D.buttonTertiary,Pe.D.buttonThird,{[Pe.D.buttonDisabled]:x}),disabled:x,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,be=R.editing&&null!==(_=R.operations)&&void 0!==_&&_.update?(0,Q.K)("fieldset",{class:Te.fileFieldset,key:"file"},(0,Q.K)("span",{class:Te.fileName,key:"file-name"},H),(0,Q.K)("label",{class:this.classes(Te.fileLabel,Pe.D.button,Pe.D.buttonSecondary)},this.messages.changeFile,(0,Q.K)("input",{bind:this,class:Te.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,Ee=(0,Q.K)("fieldset",{class:Te.metadataFieldset,key:"size"},(0,Q.K)("label",null,function Is(v,y){let g=0===(y=Math.round(y))?0:Math.floor(Math.log(y)/Math.log(ge.u.KILOBYTES));g=(0,Le.qE)(g,0,no.length-1);const _=(0,Se.ZV)(y/ge.u.KILOBYTES**g,{maximumFractionDigits:2});return(0,Ce.HC)(v.units.bytes[no[g]],{fileSize:_})}(this.messagesUnits,null!==(M=ae)&&void 0!==M?M:0))),Re=(0,Q.K)("fieldset",{class:Te.metadataFieldset,key:"content-type"},(0,Q.K)("label",null,K)),De=null!=me?(0,Q.K)("a",{class:Te.itemLink,href:me,rel:"noreferrer",target:"_blank"},this._renderImageMask(v,400),(0,Q.K)("div",{class:Te.itemLinkOverlay},(0,Q.K)("span",{class:Te.itemLinkOverlayIcon},(0,Q.K)("calcite-icon",{icon:"launch"})))):this._renderImageMask(v,400),Ve=(0,Q.K)("form",{afterCreate:xt.cA,afterRemoved:xt.N_,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:Je=>this._submitUpdateAttachment(Je,v)},(0,Q.K)("div",{class:Te.metadata},Ee,Re),be,(0,Q.K)("div",{class:Te.actions},ve,_e,ye));return(0,Q.K)("div",{class:Te.formNode,key:"edit-form-container"},De,Ve)}_renderImageMask(v,y){return v?"file"in v?this._renderGenericImageMask(v.file.name,v.file.type):this._renderImageMaskForAttachment(v,y):null}_renderGenericImageMask(v,y){const{supportsResizeAttachments:g}=this.viewModel,_=function lr(v){const y=(0,rr.s)("esri/themes/base/images/files/");return v?"text/plain"===v?`${y}text-32.svg`:"application/pdf"===v?`${y}pdf-32.svg`:"text/csv"===v?`${y}csv-32.svg`:"application/gpx+xml"===v?`${y}gpx-32.svg`:"application/x-dwf"===v?`${y}cad-32.svg`:"application/postscript"===v||"application/json"===v||"text/xml"===v||"model/vrml"===v?`${y}code-32.svg`:"application/x-zip-compressed"===v||"application/x-7z-compressed"===v||"application/x-gzip"===v||"application/x-tar"===v||"application/x-gtar"===v||"application/x-bzip2"===v||"application/gzip"===v||"application/x-compress"===v||"application/x-apple-diskimage"===v||"application/x-rar-compressed"===v||"application/zip"===v?`${y}zip-32.svg`:v.includes("image/")?`${y}image-32.svg`:v.includes("audio/")?`${y}sound-32.svg`:v.includes("video/")?`${y}video-32.svg`:v.includes("msexcel")||v.includes("ms-excel")||v.includes("spreadsheetml")?`${y}excel-32.svg`:v.includes("msword")||v.includes("ms-word")||v.includes("wordprocessingml")?`${y}word-32.svg`:v.includes("powerpoint")||v.includes("presentationml")?`${y}report-32.svg`:`${y}generic-32.svg`:`${y}generic-32.svg`}(y),M={[Te.itemImageResizable]:g};return(0,Q.K)("div",{class:this.classes(Te.itemMaskIcon,Te.itemMask),key:_},(0,Q.K)("img",{alt:v,class:this.classes(M,Te.itemImage),src:_,title:v}))}_renderImageMaskForAttachment(v,y){const{supportsResizeAttachments:g}=this.viewModel;if(!v)return null;const{contentType:_,name:M,url:b}=v;if(!g||!Eo(_))return this._renderGenericImageMask(M,_);const A=this._getCSSTransform(v),E=A?{transform:A,"image-orientation":"none"}:{},x=`${b}${null!=b&&b.includes("?")?"&":"?"}w=${y}`,R={[Te.itemImageResizable]:g};return(0,Q.K)("div",{class:this.classes(Te.itemMask),key:x},(0,Q.K)("img",{alt:M,class:this.classes(R,Te.itemImage),src:x,styles:E,title:M}))}_renderFile(v){const{file:y}=v;return(0,Q.K)("li",{class:Te.item,key:y},(0,Q.K)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:Te.itemButton,key:"details-button",onclick:()=>this._startEditFile(v),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(v),(0,Q.K)("label",{class:Te.itemLabel},(0,Q.K)("span",{class:Te.itemFilename},y.name||this.messages.noTitle),(0,Q.K)("span",{"aria-hidden":"true",class:this.classes(Te.itemChevronIcon,(0,xt.V8)(this.container)?Et.T.left:Et.T.right)}))))}_renderAttachmentInfo({attachmentInfo:v,displayType:y}){const{viewModel:g,effectiveDisplayType:_}=this,{capabilities:M,supportsResizeAttachments:b}=g,{contentType:A,name:E,url:x}=v,R=this._renderImageMask(v,"list"===y?48:400),Z=M.editing?(0,Q.K)("span",{"aria-hidden":"true",class:this.classes(Te.itemChevronIcon,(0,xt.V8)(this.container)?Et.T.left:Et.T.right)}):null,K=[R,"preview"===_&&b&&Eo(A)?null:(0,Q.K)("label",{class:Te.itemLabel},(0,Q.K)("span",{class:Te.itemFilename},E||this.messages.noTitle),Z)],H=M.editing?(0,Q.K)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:Te.itemButton,"data-attachment-info-id":v.id,key:"details-button",onclick:()=>this._startEditAttachment(v),title:this.messages.attachmentDetails,type:"button"},K):(0,Q.K)("a",{class:Te.itemButton,href:null!=x?x:void 0,key:"details-link",target:"_blank"},K);return(0,Q.K)("li",{class:Te.item,key:v},H)}_renderAttachmentContainer(){var v;const{effectiveDisplayType:y,viewModel:g,visibleElements:_}=this,{attachmentInfos:M,capabilities:b,fileInfos:A}=g,E=!(null==M||!M.length),x=!(null==A||!A.length),R={[Te.containerList]:"preview"!==y,[Te.containerPreview]:"preview"===y},Z=b.editing&&null!==(v=b.operations)&&void 0!==v&&v.add&&_.addButton?(0,Q.K)("button",{bind:this,class:this.classes(Pe.D.button,Pe.D.buttonTertiary,Te.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,Q.K)("span",{"aria-hidden":"true",class:this.classes(Te.itemAddIcon,Et.T.plus)}),this.messages.add):void 0,K=E?(0,Q.K)("ul",{class:Te.items,key:"attachments-list"},M.toArray().map(me=>this._renderAttachmentInfo({attachmentInfo:me,displayType:y}))):void 0,H=x?(0,Q.K)("ul",{class:Te.items,key:"file-list"},A.toArray().map(me=>this._renderFile(me))):void 0,ae=x||E?void 0:(0,Q.K)("div",{class:Pe.D.empty},this.messages.noAttachments);return(0,Q.K)("div",{class:this.classes(Te.container,R),key:"attachments-container"},K,H,ae,Z)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(v){var y;const _=null===(y=v.target.files)||void 0===y?void 0:y.item(0);this._set("selectedFile",_)}_submitDeleteAttachment(v,y){v.preventDefault(),y&&("file"in y?this.deleteFile(y.file):y&&this.deleteAttachment(y))}_submitAddAttachment(v){v.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(v,y){v.preventDefault(),y&&"file"in y?this.updateFile():this.updateAttachment()}_startEditAttachment(v){const{viewModel:y}=this;y.activeFileInfo=null,y.activeAttachmentInfo=v,y.mode="edit"}_startEditFile(v){const{viewModel:y}=this;y.activeAttachmentInfo=null,y.activeFileInfo=v,y.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(v){v.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(v){const{orientationInfo:y}=v;return!this._supportsImageOrientation&&y?[y.rotation?`rotate(${y.rotation}deg)`:"",y.mirrored?"scaleX(-1)":""].join(" "):""}};(0,F._)([(0,I.MZ)()],yt.prototype,"capabilities",null),(0,F._)([(0,I.MZ)()],yt.prototype,"displayType",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],yt.prototype,"effectiveDisplayType",null),(0,F._)([(0,I.MZ)()],yt.prototype,"graphic",null),(0,F._)([(0,I.MZ)()],yt.prototype,"label",null),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/Attachments/t9n/Attachments")],yt.prototype,"messages",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/core/t9n/Units")],yt.prototype,"messagesUnits",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],yt.prototype,"selectedFile",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],yt.prototype,"submitting",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],yt.prototype,"error",void 0),(0,F._)([(0,I.MZ)({type:on})],yt.prototype,"viewModel",void 0),(0,F._)([(0,I.MZ)()],yt.prototype,"visibleElements",void 0),(0,F._)([(0,oe.w)("visibleElements")],yt.prototype,"castVisibleElements",null),yt=(0,F._)([(0,ce.$)("esri.widgets.Attachments")],yt);const ar=yt;let yi=class extends on{constructor(v){super(v),this.description=null,this.title=null}};(0,F._)([(0,I.MZ)()],yi.prototype,"description",void 0),(0,F._)([(0,I.MZ)()],yi.prototype,"title",void 0),yi=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],yi);const rn=yi;function ln({level:v,class:y,...g},_){const M=function Co(v){return(0,Le.qE)(Math.ceil(v),1,6)}(v);return(0,Q.K)(`h${M}`,{...g,"aria-level":String(M),class:(0,xt.Ly)(Pe.D.heading,y),role:"heading"},_)}const an="esri-feature-element-info",dn={base:an,title:`${an}__title`,description:`${an}__description`};let di=class extends he.A{constructor(v,y){super(v,y),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,Q.K)("div",{class:dn.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:v}=this;return v?(0,Q.K)(ln,{class:dn.title,level:this.headingLevel},v):null}_renderDescription(){const{description:v}=this;return v?(0,Q.K)("div",{class:dn.description,key:"description"},v):null}};(0,F._)([(0,I.MZ)()],di.prototype,"description",void 0),(0,F._)([(0,I.MZ)()],di.prototype,"headingLevel",void 0),(0,F._)([(0,I.MZ)()],di.prototype,"title",void 0),di=(0,F._)([(0,ce.$)("esri.widgets.Feature.support.FeatureElementInfo")],di);const Ti=di;let Rt=class extends he.A{constructor(v,y){super(v,y),this._featureElementInfo=null,this.attachmentsWidget=new ar,this.headingLevel=2,this.viewModel=new rn}initialize(){this._featureElementInfo=new Ti,this.addHandles([(0,S.wB)(()=>{var v,y;return[null===(v=this.viewModel)||void 0===v?void 0:v.description,null===(y=this.viewModel)||void 0===y?void 0:y.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),S.Vh),(0,S.wB)(()=>this.viewModel,v=>this.attachmentsWidget.viewModel=v,S.Vh)])}destroy(){var v;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),null===(v=this._featureElementInfo)||void 0===v||v.destroy()}get description(){return this.viewModel.description}set description(v){this.viewModel.description=v}get displayType(){return this.attachmentsWidget.displayType}set displayType(v){this.attachmentsWidget.displayType=v}get graphic(){return this.viewModel.graphic}set graphic(v){this.viewModel.graphic=v}get title(){return this.viewModel.title}set title(v){this.viewModel.title=v}render(){var v;const{attachmentsWidget:y}=this;return(0,Q.K)("div",{class:"esri-feature-attachments"},null===(v=this._featureElementInfo)||void 0===v?void 0:v.render(),null==y?void 0:y.render())}_setupFeatureElementInfo(){var v;const{description:y,title:g,headingLevel:_}=this;null===(v=this._featureElementInfo)||void 0===v||v.set({description:y,title:g,headingLevel:_})}};(0,F._)([(0,I.MZ)({readOnly:!0})],Rt.prototype,"attachmentsWidget",void 0),(0,F._)([(0,I.MZ)()],Rt.prototype,"description",null),(0,F._)([(0,I.MZ)()],Rt.prototype,"displayType",null),(0,F._)([(0,I.MZ)()],Rt.prototype,"graphic",null),(0,F._)([(0,I.MZ)()],Rt.prototype,"headingLevel",void 0),(0,F._)([(0,I.MZ)()],Rt.prototype,"title",null),(0,F._)([(0,I.MZ)({type:rn})],Rt.prototype,"viewModel",void 0),Rt=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureAttachments")],Rt);const ur=Rt;let zt=class extends $t.A{constructor(v){super(v),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,S.wB)(()=>this.creator,y=>{this._destroyContent(),this._createContent(y)},S.Vh))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:v,graphic:y,destroyer:g}=this;v&&y&&(Li(g,{graphic:y}).catch(()=>null),this._set("created",null))}_createContent(v){var y=this;return(0,V.A)(function*(){const g=y.graphic;if(!g||!v)return;const _=Li(v,{graphic:g}).catch(()=>null);y._loadingPromise=_,y.notifyChange("state");const M=yield _;_===y._loadingPromise&&(y._loadingPromise=null,y.notifyChange("state"),y._set("created",M))})()}};(0,F._)([(0,I.MZ)({readOnly:!0})],zt.prototype,"created",void 0),(0,F._)([(0,I.MZ)()],zt.prototype,"creator",void 0),(0,F._)([(0,I.MZ)()],zt.prototype,"destroyer",void 0),(0,F._)([(0,I.MZ)({type:li.A})],zt.prototype,"graphic",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],zt.prototype,"state",null),zt=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],zt);const Oi=zt;function Lo(v){return v&&"function"==typeof v.render}w(54737);const un="esri-feature-content",cn={base:un,loaderContainer:`${un}__loader-container`,loader:`${un}__loader`};let ui=class extends he.A{constructor(v,y){super(v,y),this.viewModel=null,this._addTargetToAnchors=g=>{Array.from(g.querySelectorAll("a")).forEach(_=>{po(_.href)&&!_.hasAttribute("target")&&_.setAttribute("target","_blank")})}}get creator(){var v;return null===(v=this.viewModel)||void 0===v?void 0:v.creator}set creator(v){this.viewModel&&(this.viewModel.creator=v)}get graphic(){var v;return null===(v=this.viewModel)||void 0===v?void 0:v.graphic}set graphic(v){this.viewModel&&(this.viewModel.graphic=v)}render(){var v;const y=null===(v=this.viewModel)||void 0===v?void 0:v.state;return(0,Q.K)("div",{class:cn.base},"loading"===y?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,Q.K)("div",{class:cn.loaderContainer,key:"loader"},(0,Q.K)("div",{class:cn.loader}))}_renderCreated(){var v;const y=null===(v=this.viewModel)||void 0===v?void 0:v.created;return y?y instanceof HTMLElement?(0,Q.K)("div",{afterCreate:this._attachToNode,bind:y,key:y}):Lo(y)?(0,Q.K)("div",{key:y},!y.destroyed&&y.render()):(0,Q.K)("div",{afterCreate:this._addTargetToAnchors,innerHTML:y,key:y}):null}_attachToNode(v){v.appendChild(this)}};(0,F._)([(0,I.MZ)()],ui.prototype,"creator",null),(0,F._)([(0,I.MZ)()],ui.prototype,"graphic",null),(0,F._)([(0,I.MZ)({type:Oi})],ui.prototype,"viewModel",void 0),ui=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureContent")],ui);const Pi=ui;var hr=w(26025),To=w(61099);let Ut=class extends $t.A{constructor(v){super(v),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:v,fieldInfos:y}=this,g=[];return null!=y&&y.forEach(_=>{if(_.hasOwnProperty("visible")&&!_.visible)return;const M=_.clone();M.label=mo(M,v),g.push(M)}),g}};(0,F._)([(0,I.MZ)()],Ut.prototype,"attributes",void 0),(0,F._)([(0,I.MZ)({type:[hr.A]})],Ut.prototype,"expressionInfos",void 0),(0,F._)([(0,I.MZ)()],Ut.prototype,"description",void 0),(0,F._)([(0,I.MZ)({type:[To.A]})],Ut.prototype,"fieldInfos",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],Ut.prototype,"formattedFieldInfos",null),(0,F._)([(0,I.MZ)()],Ut.prototype,"title",void 0),Ut=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Ut);const Ri=Ut,pr=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}],Si="esri-feature-fields",$i={base:Si,fieldHeader:`${Si}__field-header`,fieldData:`${Si}__field-data`,fieldDataDate:`${Si}__field-data--date`};let Tt=class extends he.A{constructor(v,y){super(v,y),this._featureElementInfo=null,this.viewModel=new Ri,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Ti,this.addHandles((0,S.wB)(()=>{var v,y;return[null===(v=this.viewModel)||void 0===v?void 0:v.description,null===(y=this.viewModel)||void 0===y?void 0:y.title]},()=>this._setupFeatureElementInfo(),S.Vh))}destroy(){var v;null===(v=this._featureElementInfo)||void 0===v||v.destroy()}get attributes(){return this.viewModel.attributes}set attributes(v){this.viewModel.attributes=v}get description(){return this.viewModel.description}set description(v){this.viewModel.description=v}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(v){this.viewModel.expressionInfos=v}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(v){this.viewModel.fieldInfos=v}get title(){return this.viewModel.title}set title(v){this.viewModel.title=v}render(){var v;return(0,Q.K)("div",{class:$i.base},null===(v=this._featureElementInfo)||void 0===v?void 0:v.render(),this._renderFields())}_renderFieldInfo(v,y){const{attributes:g}=this.viewModel,_=v.fieldName,M=v.label||_,b=g?null==g[_]?"":g[_]:"",A=!(!v.format||!v.format.dateFormat),E="number"!=typeof b||A?function mr(v,y){if("string"!=typeof y||!y)return y;const g=pr.find(x=>x.pattern.test(y));if(!g)return y;const _=y.match(g.pattern),b=(0,Ce.HC)((0,Ce.HC)(g.label,{messages:v,hierPart:_&&_[2]}),{appName:g.appName});return y.replace(g.pattern,`<a${g.target?` target="${g.target}"`:""} href="$1"${"_blank"===g.target?' rel="noreferrer"':""}>${b}</a>`)}(this.messagesURIUtils,b):this._forceLTR(b),x={[$i.fieldDataDate]:A};return(0,Q.K)("tr",{key:`fields-element-info-row-${_}-${y}`},(0,Q.K)("th",{class:$i.fieldHeader,innerHTML:M,key:`fields-element-info-row-header-${_}-${y}`}),(0,Q.K)("td",{class:this.classes($i.fieldData,x),innerHTML:E,key:`fields-element-info-row-data-${_}-${y}`}))}_renderFields(){const{formattedFieldInfos:v}=this.viewModel;return null!=v&&v.length?(0,Q.K)("table",{class:Pe.D.table,summary:this.messages.fieldsSummary},(0,Q.K)("tbody",null,v.map((y,g)=>this._renderFieldInfo(y,g)))):null}_setupFeatureElementInfo(){var v;const{description:y,title:g}=this;null===(v=this._featureElementInfo)||void 0===v||v.set({description:y,title:g})}_forceLTR(v){return`&lrm;${v}`}};(0,F._)([(0,I.MZ)()],Tt.prototype,"attributes",null),(0,F._)([(0,I.MZ)()],Tt.prototype,"description",null),(0,F._)([(0,I.MZ)()],Tt.prototype,"expressionInfos",null),(0,F._)([(0,I.MZ)()],Tt.prototype,"fieldInfos",null),(0,F._)([(0,I.MZ)()],Tt.prototype,"title",null),(0,F._)([(0,I.MZ)({type:Ri,nonNullable:!0})],Tt.prototype,"viewModel",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/Feature/t9n/Feature")],Tt.prototype,"messages",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/support/t9n/uriUtils")],Tt.prototype,"messagesURIUtils",void 0),Tt=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureFields")],Tt);const Oo=Tt;var Jt=w(89952),fr=w(60797),Ct=(w(91515),w(5236),w(83393)),yr=w(36634),gr=w(3114);function It(v,y,g){return hn.apply(this,arguments)}function hn(){return(hn=(0,V.A)(function*(v,y,g){(0,fr.tE)(v,y,()=>[]).push(...g)})).apply(this,arguments)}function pn(){return(pn=(0,V.A)(function*(v){var y;const g=new Map;if(!v)return g;if("visualVariables"in v&&v.visualVariables){const E=v.visualVariables.filter(x=>"color"===x.type);for(const x of E){var _;const R=(null!==(_=yield(0,yr.getRampStops)(x))&&void 0!==_?_:[]).map(Z=>Z.color);yield It(g,x.field||x.valueExpression,R)}}if("heatmap"===v.type){const E=function _r(v){if(!v.colorStops)return[];const y=[...v.colorStops].filter(_=>{var M;return(null===(M=_.color)||void 0===M?void 0:M.a)>0});let g=y.length-1;if(y&&y[0]){const _=y[g];_&&1!==_.ratio&&(y.push(new gr.A({ratio:1,color:_.color})),g++)}return y.map((_,M)=>{var b,A;let E="";return 0===M?E=(null===(b=v.legendOptions)||void 0===b?void 0:b.minLabel)||"low":M===g&&(E=(null===(A=v.legendOptions)||void 0===A?void 0:A.maxLabel)||"high"),{color:_.color,label:E,ratio:_.ratio}}).reverse()}(v).map(x=>x.color);yield It(g,v.field||v.valueExpression,E)}else if("pie-chart"===v.type){var M;for(const E of v.attributes)yield It(g,E.field||E.valueExpression,[E.color]);yield It(g,"default",[null==v||null===(M=v.othersCategory)||void 0===M?void 0:M.color,(0,Ct.Sx)(v.backgroundFillSymbol,null)])}else if("dot-density"===v.type){for(const E of v.attributes)yield It(g,E.field||E.valueExpression,[E.color]);yield It(g,"default",[v.backgroundColor])}else if("unique-value"===v.type)if("predominance"===(null===(y=v.authoringInfo)||void 0===y?void 0:y.type))for(const E of null!==(b=v.uniqueValueInfos)&&void 0!==b?b:[]){var b;yield It(g,E.value.toString(),[(0,Ct.Sx)(E.symbol,null)])}else{var A;const E=(null!==(A=v.uniqueValueInfos)&&void 0!==A?A:[]).map(H=>(0,Ct.Sx)(H.symbol,null)),{field:x,field2:R,field3:Z,valueExpression:K}=v;(x||K)&&(yield It(g,x||K,E)),R&&(yield It(g,R,E)),Z&&(yield It(g,Z,E))}else if("class-breaks"===v.type){const E=v.classBreakInfos.map(Z=>(0,Ct.Sx)(Z.symbol,null)),{field:x,valueExpression:R}=v;yield It(g,null!=x?x:R,E)}else"simple"===v.type&&(yield It(g,"default",[(0,Ct.Sx)(v.symbol,null)]));return"defaultSymbol"in v&&v.defaultSymbol&&(yield It(g,"default",[(0,Ct.Sx)(v.defaultSymbol,null)])),g.forEach((E,x)=>{const R=(0,Jt.Am)(E.filter(Boolean),(Z,K)=>JSON.stringify(Z)===JSON.stringify(K));g.set(x,R)}),g})).apply(this,arguments)}(0,Ci.J2)("short-date");var Er=w(19457),xr=w(89563),ot=w(56492),fn=(w(93164),w(34687)),yn=(w(23098),w(77469),w(45272),w(87477),w(58701),w(2296),w(68643),w(21870),w(13303)),gn=(w(55861),w(93615),w(20914),w(32034),w(47258),w(55912),w(93327),w(87086)),_n=w(59487),Cr=(w(61569),w(16842));const So=()=>ie.A.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),$o=new Map;function Di(v){if(!Dt(v))return null;const[y,g]=v.split("/").slice(1);return{layerId:y,fieldName:g}}function Mn(){return(Mn=(0,V.A)(function*(v,y,g,_){const M=g.layerId.toString(),{layerInfo:b,relation:A,relatedFields:E,outStatistics:x,url:R,sourceSpatialReference:Z}=y,K=function Ur(v){return v?(0,Jt.Am)(v):void 0}(E),H=function Zr(v){return v?(0,Jt.Am)(v,(y,g)=>JSON.stringify(y.toJSON())===JSON.stringify(g.toJSON())):void 0}(x);if(!b||!A)return null;const ae=function Or({originRelationship:v,relationships:y,layerId:g}){var _;return null!==(_=y.find(({relatedTableId:M,id:b})=>`${M}`===g&&b===(null==v?void 0:v.id)))&&void 0!==_?_:null}({originRelationship:A,relationships:b.relationships,layerId:M});if(null!=ae&&ae.relationshipTableId&&ae.keyFieldInRelationshipTable){const ve=(yield function $r(v,y,g,_){var M,b;const A=new _n.default;return A.outFields=["*"],A.relationshipId="number"==typeof y.id?y.id:parseInt(y.id,10),A.objectIds=[v.attributes[g.objectIdField]],null!==(M=null===(b=g.queryRelatedFeatures)||void 0===b?void 0:b.call(g,A,_))&&void 0!==M?M:Promise.resolve({})}(v,ae,g,_))[v.attributes[g.objectIdField]];if(!ve)return null;const ye=ve.features.map(_e=>_e.attributes[b.objectIdField]);if(null!=H&&H.length&&b.supportsStatistics){const _e=new gn.A;_e.where=function Dr(v,y,g){let _=0;const M=[];for(;_<y.length;)M.push(`${v} IN (${y.slice(_,g+_)})`),_+=g;return M.join(" OR ")}(b.objectIdField,ye,1e3),_e.outFields=K,_e.outStatistics=H,_e.sourceSpatialReference=Z;const be={features:Promise.resolve(ve),statsFeatures:(0,fn.s)(R,_e)};return(0,ot.Lx)(be)}}const me=null==ae?void 0:ae.keyField;if(me){const ve=(0,mi.WA)(function jr(v,y){if(null!=v){y=y.toLowerCase();for(const g of v)if(g&&g.name.toLowerCase()===y)return g}return null}(b.fields,me)),ye=function Pr(v,y){const g=y.toLowerCase();for(const _ in v)if(_.toLowerCase()===g)return v[_];return null}(v.attributes,A.keyField),_e=ve?`${me}=${ye}`:`${me}='${ye}'`,be=(0,fn.s)(R,new gn.A({where:_e,outFields:K,sourceSpatialReference:Z}),_),Ee=null!=H&&H.length&&b.supportsStatistics?(0,fn.s)(R,new gn.A({where:_e,outFields:K,outStatistics:H,sourceSpatialReference:Z}),_):null,Re={features:be};return Ee&&(Re.statsFeatures=Ee),(0,ot.Lx)(Re)}return null})).apply(this,arguments)}const Do={chartAnimation:!0};let lt=class extends $t.A{constructor(v){super(v),this.abilities={...Do},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(v){return{...Do,...v}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(v){this._setContentElementMedia(v)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(v){const{formattedMediaInfoCount:y}=this;this.activeMediaInfoIndex=(v+y)%y}_pageContentElementMedia(v){const{activeMediaInfoIndex:y}=this;this._setContentElementMedia(y+v)}_formatMediaInfos(){var v,y,g,_,M;const{mediaInfos:b,layer:A}=this,E=null!==(v=this.attributes)&&void 0!==v?v:{},x=null!==(y=this.formattedAttributes)&&void 0!==y?y:{},R=null!==(g=this.expressionAttributes)&&void 0!==g?g:{},Z=null!==(_=this.fieldInfoMap)&&void 0!==_?_:new Map;return null!==(M=null==b?void 0:b.map(K=>{const H=null==K?void 0:K.clone();if(!H)return null;if(H.title=Yt({attributes:E,fieldInfoMap:Z,globalAttributes:x,expressionAttributes:R,layer:A,text:H.title}),H.caption=Yt({attributes:E,fieldInfoMap:Z,globalAttributes:x,expressionAttributes:R,layer:A,text:H.caption}),H.altText=Yt({attributes:E,fieldInfoMap:Z,globalAttributes:x,expressionAttributes:R,layer:A,text:H.altText}),"image"===H.type){const{value:ae}=H;return this._setImageValue({value:ae,formattedAttributes:x,layer:A}),H.value.sourceURL?H:void 0}if("pie-chart"===H.type||"line-chart"===H.type||"column-chart"===H.type||"bar-chart"===H.type){const{value:ae}=H;return this._setChartValue({value:ae,chartType:H.type,attributes:E,formattedAttributes:x,layer:A,expressionAttributes:R}),H}return null}).filter(Jt.Ru))&&void 0!==M?M:[]}_setImageValue(v){var y;const g=null!==(y=this.fieldInfoMap)&&void 0!==y?y:new Map,{value:_,formattedAttributes:M,layer:b}=v,{linkURL:A,sourceURL:E}=_;if(E){const x=Qi(E,b);_.sourceURL=Gi({formattedAttributes:M,template:x,fieldInfoMap:g})}if(A){const x=Qi(A,b);_.linkURL=Gi({formattedAttributes:M,template:x,fieldInfoMap:g})}}_setChartValue(v){var y;const{value:g,attributes:_,formattedAttributes:M,chartType:b,layer:A,expressionAttributes:E}=v,{popupTemplate:x,relatedInfos:R}=this,{fields:Z,normalizeField:K}=g,H=A;if(g.fields=function Bs(v,y){return v&&v.map(g=>vi(g,y))}(Z,H),K&&(g.normalizeField=vi(K,H)),!Z.some(me=>!!(null!=M[me]||Dt(me)&&null!=R&&R.size)))return;const ae=null!==(y=null==x?void 0:x.fieldInfos)&&void 0!==y?y:[];Z.forEach((me,ve)=>{var ye;const _e=null===(ye=g.colors)||void 0===ye?void 0:ye[ve];if(Dt(me))return void(g.series=[...g.series,...this._getRelatedChartInfos({fieldInfos:ae,fieldName:me,formattedAttributes:M,chartType:b,value:g,color:_e})]);const be=this._getChartOption({value:g,attributes:_,chartType:b,formattedAttributes:M,expressionAttributes:E,fieldName:me,fieldInfos:ae,color:_e});g.series.push(be)})}_getRelatedChartInfos(v){var y;const{fieldInfos:g,fieldName:_,formattedAttributes:M,chartType:b,value:A,color:E}=v,x=[],R=Di(_),Z=R&&(null===(y=this.relatedInfos)||void 0===y?void 0:y.get(R.layerId.toString()));if(!Z)return x;const{relatedFeatures:K,relation:H}=Z;if(!H||!K)return x;const{cardinality:ae}=H;return K.forEach(me=>{const{attributes:ve}=me;ve&&Object.keys(ve).forEach(ye=>{ye===R.fieldName&&x.push(this._getChartOption({value:A,attributes:ve,formattedAttributes:M,fieldName:_,chartType:b,relatedFieldName:ye,hasMultipleRelatedFeatures:(null==K?void 0:K.length)>1,fieldInfos:g,color:E}))})}),"one-to-many"===ae||"many-to-many"===ae?x:[x[0]]}_getTooltip({label:v,value:y,chartType:g}){return"pie-chart"===g?`${v}`:`${v}: ${y}`}_getChartOption(v){var y,g;const{value:_,attributes:M,formattedAttributes:b,expressionAttributes:A,fieldName:E,relatedFieldName:x,fieldInfos:R,chartType:Z,hasMultipleRelatedFeatures:K,color:H}=v,ae=this.layer,me=null!==(y=this.fieldInfoMap)&&void 0!==y?y:new Map,{normalizeField:ve,tooltipField:ye}=_,_e=ve?Dt(ve)?M[Di(ve).fieldName]:M[ve]:null,be=Hi(E)&&A&&void 0!==A[E]?A[E]:x&&void 0!==M[x]?M[x]:void 0!==M[E]?M[E]:b[E],Ee=new Er.A({fieldName:E,color:H,value:void 0===be?null:be&&_e?be/_e:be});if(Dt(E)){var Re,De,Ve,Je,He;const Ot=me.get(E.toLowerCase()),Ht=ye&&me.get(ye.toLowerCase()),eo=null!==(Re=null==Ot?void 0:Ot.fieldName)&&void 0!==Re?Re:E,kt=K&&ye?Di(ye).fieldName:null!==(De=null==Ht?void 0:Ht.fieldName)&&void 0!==De?De:ye,to=K&&kt?M[kt]:null!==(Ve=null!==(Je=null!==(He=b[kt])&&void 0!==He?He:null==Ot?void 0:Ot.label)&&void 0!==Je?Je:null==Ot?void 0:Ot.fieldName)&&void 0!==Ve?Ve:x;return Ee.tooltip=this._getTooltip({label:to,value:K&&x?M[x]:b[eo],chartType:Z}),Ee}const vt=fo(R,E),Vt=vi(E,ae),Xn=ye&&void 0!==b[ye]?b[ye]:mo(vt||new To.A({fieldName:Vt}),null===(g=this.popupTemplate)||void 0===g?void 0:g.expressionInfos);return Ee.tooltip=this._getTooltip({label:Xn,value:b[Vt],chartType:Z}),Ee}};(0,F._)([(0,I.MZ)()],lt.prototype,"abilities",void 0),(0,F._)([(0,oe.w)("abilities")],lt.prototype,"castAbilities",null),(0,F._)([(0,I.MZ)()],lt.prototype,"activeMediaInfoIndex",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],lt.prototype,"activeMediaInfo",null),(0,F._)([(0,I.MZ)()],lt.prototype,"attributes",void 0),(0,F._)([(0,I.MZ)()],lt.prototype,"description",void 0),(0,F._)([(0,I.MZ)()],lt.prototype,"fieldInfoMap",void 0),(0,F._)([(0,I.MZ)()],lt.prototype,"formattedAttributes",void 0),(0,F._)([(0,I.MZ)()],lt.prototype,"expressionAttributes",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],lt.prototype,"formattedMediaInfos",null),(0,F._)([(0,I.MZ)()],lt.prototype,"isAggregate",void 0),(0,F._)([(0,I.MZ)()],lt.prototype,"layer",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],lt.prototype,"formattedMediaInfoCount",null),(0,F._)([(0,I.MZ)()],lt.prototype,"mediaInfos",void 0),(0,F._)([(0,I.MZ)()],lt.prototype,"popupTemplate",void 0),(0,F._)([(0,I.MZ)()],lt.prototype,"relatedInfos",void 0),(0,F._)([(0,I.MZ)()],lt.prototype,"title",void 0),lt=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],lt);const Xt=lt;var Wr=w(67722);const at="esri-feature-media",_t={base:at,mediaContainer:`${at}__container`,mediaItemContainer:`${at}__item-container`,mediaItem:`${at}__item`,mediaItemText:`${at}__item-text`,mediaItemTitle:`${at}__item-title`,mediaItemCaption:`${at}__item-caption`,mediaNavigation:`${at}__item-navigation`,mediaPagination:`${at}__pagination`,mediaPaginationText:`${at}__pagination-text`,mediaPrevious:`${at}__previous`,mediaPreviousIconLTR:`${at}__previous-icon`,mediaPreviousIconRTL:`${at}__previous-icon--rtl`,mediaNext:`${at}__next`,mediaNextIconLTR:`${at}__next-icon`,mediaNextIconRTL:`${at}__next-icon--rtl`,mediaChart:`${at}__chart`,mediaPaginationButton:`${at}__pagination-button`,mediaPaginationIcon:`${at}__pagination-icon`,mediaChartRendered:`${at}__chart--rendered`},Kt="category",Mi="value";let Mt=class extends he.A{constructor(v,y){var g;super(v,y),g=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new Xt,this.messages=null,this._disposeChart=_=>{var M;null!==(M=this._chartRootMap.get(_))&&void 0!==M&&M.dispose(),this._chartRootMap.delete(_)},this._createChart=function(){var _=(0,V.A)(function*(M){const{destroyed:b,viewModel:A}=g;if(b||!A||!M)return;const{createRoot:E}=yield Promise.all([w.e(3568),w.e(2076),w.e(959)]).then(w.bind(w,60959)),x=yield E(M);g._chartRootMap.set(M,x),g._renderChart({mediaInfo:A.activeMediaInfo,root:x})});return function(M){return _.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new Ti,this.addHandles([(0,S.wB)(()=>{var v,y;return[null===(v=this.viewModel)||void 0===v?void 0:v.activeMediaInfo,null===(y=this.viewModel)||void 0===y?void 0:y.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),S.Vh),(0,S.wB)(()=>{var v,y;return[null===(v=this.viewModel)||void 0===v?void 0:v.description,null===(y=this.viewModel)||void 0===y?void 0:y.title]},()=>this._setupFeatureElementInfo(),S.Vh)])}loadDependencies(){return(0,ai.W)({icon:()=>Promise.all([w.e(2597),w.e(8278)]).then(w.bind(w,8278))})}destroy(){var v;this._clearMediaRefreshTimer(),null===(v=this._featureElementInfo)||void 0===v||v.destroy()}get attributes(){return this.viewModel.attributes}set attributes(v){this.viewModel.attributes=v}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(v){this.viewModel.activeMediaInfoIndex=v}get description(){return this.viewModel.description}set description(v){this.viewModel.description=v}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(v){this.viewModel.fieldInfoMap=v}get layer(){return this.viewModel.layer}set layer(v){this.viewModel.layer=v}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(v){this.viewModel.mediaInfos=v}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(v){this.viewModel.popupTemplate=v}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(v){this.viewModel.relatedInfos=v}get title(){return this.viewModel.title}set title(v){this.viewModel.title=v}render(){var v;return(0,Q.K)("div",{bind:this,class:_t.base,onkeyup:this._handleMediaKeyup},null===(v=this._featureElementInfo)||void 0===v?void 0:v.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:v,activeMediaInfoIndex:y}=this.viewModel,g=this._renderMediaText();return v?(0,Q.K)("div",{class:_t.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,Q.K)("div",{class:_t.mediaNavigation},g,v>1?(0,Q.K)("div",{class:_t.mediaPagination},this._renderMediaPageButton("previous"),(0,Q.K)("span",{class:_t.mediaPaginationText},(0,$.V)(this.messages.pageText,{index:y+1,total:v})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:v}=this.viewModel;if(!v)return null;const y=v&&v.title?(0,Q.K)("div",{class:_t.mediaItemTitle,innerHTML:v.title,key:"media-title"}):null,g=v&&v.caption?(0,Q.K)("div",{class:_t.mediaItemCaption,innerHTML:v.caption,key:"media-caption"}):null;return y||g?(0,Q.K)("div",{class:_t.mediaItemText,key:"media-text"},y,g):null}_renderImageMediaInfo(v){var y;const{_refreshIntervalInfo:g}=this,{activeMediaInfoIndex:_,formattedMediaInfoCount:M}=this.viewModel,{value:b,refreshInterval:A,altText:E,title:x,type:R}=v,{sourceURL:Z,linkURL:K}=b,H=po(null!=K?K:void 0)?"_blank":"_self",ae="_blank"===H?"noreferrer":"",me=A?g:null,ye=me?me.sourceURL:Z,_e=(0,Q.K)("img",{alt:E||x,key:`media-${R}-${_}-${M}-${me?me.timestamp:0}`,src:null!=ye?ye:void 0});return null!==(y=K?(0,Q.K)("a",{href:K,rel:ae,target:H,title:x},_e):null)&&void 0!==y?y:_e}_renderChartMediaInfo(v){const{activeMediaInfoIndex:y,formattedMediaInfoCount:g}=this.viewModel;return(0,Q.K)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:_t.mediaChart,key:`media-${v.type}-${y}-${g}`})}_renderMediaInfoType(){const{activeMediaInfo:v}=this.viewModel;return v?"image"===v.type?this._renderImageMediaInfo(v):v.type.includes("chart")?this._renderChartMediaInfo(v):null:null}_renderMediaInfo(){const{activeMediaInfo:v}=this.viewModel;return v?(0,Q.K)("div",{class:_t.mediaItemContainer,key:"media-container"},(0,Q.K)("div",{class:_t.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(v){if(this.viewModel.formattedMediaInfoCount<2)return null;const y="previous"===v,g=y?this.messages.previous:this.messages.next;return(0,Q.K)("button",{"aria-label":g,bind:this,class:_t.mediaPaginationButton,key:y?"media-previous":"media-next",onclick:y?this._previous:this._next,tabIndex:0,title:g,type:"button"},(0,Q.K)("calcite-icon",{class:_t.mediaPaginationIcon,icon:y?"chevron-left":"chevron-right",scale:"s"}))}_setupFeatureElementInfo(){var v;const{description:y,title:g}=this;null===(v=this._featureElementInfo)||void 0===v||v.set({description:y,title:g})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:v,layer:y}=this.viewModel;return v&&null!=y&&y.featureReduction&&"renderer"in y.featureReduction?y.featureReduction.renderer:null==y?void 0:y.renderer}_getSeriesColors(v){return(0,V.A)(function*(){const{colorAm5:y}=yield Promise.all([w.e(3568),w.e(2076),w.e(4674)]).then(w.bind(w,14674)),g=new Map;return v.forEach(_=>{_.color&&g.set(_,y(_.color.toCss(!0)))}),g})()}_getRendererColors(){var v=this;return(0,V.A)(function*(){const{colorAm5:y}=yield Promise.all([w.e(3568),w.e(2076),w.e(4674)]).then(w.bind(w,14674)),g=new Map,_=v._getRenderer();if(!_)return g;const b=yield function wr(v){return pn.apply(this,arguments)}(_);return b.delete("default"),Array.from(b.values()).every(A=>1===(null==A?void 0:A.length))&&Array.from(b.keys()).forEach(A=>{var E;const x=null===(E=b.get(A))||void 0===E||null===(E=E[0])||void 0===E?void 0:E.toCss(!0);x&&g.set(A,y(x))}),g})()}_handleMediaKeyup(v){const{key:y}=v;"ArrowLeft"===y&&(v.stopPropagation(),this.viewModel.previous()),"ArrowRight"===y&&(v.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}_renderChart(v){var y=this;return(0,V.A)(function*(){const{root:g,mediaInfo:_}=v,{value:M,type:b}=_,{ResponsiveThemeAm5:A,DarkThemeAm5:E,AnimatedThemeAm5:x,ColorSetAm5:R,ThemeAm5:Z,esriChartColorSet:K}=yield Promise.all([w.e(3568),w.e(2076),w.e(4674)]).then(w.bind(w,14674)),H=Z.new(g);H.rule("ColorSet").set("colors",K),H.rule("ColorSet").set("reuse",!0);const ae=[A.new(g),H];(0,Wr.g4)()&&ae.push(E.new(g)),y._canAnimateChart()&&ae.push(x.new(g)),g.setThemes(ae);const me=yield y._getRendererColors(),ve=yield y._getSeriesColors(M.series),ye=R.new(g,{}),_e=ve.get(M.series[0]),be=_e?{lineSettings:{stroke:_e}}:void 0,Ee=M.series.map((Re,De)=>{const Ve=ve.get(Re)||me.get(Re.fieldName)||ye.getIndex(De);return{[Kt]:Re.tooltip,[Mi]:Re.value,columnSettings:{fill:Ve,stroke:Ve},...be}}).filter(Re=>"pie-chart"!==b||null!=Re.value&&Re.value>0);"pie-chart"===b?y._createPieChart(v,Ee):y._createXYChart(v,Ee)})()}_getDirection(){return(0,xt.V8)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,xt.V8)(this.container)}_customizeChartTooltip(v,y="horizontal"){var g=this;return(0,V.A)(function*(){var _;const{colorAm5:M}=yield Promise.all([w.e(3568),w.e(2076),w.e(4674)]).then(w.bind(w,14674));v.setAll({pointerOrientation:y}),null!==(_=v.get("background"))&&void 0!==_&&_.setAll({stroke:M("rgba(50, 50, 50, 1)")}),v.label.setAll({direction:g._getDirection(),oversizedBehavior:"wrap",maxWidth:200})})()}_createPieChart(v,y){var g=this;return(0,V.A)(function*(){const{TooltipAm5:_}=yield Promise.all([w.e(3568),w.e(2076),w.e(4674)]).then(w.bind(w,14674)),{PieChartAm5:M,PieSeriesAm5:b}=yield Promise.all([w.e(3568),w.e(6887),w.e(2644)]).then(w.bind(w,22644)),{mediaInfo:A,root:E}=v,{title:x}=A,K=E.container.children.push(M.new(E,{ariaLabel:(null==A?void 0:A.altText)||(null==A?void 0:A.title)||"",focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),H="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",ae=_.new(E,{labelText:H}),me=K.series.push(b.new(E,{name:x,valueField:Mi,categoryField:Kt,tooltip:ae}));me.ticks.template.set("forceHidden",!0),me.labels.template.set("forceHidden",!0),me.slices.template.states.create("active",{shiftRadius:5}),g._customizeChartTooltip(ae),me.slices.template.setAll({ariaLabel:H,focusable:!0,templateField:"columnSettings"}),me.data.setAll(y),me.appear(g._getChartSeriesAnimationMS()),K.appear(g._getChartAnimationMS()),K.root.dom.classList.toggle(_t.mediaChartRendered,!0)})()}_getMinSeriesValue(v){let y=0;return v.forEach(g=>y=Math.min(g.value,y)),y}_createColumnChart(v,y,g){var _=this;return(0,V.A)(function*(){const{TooltipAm5:M,ScrollbarAm5:b}=yield Promise.all([w.e(3568),w.e(2076),w.e(4674)]).then(w.bind(w,14674)),{CategoryAxisAm5:A,AxisRendererXAm5:E,ValueAxisAm5:x,AxisRendererYAm5:R,ColumnSeriesAm5:Z}=yield Promise.all([w.e(3568),w.e(6887),w.e(2076),w.e(9064)]).then(w.bind(w,29064)),{mediaInfo:K,root:H}=y,{value:ae,title:me}=K;v.setAll({wheelX:"panX",wheelY:"zoomX"});const ve=v.xAxes.push(A.new(H,{renderer:E.new(H,{inversed:_._isInversed()}),categoryField:Kt}));ve.get("renderer").labels.template.setAll({forceHidden:!0});const ye=v.yAxes.push(x.new(H,{renderer:R.new(H,{inside:!1}),min:_._getMinSeriesValue(ae.series)}));ye.get("renderer").labels.template.setAll({direction:_._getDirection()});const _e="{categoryX}",be=M.new(H,{labelText:_e}),Ee=v.series.push(Z.new(H,{name:me,xAxis:ve,yAxis:ye,valueYField:Mi,categoryXField:Kt,tooltip:be}));_._customizeChartTooltip(be),Ee.columns.template.setAll({ariaLabel:_e,focusable:!0,templateField:"columnSettings"}),ae.series.length>15&&v.set("scrollbarX",b.new(H,{orientation:"horizontal"})),ve.data.setAll(g),Ee.data.setAll(g),Ee.appear(_._getChartSeriesAnimationMS()),v.appear(_._getChartAnimationMS())})()}_createBarChart(v,y,g){var _=this;return(0,V.A)(function*(){const{TooltipAm5:M,ScrollbarAm5:b}=yield Promise.all([w.e(3568),w.e(2076),w.e(4674)]).then(w.bind(w,14674)),{CategoryAxisAm5:A,AxisRendererXAm5:E,ValueAxisAm5:x,AxisRendererYAm5:R,ColumnSeriesAm5:Z}=yield Promise.all([w.e(3568),w.e(6887),w.e(2076),w.e(9064)]).then(w.bind(w,29064)),{mediaInfo:K,root:H}=y,{value:ae,title:me}=K;v.setAll({wheelX:"panY",wheelY:"zoomY"});const ve=v.yAxes.push(A.new(H,{renderer:R.new(H,{inversed:!0}),categoryField:Kt}));ve.get("renderer").labels.template.setAll({forceHidden:!0});const ye=v.xAxes.push(x.new(H,{renderer:E.new(H,{inside:!1,inversed:_._isInversed()}),min:_._getMinSeriesValue(ae.series)}));ye.get("renderer").labels.template.setAll({direction:_._getDirection()});const _e="{categoryY}",be=M.new(H,{labelText:_e}),Ee=v.series.push(Z.new(H,{name:me,xAxis:ye,yAxis:ve,valueXField:Mi,categoryYField:Kt,tooltip:be}));_._customizeChartTooltip(be,"vertical"),Ee.columns.template.setAll({ariaLabel:_e,focusable:!0,templateField:"columnSettings"}),ae.series.length>15&&v.set("scrollbarY",b.new(H,{orientation:"vertical"})),ve.data.setAll(g),Ee.data.setAll(g),Ee.appear(_._getChartSeriesAnimationMS()),v.appear(_._getChartAnimationMS())})()}_createLineChart(v,y,g){var _=this;return(0,V.A)(function*(){var M,b;const{TooltipAm5:A,ScrollbarAm5:E}=yield Promise.all([w.e(3568),w.e(2076),w.e(4674)]).then(w.bind(w,14674)),{CategoryAxisAm5:x,AxisRendererXAm5:R,ValueAxisAm5:Z,AxisRendererYAm5:K,LineSeriesAm5:H}=yield Promise.all([w.e(3568),w.e(6887),w.e(2076),w.e(9064)]).then(w.bind(w,29064)),{root:ae,mediaInfo:me}=y,{value:ve,title:ye}=me;v.setAll({wheelX:"panX",wheelY:"zoomX"});const _e=v.xAxes.push(x.new(ae,{renderer:R.new(ae,{inversed:_._isInversed()}),categoryField:Kt}));_e.get("renderer").labels.template.setAll({forceHidden:!0});const be=v.yAxes.push(Z.new(ae,{renderer:K.new(ae,{inside:!1}),min:_._getMinSeriesValue(ve.series)}));be.get("renderer").labels.template.setAll({direction:_._getDirection()});const Re=null===(M=g[0])||void 0===M||null===(M=M.lineSettings)||void 0===M?void 0:M.stroke,De=A.new(ae,{getFillFromSprite:!Re,labelText:"{categoryX}"});Re&&(null===(b=De.get("background"))||void 0===b||b.setAll({fill:Re}));const Ve=v.series.push(H.new(ae,{name:ye,xAxis:_e,yAxis:be,valueYField:Mi,categoryXField:Kt,tooltip:De}));Ve.strokes.template.setAll({templateField:"lineSettings"}),_._customizeChartTooltip(De,"vertical"),ve.series.length>15&&v.set("scrollbarX",E.new(ae,{orientation:"horizontal"})),_e.data.setAll(g),Ve.data.setAll(g),Ve.appear(_._getChartSeriesAnimationMS()),v.appear(_._getChartAnimationMS())})()}_createXYChart(v,y){var g=this;return(0,V.A)(function*(){const{XYChartAm5:_,XYCursorAm5:M}=yield Promise.all([w.e(3568),w.e(6887),w.e(2076),w.e(9064)]).then(w.bind(w,29064)),{root:b,mediaInfo:A}=v,{type:E}=A,R=b.container.children.push(_.new(b,{ariaLabel:(null==A?void 0:A.altText)||(null==A?void 0:A.title)||"",focusable:!0,panX:!0,panY:!0}));R.set("cursor",M.new(b,{})),"column-chart"===E&&(yield g._createColumnChart(R,v,y)),"bar-chart"===E&&(yield g._createBarChart(R,v,y)),"line-chart"===E&&(yield g._createLineChart(R,v,y)),R.root.dom.classList.toggle(_t.mediaChartRendered,!0)})()}_clearMediaRefreshTimer(){const{_refreshTimer:v}=this;v&&(clearTimeout(v),this._refreshTimer=null)}_updateMediaInfoTimestamp(v){const y=Date.now();this._refreshIntervalInfo={timestamp:y,sourceURL:v&&this._getImageSource(v,y)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:v}=this.viewModel;v&&"image"===v.type&&v.refreshInterval&&this._setRefreshTimeout(v)}_setRefreshTimeout(v){const{refreshInterval:y,value:g}=v;if(!y)return;const _=6e4*y;this._updateMediaInfoTimestamp(g.sourceURL);const M=setInterval(()=>{this._updateMediaInfoTimestamp(g.sourceURL)},_);this._refreshTimer=M}_getImageSource(v,y){const g=v.includes("?")?"&":"?",[_,M=""]=v.split("#");return`${_}${g}timestamp=${y}${M?"#":""}${M}`}};(0,F._)([(0,I.MZ)()],Mt.prototype,"_refreshIntervalInfo",void 0),(0,F._)([(0,I.MZ)()],Mt.prototype,"attributes",null),(0,F._)([(0,I.MZ)()],Mt.prototype,"activeMediaInfoIndex",null),(0,F._)([(0,I.MZ)()],Mt.prototype,"description",null),(0,F._)([(0,I.MZ)()],Mt.prototype,"fieldInfoMap",null),(0,F._)([(0,I.MZ)()],Mt.prototype,"layer",null),(0,F._)([(0,I.MZ)()],Mt.prototype,"mediaInfos",null),(0,F._)([(0,I.MZ)()],Mt.prototype,"popupTemplate",null),(0,F._)([(0,I.MZ)()],Mt.prototype,"relatedInfos",null),(0,F._)([(0,I.MZ)()],Mt.prototype,"title",null),(0,F._)([(0,I.MZ)({type:Xt})],Mt.prototype,"viewModel",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/Feature/t9n/Feature")],Mt.prototype,"messages",void 0),Mt=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureMedia")],Mt);const Uo=Mt;w(54042),w(75432),w(65121),w(558);var Yr=w(8975),Jr=w(90792),Zo=(w(83902),w(98089)),Xr=w(19969),qr=w(35940);const Bo=()=>ie.A.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function tl(v){return"string"==typeof v?fi(Xi(v)):Array.isArray(v)?function il(v){return`<ul class="esri-widget__list">${v.map(y=>`<li>${"string"==typeof y?fi(Xi(y)):y}</li>`).join("")}</ul>`}(v):"esri.arcade.Dictionary"===(null==v?void 0:v.declaredClass)?function nl(v){const y=v.keys().map(g=>{const _=v.field(g);return`<tr><th>${g}</th><td>${"string"==typeof _?fi(Xi(_)):_}</td></tr>`}).join("");return`<table class="${Pe.D.table}">${y}</table>`}(v):v}function No(){return Promise.all([w.e(7936),w.e(2076),w.e(5724)]).then(w.bind(w,55724))}function sl(v){return wn.apply(this,arguments)}function wn(){return(wn=(0,V.A)(function*({graphic:v,view:y,options:g}){const{isAggregate:_,layer:M}=v;if(!_||!M||"2d"!==(null==y?void 0:y.type))return[];const b=yield y.whenLayerView(M);if(!function ol(v){return"createQuery"in v&&"queryFeatures"in v}(b))return[];const A=b.createQuery(),E=v.getObjectId();A.aggregateIds=null!=E?[E]:[];const{features:x}=yield b.queryFeatures(A,g);return x})).apply(this,arguments)}function Vo(v){return An.apply(this,arguments)}function An(){return(An=(0,V.A)(function*({expressionInfo:v,arcade:y,interceptor:g,spatialReference:_,map:M,graphic:b,location:A,view:E,options:x}){var R,Z,K;if(null==v||!v.expression)return null;const{isAggregate:H}=b,ae=null!==(R=b.sourceLayer||b.layer)&&void 0!==R?R:void 0,me=H?"feature-reduction-popup":"popup",ve=y.createArcadeProfile(me),ye=y.createArcadeExecutor(v.expression,ve).catch(Ve=>Bo().error("arcade-executor-error",{error:Ve,expressionInfo:v})),[_e,be]=yield Promise.all([sl({graphic:b,view:E,options:x}),ye]);if(!be)return null;const Ee="feature-reduction-popup"===me?function rl({layer:v,aggregatedFeatures:y,interceptor:g}){const{fields:_,objectIdField:M,geometryType:b,spatialReference:A,displayField:E}=v;return new qr.default({fields:_,objectIdField:M,geometryType:b,spatialReference:A,displayField:E,interceptor:g,..."feature"===v.type?{templates:v.templates,typeIdField:v.typeIdField,types:v.types}:null,source:y})}({layer:ae,aggregatedFeatures:_e,interceptor:g}):void 0,Re={..."feature-reduction-popup"===me?{$aggregatedFeatures:Ee}:{$datastore:null==ae?void 0:ae.url,$layer:"feature"===(null==ae?void 0:ae.type)||"subtype-sublayer"===(null==ae?void 0:ae.type)?ae:"scene"===(null==ae?void 0:ae.type)&&null!=ae.associatedLayer?ae.associatedLayer:void 0,$map:M,$userInput:A,$graph:"knowledge-graph-sublayer"===(null==ae?void 0:ae.type)?null==ae||null===(Z=ae.parentCompositeLayer)||void 0===Z?void 0:Z.knowledgeGraph:void 0},$feature:b},De={abortSignal:null!==(K=null==x?void 0:x.signal)&&void 0!==K?K:void 0,interceptor:null!=g?g:void 0,rawOutput:!0,spatialReference:null!=_?_:void 0,timeZone:null==E?void 0:E.timeZone};return yield be.executeAsync(Re,De).catch(Ve=>Bo().error("arcade-execution-error",{error:Ve,graphic:b,expressionInfo:v})).finally(()=>null==Ee?void 0:Ee.destroy())})).apply(this,arguments)}function ll(v){return Fn.apply(this,arguments)}function Fn(){return(Fn=(0,V.A)(function*({expressionInfos:v,spatialReference:y,graphic:g,interceptor:_,map:M,view:b,location:A,options:E}){if(null==v||!v.length)return{};const x=yield No(),R={};for(const H of v)R[`expression/${H.name}`]=Vo({expressionInfo:H,arcade:x,interceptor:_,spatialReference:y,map:M,graphic:g,location:A,view:b,options:E});const Z=yield(0,ot.Lx)(R),K={};for(const H in Z)K[H]=tl(Z[H].value);return K})).apply(this,arguments)}let At=class extends $t.A{constructor(v){var y;super(v),y=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:g}=this;g&&g.abort(),this._abortController=null},this._createVM=()=>{var g,_;const M=null===(g=this.contentElement)||void 0===g?void 0:g.type;null===(_=this.contentElementViewModel)||void 0===_||_.destroy();const b="fields"===M?new Ri:"media"===M?new Xt:"text"===M?new Oi:null;this._set("contentElementViewModel",b)},this._compile=(0,V.A)(function*(){y._cancelQuery();const g=new AbortController;y._abortController=g,yield y._compileExpression(),y._abortController===g&&(y._abortController=null)}),this._compileThrottled=q(this._compile,1,this),this._compileExpression=(0,V.A)(function*(){const{expressionInfo:g,graphic:_,interceptor:M,spatialReference:b,map:A,location:E,view:x,_abortController:R}=y;if(!g||!_)return void y._set("contentElement",null);const Z=yield No();if(R!==y._abortController)return;const K=yield Vo({arcade:Z,expressionInfo:g,graphic:_,location:E,interceptor:M,map:A,spatialReference:b,view:x});if(!K||"esri.arcade.Dictionary"!==K.declaredClass)return void y._set("contentElement",null);const H=yield K.castAsJsonAsync(null==R?void 0:R.signal),ae=null==H?void 0:H.type,me="media"===ae?Jr.A.fromJSON(H):"text"===ae?Zo.A.fromJSON(H):"fields"===ae?Yr.A.fromJSON(H):null;y._set("contentElement",me)}),this.addHandles([(0,S.wB)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),S.Vh),(0,S.wB)(()=>[this.contentElement],()=>this._createVM(),S.Vh)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){var v;this._cancelQuery(),null!==(v=this.contentElementViewModel)&&void 0!==v&&v.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var v,y;return null!==(v=null===(y=this.view)||void 0===y?void 0:y.spatialReference)&&void 0!==v?v:null}set spatialReference(v){this._override("spatialReference",v)}get state(){const{_abortController:v,contentElement:y,contentElementViewModel:g}=this;return v?"loading":y||g?"ready":"disabled"}get map(){var v,y;return null!==(v=null===(y=this.view)||void 0===y?void 0:y.map)&&void 0!==v?v:null}set map(v){this._override("map",v)}};(0,F._)([(0,I.MZ)()],At.prototype,"_abortController",void 0),(0,F._)([(0,I.MZ)({type:Xr.A})],At.prototype,"expressionInfo",void 0),(0,F._)([(0,I.MZ)({type:li.A})],At.prototype,"graphic",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],At.prototype,"contentElement",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],At.prototype,"contentElementViewModel",void 0),(0,F._)([(0,I.MZ)()],At.prototype,"interceptor",void 0),(0,F._)([(0,I.MZ)({type:yn.A})],At.prototype,"location",void 0),(0,F._)([(0,I.MZ)()],At.prototype,"spatialReference",null),(0,F._)([(0,I.MZ)({readOnly:!0})],At.prototype,"state",null),(0,F._)([(0,I.MZ)()],At.prototype,"map",null),(0,F._)([(0,I.MZ)()],At.prototype,"view",void 0),At=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],At);const In=At,En="esri-feature",xn={base:`${En}-expression`,loadingSpinnerContainer:`${En}__loading-container`,spinner:`${En}__loading-spinner`};let Ui=class extends he.A{constructor(v,y){super(v,y),this._contentWidget=null,this.viewModel=new In}initialize(){this.addHandles((0,S.wB)(()=>{var v;return null===(v=this.viewModel)||void 0===v?void 0:v.contentElementViewModel},()=>this._setupExpressionWidget(),S.Vh))}destroy(){this._destroyContentWidget()}render(){var v;const{state:y}=this.viewModel;return(0,Q.K)("div",{class:xn.base},"loading"===y?this._renderLoading():"disabled"===y?null:null===(v=this._contentWidget)||void 0===v?void 0:v.render())}_renderLoading(){return(0,Q.K)("div",{class:xn.loadingSpinnerContainer,key:"loading-container"},(0,Q.K)("span",{class:this.classes(Et.T.loadingIndicator,Pe.D.rotating,xn.spinner)}))}_destroyContentWidget(){const{_contentWidget:v}=this;v&&(v.viewModel=null,v.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:v,contentElement:y}=this.viewModel,g=null==y?void 0:y.type;this._destroyContentWidget();const _=v?"fields"===g?new Oo({viewModel:v}):"media"===g?new Uo({viewModel:v}):"text"===g?new Pi({viewModel:v}):null:null;this._contentWidget=_,this.scheduleRender()}};(0,F._)([(0,I.MZ)({type:In})],Ui.prototype,"viewModel",void 0),Ui=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureExpression")],Ui);const dl=Ui;var Cn,ul=w(11432),cl=w(90660),zo=w(3046);w(69690),w(54444),w(77365),(Cn||(Cn={})).TOO_SHORT="length-validation-error::too-short";const gl=v=>{const y=[];if(v.formTemplate){var g;const{description:_,title:M}=v.formTemplate;null===(g=v.fields)||void 0===g||g.forEach(b=>{const A=M&&(0,Ce.mk)(M,b.name),E=_&&(0,Ce.mk)(_,b.name);(A||E)&&y.push(b.name)})}return y};let Ye=class extends((0,cl.O)((0,zo.sA)($t.A))){constructor(v){var y;super(v),y=this,this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:g}=this;g&&g.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:g}=this;g&&g.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:g}=this;g&&g.abort(),this._queryPageAbortController=null},this._queryController=(0,V.A)(function*(){y._cancelQuery();const g=new AbortController;y._queryAbortController=g,yield(0,ot.QZ)(y._query()),y._queryAbortController===g&&(y._queryAbortController=null)}),this._queryFeatureCountController=(0,V.A)(function*(){y._loaded=!1,y._cancelQueryFeatureCount();const g=new AbortController;y._queryFeatureCountAbortController=g,yield(0,ot.QZ)(y._queryFeatureCount()),y._queryFeatureCountAbortController===g&&(y._queryFeatureCountAbortController=null),y._loaded=!0}),this._queryPageController=(0,V.A)(function*(){const g=new AbortController;y._queryPageAbortController=g,yield(0,ot.QZ)(y._queryPage()),y._queryPageAbortController===g&&(y._queryPageAbortController=null)}),this._queryDebounced=(0,ot.sg)(this._queryController,100),this._queryFeatureCountDebounced=(0,ot.sg)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,ot.sg)(this._queryPageController,100),this._query=(0,V.A)(function*(){const{_queryAbortController:g,relatedFeatures:_}=y;y.featureCount&&(y._destroyRelatedFeatureViewModels(),y.featurePage=1,_.removeAll(),y.destroyed||_.addMany(y._sliceFeatures(yield y._queryRelatedFeatures({signal:null==g?void 0:g.signal}))))}),this.addHandles([(0,S.wB)(()=>{var g;return[this.displayCount,this.graphic,this.layer,null===(g=this.layer)||void 0===g?void 0:g.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount]},()=>this._queryDebounced(),S.Vh),(0,S.wB)(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),(0,S.wB)(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(v){const{featuresPerPage:y,featureCount:g}=this,M=Math.ceil(g/y)||1;this._set("featurePage",Math.min(Math.max(v,1),M))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:v,relatedLayer:y}=this;return v&&null!=y&&y.loaded?v.map(g=>{const _=g.clone();return _.field=vi(g.field,y),_}):null!=v?v:[]}get supportsCacheHint(){var v;return!(null===(v=this.layer)||void 0===v||null===(v=v.capabilities)||void 0===v||null===(v=v.queryRelated)||void 0===v||!v.supportsCacheHint)}get canLoad(){return!!this.map&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId}get canQuery(){var v;const y=null===(v=this.layer)||void 0===v||null===(v=v.capabilities)||void 0===v?void 0:v.queryRelated;return!!(this.relatedLayer&&this.relationship&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId&&null!=y&&y.supportsCount&&null!=y&&y.supportsPagination)}get itemDescriptionFieldName(){var v;return(null===(v=this.orderByFieldsFixedCasing[0])||void 0===v?void 0:v.field)||null}set displayCount(v){this._set("displayCount",Math.min(Math.max(v,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var v,y;return null!==(v=this.objectIdField&&(null===(y=this.graphic)||void 0===y||null===(y=y.attributes)||void 0===y?void 0:y[this.objectIdField]))&&void 0!==v?v:null}get objectIdField(){var v;return(null===(v=this.layer)||void 0===v?void 0:v.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new z.A}get relatedLayer(){var v;const{layer:y,map:g,relationship:_}=this;return null!=y&&y.loaded&&g&&_&&null!==(v=function sr(v,y,g){return v&&y&&g?Ao(v.allLayers,y,g)||Ao(v.allTables,y,g):null}(g,y,_))&&void 0!==v?v:null}get relationship(){var v,y;const{relationshipId:g,layer:_}=this;return"number"==typeof g&&null!==(v=null==_||null===(y=_.relationships)||void 0===y?void 0:y.find(({id:M})=>M===g))&&void 0!==v?v:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new z.A}get state(){const{_queryAbortController:v,_queryFeatureCountAbortController:y,_queryPageAbortController:g,canQuery:_,_loaded:M,canLoad:b}=this;return y||b&&!M?"loading":v||g?"querying":_?"ready":"disabled"}getRelatedFeatureByObjectId(v){return this.relatedFeatures.find(y=>y.getObjectId()===v)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var v;null!==(v=this.relatedFeatureViewModels)&&void 0!==v&&v.forEach(y=>!y.destroyed&&y.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){var v=this;return(0,V.A)(function*(){var y;const{layer:g,relatedLayer:_,relationshipId:M,objectId:b,_queryFeatureCountAbortController:A,canQuery:E,supportsCacheHint:x}=v;if(yield null==g?void 0:g.load(),yield null==_?void 0:_.load(),!E||!g||!_)return void v._set("featureCount",0);const R=_.createQuery(),Z=new _n.default({cacheHint:x,relationshipId:M,returnGeometry:!1,objectIds:[b],where:null!==(y=R.where)&&void 0!==y?y:void 0}),K=yield g.queryRelatedFeaturesCount(Z,{signal:null==A?void 0:A.signal});v._set("featureCount",K[b]||0)})()}_sliceFeatures(v){const{showAllEnabled:y,displayCount:g}=this;return y?v:g?v.slice(0,g):[]}_queryPage(){var v=this;return(0,V.A)(function*(){const{relatedFeatures:y,featurePage:g,showAllEnabled:_,_queryPageAbortController:M,featureCount:b}=v;!_||g<2||!b||y.addMany(yield v._queryRelatedFeatures({signal:null==M?void 0:M.signal}))})()}_queryRelatedFeatures(v){var y=this;return(0,V.A)(function*(){var g,_;const{orderByFieldsFixedCasing:M,showAllEnabled:b,featuresPerPage:A,displayCount:E,layer:x,relationshipId:R,featurePage:Z,featureCount:K,relatedLayer:H,supportsCacheHint:ae}=y,{canQuery:me,objectId:ve}=y;if(!me||!x||!H)return[];const ye=b?((Z-1)*A+K)%K:0,_e=b?A:E,be=H.objectIdField,Ee=[...M.map(vt=>vt.field),...gl(H),be].filter(Jt.Ru),Re=M.map(vt=>`${vt.field} ${vt.order}`),De=H.createQuery(),Ve=new _n.default({orderByFields:Re,start:ye,num:_e,outFields:Ee,cacheHint:ae,relationshipId:R,returnGeometry:!1,objectIds:[ve],where:null!==(g=De.where)&&void 0!==g?g:void 0}),He=(null===(_=(yield x.queryRelatedFeatures(Ve,{signal:null==v?void 0:v.signal}))[ve])||void 0===_?void 0:_.features)||[];return He.forEach(vt=>{vt.sourceLayer=H,vt.layer=H}),He})()}};(0,F._)([(0,I.MZ)()],Ye.prototype,"_loaded",void 0),(0,F._)([(0,I.MZ)()],Ye.prototype,"_queryAbortController",void 0),(0,F._)([(0,I.MZ)()],Ye.prototype,"_queryPageAbortController",void 0),(0,F._)([(0,I.MZ)()],Ye.prototype,"_queryFeatureCountAbortController",void 0),(0,F._)([(0,I.MZ)({value:1})],Ye.prototype,"featurePage",null),(0,F._)([(0,I.MZ)()],Ye.prototype,"featuresPerPage",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"orderByFieldsFixedCasing",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"supportsCacheHint",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"canLoad",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"canQuery",null),(0,F._)([(0,I.MZ)()],Ye.prototype,"description",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"itemDescriptionFieldName",null),(0,F._)([(0,I.MZ)({value:3})],Ye.prototype,"displayCount",null),(0,F._)([(0,I.MZ)({type:li.A})],Ye.prototype,"graphic",void 0),(0,F._)([(0,I.MZ)()],Ye.prototype,"layer",void 0),(0,F._)([(0,I.MZ)()],Ye.prototype,"map",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"objectId",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"objectIdField",null),(0,F._)([(0,I.MZ)()],Ye.prototype,"orderByFields",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"relatedFeatures",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"relatedLayer",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"relationship",null),(0,F._)([(0,I.MZ)()],Ye.prototype,"featureCount",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],Ye.prototype,"relatedFeatureViewModels",null),(0,F._)([(0,I.MZ)()],Ye.prototype,"relationshipId",void 0),(0,F._)([(0,I.MZ)()],Ye.prototype,"showAllEnabled",void 0),(0,F._)([(0,I.MZ)()],Ye.prototype,"state",null),(0,F._)([(0,I.MZ)()],Ye.prototype,"title",void 0),Ye=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Ye);const Tn=Ye,bi="esri-feature",wi=`${bi}-relationship`,Zt={base:wi,listContainer:`${wi}__list`,listItem:`${wi}__list-item`,listItemHidden:`${wi}__list-item--hidden`,listContainerQuerying:`${wi}__list--querying`,featureObserver:`${bi}__feature-observer`,stickySpinnerContainer:`${bi}__sticky-loading-container`,loadingSpinnerContainer:`${bi}__loading-container`,spinner:`${bi}__loading-spinner`},Qo={title:!0,description:!0};let bt=class extends he.A{constructor(v,y){super(v,y),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([g])=>{null!=g&&g.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Tn,this.messages=null,this.messagesCommon=null,this.visibleElements={...Qo},this._increaseFeaturePage=()=>{const{state:g,showAllEnabled:_,relatedFeatures:M,featuresPerPage:b,featurePage:A}=this.viewModel;"ready"===g&&_&&M.length>=b*A&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Ti,this.addHandles([(0,S.wB)(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),S.Vh),(0,S.wB)(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),(0,S.on)(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return(0,ai.W)({icon:()=>Promise.all([w.e(2597),w.e(8278)]).then(w.bind(w,8278)),list:()=>Promise.all([w.e(2597),w.e(4668),w.e(4319),w.e(4827),w.e(2076),w.e(861)]).then(w.bind(w,861)),"list-item":()=>Promise.all([w.e(2597),w.e(4668),w.e(8843),w.e(2076),w.e(4835)]).then(w.bind(w,4835)),notice:()=>Promise.all([w.e(2597),w.e(4668),w.e(2076),w.e(5661)]).then(w.bind(w,85661))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,ul.pR)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:v,featureCount:y,displayCount:g,state:_}=this.viewModel;return!v&&!!y&&"ready"===_&&(y>g||0===g)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(v){this.viewModel.description=v}get featureCountDescription(){const{messages:v}=this,{featureCount:y}=this.viewModel;return(0,$.V)(null==v?void 0:v.numberRecords,{number:y})}get title(){return this.viewModel.title}set title(v){this.viewModel.title=v}castVisibleElements(v){return{...Qo,...v}}render(){var v;const{state:y}=this.viewModel;return(0,Q.K)("div",{class:this.classes(Zt.base,Pe.D.widget)},null===(v=this._featureElementInfo)||void 0===v?void 0:v.render(),"loading"===y?this._renderLoading():"disabled"===y?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,Q.K)("div",{class:Zt.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,Q.K)("span",{class:this.classes(Et.T.loadingIndicator,Pe.D.rotating,Zt.spinner)})}_renderLoading(){return(0,Q.K)("div",{class:Zt.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,Q.K)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const v=(0,xt.V8)(this.container)?"chevron-left":"chevron-right";return(0,Q.K)("calcite-icon",{icon:v,scale:"s",slot:"content-end"})}_renderRelatedFeature(v){var y,g;const{itemDescriptionFieldName:_}=this.viewModel,M=v.title;return v.description=_&&(null===(y=v.formattedAttributes)||void 0===y?void 0:y.global[_]),(0,Q.K)("calcite-list-item",{class:this.classes(Zt.listItem,{[Zt.listItemHidden]:"loading"===v.state}),description:null!==(g=v.description)&&void 0!==g?g:"",key:v.uid,label:M,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:v})},this._renderChevronIconNode())}_renderShowAllListItem(){var v;return this.displayShowAllButton?(0,Q.K)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:null===(v=this.messages)||void 0===v?void 0:v.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var v;return(0,Q.K)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,Q.K)("div",{slot:"message"},null===(v=this.messages)||void 0===v?void 0:v.noRelatedFeatures))}_renderFeatureObserver(){return(0,Q.K)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Zt.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:v}=this.viewModel;return(0,Q.K)("calcite-list",null,v.toArray().map(y=>this._renderRelatedFeature(y)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:v}=this,{state:y}=this.viewModel;return(0,Q.K)("div",{class:this.classes(Zt.listContainer,{[Zt.listContainerQuerying]:"querying"===y}),key:"list-container"},v?this._renderList():"ready"===y?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var v;return(0,Q.K)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,Q.K)("div",{slot:"message"},null===(v=this.messages)||void 0===v?void 0:v.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:v}=this.viewModel,y="related-feature-viewmodels";this.removeHandles(y),null!=v&&v.forEach(g=>{this.addHandles((0,S.wB)(()=>[g.title,g.state],()=>this.scheduleRender(),S.Vh),y)}),this.scheduleRender()}_setupFeatureElementInfo(){var v;const{headingLevel:y,visibleElements:g}=this;null===(v=this._featureElementInfo)||void 0===v||v.set({description:g.description&&this.description,title:g.title&&this.title,headingLevel:y})}_handleRelatedFeatureObserverChange(){var v=this;return(0,V.A)(function*(){v._unobserveRelatedFeatureObserver();const{state:y,showAllEnabled:g}=v.viewModel;yield(0,ot.Pl)(0),v._relatedFeatureIntersectionObserverNode&&"ready"===y&&g&&v._relatedFeatureIntersectionObserver.observe(v._relatedFeatureIntersectionObserverNode)})()}_relatedFeatureIntersectionObserverCreated(v){this._relatedFeatureIntersectionObserverNode=v}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,F._)([(0,I.MZ)()],bt.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],bt.prototype,"displayShowAllButton",null),(0,F._)([(0,I.MZ)({readOnly:!0})],bt.prototype,"displayListItems",null),(0,F._)([(0,I.MZ)()],bt.prototype,"description",null),(0,F._)([(0,I.MZ)({readOnly:!0})],bt.prototype,"featureCountDescription",null),(0,F._)([(0,I.MZ)()],bt.prototype,"headingLevel",void 0),(0,F._)([(0,I.MZ)()],bt.prototype,"title",null),(0,F._)([(0,I.MZ)({type:Tn})],bt.prototype,"viewModel",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/Feature/t9n/Feature")],bt.prototype,"messages",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/t9n/common")],bt.prototype,"messagesCommon",void 0),(0,F._)([(0,I.MZ)()],bt.prototype,"visibleElements",void 0),(0,F._)([(0,oe.w)("visibleElements")],bt.prototype,"castVisibleElements",null),bt=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureRelationship")],bt);const Yo=bt;var Ai;const Jo="content-view-models",Xo="relationship-view-models",qo={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let qe=Ai=class extends((0,zo.sA)($t.A)){constructor(v){super(v),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=q(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...qo},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=y=>{const{abilities:g}=this;return"attachments"===y.type&&!!g.attachmentsContent||"custom"===y.type&&!!g.customContent||"fields"===y.type&&!!g.fieldsContent||"media"===y.type&&!!g.mediaContent||"text"===y.type&&!!g.textContent||"expression"===y.type&&!!g.expressionContent||"relationship"===y.type&&!!g.relationshipContent},this.addHandles((0,S.wB)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),S.Vh))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function Xs(v,y){const g=new Map;return v&&v.forEach(_=>{const M=vi(_.fieldName,y);_.fieldName=M,g.set(M.toLowerCase(),_)}),g}(yo(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return ho(this.graphic)}castAbilities(v){return{...qo,...v}}get isTable(){var v;return(null===(v=this._sourceLayer)||void 0===v?void 0:v.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(v){var y;this._set("graphic",null!==(y=null==v?void 0:v.clone())&&void 0!==y?y:null)}get spatialReference(){var v,y;return null!==(v=null===(y=this.view)||void 0===y?void 0:y.spatialReference)&&void 0!==v?v:null}set spatialReference(v){this._override("spatialReference",v)}get timeZone(){var v,y;return null!==(v=null===(y=this.view)||void 0===y?void 0:y.timeZone)&&void 0!==v?v:ro.qU}set timeZone(v){this._overrideIfSome("timeZone",v)}get map(){var v;return(null===(v=this.view)||void 0===v?void 0:v.map)||null}set map(v){this._override("map",v)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(v,y){const g=this.contentViewModels[v];g instanceof Xt&&g.setActiveMedia(y)}nextMedia(v){const y=this.contentViewModels[v];y instanceof Xt&&y.next()}previousMedia(v){const y=this.contentViewModels[v];y instanceof Xt&&y.previous()}updateGeometry(){var v=this;return(0,V.A)(function*(){var y;const{graphic:g,spatialReference:_,_sourceLayer:M}=v;yield null==M?void 0:M.load();const b=null==M?void 0:M.objectIdField;if(!b||!g||!M)return;const A=null==g||null===(y=g.attributes)||void 0===y?void 0:y[b];if(null==A)return;const E=[A];if(!g.geometry){const x=yield _o({layer:M,graphic:g,outFields:[],objectIds:E,returnGeometry:!0,spatialReference:_}),R=null==x?void 0:x.geometry;R&&(g.geometry=R)}})()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var v=this;return(0,V.A)(function*(){v._cancelFeatureQuery(),v._error=null,v._clear();const{graphic:y}=v;if(!y)return;const g=new AbortController;v._featureAbortController=g;try{yield v._queryFeature({signal:g.signal})}catch(_){(0,ot.zf)(_)||(v._error=_,ie.A.getLogger(v).error("error","The popupTemplate could not be displayed for this feature.",{error:_,graphic:y,popupTemplate:v._effectivePopupTemplate}))}v._featureAbortController===g&&(v._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:v}=this;v&&v.abort(),this._featureAbortController=null}_compileContentElement(v,y){return"attachments"===v.type?this._compileAttachments(v,y):"custom"===v.type?this._compileCustom(v,y):"fields"===v.type?this._compileFields(v,y):"media"===v.type?this._compileMedia(v,y):"text"===v.type?this._compileText(v,y):"expression"===v.type?this._compileExpression(v,y):"relationship"===v.type?this._compileRelationship(v,y):void 0}_compileContent(v){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(v)?v.filter(this._isAllowedContentType).map((y,g)=>this._compileContentElement(y,g)).filter(Jt.Ru):"string"==typeof v?this._compileText(new Zo.A({text:v}),0).text:v}_destroyContentViewModels(){this.removeHandles(Xo),this.removeHandles(Jo),this.contentViewModels.forEach(v=>v&&!v.destroyed&&v.destroy()),this._set("contentViewModels",[])}_matchesFeature(v,y){var g;const _=null==v||null===(g=v.graphic)||void 0===g?void 0:g.getObjectId(),M=null==y?void 0:y.getObjectId();return null!=_&&null!=M&&_===M}_setRelatedFeaturesViewModels({relatedFeatureViewModels:v,relatedFeatures:y,map:g}){const{view:_,spatialReference:M}=this;null!=y&&y.filter(Boolean).forEach(b=>{v.some(A=>this._matchesFeature(A,b))||v.add(new Ai({abilities:{relationshipContent:!1},map:g,view:_,spatialReference:M,graphic:b}))}),v.forEach(b=>{(null==y?void 0:y.find(E=>this._matchesFeature(b,E)))||v.remove(b)})}_setExpressionContentVM(v,y){const g=this.formattedAttributes,{contentElement:_,contentElementViewModel:M}=v,b=null==_?void 0:_.type;M&&b&&("fields"===b&&(this._createFieldsFormattedAttributes({contentElement:_,contentElementIndex:y,formattedAttributes:g}),M.set(this._createFieldsVMParams(_,y))),"media"===b&&(this._createMediaFormattedAttributes({contentElement:_,contentElementIndex:y,formattedAttributes:g}),M.set(this._createMediaVMParams(_,y))),"text"===b&&M.set(this._createTextVMParams(_)))}_compileRelationship(v,y){const{displayCount:g,orderByFields:_,relationshipId:M,title:b,description:A}=v,{_sourceLayer:E,graphic:x,map:R}=this;if(!Yi(E))return;const Z=new Tn({displayCount:g,graphic:x,orderByFields:_,relationshipId:M,layer:E,map:R,...this._compileTitleAndDesc({title:b,description:A})});return this.contentViewModels[y]=Z,this.addHandles((0,S.on)(()=>Z.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(Z)),Xo),v}_compileExpression(v,y){const{expressionInfo:g}=v,{graphic:_,map:M,spatialReference:b,view:A,location:E}=this,x=new In({expressionInfo:g,graphic:_,interceptor:Ai.interceptor,map:M,spatialReference:b,view:A,location:E});return this.contentViewModels[y]=x,this.addHandles((0,S.wB)(()=>x.contentElementViewModel,()=>this._setExpressionContentVM(x,y),S.Vh),Jo),v}_compileAttachments(v,y){const{graphic:g}=this,{description:_,title:M}=v;return this.contentViewModels[y]=new rn({graphic:g,...this._compileTitleAndDesc({title:M,description:_})}),v}_compileCustom(v,y){const{graphic:g}=this,{creator:_,destroyer:M}=v;return this.contentViewModels[y]=new Oi({graphic:g,creator:_,destroyer:M}),v}_compileTitleAndDesc({title:v,description:y}){const{_fieldInfoMap:g,_sourceLayer:_,graphic:M,formattedAttributes:b}=this,A=null==M?void 0:M.attributes,E=this._expressionAttributes,x=b.global;return{title:Yt({attributes:A,fieldInfoMap:g,globalAttributes:x,expressionAttributes:E,layer:_,text:v}),description:Yt({attributes:A,fieldInfoMap:g,globalAttributes:x,expressionAttributes:E,layer:_,text:y})}}_createFieldsVMParams(v,y){const g=this._effectivePopupTemplate,_=this.formattedAttributes,M={...null==_?void 0:_.global,...null==_?void 0:_.content[y]},b=(null==v?void 0:v.fieldInfos)||(null==g?void 0:g.fieldInfos),A=null==b?void 0:b.filter(({fieldName:Z})=>Hi(Z)||Dt(Z)||M.hasOwnProperty(Z)),E=null==g?void 0:g.expressionInfos,{description:x,title:R}=v;return{attributes:M,expressionInfos:E,fieldInfos:A,...this._compileTitleAndDesc({title:R,description:x})}}_compileFields(v,y){const g=v.clone(),_=new Ri(this._createFieldsVMParams(v,y));return this.contentViewModels[y]=_,g.fieldInfos=_.formattedFieldInfos.slice(0),g}_createMediaVMParams(v,y){var g;const{abilities:_,graphic:M,_fieldInfoMap:b,_effectivePopupTemplate:A,relatedInfos:E,_sourceLayer:x,_expressionAttributes:R}=this,Z=this.formattedAttributes,K=null!==(g=null==M?void 0:M.attributes)&&void 0!==g?g:{},{description:H,mediaInfos:ae,title:me}=v;return{abilities:{chartAnimation:_.chartAnimation},activeMediaInfoIndex:v.activeMediaInfoIndex||0,attributes:K,isAggregate:null==M?void 0:M.isAggregate,layer:x,fieldInfoMap:b,formattedAttributes:{...null==Z?void 0:Z.global,...null==Z?void 0:Z.content[y]},expressionAttributes:R,mediaInfos:ae,popupTemplate:A,relatedInfos:E,...this._compileTitleAndDesc({title:me,description:H})}}_compileMedia(v,y){const g=v.clone(),_=new Xt(this._createMediaVMParams(v,y));return g.mediaInfos=_.formattedMediaInfos.slice(0),this.contentViewModels[y]=_,g}_createTextVMParams(v){const{graphic:y,_fieldInfoMap:g,_sourceLayer:_,_expressionAttributes:M}=this;if(v&&v.text){var b,A,E;const x=null!==(b=null==y?void 0:y.attributes)&&void 0!==b?b:{},R=null!==(A=null===(E=this.formattedAttributes)||void 0===E?void 0:E.global)&&void 0!==A?A:{};v.text=Yt({attributes:x,fieldInfoMap:g,globalAttributes:R,expressionAttributes:M,layer:_,text:v.text})}return{graphic:y,creator:v.text}}_compileText(v,y){const g=v.clone();return this.contentViewModels[y]=new Oi(this._createTextVMParams(g)),g}_compileLastEditInfo(){const{_effectivePopupTemplate:v,_sourceLayer:y,graphic:g,timeZone:_}=this;if(!v)return;const{lastEditInfoEnabled:M}=v,b=null==y?void 0:y.editFieldsInfo;return M&&b?function Js(v,y,g,_){const{creatorField:M,creationDateField:b,editorField:A,editDateField:E}=v;if(!y)return;const x=(0,ro.hv)(_&&"preferredTimeZone"in _?_.preferredTimeZone:null,!(!_||!("datesInUnknownTimezone"in _)||!_.datesInUnknownTimezone),g,co,"date"),R={...co,...x},Z=y[E];if("number"==typeof Z){const H=y[A];return{type:"edit",date:(0,Ci.Yq)(Z,R),user:H}}const K=y[b];if("number"==typeof K){const H=y[M];return{type:"create",date:(0,Ci.Yq)(K,R),user:H}}return null}(b,null==g?void 0:g.attributes,_,y):void 0}_compileTitle(v){var y,g,_;const{_fieldInfoMap:M,_sourceLayer:b,graphic:A,_expressionAttributes:E}=this;return Yt({attributes:null!==(y=null==A?void 0:A.attributes)&&void 0!==y?y:{},fieldInfoMap:M,globalAttributes:null!==(g=null===(_=this.formattedAttributes)||void 0===_?void 0:_.global)&&void 0!==g?g:{},expressionAttributes:E,layer:b,text:v})}_getTitle(){var v=this;return(0,V.A)(function*(){const{_effectivePopupTemplate:y,graphic:g}=v;return g?Li(null==y?void 0:y.title,{graphic:g}):null})()}_getContent(){var v=this;return(0,V.A)(function*(){const{_effectivePopupTemplate:y,graphic:g}=v;return g?Li(null==y?void 0:y.content,{graphic:g}):null})()}_queryFeature(v){var y=this;return(0,V.A)(function*(){const{_featureAbortController:g,_sourceLayer:_,graphic:M,_effectivePopupTemplate:b}=y,A=y.map,E=y.view,x=y.spatialReference,R=y.location;if(g!==y._featureAbortController||!M)return;yield function er(v,y){return nn.apply(this,arguments)}({graphic:M,popupTemplate:b,layer:_,spatialReference:x},v);const{content:{value:Z},title:{value:K}}=yield(0,ot.Lx)({content:y._getContent(),title:y._getTitle()}),{expressionAttributes:{value:H}}=yield(0,ot.Lx)({checkForRelatedFeatures:y._checkForRelatedFeatures(v),expressionAttributes:ll({expressionInfos:null==b?void 0:b.expressionInfos,spatialReference:x,graphic:M,map:A,interceptor:Ai.interceptor,view:E,options:v,location:R})});g===y._featureAbortController&&M&&(y._expressionAttributes=H,y._graphicExpressionAttributes={...M.attributes,...H},y._set("formattedAttributes",y._createFormattedAttributes(Z)),y._set("title",y._compileTitle(K)),y._set("lastEditInfo",y._compileLastEditInfo()||null),y._set("content",y._compileContent(Z)||null))})()}_createMediaFormattedAttributes({contentElement:v,contentElementIndex:y,formattedAttributes:g}){const{_effectivePopupTemplate:_,graphic:M,relatedInfos:b,_sourceLayer:A,_fieldInfoMap:E,_graphicExpressionAttributes:x,timeZone:R}=this;g.content[y]=qi({fieldInfos:null==_?void 0:_.fieldInfos,graphic:M,attributes:{...x,...v.attributes},layer:A,fieldInfoMap:E,relatedInfos:b,timeZone:R})}_createFieldsFormattedAttributes({contentElement:v,contentElementIndex:y,formattedAttributes:g}){if(v.fieldInfos){const{graphic:_,relatedInfos:M,_sourceLayer:b,_fieldInfoMap:A,_graphicExpressionAttributes:E,timeZone:x}=this;g.content[y]=qi({fieldInfos:v.fieldInfos,graphic:_,attributes:{...E,...v.attributes},layer:b,fieldInfoMap:A,relatedInfos:M,timeZone:x})}}_createFormattedAttributes(v){const{_effectivePopupTemplate:y,graphic:g,relatedInfos:_,_sourceLayer:M,_fieldInfoMap:b,_graphicExpressionAttributes:A,timeZone:E}=this,R={global:qi({fieldInfos:null==y?void 0:y.fieldInfos,graphic:g,attributes:A,layer:M,fieldInfoMap:b,relatedInfos:_,timeZone:E}),content:[]};return Array.isArray(v)&&v.forEach((Z,K)=>{"fields"===Z.type&&this._createFieldsFormattedAttributes({contentElement:Z,contentElementIndex:K,formattedAttributes:R}),"media"===Z.type&&this._createMediaFormattedAttributes({contentElement:Z,contentElementIndex:K,formattedAttributes:R})}),R}_checkForRelatedFeatures(v){const{graphic:y,_effectivePopupTemplate:g}=this;return this._queryRelatedInfos(y,yo(g),v)}_queryRelatedInfos(v,y,g){var _=this;return(0,V.A)(function*(){const{relatedInfos:M,_sourceLayer:b}=_;M.clear();const A=null!=(null==b?void 0:b.associatedLayer)?yield null==b?void 0:b.associatedLayer.load(g):b;if(!A||!v)return;const E=y.filter(Z=>Z&&Dt(Z.fieldName));if(null==E||!E.length)return;y.forEach(Z=>_._configureRelatedInfo(Z,A));const x=yield function Vr({relatedInfos:v,layer:y},g){const _={};return v.forEach((M,b)=>{const{relation:A}=M;if(!A){const K=new Y.A("relation-required","A relation is required on a layer to retrieve related records.");throw So().error(K),K}const{relatedTableId:E}=A;if("number"!=typeof E){const K=new Y.A("A related table ID is required on a layer to retrieve related records.");throw So().error(K),K}const x=`${y.url}/${E}`,R=$o.get(x),Z=null!=R?R:function Nr(v,y){return(0,xr.A)(v,{query:{f:"json"},signal:null==y?void 0:y.signal})}(x);R||$o.set(x,Z),_[b]=Z}),(0,ot.qr)((0,ot.Lx)(_),g)}({relatedInfos:M,layer:A},g);Object.keys(x).forEach(Z=>{var K;const H=M.get(Z.toString()),ae=null===(K=x[Z])||void 0===K?void 0:K.value;H&&ae&&(H.layerInfo=ae.data)});const R=yield function zr({graphic:v,relatedInfos:y,layer:g},_){const M={};return y.forEach((b,A)=>{b.layerInfo&&(M[A]=function Br(v,y,g,_){return Mn.apply(this,arguments)}(v,b,g,_))}),(0,ot.Lx)(M)}({graphic:v,relatedInfos:M,layer:A},g);Object.keys(R).forEach(Z=>{var K;!function Sr(v,y){if(!y||!v)return;const{features:g,statsFeatures:_}=v,M=null==g?void 0:g.value;y.relatedFeatures=M?M.features:[];const b=null==_?void 0:_.value;y.relatedStatsFeatures=b?b.features:[]}(null===(K=R[Z])||void 0===K?void 0:K.value,M.get(Z.toString()))})})()}_configureRelatedInfo(v,y){const{relatedInfos:g}=this,_=Di(v.fieldName);if(!_)return;const{layerId:M,fieldName:b}=_;if(!M)return;const A=g.get(M.toString())||function Rr(v,y){const g=function Tr(v,y){if(!y.relationships)return null;let g=null;const{relationships:_}=y;return _.some(M=>M.id===parseInt(v,10)&&(g=M,!0)),g}(v,y);if(g)return{url:`${y.url}/${g.relatedTableId}`,sourceSpatialReference:y.spatialReference,relation:g,relatedFields:[],outStatistics:[]}}(M,y);A&&(function Kr({relatedInfo:v,fieldName:y,fieldInfo:g}){var _;if(null!==(_=v.relatedFields)&&void 0!==_&&_.push(y),g.statisticType){var M;const b=new Cr.A({statisticType:g.statisticType,onStatisticField:y,outStatisticFieldName:y});null===(M=v.outStatistics)||void 0===M||M.push(b)}}({relatedInfo:A,fieldName:b,fieldInfo:v}),this.relatedInfos.set(M,A))}};qe.interceptor=new class _l{constructor(y,g){this.preLayerQueryCallback=y,this.preRequestCallback=g,this.preLayerQueryCallback||(this.preLayerQueryCallback=_=>{}),this.preRequestCallback||(this.preLayerQueryCallback=_=>{})}}(({query:v,layer:y,method:g})=>{wo({layer:y,method:g,query:v,definitionExpression:`${y.definitionExpression} ${y.serviceDefinitionExpression}`})},({queryPayload:v,layer:y,method:g})=>{wo({layer:y,method:g,query:v,definitionExpression:`${y.definitionExpression} ${y.serviceDefinitionExpression}`})}),(0,F._)([(0,I.MZ)()],qe.prototype,"_error",void 0),(0,F._)([(0,I.MZ)()],qe.prototype,"_featureAbortController",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"_effectivePopupTemplate",null),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"_fieldInfoMap",null),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"_sourceLayer",null),(0,F._)([(0,I.MZ)()],qe.prototype,"abilities",void 0),(0,F._)([(0,oe.w)("abilities")],qe.prototype,"castAbilities",null),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"content",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"contentViewModels",void 0),(0,F._)([(0,I.MZ)()],qe.prototype,"description",void 0),(0,F._)([(0,I.MZ)({type:Boolean})],qe.prototype,"defaultPopupTemplateEnabled",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"isTable",null),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"state",null),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"formattedAttributes",void 0),(0,F._)([(0,I.MZ)({type:li.A,value:null})],qe.prototype,"graphic",null),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"lastEditInfo",void 0),(0,F._)([(0,I.MZ)({type:yn.A})],qe.prototype,"location",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"relatedInfos",void 0),(0,F._)([(0,I.MZ)()],qe.prototype,"spatialReference",null),(0,F._)([(0,I.MZ)()],qe.prototype,"timeZone",null),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"title",void 0),(0,F._)([(0,I.MZ)()],qe.prototype,"map",null),(0,F._)([(0,I.MZ)({readOnly:!0})],qe.prototype,"waitingForContent",null),(0,F._)([(0,I.MZ)()],qe.prototype,"view",void 0),qe=Ai=(0,F._)([(0,ce.$)("esri.widgets.Feature.FeatureViewModel")],qe);const On=qe,pt="esri-feature",nt={base:pt,container:`${pt}__size-container`,title:`${pt}__title`,main:`${pt}__main-container`,btn:`${pt}__button`,icon:`${pt}__icon`,content:`${pt}__content`,contentNode:`${pt}__content-node`,contentNodeText:`${pt}__content-node--text`,contentElement:`${pt}__content-element`,text:`${pt}__text`,lastEditedInfo:`${pt}__last-edited-info`,fields:`${pt}__fields`,fieldHeader:`${pt}__field-header`,fieldData:`${pt}__field-data`,fieldDataDate:`${pt}__field-data--date`,loadingSpinnerContainer:`${pt}__loading-container`,spinner:`${pt}__loading-spinner`},es=v=>{let y=class extends v{constructor(){super(...arguments),this.renderNodeContent=g=>Lo(g)&&!g.destroyed?(0,Q.K)("div",{class:nt.contentNode,key:g},g.render()):g instanceof HTMLElement?(0,Q.K)("div",{afterCreate:this._attachToNode,bind:g,class:nt.contentNode,key:g}):function cr(v){return v&&"function"==typeof v.postMixInProperties&&"function"==typeof v.buildRendering&&"function"==typeof v.postCreate&&"function"==typeof v.startup}(g)?(0,Q.K)("div",{afterCreate:this._attachToNode,bind:g.domNode,class:nt.contentNode,key:g}):null}_attachToNode(g){g.appendChild(this)}};return y=(0,F._)([(0,ce.$)("esri.widgets.Feature.ContentMixin")],y),y};var Pn;const ts={title:!0,content:!0,lastEditedInfo:!0},is="relationship-handles";let ht=Pn=class extends(es(he.A)){constructor(v,y){super(v,y),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...ts},this.viewModel=new On}initialize(){this.addHandles((0,S.wB)(()=>{var v;return null===(v=this.viewModel)||void 0===v?void 0:v.contentViewModels},()=>this._setupContentWidgets(),S.Vh))}loadDependencies(){return(0,ai.W)({notice:()=>Promise.all([w.e(2597),w.e(4668),w.e(2076),w.e(5661)]).then(w.bind(w,85661))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(v){this.viewModel.graphic=v}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(v){this.viewModel.defaultPopupTemplateEnabled=v}get isTable(){return this.viewModel.isTable}get label(){var v,y;return null!==(v=null===(y=this.messages)||void 0===y?void 0:y.widgetLabel)&&void 0!==v?v:""}set label(v){this._overrideIfSome("label",v)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(v){this.viewModel.spatialReference=v}get timeZone(){return this.viewModel.timeZone}set timeZone(v){this.viewModel.timeZone=v}get title(){return this.viewModel.title}castVisibleElements(v){return{...ts,...v}}get map(){return this.viewModel.map}set map(v){this.viewModel.map=v}get view(){return this.viewModel.view}set view(v){this.viewModel.view=v}setActiveMedia(v,y){return this.viewModel.setActiveMedia(v,y)}nextMedia(v){return this.viewModel.nextMedia(v)}previousMedia(v){return this.viewModel.previousMedia(v)}render(){const{state:v}=this.viewModel,y=(0,Q.K)("div",{class:nt.container,key:"container"},this._renderTitle(),"error"===v?this._renderError():"loading"===v?this._renderLoading():this._renderContentContainer());return(0,Q.K)("div",{class:this.classes(nt.base,Pe.D.widget)},y)}_renderError(){const{messagesCommon:v,messages:y,visibleElements:g}=this;return(0,Q.K)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},g.title?(0,Q.K)("div",{key:"error-title",slot:"title"},v.errorMessage):null,(0,Q.K)("div",{key:"error-message",slot:"message"},y.loadingError))}_renderLoading(){return(0,Q.K)("div",{class:nt.loadingSpinnerContainer,key:"loading-container"},(0,Q.K)("span",{class:this.classes(Et.T.loadingIndicator,Pe.D.rotating,nt.spinner)}))}_renderContentContainer(){const{visibleElements:v}=this;return v.content?(0,Q.K)("div",{class:nt.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:v,title:y}=this;return v.title?(0,Q.K)(ln,{class:nt.title,innerHTML:y,level:this.headingLevel}):null}_renderContent(){const v=this.viewModel.content,y="content";if(!v)return null;if(Array.isArray(v))return v.length?(0,Q.K)("div",{class:nt.contentNode,key:`${y}-content-elements`},v.map(this._renderContentElement,this)):null;if("string"==typeof v){const g=this._contentWidgets[0];return!g||g.destroyed?null:(0,Q.K)("div",{class:this.classes(nt.contentNode,nt.contentNodeText),key:`${y}-content`},g.render())}return this.renderNodeContent(v)}_renderContentElement(v,y){var g;const{visibleElements:_}=this;if("boolean"!=typeof _.content&&(null===(g=_.content)||void 0===g||!g[v.type]))return null;switch(v.type){case"attachments":return this._renderAttachments(y);case"custom":return this._renderCustom(v,y);case"fields":return this._renderFields(y);case"media":return this._renderMedia(y);case"text":return this._renderText(v,y);case"expression":return this._renderExpression(y);case"relationship":return this._renderRelationship(y);default:return null}}_renderAttachments(v){const y=this._contentWidgets[v];if(!y||y.destroyed)return null;const{state:g,attachmentInfos:_}=y.viewModel;return"loading"===g||_.length>0?(0,Q.K)("div",{class:this.classes(nt.contentElement),key:this._buildKey("attachments-element",v)},y.render()):null}_renderRelationship(v){const y=this._contentWidgets[v];return y&&!y.destroyed&&this.flowItems?(0,Q.K)("div",{class:nt.contentElement,key:this._buildKey("relationship-element",v)},y.render()):null}_renderExpression(v){const y=this._contentWidgets[v];return!y||y.destroyed?null:(0,Q.K)("div",{class:nt.contentElement,key:this._buildKey("expression-element",v)},y.render())}_renderCustom(v,y){const{creator:g}=v,_=this._contentWidgets[y];return!_||_.destroyed?null:g?(0,Q.K)("div",{class:nt.contentElement,key:this._buildKey("custom-element",y)},_.render()):null}_renderFields(v){const y=this._contentWidgets[v];return!y||y.destroyed?null:(0,Q.K)("div",{class:nt.contentElement,key:this._buildKey("fields-element",v)},y.render())}_renderMedia(v){const y=this._contentWidgets[v];return!y||y.destroyed?null:(0,Q.K)("div",{class:nt.contentElement,key:this._buildKey("media-element",v)},y.render())}_renderLastEditInfo(){const{visibleElements:v,messages:y}=this,{lastEditInfo:g}=this.viewModel;if(!g||!v.lastEditedInfo)return null;const{date:_,user:M}=g,A=(0,$.V)("edit"===g.type?M?y.lastEditedByUser:y.lastEdited:M?y.lastCreatedByUser:y.lastCreated,{date:_,user:M});return(0,Q.K)("div",{class:this.classes(nt.lastEditedInfo,nt.contentElement),key:"edit-info-element"},A)}_renderText(v,y){const _=this._contentWidgets[y];return!_||_.destroyed?null:v.text?(0,Q.K)("div",{class:this.classes(nt.contentElement,nt.text),key:this._buildKey("text-element",y)},_.render()):null}_buildKey(v,...y){var g;return`${v}__${(null===(g=this.viewModel)||void 0===g||null===(g=g.graphic)||void 0===g?void 0:g.uid)||"0"}-${y.join("-")}`}_destroyContentWidget(v){v&&(v.viewModel=null,!v.destroyed&&v.destroy())}_destroyContentWidgets(){this.removeHandles(is),this._contentWidgets.forEach(v=>this._destroyContentWidget(v)),this._contentWidgets=[]}_addFeatureRelationshipHandles(v){const{flowItems:y,visibleElements:g}=this;this.addHandles([(0,S.on)(()=>v,"select-record",({featureViewModel:_})=>{y&&(_.abilities={relationshipContent:!0},y.push(new Pn({flowItems:y,viewModel:_,visibleElements:g})))}),(0,S.on)(()=>v,"show-all-records",()=>{if(!y)return;const{viewModel:_}=v;_.showAllEnabled=!0;const M=new Yo({visibleElements:{title:!1,description:!1},viewModel:_});this._addFeatureRelationshipHandles(M),y.push(M)})],is)}_setupContentWidgets(){var v;this._destroyContentWidgets();const{headingLevel:y,visibleElements:g}=this,_=null===(v=this.viewModel)||void 0===v?void 0:v.content,{contentViewModels:M}=this.viewModel;if(Array.isArray(_))_.forEach((b,A)=>{if("attachments"===b.type&&(this._contentWidgets[A]=new ur({displayType:b.displayType,headingLevel:g.title?y+1:y,viewModel:M[A]})),"fields"===b.type&&(this._contentWidgets[A]=new Oo({viewModel:M[A]})),"media"===b.type&&(this._contentWidgets[A]=new Uo({viewModel:M[A]})),"text"===b.type&&(this._contentWidgets[A]=new Pi({viewModel:M[A]})),"custom"===b.type&&(this._contentWidgets[A]=new Pi({viewModel:M[A]})),"expression"===b.type&&(this._contentWidgets[A]=new dl({viewModel:M[A]})),"relationship"===b.type){const E=new Yo({viewModel:M[A]});this._addFeatureRelationshipHandles(E),this._contentWidgets[A]=E}},this);else{const b=M[0];b&&!b.destroyed&&(this._contentWidgets[0]=new Pi({viewModel:b}))}this.scheduleRender()}};(0,F._)([(0,I.MZ)()],ht.prototype,"graphic",null),(0,F._)([(0,I.MZ)()],ht.prototype,"defaultPopupTemplateEnabled",null),(0,F._)([(0,I.MZ)()],ht.prototype,"flowItems",void 0),(0,F._)([(0,I.MZ)()],ht.prototype,"headingLevel",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],ht.prototype,"isTable",null),(0,F._)([(0,I.MZ)()],ht.prototype,"label",null),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/Feature/t9n/Feature")],ht.prototype,"messages",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/t9n/common")],ht.prototype,"messagesCommon",void 0),(0,F._)([(0,I.MZ)()],ht.prototype,"spatialReference",null),(0,F._)([(0,I.MZ)()],ht.prototype,"timeZone",null),(0,F._)([(0,I.MZ)({readOnly:!0})],ht.prototype,"title",null),(0,F._)([(0,I.MZ)()],ht.prototype,"visibleElements",void 0),(0,F._)([(0,oe.w)("visibleElements")],ht.prototype,"castVisibleElements",null),(0,F._)([(0,I.MZ)()],ht.prototype,"map",null),(0,F._)([(0,I.MZ)()],ht.prototype,"view",null),(0,F._)([(0,I.MZ)({type:On})],ht.prototype,"viewModel",void 0),ht=Pn=(0,F._)([(0,ce.$)("esri.widgets.Feature")],ht);const bl=ht;var wl=w(42425),Rn=w(11817);let qt=class extends wl.A.EventedAccessor{constructor(v){super(v),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,S.z7)(()=>{const y=this.screenLocationEnabled?this.view:null;return y?[y.size,"3d"===y.type?y.camera:y.viewpoint]:null},()=>this.notifyChange("screenLocation")),(0,S.wB)(()=>this.screenLocation,(y,g)=>{null!=y&&null!=g&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:v,view:y,screenLocationEnabled:g}=this,_=null==y?void 0:y.spatialReference,M=_?(0,Rn.projectOrLoad)(v,_).geometry:null;return g&&M&&null!=y&&y.ready?y.toScreen(M):null}};(0,F._)([(0,I.MZ)()],qt.prototype,"location",void 0),(0,F._)([(0,I.MZ)()],qt.prototype,"screenLocation",null),(0,F._)([(0,I.MZ)()],qt.prototype,"screenLocationEnabled",void 0),(0,F._)([(0,I.MZ)()],qt.prototype,"view",void 0),qt=(0,F._)([(0,ce.$)("esri.widgets.support.AnchorElementViewModel")],qt);const ns=qt;let Bi=class extends ns{constructor(v){super(v),this.visible=!1}};(0,F._)([(0,I.MZ)()],Bi.prototype,"visible",void 0),Bi=(0,F._)([(0,ce.$)("esri.widgets.CompassViewModel")],Bi);const os=Bi,Sn="esri-spinner",$n_base=Sn,$n_spinnerStart=`${Sn}--start`,$n_spinnerFinish=`${Sn}--finish`;let ei=class extends he.A{constructor(v,y){super(v,y),this._animationDelay=500,this._animationPromise=null,this.viewModel=new os}initialize(){this.addHandles((0,S.wB)(()=>this.visible,v=>this._visibleChange(v)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(v){this.viewModel.location=v}get view(){return this.viewModel.view}set view(v){this.viewModel.view=v}get visible(){return this.viewModel.visible}set visible(v){this.viewModel.visible=v}show(v){const{location:y,promise:g}=null!=v?v:{};y&&(this.viewModel.location=y),this.visible=!0,g&&g.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:v}=this,{screenLocation:y}=this.viewModel,g=!!y,b={[$n_spinnerStart]:v&&g,[$n_spinnerFinish]:!v&&g},A=this._getPositionStyles();return(0,Q.K)("div",{class:this.classes($n_base,b),styles:A})}_visibleChange(v){if(v)return void(this.viewModel.screenLocationEnabled=!0);const y=(0,ot.Pl)(this._animationDelay);this._animationPromise=y,y.catch(()=>{}).then(()=>{this._animationPromise===y&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:v,view:y}=this.viewModel;if(null==y||null==v)return{};const{padding:g}=y;return{left:v.x-g.left+"px",top:v.y-g.top+"px"}}};(0,F._)([(0,I.MZ)()],ei.prototype,"location",null),(0,F._)([(0,I.MZ)()],ei.prototype,"view",null),(0,F._)([(0,I.MZ)({type:os})],ei.prototype,"viewModel",void 0),(0,F._)([(0,I.MZ)()],ei.prototype,"visible",null),ei=(0,F._)([(0,ce.$)("esri.widgets.Spinner")],ei);const Fl=ei,gt="esri-features",mt={icon:`${gt}__icon`,actionImage:`${gt}__action-image`,base:gt,container:`${gt}__container`,contentContainer:`${gt}__content-container`,contentFeature:`${gt}__content-feature`,flowItemCollapsed:`${gt}__flow-item--collapsed`,header:`${gt}__header`,footer:`${gt}__footer`,featureMenuObserver:`${gt}__feature-menu-observer`,actionExit:`${gt}__action--exit`,loader:`${gt}__loader`,featuresHeading:`${gt}__heading`,paginationActionBar:`${gt}__pagination-action-bar`,paginationPrevious:`${gt}__pagination-previous`,paginationNext:`${gt}__pagination-next`};let ti=class extends he.A{constructor(v,y){super(v,y),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=g=>{this.emit("open-related-feature",{feature:g})}}loadDependencies(){return(0,ai.W)({action:()=>Promise.all([w.e(2597),w.e(4668),w.e(8843),w.e(4201)]).then(w.bind(w,14201)),"flow-item":()=>Promise.all([w.e(2597),w.e(4668),w.e(8843),w.e(9560),w.e(5564),w.e(2076),w.e(8851)]).then(w.bind(w,18851))})}render(){const{flowItems:v}=this,y=null==v?void 0:v.toArray();return(0,Q.K)(Q.w,null,null==y?void 0:y.map(g=>this._renderRelatedRecordsFlowItem(g)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){var v;const y=null===(v=this.flowItems)||void 0===v?void 0:v.pop();y&&("showAllEnabled"in y.viewModel&&(y.viewModel.showAllEnabled=!1),y&&(y.viewModel=null,y.destroy()))}_renderRelatedRecordsFlowItem(v){var y;const{messages:g,closable:_,closed:M}=this,b="graphic"in v&&!v.isTable;return(0,Q.K)("calcite-flow-item",{bind:this,closable:_,closed:M,description:this._getRelatedRecordsFlowItemDescription(v),heading:null!==(y=v.title)&&void 0!==y?y:"",key:`flow-item-${v.viewModel.uid}`,onCalciteFlowItemBack:A=>{A.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},(0,Q.K)("calcite-action",{appearance:"transparent",bind:this,class:mt.actionExit,icon:"move-up",key:"exit-related-records-action",label:g.exitRelatedRecords,onclick:this._handleExitClick,scale:"m",slot:"header-actions-start",text:g.exitRelatedRecords,title:g.exitRelatedRecords}),b?(0,Q.K)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",label:g.selectFeature,onclick:()=>this._handleOpenRelatedFeature(v),scale:"m",slot:"header-actions-end",text:g.selectFeature,title:g.selectFeature}):null,(0,Q.K)("div",{class:mt.container},v.render()))}_getRelatedRecordsFlowItemDescription(v){var y;return"featureCountDescription"in v?v.featureCountDescription:null!==(y=v.viewModel.description)&&void 0!==y?y:""}};(0,F._)([(0,I.MZ)()],ti.prototype,"flowItems",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/Features/t9n/Features")],ti.prototype,"messages",void 0),(0,F._)([(0,I.MZ)()],ti.prototype,"closed",void 0),(0,F._)([(0,I.MZ)()],ti.prototype,"closable",void 0),ti=(0,F._)([(0,ce.$)("esri.widgets.Features.FeaturesRelatedRecords")],ti);const Il=ti;w(47280);var ii=w(9700),El=w(4032);class xl{constructor(y){this._observable=new El.I,this._set=new Set(y)}get size(){return(0,ii.gc)(this._observable),this._set.size}add(y){const g=this._set.size;return this._set.add(y),this._set.size!==g&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(y){const g=this._set.delete(y);return g&&this._observable.notify(),g}entries(){return(0,ii.gc)(this._observable),this._set.entries()}forEach(y,g){(0,ii.gc)(this._observable),this._set.forEach((_,M)=>y.call(g,_,M,this),g)}has(y){return(0,ii.gc)(this._observable),this._set.has(y)}keys(){return(0,ii.gc)(this._observable),this._set.keys()}values(){return(0,ii.gc)(this._observable),this._set.values()}[Symbol.iterator](){return(0,ii.gc)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}var Cl=w(55039),ss=w(95478);const rs="OBJECTID";function Un(v){return v&&"opacity"in v?v.opacity*Un(v.parent):1}function hs(v,y){return Zn.apply(this,arguments)}function Zn(){return(Zn=(0,V.A)(function*(v,y){var g,_,M,b,A;if(!v)return;const E=v.sourceLayer,x=null!==(g=null!=y&&y.useSourceLayer?E:v.layer)&&void 0!==g?g:E,R=Un(x);if(null!=v.symbol&&(null==y||!0!==y.ignoreGraphicSymbol)){const He="web-style"===v.symbol.type?yield(0,Ct.yG)(v.symbol,{...y,cache:null!=y?y.webStyleCache:null}):v.symbol.clone();return(0,Ct.dt)(He,null,R),He}const Z=null!==(_=null===(M=y)||void 0===M?void 0:M.renderer)&&void 0!==_?_:function Fi(v){if(v)return"renderer"in v?v.renderer:void 0}(x);let K=Z&&"getSymbolAsync"in Z?yield Z.getSymbolAsync(v,y):null;if(!K)return;if(K="web-style"===K.type?yield K.fetchSymbol({...y,cache:null!=y?y.webStyleCache:null}):K.clone(),!Z||!("visualVariables"in Z)||null===(b=Z.visualVariables)||void 0===b||!b.length)return(0,Ct.dt)(K,null,R),K;if("arcadeRequiredForVisualVariables"in Z&&Z.arcadeRequiredForVisualVariables&&null==(null===(A=y)||void 0===A?void 0:A.arcade)){const He={...y};He.arcade=yield(0,so.lw)(),y=He}const{getColor:H,getOpacity:ae,getAllSizes:me,getRotationAngle:ve}=yield Promise.resolve().then(w.bind(w,77522)),ye=[],_e=[],be=[],Ee=[];for(const He of Z.visualVariables)switch(He.type){case"color":ye.push(He);break;case"opacity":_e.push(He);break;case"rotation":Ee.push(He);break;case"size":He.target||be.push(He)}const Re=!!ye.length&&ye[ye.length-1],De=Re?H(Re,v,y):null,Ve=!!_e.length&&_e[_e.length-1];let Je=Ve?ae(Ve,v,y):null;if(null!=R&&(Je=null!=Je?Je*R:R),(0,Ct.dt)(K,De,Je),be.length){const He=me(be,v,y);yield(0,Ct.UQ)(K,He)}for(const He of Ee)(0,Ct.GG)(K,ve(He,v,y),He.axis);return K})).apply(this,arguments)}function ps(v){return v&&"function"==typeof v.highlight}w(8134),w(22079),w(16633),w(94013),w(77806),w(20175);var Ul=w(52491),ms=w(41866);const ni=z.A.ofType({key:"type",defaultKeyValue:"button",base:Ul.A,typeMap:{button:J.A,toggle:ms.A}}),Wt=new J.A({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:Et.T.zoomInMagnifyingGlass}),Vn=new J.A({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:Et.T.trash}),oi=new J.A({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Et.T.zoomInMagnifyingGlass}),Bt=new ms.A({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Et.T.table,value:!1}),Ni=()=>ie.A.getLogger("esri.widgets.Popup.PopupViewModel"),Bl=v=>{const{event:y,view:g,viewModel:_}=v,{action:M}=y;if(!M)return Promise.reject(new Y.A("trigger-action:missing-arguments","Event has no action"));const{disabled:b,id:A}=M;if(!A)return Promise.reject(new Y.A("trigger-action:invalid-action","action.id is missing"));if(b)return Promise.reject(new Y.A("trigger-action:invalid-action","Action is disabled"));if(A===Wt.id)return function Vl(v){return Kn.apply(this,arguments)}(_).catch(ot.jH);if(A===oi.id)return function zl(v){return jn.apply(this,arguments)}(_);if(A===Bt.id)return _.browseClusterEnabled=!_.browseClusterEnabled,_.featureMenuOpen=_.browseClusterEnabled,Promise.resolve();if(A===Vn.id){_.visible=!1;const{selectedFeature:E}=_;if(!E)return Promise.reject(new Y.A(`trigger-action:${Vn.id}`,"selectedFeature is required",{selectedFeature:E}));const{sourceLayer:x}=E;return x?x.remove(E):null==g||g.graphics.remove(E),Promise.resolve()}return Promise.resolve()};function vs(v){var y;const{selectedFeature:g,location:_,view:M}=v;return M&&null!==(y=null!=g?g:_)&&void 0!==y?y:null}function si(v){var y;return!!v&&v.isAggregate&&"cluster"===(null===(y=v.sourceLayer)||void 0===y||null===(y=y.featureReduction)||void 0===y?void 0:y.type)}function zn(){return(zn=(0,V.A)(function*(v,y){if("3d"!==(null==y?void 0:y.type)||!v||"esri.Graphic"!==v.declaredClass)return!0;const g=y.getViewForGraphic(v);if(g&&"whenGraphicBounds"in g){let _=null;try{_=yield g.whenGraphicBounds(v,{useViewElevation:!0})}catch{}return!_||!_.boundingBox||_.boundingBox[0]===_.boundingBox[3]&&_.boundingBox[1]===_.boundingBox[4]&&_.boundingBox[2]===_.boundingBox[5]}return!0})).apply(this,arguments)}function Kn(){return Kn=(0,V.A)(function*(v){var y;const{location:g,selectedFeature:_,view:M,zoomFactor:b}=v,A=vs(v);if(!M||!A){const K=new Y.A("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:A,view:M});throw Ni().error(K),K}const E=M.scale/b,x=null===(y=v.selectedFeature)||void 0===y?void 0:y.geometry,R=null!=x?x:g,Z=null!=R&&"point"===R.type&&(yield function Nl(v,y){return zn.apply(this,arguments)}(_,M));Wt.active=!0,Wt.disabled=!0;try{yield v.zoomTo({target:{target:A,scale:Z?E:void 0}})}catch{const H=new Y.A("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:_});Ni().error(H)}finally{Wt.active=!1,Wt.disabled=!1,v.zoomToLocation=null,Z&&(v.location=R)}}),Kn.apply(this,arguments)}function jn(){return(jn=(0,V.A)(function*(v){const{selectedFeature:y,view:g}=v;if("2d"!==(null==g?void 0:g.type)){const A=new Y.A("zoomToCluster:invalid-view","View must be 2d MapView.",{view:g});throw Ni().error(A),A}if(!y||!si(y)){const A=new Y.A("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:y});throw Ni().error(A),A}const[_,M]=yield kn(g,y);oi.active=!0,oi.disabled=!0;const{extent:b}=yield _.queryExtent(M);b&&(yield v.zoomTo({target:b})),oi.active=!1,oi.disabled=!1})).apply(this,arguments)}function Wn(){return(Wn=(0,V.A)(function*(v){const{view:y,selectedFeature:g}=v;if(!y||!g)return;const[_,M]=yield kn(y,g),{extent:b}=yield _.queryExtent(M);v.selectedClusterBoundaryFeature.geometry=b,y.graphics.add(v.selectedClusterBoundaryFeature)})).apply(this,arguments)}function Hn(){return(Hn=(0,V.A)(function*(v){const{selectedFeature:y,view:g}=v;if(!g||!y)return;const[_,M]=yield kn(g,y);Bt.active=!0,Bt.disabled=!0;const{features:b}=yield _.queryFeatures(M);Bt.active=!1,Bt.disabled=!1,Bt.value=!0,null==v||v.open({features:[y].concat(b),featureMenuOpen:!0})})).apply(this,arguments)}function kn(v,y){return Gn.apply(this,arguments)}function Gn(){return(Gn=(0,V.A)(function*(v,y){const g=yield v.whenLayerView(y.sourceLayer),_=g.createQuery(),M=y.getObjectId();return _.aggregateIds=null!=M?[M]:[],[g,_]})).apply(this,arguments)}var Hl=w(10361),kl=w(88521);let Vi=null,$e=class extends((0,Hl.R)(ns)){constructor(v){var y;super(v),y=this,this._pendingPromises=new xl,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this._locationScaleHandle=null,this.actions=new ni,this.activeFeature=null,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new li.A({symbol:new kl.A({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=(0,ot.sg)(function(){var g=(0,V.A)(function*(_){var M,b,A;const{view:E}=y,x=null===(M=y.selectedFeature)||void 0===M||null===(M=M.geometry)||void 0===M?void 0:M.type,R=null!==(b=y.location)&&void 0!==b?b:_;if("mesh"!==x&&E&&R&&y.selectedFeature)if("point"!==x)try{var Z,K,H;const{pendingFeatures:ae}=yield y._fetchFeaturesWithController({mapPoint:R}),me=(yield Promise.all(ae)).flat().filter(Boolean);if(!me.length)return;if(me.length!==y.features.length){const be=y._getHighlightLayer(y.selectedFeature),Ee="imagery"===(null==be?void 0:be.type)?void 0:be&&"objectIdField"in be?be.objectIdField||rs:null;if(Ee){const Re=y.selectedFeature.getObjectId(),De=me.findIndex(Ve=>{const Je=y._getHighlightLayer(Ve);return(null==Je?void 0:Je.uid)===(null==be?void 0:be.uid)&&Ve.attributes[Ee]===Re});y.features=me,y.selectedFeatureIndex=De}}const ve=null===(Z=me[y.selectedFeatureIndex])||void 0===Z?void 0:Z.geometry,ye=null!==(K="mesh"!==(null==ve?void 0:ve.type)?ve:null)&&void 0!==K?K:y.selectedFeature.geometry,_e=ye?(0,Rn.project)(ye,E.spatialReference):null;if(!_e)return;Vi||(Vi=yield w.e(6773).then(w.bind(w,16773))),(yield Vi.intersects(_e,R))||(y.location=null!==(H=(yield Vi.nearestCoordinate(_e,R)).coordinate)&&void 0!==H?H:R)}catch(ae){(0,ot.zf)(ae)||ie.A.getLogger(y).error(ae)}else y.location=null!==(A=N(y.selectedFeature.geometry))&&void 0!==A?A:R});return function(_){return g.apply(this,arguments)}}())}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),(0,S.wB)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,S.wB)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,S.wB)(()=>{var v;return null===(v=this.view)||void 0===v||null===(v=v.animation)||void 0===v?void 0:v.state},v=>this._animationStateChange(v)),(0,S.wB)(()=>this.location,v=>this._locationChange(v)),(0,S.wB)(()=>this.selectedFeature,v=>this._selectedFeatureChange(v)),(0,S.wB)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,S.wB)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,S.wB)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",v=>Bl({event:v,viewModel:this,view:this.view})),(0,S.z7)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),S.OH),(0,S.wB)(()=>{var v,y,g;return[this.features,null===(v=this.view)||void 0===v?void 0:v.map,null===(y=this.view)||void 0===y?void 0:y.spatialReference,null===(g=this.view)||void 0===g?void 0:g.timeZone]},()=>this._updateFeatureVMs()),(0,S.wB)(()=>{var v;return null===(v=this.view)||void 0===v?void 0:v.scale},()=>this._viewScaleChange()),(0,S.z7)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,S.wB)(()=>this.browseClusterEnabled,v=>v?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){var v;this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,null!==(v=this._locationScaleHandle)&&void 0!==v&&v.remove(),this._locationScaleHandle=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){var v;const y=this._get("allActions")||new ni;y.removeAll();const{actions:g,defaultActions:_,defaultPopupTemplateEnabled:M,includeDefaultActions:b,selectedFeature:A}=this,E=b?_.concat(g):g,x=A&&("function"==typeof A.getEffectivePopupTemplate&&A.getEffectivePopupTemplate(M)||A.popupTemplate),R=null==x?void 0:x.actions,Z=null!=x&&x.overwriteActions?R:null!==(v=null==R?void 0:R.concat(E))&&void 0!==v?v:E;return null!=Z&&Z.filter(Boolean).forEach(K=>y.add(K)),y}get defaultActions(){const v=this._get("defaultActions")||new ni;return v.removeAll(),v.addMany(si(this.selectedFeature)?[oi.clone(),Bt.clone()]:[Wt.clone()]),v}get featureCount(){return this.features.length}set features(v){const y=v||[];this._set("features",y);const{pendingPromisesCount:g,promiseCount:_,selectedFeatureIndex:M}=this,b=_&&y.length;b&&g&&-1===M?this.selectedFeatureIndex=0:b&&-1!==M||(this.selectedFeatureIndex=y.length?0:-1)}set location(v){var y,g;let _=v;const M=null===(y=this.view)||void 0===y||null===(y=y.spatialReference)||void 0===y?void 0:y.isWebMercator;(null==v||null===(g=v.spatialReference)||void 0===g?void 0:g.isWGS84)&&M&&(_=(0,Cl.Gh)(v)),this._set("location",_)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(v){this._pendingPromises.clear(),this.features=[],Array.isArray(v)&&v.length?(this._set("promises",v),(v=v.slice(0)).forEach(y=>this._pendingPromises.add(y)),v.reduce((y,g)=>y.finally(()=>g.then(_=>{this._pendingPromises.has(g)&&this._updateFeatures(_)}).finally(()=>this._pendingPromises.delete(g)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:v,selectedFeatureIndex:y}=this;return-1===y?null:v[y]||null}get selectedFeatureIndex(){const v=this._get("selectedFeatureIndex");return"number"==typeof v?v:-1}set selectedFeatureIndex(v){const{featureCount:y}=this;v=isNaN(v)||v<-1||!y?-1:(v+y)%y,this.activeFeature=null,this._set("selectedFeatureIndex",v)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){var v;return null!==(v=this.view)&&void 0!==v&&v.ready?"ready":"disabled"}get waitingForContents(){return this.featureViewModels.some(v=>v.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:v}=this,y=vs(this);return y&&v?this.callGoTo({target:{target:y,scale:v.scale}}):Promise.reject(new Y.A("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:y,view:v}))}zoomTo(v){return this.callGoTo(v)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(v,y){var g;const{view:_}=this;if(!_||!v)throw new Y.A("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:v,view:_});return _.fetchPopupFeatures(v,{pointerType:null==y||null===(g=y.event)||void 0===g?void 0:g.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:null==y?void 0:y.signal})}open(v){const y={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...v,visible:!0},{fetchFeatures:g}=y;delete y.fetchFeatures,g&&this._setFetchFeaturesPromises(y.location);const _=["actionsMenuOpen","collapsed"];for(const M of _)delete y[M];this.set(y)}triggerAction(v){const y=this.allActions.at(v);y&&!y.disabled&&this.emit("trigger-action",{action:y})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function Wl(v){Bt.value=!1;const y=v.features.filter(g=>si(g));y.length&&(v.features=y)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var v=this;return(0,V.A)(function*(){const{view:y,selectedFeature:g}=v;"2d"===(null==y?void 0:y.type)?si(g)?(yield function Kl(v){return Wn.apply(this,arguments)}(v),yield function jl(v){return Hn.apply(this,arguments)}(v)):ie.A.getLogger(v).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",g):ie.A.getLogger(v).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",g)})()}handleViewClick(v){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(v)}_animationStateChange(v){this.zoomToLocation||(Wt.disabled="waiting-for-target"===v)}_clearBrowsedClusterGraphics(){var v;const y=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(Jt.Ru);null!==(v=this.view)&&void 0!==v&&null!==(v=v.graphics)&&void 0!==v&&v.removeMany(y),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(si(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(v){const{selectedFeature:y,updateLocationEnabled:g}=this;g&&v&&(!y||y.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:v,featureCount:y,featurePage:g,featuresPerPage:_,featureViewModels:M}=this;if(null===g)return;const b=((g-1)*_+y)%y;M.slice(b,b+_).forEach((E,x)=>{var R;E&&(null!==(R=E.graphic)&&void 0!==R||(E.graphic=v[b+x]))})}_selectedFeatureChange(v){var y=this;return(0,V.A)(function*(){const{location:g,updateLocationEnabled:_,view:M}=y;if(v&&M){if(y.browseClusterEnabled)return y._selectedClusterFeature&&(M.graphics.remove(y._selectedClusterFeature),y._selectedClusterFeature=null),si(v)?void 0:(v.symbol=yield hs(v),y._selectedClusterFeature=v,void M.graphics.add(y._selectedClusterFeature));if(v.symbol=yield hs(v),!_&&g||!v.geometry){if(_&&!v.geometry){var b;yield y.centerAtLocation();const A=null===(b=M.center)||void 0===b?void 0:b.clone();A&&(y.location=A)}}else y.location=N(v.geometry)}})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(v){var y=this;return(0,V.A)(function*(){const{pendingFeatures:g}=yield y._fetchFeaturesWithController({mapPoint:v});y.promises=g})()}_destroyFeatureVMs(){this.featureViewModels.forEach(v=>v&&!v.destroyed&&v.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:v,features:y,featureViewModels:g,view:_}=this;if(si(v)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),null==y||!y.length)return;const M=g.slice(0),b=[];y.forEach((A,E)=>{if(!A)return;let x=null;if(M.some((R,Z)=>(R&&R.graphic===A&&(x=R,M.splice(Z,1)),!!x)),x)b[E]=x;else{const R=new On({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==_?void 0:_.spatialReference,graphic:A===v?A:null,location:this.location,map:null==_?void 0:_.map,view:_});b[E]=R}}),M.forEach(A=>A&&!A.destroyed&&A.destroy()),this._set("featureViewModels",b)}_getScreenPoint(v,y){var g=this;return(0,V.A)(function*(){const{view:_}=g;yield null==_?void 0:_.when();const M=null==v?void 0:v.spatialReference,b=null==_?void 0:_.spatialReference;return M&&b?(yield(0,Rn.initializeProjection)(M,b,null,y),_.toScreen(v)):null})()}_cancelFetchingFeatures(){const v=this._fetchFeaturesController;v&&v.abort(),this._fetchFeaturesController=null}_projectScreenPointAndFetchFeatures({mapPoint:v,screenPoint:y,event:g,signal:_}){var M=this;return(0,V.A)(function*(){return M.fetchFeatures(null!=y?y:yield M._getScreenPoint(null!=v?v:M.location,{signal:_}),{signal:_,event:g})})()}_fetchFeaturesWithController({mapPoint:v,screenPoint:y,event:g}){this._cancelFetchingFeatures();const _=new AbortController,{signal:M}=_;this._fetchFeaturesController=_;const b=this._projectScreenPointAndFetchFeatures({mapPoint:v,screenPoint:y,signal:M,event:g});return b.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),b}_fetchFeaturesAndOpen(v){var y=this;return(0,V.A)(function*(){var g;const{mapPoint:_,screenPoint:M}=v,{view:b}=y;null!==(g=y._locationScaleHandle)&&void 0!==g&&g.remove(),y._locationScaleHandle=(0,S.wB)(()=>{var E;return null===(E=y.view)||void 0===E?void 0:E.scale},()=>y._debouncedLocationUpdate(_).catch(E=>{(0,ot.zf)(E)||ie.A.getLogger(y).error(E)}));const{pendingFeatures:A}=yield y._fetchFeaturesWithController({mapPoint:_,screenPoint:M,event:v});null!=b&&b.popup&&"open"in b.popup&&b.popup.open({location:null!=_?_:void 0,promises:A})})()}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(v,y){return(0,V.A)(function*(){return yield v.when(),v.whenLayerView(y)})()}_getHighlightLayer(v){const{layer:y,sourceLayer:g}=v;return g&&"layer"in g&&g.layer?g.layer:"map-notes"===(null==g?void 0:g.type)||"subtype-group"===(null==g?void 0:g.type)?g:y}_getHighlightTarget(v,y,g){if(function Yl(v,y){return"building-scene"===v||"2d"===y&&("map-image"===v||"tile"===v||"imagery"===v||"imagery-tile"===v)}(y.type,g))return v;const _=v.getObjectId();if(null!=_)return _;const M="imagery"===y.type?void 0:"objectIdField"in y?y.objectIdField||rs:null,b=v.attributes;return b&&M&&b[M]||v}_mapIncludesLayer(v){var y;return!(null===(y=this.view)||void 0===y||null===(y=y.map)||void 0===y||null===(y=y.allLayers)||void 0===y||!y.includes(v))}_highlightActiveFeature(){var v=this;return(0,V.A)(function*(){const y="highlight-active-feature";v.removeHandles(y);const{highlightEnabled:g,view:_,activeFeature:M,visible:b}=v;if(!(M&&_&&g&&b))return;const A=v._getHighlightLayer(M);if(!(A&&A instanceof ss.A&&v._mapIncludesLayer(A)))return;const E=v._getLayerView(_,A);v._highlightActiveFeaturePromise=E;const x=yield E;if(!(x&&ps(x)&&v._highlightActiveFeaturePromise===E&&v.activeFeature&&v.highlightEnabled))return;const R=x.highlight(v._getHighlightTarget(M,A,_.type));v.addHandles(R,y)})()}_highlightSelectedFeature(){var v=this;return(0,V.A)(function*(){const y="highlight-selected-feature";v.removeHandles(y);const{selectedFeature:g,highlightEnabled:_,view:M,visible:b}=v;if(!(g&&M&&_&&b))return;const A=v._getHighlightLayer(g);if(!(A&&A instanceof ss.A&&v._mapIncludesLayer(A)))return;const E=v._getLayerView(M,A);v._highlightSelectedFeaturePromise=E;const x=yield E;if(!(x&&ps(x)&&v._highlightSelectedFeaturePromise===E&&v.selectedFeature&&v.highlightEnabled&&v.visible))return;const R=x.highlight(v._getHighlightTarget(g,A,M.type));v.addHandles(R,y)})()}_updateFeatures(v){const{features:y}=this,g=v.filter(_=>!y.includes(_));null!=g&&g.length&&(this.features=y.concat(g))}};(0,F._)([(0,I.MZ)()],$e.prototype,"_fetchFeaturesController",void 0),(0,F._)([(0,I.MZ)({type:ni})],$e.prototype,"actions",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"active",null),(0,F._)([(0,I.MZ)()],$e.prototype,"activeFeature",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"allActions",null),(0,F._)([(0,I.MZ)()],$e.prototype,"autoCloseEnabled",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"autoOpenEnabled",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"browseClusterEnabled",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"content",void 0),(0,F._)([(0,I.MZ)({type:ni,readOnly:!0})],$e.prototype,"defaultActions",null),(0,F._)([(0,I.MZ)({type:Boolean})],$e.prototype,"defaultPopupTemplateEnabled",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"featureCount",null),(0,F._)([(0,I.MZ)()],$e.prototype,"featurePage",void 0),(0,F._)([(0,I.MZ)({value:[]})],$e.prototype,"features",null),(0,F._)([(0,I.MZ)()],$e.prototype,"featuresPerPage",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"featureMenuOpen",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"featureViewModelAbilities",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"featureViewModels",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"highlightEnabled",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"includeDefaultActions",void 0),(0,F._)([(0,I.MZ)({type:yn.A})],$e.prototype,"location",null),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"pendingPromisesCount",null),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"promiseCount",null),(0,F._)([(0,I.MZ)()],$e.prototype,"promises",null),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"selectedClusterBoundaryFeature",void 0),(0,F._)([(0,I.MZ)({value:null,readOnly:!0})],$e.prototype,"selectedFeature",null),(0,F._)([(0,I.MZ)({value:-1})],$e.prototype,"selectedFeatureIndex",null),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"selectedFeatureViewModel",null),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"state",null),(0,F._)([(0,I.MZ)()],$e.prototype,"title",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"updateLocationEnabled",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"view",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"visible",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"waitingForContents",null),(0,F._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"waitingForResult",null),(0,F._)([(0,I.MZ)()],$e.prototype,"zoomFactor",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"zoomToLocation",void 0),(0,F._)([(0,I.MZ)()],$e.prototype,"centerAtLocation",null),$e=(0,F._)([(0,ce.$)("esri.widgets.Features.FeaturesViewModel")],$e);const Qn=$e;let St=class extends $t.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"actionBar",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"closeButton",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"collapseButton",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"featureNavigation",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"flow",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"heading",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"spinner",void 0),St=(0,F._)([(0,ce.$)("esri.widgets.Features.FeaturesVisibleElements")],St);const fs=St;function ys(v){return y=>{y.hasOwnProperty("_delegatedEventNames")||(y._delegatedEventNames=y._delegatedEventNames?y._delegatedEventNames.slice():[]);const g=y._delegatedEventNames,_=Array.isArray(v)?v:function Jl(v){return v.split(",").map(y=>y.trim())}(v);g.push(..._)}}const gs="selected-index",_s="features-spinner";let Qe=class extends(es(he.A)){constructor(v,y){var g;super(v,y),g=this,this._featureMenuIntersectionObserverCallback=([_])=>{null!=_&&_.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new z.A,this._relatedRecordsWidget=new Il({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.icon=null,this.featureNavigationTop=!1,this.headerActions=new ni,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Qn,this.visibleElements=new fs,this._renderAction=(_,M)=>{const b=this._getActionTitle(_),{type:A,active:E,uid:x,disabled:R,indicator:Z}=_;return _.visible?(0,Q.K)("calcite-action",{active:"toggle"===A&&_.value,appearance:"solid",bind:this,"data-action-uid":x,disabled:R,icon:this._getActionIcon(_),indicator:Z,key:`action-${M}`,loading:E,onclick:this._triggerAction,scale:"s",text:b,title:this._hideActionText?b:void 0},this._getFallbackIcon(_)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=_=>{this._focusOn===_&&requestAnimationFrame((0,V.A)(function*(){var M,b;switch(_){case"menu-flow-item":yield null===(M=g._featureMenuViewportNode)||void 0===M?void 0:M.setFocus();break;case"root-flow-item":yield null===(b=g._rootFlowItemNode)||void 0===b?void 0:b.setFocus()}g._focusOn=null}))},this._focusFlowItemNodeThrottled=q(this._focusFlowItemNode,50),this._displaySpinnerThrottled=q(()=>this._displaySpinner(),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,S.wB)(()=>{var _;return null===(_=this.viewModel)||void 0===_?void 0:_.active},()=>this._toggleScreenLocationEnabled()),(0,S.wB)(()=>{var _;return null===(_=this.viewModel)||void 0===_?void 0:_.active},_=>this._relatedRecordsWidget.closed=!_),(0,S.wB)(()=>{var _;return null===(_=this.visibleElements)||void 0===_?void 0:_.closeButton},_=>this._relatedRecordsWidget.closable=_),(0,S.wB)(()=>{var _;return null===(_=this.visibleElements)||void 0===_?void 0:_.spinner},_=>this._spinnerEnabledChange(_)),(0,S.wB)(()=>{var _;return null===(_=this.viewModel)||void 0===_?void 0:_.view},(_,M)=>this._viewChange(_,M)),(0,S.wB)(()=>{var _;return null===(_=this.viewModel)||void 0===_||null===(_=_.view)||void 0===_?void 0:_.ready},(_,M)=>this._viewReadyChange(null!=_&&_,null!=M&&M)),(0,S.wB)(()=>{var _,M;return[null===(_=this.viewModel)||void 0===_?void 0:_.waitingForResult,null===(M=this.viewModel)||void 0===M?void 0:M.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,S.wB)(()=>{var _;return null===(_=this.viewModel)||void 0===_?void 0:_.screenLocation},()=>this._closeOpenActionMenu()),(0,S.wB)(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),(0,S.wB)(()=>{var _;const M=null===(_=this.selectedFeatureWidget)||void 0===_?void 0:_.viewModel;return[null==M?void 0:M.title,null==M?void 0:M.state]},()=>this._setTitleFromFeatureWidget()),(0,S.wB)(()=>{var _;const M=null===(_=this.selectedFeatureWidget)||void 0===_?void 0:_.viewModel;return[null==M?void 0:M.content,null==M?void 0:M.state]},()=>this._setContentFromFeatureWidget()),(0,S.wB)(()=>{var _;return null===(_=this.viewModel)||void 0===_?void 0:_.featureViewModels},()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:_})=>this._openRelatedFeature(_))])}loadDependencies(){return(0,ai.W)({action:()=>Promise.all([w.e(2597),w.e(4668),w.e(8843),w.e(4201)]).then(w.bind(w,14201)),"action-bar":()=>Promise.all([w.e(2597),w.e(4668),w.e(8843),w.e(9560),w.e(5564),w.e(2076),w.e(9511)]).then(w.bind(w,79511)),"action-group":()=>Promise.all([w.e(2597),w.e(4668),w.e(8843),w.e(9560),w.e(5564),w.e(2076),w.e(1887)]).then(w.bind(w,41887)),button:()=>Promise.all([w.e(2597),w.e(4668),w.e(4319),w.e(6615)]).then(w.bind(w,6615)),flow:()=>w.e(6195).then(w.bind(w,66195)),"flow-item":()=>Promise.all([w.e(2597),w.e(4668),w.e(8843),w.e(9560),w.e(5564),w.e(2076),w.e(8851)]).then(w.bind(w,18851)),list:()=>Promise.all([w.e(2597),w.e(4668),w.e(4319),w.e(4827),w.e(2076),w.e(861)]).then(w.bind(w,861)),"list-item":()=>Promise.all([w.e(2597),w.e(4668),w.e(8843),w.e(2076),w.e(4835)]).then(w.bind(w,4835)),"list-item-group":()=>Promise.all([w.e(2076),w.e(7277)]).then(w.bind(w,17277)),loader:()=>w.e(2748).then(w.bind(w,2748))})}destroy(){var v,y;this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),null!==(v=this._featureMenuIntersectionObserver)&&void 0!==v&&v.disconnect(),null===(y=this._relatedRecordsWidget)||void 0===y||y.destroy()}get _hideActionText(){var v;if(!this.responsiveActionsEnabled)return!1;const y=null===(v=this.view)||void 0===v?void 0:v.widthBreakpoint;return"xsmall"===y||"small"===y||"medium"===y}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get content(){return this.viewModel.content}set content(v){this.viewModel.content=v}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(v){this.viewModel.featureMenuOpen=v}get features(){return this.viewModel.features}set features(v){this.viewModel.features=v}get location(){return this.viewModel.location}set location(v){this.viewModel.location=v}get label(){var v,y;return null!==(v=null===(y=this.messages)||void 0===y?void 0:y.widgetLabel)&&void 0!==v?v:""}set label(v){this._overrideIfSome("label",v)}get promises(){return this.viewModel.promises}set promises(v){this.viewModel.promises=v}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(v){this.viewModel.selectedFeatureIndex=v}get selectedFeatureWidget(){const{_feature:v,headingLevel:y,_relatedRecordsFlowItems:g}=this,{selectedFeatureViewModel:_}=this.viewModel,M={title:!1};return _?(v?(v.viewModel=_,v.visibleElements=M):this._feature=new bl({flowItems:g,headingLevel:y+1,viewModel:_,visibleElements:M}),this._feature):null}get title(){return this.viewModel.title}set title(v){this.viewModel.title=v}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(v){this.viewModel.updateLocationEnabled=v}get view(){return this.viewModel.view}set view(v){this.viewModel.view=v}get visible(){return this.viewModel.visible}set visible(v){this.viewModel.visible=v}blur(){var v;const{active:y}=this.viewModel;y?null===(v=this._rootFlowItemNode)||void 0===v||v.blur():ie.A.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(v,y){return this.viewModel.fetchFeatures(v,y)}focus(){const{active:v}=this.viewModel;v?this._setFocusOn():ie.A.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(v){var y;this.removeHandles(gs);const g={collapsed:null!==(y=null==v?void 0:v.collapsed)&&void 0!==y&&y};this.set(g),this.viewModel.open(v),this.addHandles((0,S.z7)(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(v){return this.viewModel.triggerAction(v)}render(){return(0,Q.K)("div",{bind:this,class:this.classes(mt.base,Pe.D.widget,Pe.D.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,Q.K)("div",{class:mt.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,Q.K)("div",{class:mt.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:v,viewModel:y}=this,{featureCount:g,selectedFeatureIndex:_,pendingPromisesCount:M}=y;return(0,Q.K)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:v.selectFeature,loading:M>0,onclick:this._openFeatureMenu,scale:"s",text:(0,$.V)(v.pageText,{index:(0,Se.ZV)(_+1),total:(0,Se.ZV)(g)}),textEnabled:!0,title:v.selectFeature})}_renderPagination(){const{previous:v,next:y}=this.messagesCommon.pagination;return(0,Q.K)("calcite-action-bar",{class:mt.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,Q.K)("calcite-action-group",{scale:"s"},(0,Q.K)("calcite-action",{appearance:"solid",class:mt.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:v,onclick:this._previousFeature,scale:"s",text:v,title:v}),(0,Q.K)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:y,onclick:this._nextFeature,scale:"s",text:y,title:y})))}_renderFeatureMenuItem(v){const{selectedFeatureViewModel:y,featureViewModels:g}=this.viewModel,_=v===y,M=g.indexOf(v);return(0,Q.K)("calcite-list-item",{bind:this,"data-feature-index":M,key:`feature-menu-item-${v.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:_,onCalciteListItemSelect:this._selectFeature},(0,Q.K)("span",{innerHTML:v.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:v}=this.viewModel,y=new Map;return v.forEach(g=>{var _,M;const b=null==g?void 0:g.graphic;if(!b)return;const A=null!==(_=b.sourceLayer)&&void 0!==_?_:b.layer,E=null!==(M=y.get(A))&&void 0!==M?M:[];y.set(A,[...E,g])}),y}_renderFeatureMenu(){const{featureViewModels:v}=this.viewModel,y=this._groupResultsByLayer();return v.length?(0,Q.K)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(y.keys()).map(g=>{var _,M;return(0,Q.K)("calcite-list-item-group",{heading:null!==(_=null==g?void 0:g.title)&&void 0!==_?_:this.messagesCommon.untitled,key:(null==g?void 0:g.uid)||"untitled"},null===(M=y.get(g))||void 0===M?void 0:M.map(b=>this._renderFeatureMenuItem(b)))})):null}_renderHeaderAction(v,y){return v.visible?(0,Q.K)("calcite-action",{active:"toggle"===v.type&&v.value,appearance:"solid",bind:this,"data-action-uid":v.uid,disabled:v.disabled,icon:v.icon||"",indicator:v.indicator,key:`header-action-${y}`,loading:v.active,onclick:this._triggerHeaderAction,scale:"m",slot:"header-actions-end",text:v.title||"",title:v.title||""}):null}_renderHeaderActions(){return this.headerActions.map((v,y)=>this._renderHeaderAction(v,y)).toArray()}_renderContentFeature(){const{headingLevel:v,visibleElements:y,_isCollapsed:g,_collapseEnabled:_,featureNavigationTop:M}=this,{title:b,active:A}=this.viewModel,E=y.heading&&b?b:"";return(0,Q.K)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[mt.contentFeature]:!0,[mt.flowItemCollapsed]:g}),closable:y.closeButton,closed:!A,collapsed:g,collapseDirection:M?"down":"up",collapsible:_,headingLevel:v,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},E?(0,Q.K)(ln,{class:this.classes(mt.featuresHeading,Pe.D.heading),innerHTML:E,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),g?null:(0,Q.K)("div",{class:this.classes(mt.container,mt.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:v,featureMenuOpen:y,messages:g,messagesCommon:_}=this,{active:M,featureViewModels:b,pendingPromisesCount:A}=v;return y?(0,Q.K)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!M,description:(0,$.V)(g.total,{total:b.length}),heading:g.selectFeature,key:"feature-menu",loading:v.waitingForContents,onCalciteFlowItemBack:E=>{E.preventDefault(),this._handleFeatureMenuBack()}},A>0?(0,Q.K)("calcite-loader",{class:mt.loader,inline:!0,key:"feature-menu-loader",label:_.loading,scale:"m",slot:"header-actions-end"}):null,(0,Q.K)("div",{class:mt.container},this._renderFeatureMenu()),(0,Q.K)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:mt.featureMenuObserver}),(0,Q.K)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},_.back)):null}_renderContentContainer(){const v=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?(0,Q.K)("calcite-flow",{key:"content-container"},v):v}_getFallbackIcon(v){const{className:y,icon:g}=v;if(g)return null;const _=function ue({action:v,feature:y}){const g=null==y?void 0:y.attributes,_="image"in v?v.image:void 0;return _&&g?(0,$.V)(_,g):null!=_?_:""}({action:v,feature:this.selectedFeature}),M={[mt.icon]:!!y,[mt.actionImage]:!!_};return y&&(M[y]=!0),_||y?(0,Q.K)("span",{"aria-hidden":"true",class:this.classes(mt.icon,M),key:"icon",styles:le(_)}):null}_renderActionBar(){var v;return!this._isCollapsed&&this.visibleElements.actionBar&&null!==(v=this.viewModel.allActions)&&void 0!==v&&v.length?(0,Q.K)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,Q.K)("calcite-action-group",{afterCreate:y=>this._actionBarMenuNode=y,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var v;const y=null===(v=this.viewModel)||void 0===v?void 0:v.content;return y?"string"==typeof y?(0,Q.K)("div",{class:nt.contentNode,innerHTML:y,key:y}):this.renderNodeContent(y):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(v){var y=this;return(0,V.A)(function*(){yield v.viewModel.updateGeometry();const g=v.graphic,_=null==g?void 0:g.geometry;if(null==_||null==g)return;y._destroyRelatedRecordsFlowItemWidgets(),yield y.viewModel.zoomTo({target:_});const M=N(_);y.open({features:[g],location:null!=M?M:void 0})})()}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(v){this._rootFlowItemNode=v,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(v){this._featureMenuViewportNode=v,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(v){var y;const{viewModel:g}=this;g.activeFeature=(null===(y=g.features)||void 0===y?void 0:y[v.currentTarget["data-feature-index"]])||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(v){const y=v.currentTarget["data-feature-index"];isNaN(y)||(this.viewModel.selectedFeatureIndex=y),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(v){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(v),this._featureMenuIntersectionObserverNode=v}_getActionIcon(v){return v.icon?v.icon:v.image||v.className?void 0:"question"}_getActionTitle(v){var y;const{messages:g,selectedFeature:_,messagesCommon:M}=this,{id:b}=v,A=null==_?void 0:_.attributes,E=null!==(y=v.title)&&void 0!==y?y:"",x="zoom-to-feature"===b?(0,$.V)(E,{messages:g}):"remove-selected-feature"===b?(0,$.V)(E,{messages:M}):"zoom-to-clustered-features"===b||"browse-clustered-features"===b?(0,$.V)(E,{messages:g}):v.title;return x&&A?(0,$.V)(x,A):null!=x?x:""}_onMainKeydown(v){const{key:y}=v;"ArrowLeft"===y&&(v.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===y&&(v.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:v}=this;v&&(this.viewModel.content=v)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:v,messagesCommon:y}=this,g=null==v?void 0:v.viewModel;v&&(this.viewModel.title="error"===(null==g?void 0:g.state)?null==y?void 0:y.errorMessage:(null==g?void 0:g.title)||"")}_addSelectedFeatureIndexHandle(){const v=(0,S.wB)(()=>{var y;return null===(y=this.viewModel)||void 0===y?void 0:y.selectedFeatureIndex},(y,g)=>this._selectedFeatureIndexUpdated(y,g));this.addHandles(v,gs)}_selectedFeatureIndexUpdated(v,y){const{featureCount:g}=this.viewModel;g&&v!==y&&-1!==v&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(v){const y=v.currentTarget;if(y.disabled)return;const g=y.dataset.actionUid,_=this.headerActions.find(({uid:M})=>M===g);_&&!_.disabled&&("toggle"===(null==_?void 0:_.type)&&(_.value=!_.value),this.emit("trigger-header-action",{action:_}))}_triggerAction(v){const y=v.currentTarget;if(y.disabled)return;const g=y.dataset.actionUid,{allActions:_}=this.viewModel,M=_.findIndex(A=>A.uid===g),b=_.at(M);b&&"toggle"===b.type&&(b.value=!b.value),this.viewModel.triggerAction(M)}_createSpinner(v){v&&(this._spinner=new Fl({view:v}),v.ui.add(this._spinner,{key:_s,position:"manual",internal:!0}))}_wireUpView(v){var y;this._destroySpinner(),v&&null!==(y=this.visibleElements)&&void 0!==y&&y.spinner&&this._createSpinner(v)}_hideSpinner(){const{_spinner:v}=this;v&&(v.location=null,v.hide())}_viewReadyChange(v,y){var g;v?this._wireUpView(null===(g=this.viewModel)||void 0===g?void 0:g.view):y&&this.viewModel.clear()}_viewChange(v,y){v&&y&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:v}=this;v&&(v.viewModel=null,!v.destroyed&&v.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:v}=this;v&&(v.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.removeAll().forEach(v=>{"showAllEnabled"in v.viewModel&&(v.viewModel.showAllEnabled=!1),v.viewModel=null,v.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:v}=this;v&&(v.screenLocationEnabled=v.active)}_displaySpinner(){const{_spinner:v}=this;if(!v)return;const{location:y,waitingForResult:g}=this.viewModel;g&&y?v.show({location:y}):v.hide()}_destroySpinner(){var v;const{_spinner:y,view:g}=this;y&&(null!=g&&null!==(v=g.ui)&&void 0!==v&&v.remove(y,_s),y.destroy(),this._spinner=null)}_spinnerEnabledChange(v){var y;this._destroySpinner(),v&&this._createSpinner(null===(y=this.viewModel)||void 0===y?void 0:y.view)}};(0,F._)([(0,I.MZ)()],Qe.prototype,"_focusOn",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"_relatedRecordsFlowItems",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"_hideActionText",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"_featureNavigationVisible",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"_isCollapsed",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"_collapseEnabled",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"collapsed",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"content",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"icon",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"featureMenuOpen",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"featureNavigationTop",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"features",null),(0,F._)([(0,I.MZ)({type:ni})],Qe.prototype,"headerActions",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"headingLevel",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"location",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"label",null),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/Features/t9n/Features")],Qe.prototype,"messages",void 0),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/t9n/common")],Qe.prototype,"messagesCommon",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"promises",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"responsiveActionsEnabled",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],Qe.prototype,"selectedFeature",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"selectedFeatureIndex",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Qe.prototype,"selectedFeatureWidget",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"title",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"updateLocationEnabled",null),(0,F._)([(0,I.MZ)()],Qe.prototype,"view",null),(0,F._)([(0,I.MZ)({type:Qn}),ys(["triggerAction","trigger-action"])],Qe.prototype,"viewModel",void 0),(0,F._)([(0,I.MZ)({type:fs,nonNullable:!0})],Qe.prototype,"visibleElements",void 0),(0,F._)([(0,I.MZ)()],Qe.prototype,"visible",null),Qe=(0,F._)([(0,ce.$)("esri.widgets.Features")],Qe);const ea=Qe,Lt="esri-popup",ri=`${Lt}--is-docked`,dt={base:Lt,main:`${Lt}__main-container`,shadow:`${Lt}--shadow`,isDocked:ri,isDockedTopLeft:`${ri}-top-left`,isDockedTopCenter:`${ri}-top-center`,isDockedTopRight:`${ri}-top-right`,isDockedBottomLeft:`${ri}-bottom-left`,isDockedBottomCenter:`${ri}-bottom-center`,isDockedBottomRight:`${ri}-bottom-right`,alignTopCenter:`${Lt}--aligned-top-center`,alignBottomCenter:`${Lt}--aligned-bottom-center`,alignTopLeft:`${Lt}--aligned-top-left`,alignBottomLeft:`${Lt}--aligned-bottom-left`,alignTopRight:`${Lt}--aligned-top-right`,alignBottomRight:`${Lt}--aligned-bottom-right`,pointer:`${Lt}__pointer`,pointerDirection:`${Lt}__pointer-direction`};let Yn=class extends Qn{constructor(v){super(v)}};Yn=(0,F._)([(0,ce.$)("esri.widgets.Popup.PopupViewModel")],Yn);const Ms=Yn;let Nt=class extends $t.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.heading=!0,this.spinner=!0}};(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Nt.prototype,"actionBar",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Nt.prototype,"closeButton",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Nt.prototype,"collapseButton",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Nt.prototype,"featureNavigation",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Nt.prototype,"heading",void 0),(0,F._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Nt.prototype,"spinner",void 0),Nt=(0,F._)([(0,ce.$)("esri.widgets.Features.PopupVisibleElements")],Nt);const Jn=Nt,bs={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let Ke=class extends he.A{constructor(v,y){super(v,y),this._dockAction=new J.A({id:"popup-dock-action"}),this._featuresWidget=new ea({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.collapsed=!1,this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new Ms,this.visibleElements=new Jn}initialize(){this.addHandles([(0,S.wB)(()=>{var v;return[null===(v=this.viewModel)||void 0===v||null===(v=v.view)||void 0===v?void 0:v.widthBreakpoint,this.dockEnabled]},()=>this._handleDockIcon(),S.Vh),(0,S.wB)(()=>{var v,y;return[this.dockEnabled,null===(v=this.messages)||void 0===v?void 0:v.undock,null===(y=this.messages)||void 0===y?void 0:y.dock]},()=>this._handleDockEnabled(),S.Vh),(0,S.wB)(()=>this.dockOptions,v=>{const{_dockAction:y}=this,g=this._featuresWidget.headerActions;g.remove(y),v.buttonEnabled&&g.add(y)},S.Vh),(0,S.wB)(()=>{var v;return null===(v=this.viewModel)||void 0===v?void 0:v.screenLocation},()=>this._positionContainer()),(0,S.wB)(()=>{var v;return[null===(v=this.viewModel)||void 0===v?void 0:v.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),(0,S.wB)(()=>{var v,y,g,_,M;return[null===(v=this.viewModel)||void 0===v?void 0:v.screenLocation,null===(y=this.viewModel)||void 0===y||null===(y=y.view)||void 0===y?void 0:y.padding,null===(g=this.viewModel)||void 0===g||null===(g=g.view)||void 0===g?void 0:g.size,null===(_=this.viewModel)||void 0===_?void 0:_.active,null===(M=this.viewModel)||void 0===M?void 0:M.location,this.alignment]},()=>this.reposition()),(0,S.wB)(()=>{var v;return null===(v=this.viewModel)||void 0===v||null===(v=v.view)||void 0===v?void 0:v.size},(v,y)=>this._updateDockEnabledForViewSize(v,y)),(0,S.wB)(()=>{var v;return null===(v=this.viewModel)||void 0===v?void 0:v.view},(v,y)=>this._viewChange(v,y)),(0,S.wB)(()=>{var v;return null===(v=this.viewModel)||void 0===v||null===(v=v.view)||void 0===v?void 0:v.ready},(v,y)=>this._viewReadyChange(null!=v&&v,null!=y&&y)),(0,S.wB)(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,S.Vh),(0,S.wB)(()=>this._featureNavigationTop,v=>this._featuresWidget.featureNavigationTop=v,S.Vh),(0,S.wB)(()=>this.headingLevel,v=>this._featuresWidget.headingLevel=v,S.Vh),(0,S.wB)(()=>this.collapsed,v=>this._featuresWidget.collapsed=v,S.Vh),(0,S.wB)(()=>this.visibleElements.actionBar,v=>this._featuresWidget.visibleElements.actionBar=!!v,S.Vh),(0,S.wB)(()=>this.visibleElements.closeButton,v=>this._featuresWidget.visibleElements.closeButton=!!v,S.Vh),(0,S.wB)(()=>this.visibleElements.collapseButton,v=>this._featuresWidget.visibleElements.collapseButton=!!v,S.Vh),(0,S.wB)(()=>this.visibleElements.heading,v=>this._featuresWidget.visibleElements.heading=!!v,S.Vh),(0,S.wB)(()=>this.visibleElements.spinner,v=>this._featuresWidget.visibleElements.spinner=!!v,S.Vh),(0,S.wB)(()=>this.visibleElements.featureNavigation,v=>this._featuresWidget.visibleElements.featureNavigation=!!v,S.Vh),(0,S.on)(()=>this._featuresWidget,"trigger-header-action",v=>{v.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(v){const y={...v};return null!=(null==v?void 0:v.visibleElements)&&(y.visibleElements=new Jn(v.visibleElements),null!=v.collapseEnabled&&(y.visibleElements.collapseButton=v.collapseEnabled),null!=v.spinnerEnabled&&(y.visibleElements.spinner=v.spinnerEnabled)),y}destroy(){var v;this._dockAction.destroy(),null===(v=this._featuresWidget)||void 0===v||v.destroy()}get _featureNavigationTop(){const{currentAlignment:v,currentDockPosition:y}=this;return"bottom-left"===v||"bottom-center"===v||"bottom-right"===v||"top-left"===y||"top-center"===y||"top-right"===y}get actions(){return this.viewModel.actions}set actions(v){this.viewModel.actions=v}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(v){this.viewModel.autoCloseEnabled=v}get autoOpenEnabled(){return(0,G.Lx)(ie.A.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(v){(0,G.Lx)(ie.A.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=v}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(v){this.viewModel.defaultPopupTemplateEnabled=v}get content(){return this.viewModel.content}set content(v){this.viewModel.content=v}get collapseEnabled(){return(0,G.Lx)(ie.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(v){(0,G.Lx)(ie.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=v}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||bs}set dockOptions(v){var y;const g={...bs},_=null===(y=this.viewModel)||void 0===y||null===(y=y.view)||void 0===y?void 0:y.breakpoints,M={};_&&(M.width=_.xsmall,M.height=_.xsmall);const b={...g,...v},A={...g.breakpoint,...M},{breakpoint:E}=b;"object"==typeof E?b.breakpoint={...A,...E}:E&&(b.breakpoint=A),this._set("dockOptions",b),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(v){this.viewModel.featureMenuOpen=v}get features(){return this.viewModel.features}set features(v){this.viewModel.features=v}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(v){this.viewModel.goToOverride=v}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(v){this.viewModel.highlightEnabled=v}get location(){return this.viewModel.location}set location(v){this.viewModel.location=v}get label(){var v,y;return null!==(v=null===(y=this.messages)||void 0===y?void 0:y.widgetLabel)&&void 0!==v?v:""}set label(v){this._overrideIfSome("label",v)}get promises(){return this.viewModel.promises}set promises(v){this.viewModel.promises=v}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(v){this.viewModel.selectedFeatureIndex=v}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return(0,G.Lx)(ie.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(v){(0,G.Lx)(ie.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=v}get title(){return this.viewModel.title}set title(v){this.viewModel.title=v}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(v){this.viewModel.updateLocationEnabled=v}get view(){return this.viewModel.view}set view(v){this.viewModel.view=v}get visible(){return this.viewModel.visible}set visible(v){this.viewModel.visible=v}blur(){const{active:v}=this.viewModel;v||ie.A.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(v,y){return this.viewModel.fetchFeatures(v,y)}focus(){const{active:v}=this.viewModel;v||ie.A.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(v){this.set({collapsed:!!v&&!!v.collapsed,featureMenuOpen:!!v&&!!v.featureMenuOpen}),this.viewModel.open(v),this._shouldFocus(v)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(v){return this.viewModel.triggerAction(v)}render(){var v,y;const{dockEnabled:g,currentAlignment:_,currentDockPosition:M}=this,{active:b}=this.viewModel,x=null===(v=this.selectedFeature)||void 0===v||null===(v=v.layer)||void 0===v?void 0:v.title,R=null===(y=this.selectedFeature)||void 0===y||null===(y=y.layer)||void 0===y?void 0:y.id;return(0,Q.K)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(dt.base,{[dt.alignTopCenter]:"top-center"===_,[dt.alignBottomCenter]:"bottom-center"===_,[dt.alignTopLeft]:"top-left"===_,[dt.alignBottomLeft]:"bottom-left"===_,[dt.alignTopRight]:"top-right"===_,[dt.alignBottomRight]:"bottom-right"===_,[dt.isDocked]:b&&g,[dt.shadow]:b&&!g,[dt.isDockedTopLeft]:"top-left"===M,[dt.isDockedTopCenter]:"top-center"===M,[dt.isDockedTopRight]:"top-right"===M,[dt.isDockedBottomLeft]:"bottom-left"===M,[dt.isDockedBottomCenter]:"bottom-center"===M,[dt.isDockedBottomRight]:"bottom-right"===M}),"data-layer-id":R,"data-layer-title":x,role:"presentation"},b?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,Q.K)("div",{class:dt.pointer,key:"popup-pointer",role:"presentation"},(0,Q.K)("div",{class:this.classes(dt.pointerDirection,dt.shadow)}))}_renderMainContainer(){const{dockEnabled:v}=this;return(0,Q.K)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(dt.main,Pe.D.widget,{[dt.shadow]:v})},this._featuresWidget.render())}_shouldFocus(v){var y=this;return(0,V.A)(function*(){null!=v&&v.shouldFocus&&(yield(0,S.C_)(()=>{var g;return!0===(null===(g=y.viewModel)||void 0===g?void 0:g.active)}),y.focus())})()}_isOutsideView(v){const{popupHeight:y,popupWidth:g,screenLocation:_,side:M,view:b}=v;if(isNaN(g)||isNaN(y)||!b||!_)return!1;const A=b.padding;return"right"===M&&_.x+g/2>b.width-A.right||"left"===M&&_.x-g/2<A.left||"top"===M&&_.y-y<A.top||"bottom"===M&&_.y+y>b.height-A.bottom}_calculateAutoAlignment(v){if("auto"!==v)return v;const{_pointerOffsetInPx:y,_containerNode:g,_mainContainerNode:_,viewModel:M}=this,{screenLocation:b,view:A}=M;if(null==b||!A||!g)return"top-center";function E(Ee){return parseInt(Ee.replaceAll(/[^-\d\.]/g,""),10)}const x=_?window.getComputedStyle(_,null):null,R=x?E(x.getPropertyValue("max-height")):0,Z=x?E(x.getPropertyValue("height")):0,{height:K,width:H}=g.getBoundingClientRect(),ae=H+y,me=Math.max(K,R,Z)+y,ve=this._isOutsideView({popupHeight:me,popupWidth:ae,screenLocation:b,side:"right",view:A}),ye=this._isOutsideView({popupHeight:me,popupWidth:ae,screenLocation:b,side:"left",view:A}),_e=this._isOutsideView({popupHeight:me,popupWidth:ae,screenLocation:b,side:"top",view:A}),be=this._isOutsideView({popupHeight:me,popupWidth:ae,screenLocation:b,side:"bottom",view:A});return ye?_e?"bottom-right":"top-right":ve?_e?"bottom-left":"top-left":_e?be?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(v){return"function"==typeof v?v.call(this):v}_getCurrentAlignment(){const{alignment:v,dockEnabled:y}=this;return y||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(v)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(v){const y=["left","right"];return(0,xt.V8)(this.container)&&y.reverse(),null==v?void 0:v.replace(/leading/gi,y[0]).replaceAll(/trailing/gi,y[1])}_callDockPosition(v){return"function"==typeof v?v.call(this):v}_getDockPosition(){var v;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null===(v=this.dockOptions)||void 0===v?void 0:v.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(v){var y;if("auto"!==v)return v;const g=null===(y=this.viewModel)||void 0===y?void 0:y.view,_=(0,xt.V8)(this.container)?"top-left":"top-right";if(!g)return _;const M=g.padding||{left:0,right:0,top:0,bottom:0},b=g.width-M.left-M.right,{breakpoints:A}=g;return A&&b<=A.xsmall?"bottom-center":_}_getDockIcon(){const v=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(v){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var v,y;this._dockAction.title=this.dockEnabled?null===(v=this.messages)||void 0===v?void 0:v.undock:null===(y=this.messages)||void 0===y?void 0:y.dock}_setMainContainerNode(v){this._mainContainerNode=v}_positionContainer(v=this._containerNode){if(v&&(this._containerNode=v),!this._containerNode)return;const{screenLocation:y}=this.viewModel,{width:g}=this._containerNode.getBoundingClientRect(),_=this._calculatePositionStyle(y,g);_&&Object.assign(this._containerNode.style,_)}_calculateFullWidth(v){const{currentAlignment:y,_pointerOffsetInPx:g}=this;return"top-left"===y||"bottom-left"===y||"top-right"===y||"bottom-right"===y?v+g:v}_calculateAlignmentPosition(v,y,g,_){const{currentAlignment:M,_pointerOffsetInPx:b}=this;if(!g)return;const{padding:A}=g,E=_/2,x=g.height-y,R=g.width-v;return"bottom-center"===M?{top:y+b-A.top,left:v-E-A.left}:"top-left"===M?{bottom:x+b-A.bottom,right:R+b-A.right}:"bottom-left"===M?{top:y+b-A.top,right:R+b-A.right}:"top-right"===M?{bottom:x+b-A.bottom,left:v+b-A.left}:"bottom-right"===M?{top:y+b-A.top,left:v+b-A.left}:"top-center"===M?{bottom:x+b-A.bottom,left:v-E-A.left}:void 0}_calculatePositionStyle(v,y){const{dockEnabled:g,view:_}=this;if(!_)return;if(g)return{left:"",top:"",right:"",bottom:""};if(null==v||!y)return;const M=this._calculateFullWidth(y),b=this._calculateAlignmentPosition(v.x,v.y,_,M);return b?{top:void 0!==b.top?`${b.top}px`:"auto",left:void 0!==b.left?`${b.left}px`:"auto",bottom:void 0!==b.bottom?`${b.bottom}px`:"auto",right:void 0!==b.right?`${b.right}px`:"auto"}:void 0}_viewChange(v,y){v&&y&&(this.close(),this.clear())}_viewReadyChange(v,y){v?this._wireUpView():y&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(v,y,g){const[_,M]=v,[b,A]=y,{width:E=0,height:x=0}=null!=g?g:{};return _<=E&&b>E||_>E&&b<=E||M<=x&&A>x||M>x&&A<=x}_updateDockEnabledForViewSize(v,y){var g;if(!v||!y)return;const _=(null===(g=this.viewModel)||void 0===g||null===(g=g.view)||void 0===g?void 0:g.padding)||{left:0,right:0,top:0,bottom:0},M=_.left+_.right,b=_.top+_.bottom,A=[],E=[];A[0]=v[0]-M,A[1]=v[1]-b,E[0]=y[0]-M,E[1]=y[1]-b;const{dockOptions:x}=this;this._dockingThresholdCrossed(A,E,x.breakpoint)&&this._setDockEnabledForViewSize(x),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:v,viewModel:y}=this;y&&(y.screenLocationEnabled=y.active&&!v)}_shouldDockAtCurrentViewSize(v){var y,g,_;const M=v.breakpoint,b=null===(y=this.viewModel)||void 0===y||null===(y=y.view)||void 0===y?void 0:y.ui;if(!b)return!1;const{width:A,height:E}=b;if(isNaN(A)||isNaN(E)||!M)return!1;const x=M.hasOwnProperty("width")&&A<=(null!==(g=M.width)&&void 0!==g?g:0),R=M.hasOwnProperty("height")&&E<=(null!==(_=M.height)&&void 0!==_?_:0);return x||R}_setDockEnabledForViewSize(v){v.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(v))}};(0,F._)([(0,I.MZ)({readOnly:!0})],Ke.prototype,"_featureNavigationTop",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"actions",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"alignment",void 0),(0,F._)([(0,I.MZ)()],Ke.prototype,"autoCloseEnabled",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"autoOpenEnabled",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"defaultPopupTemplateEnabled",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"content",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"collapsed",void 0),(0,F._)([(0,I.MZ)()],Ke.prototype,"collapseEnabled",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ke.prototype,"currentAlignment",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ke.prototype,"currentDockPosition",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"dockOptions",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"dockEnabled",void 0),(0,F._)([(0,I.MZ)({readOnly:!0})],Ke.prototype,"featureCount",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"featureMenuOpen",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"features",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"goToOverride",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"headingLevel",void 0),(0,F._)([(0,I.MZ)()],Ke.prototype,"highlightEnabled",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"location",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"label",null),(0,F._)([(0,I.MZ)(),(0,Ft.G)("esri/widgets/Popup/t9n/Popup")],Ke.prototype,"messages",void 0),(0,F._)([(0,I.MZ)()],Ke.prototype,"promises",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ke.prototype,"selectedFeature",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"selectedFeatureIndex",null),(0,F._)([(0,I.MZ)({readOnly:!0})],Ke.prototype,"selectedFeatureWidget",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"spinnerEnabled",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"title",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"updateLocationEnabled",null),(0,F._)([(0,I.MZ)()],Ke.prototype,"view",null),(0,F._)([(0,I.MZ)({type:Ms}),ys(["triggerAction","trigger-action"])],Ke.prototype,"viewModel",void 0),(0,F._)([(0,I.MZ)()],Ke.prototype,"visible",null),(0,F._)([(0,I.MZ)({type:Jn,nonNullable:!0})],Ke.prototype,"visibleElements",void 0),Ke=(0,F._)([(0,ce.$)("esri.widgets.Popup")],Ke);const ta=Ke}}]);