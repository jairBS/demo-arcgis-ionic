"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[995],{29430:(le,k,l)=>{l.d(k,{$:()=>H,IB:()=>G,N2:()=>z,RH:()=>de,Ws:()=>he,ZD:()=>ce});var L=l(68677);function G(e){return"r"in e&&"g"in e&&"b"in e}function N(e){return"h"in e&&"s"in e&&"v"in e}function I(e){return"l"in e&&"a"in e&&"b"in e}function x(e){return"l"in e&&"c"in e&&"h"in e}l(53781),l(89141);const R=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],A=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function j(e,v){const M=[];let y,P;if(e[0].length!==v.length)throw new Error("dimensions do not match");const B=e.length,K=e[0].length;let X=0;for(y=0;y<B;y++){for(X=0,P=0;P<K;P++)X+=e[y][P]*v[P];M.push(X)}return M}function V(e){const v=[e.r/255,e.g/255,e.b/255].map(y=>y<=.04045?y/12.92:((y+.055)/1.055)**2.4),M=j(R,v);return{x:100*M[0],y:100*M[1],z:100*M[2]}}function Z(e){const v=j(A,[e.x/100,e.y/100,e.z/100]).map(M=>Math.min(1,Math.max(M<=.0031308?12.92*M:1.055*M**.4166666666666667-.055,0)));return{r:Math.round(255*v[0]),g:Math.round(255*v[1]),b:Math.round(255*v[2])}}function C(e){const v=[e.x/95.047,e.y/100,e.z/108.883].map(M=>M>.008856451679035631?M**.3333333333333333:7.787037037037035*M+.13793103448275862);return{l:116*v[1]-16,a:500*(v[0]-v[1]),b:200*(v[1]-v[2])}}function S(e){const v=e.l,M=[(v+16)/116+e.a/500,(v+16)/116,(v+16)/116-e.b/200].map(y=>y>6/29?y**3:3*(6/29)**2*(y-4/29));return{x:95.047*M[0],y:100*M[1],z:108.883*M[2]}}function H(e){return G(e)?e:x(e)?function h(e){return Z(S(function s(e){const M=e.c,y=e.h;return{l:e.l,a:M*Math.cos(y),b:M*Math.sin(y)}}(e)))}(e):I(e)?function d(e){return Z(S(e))}(e):function O(e){return"x"in e&&"y"in e&&"z"in e}(e)?Z(e):N(e)?function _(e){const v=(e.h+360)%360/60,y=e.v/100*255,P=y*(e.s/100),B=P*(1-Math.abs(v%2-1));let K;switch(Math.floor(v)){case 0:K={r:P,g:B,b:0};break;case 1:K={r:B,g:P,b:0};break;case 2:K={r:0,g:P,b:B};break;case 3:K={r:0,g:B,b:P};break;case 4:K={r:B,g:0,b:P};break;case 5:case 6:K={r:P,g:0,b:B};break;default:K={r:0,g:0,b:0}}return K.r=Math.round(K.r+y-P),K.g=Math.round(K.g+y-P),K.b=Math.round(K.b+y-P),K}(e):e}function z(e){return N(e)?e:function F(e){const v=e.r,M=e.g,y=e.b,P=Math.max(v,M,y),B=P-Math.min(v,M,y);let K=P,X=0===B?0:P===v?(M-y)/B%6:P===M?(y-v)/B+2:(v-M)/B+4,ge=0===B?0:B/K;return X<0&&(X+=6),X*=60,ge*=100,K*=100/255,{h:X,s:ge,v:K}}(H(e))}function ce(e){return I(e)?e:function a(e){return C(V(e))}(H(e))}function de(e){return x(e)?e:function m(e){return function w(e){const v=e.l,M=e.a,y=e.b,P=Math.sqrt(M*M+y*y);let B=Math.atan2(y,M);return B=B>0?B:B+2*Math.PI,{l:v,c:P,h:B}}(C(V(e)))}(H(e))}function he(e,v){const{r:M,g:y,b:P}=null!=v&&v.ignoreAlpha?e:function te(e){let{r:v,g:M,b:y,a:P}=e;return P<1&&(v=Math.round(P*v+255*(1-P)),M=Math.round(P*M+255*(1-P)),y=Math.round(P*y+255*(1-P))),new L.A({r:v,g:M,b:y})}(e);return.2126*M+.7152*y+.0722*P}var me,e;(e=me||(me={}))[e.Low=160]="Low",e[e.High=225]="High"},14916:(le,k,l)=>{function L(G){var N;const I=G.layer;return"floorInfo"in I&&null!==(N=I.floorInfo)&&void 0!==N&&N.floorField&&"floors"in G.view?J(G.view.floors,I.floorInfo.floorField):null}function E(G,N){var I;return"floorInfo"in N&&null!==(I=N.floorInfo)&&void 0!==I&&I.floorField?J(G,N.floorInfo.floorField):null}function J(G,N){if(null==G||!G.length)return null;const I=G.filter(x=>""!==x).map(x=>`'${x}'`);return I.push("''"),`${N} IN (${I.join(",")}) OR ${N} IS NULL`}l.d(k,{E:()=>L,f:()=>E})},87293:(le,k,l)=>{l.d(k,{Sk:()=>J,Zx:()=>E,_X:()=>N});var L=l(26514);function E(I,x,O){return x.flatten(({sublayers:A})=>A).length!==I.length||!!I.some(A=>A.originIdOf("minScale")>O||A.originIdOf("maxScale")>O||A.originIdOf("renderer")>O||A.originIdOf("labelingInfo")>O||A.originIdOf("opacity")>O||A.originIdOf("labelsVisible")>O||A.originIdOf("source")>O)||!G(I,x)}function J(I,x,O){return!!I.some(R=>{const A=R.source;return!(!A||"map-layer"===A.type&&A.mapLayerId===R.id&&(null==A.gdbVersion||A.gdbVersion===O))||R.originIdOf("renderer")>L.Gr.SERVICE||R.originIdOf("labelingInfo")>L.Gr.SERVICE||R.originIdOf("opacity")>L.Gr.SERVICE||R.originIdOf("labelsVisible")>L.Gr.SERVICE})||!G(I,x)}function G(I,x){if(null==I||!I.length||null==x)return!0;const O=x.slice().reverse().flatten(({sublayers:j})=>j&&j.toArray().reverse()).map(j=>j.id).toArray();if(I.length>O.length)return!1;let R=0;const A=O.length;for(const{id:j}of I){for(;R<A&&O[R]!==j;)R++;if(R>=A)return!1}return!0}function N(I){return!!I&&I.some(x=>{var O;return null!=x.minScale||null!=(null===(O=x.layerDefinition)||void 0===O?void 0:O.minScale)})}},1684:(le,k,l)=>{l.d(k,{$:()=>S});var L=l(10467),E=l(68677),J=l(29430),G=l(77806),N=l(48218),I=l(32117),x=l(5922),O=l(35150),R=l(721);function A(w,s,a,d,m){if(null==w)return null;const h=w.referencesGeometry()&&m?function V(w,s,a){const{transform:d,hasZ:m,hasM:h}=a;j.has(s)||j.set(s,function Z(w){const s={};switch(w){case"esriGeometryPoint":return(a,d,m,h)=>(0,R.Tr)(d,s,a,m,h);case"esriGeometryPolygon":return(a,d,m,h)=>(0,R.$X)(d,s,a,m,h);case"esriGeometryPolyline":return(a,d,m,h)=>(0,R.P5)(d,s,a,m,h);case"esriGeometryMultipoint":return(a,d,m,h)=>(0,R.SW)(d,s,a,m,h);default:return O.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new x.A("mapview-arcade",`Unable to handle geometryType: ${w}`)),a=>a}}(s));const F=j.get(s)(w.geometry,d,m,h);return{...w,geometry:F}}(s,d,m):s,F=w.repurposeFeature(h);try{return w.evaluate({...a,$feature:F},w.services)}catch(_){return O.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",_),null}}const j=new Map,C=w=>{if(!w)return[0,0,0,0];const{r:s,g:a,b:d,a:m}=w;return[s,a,d,255*m]};class S{static findApplicableOverrides(s,a,d){if(s&&a){if(s.primitiveName){let m=!1;for(const h of d)if(h.primitiveName===s.primitiveName){m=!0;break}if(!m)for(const h of a)h.primitiveName===s.primitiveName&&d.push(h)}switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(s.effects)for(const m of s.effects)S.findApplicableOverrides(m,a,d);if(s.symbolLayers)for(const m of s.symbolLayers)S.findApplicableOverrides(m,a,d);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(s.effects)for(const m of s.effects)S.findApplicableOverrides(m,a,d);if(s.markerPlacement&&S.findApplicableOverrides(s.markerPlacement,a,d),"CIMVectorMarker"===s.type){if(s.markerGraphics)for(const m of s.markerGraphics)S.findApplicableOverrides(m,a,d),S.findApplicableOverrides(m.symbol,a,d)}else"CIMCharacterMarker"===s.type?S.findApplicableOverrides(s.symbol,a,d):"CIMHatchFill"===s.type?S.findApplicableOverrides(s.lineSymbol,a,d):"CIMPictureMarker"===s.type&&S.findApplicableOverrides(s.animatedSymbolProperties,a,d)}}}static findEffectOverrides(s,a){if(!s)return null;if("CIMGeometricEffectDashes"===s.type&&(0,I.K3)(s),!a||!s.primitiveName)return{type:"cim-effect-info",effect:s,overrides:[]};const d=s.primitiveName,m=[];for(const h of a)h.primitiveName===d&&m.push({...h,propertyName:(0,I.YF)(h.propertyName)});return{type:"cim-effect-info",effect:s,overrides:m}}static resolveSymbolOverrides(s,a,d,m,h,F,_){return(0,L.A)(function*(){if(null==s||!s.symbol)return null;let{symbol:H,primitiveOverrides:z}=s;const ce=!!z;if(!ce&&!m)return H;H=(0,G.o8)(H),z=(0,G.o8)(z);let de=!0;if(a||(a={attributes:{}},de=!1),ce){if(de||(z=z.filter(ie=>{var te;return!(null!==(te=ie.valueExpressionInfo)&&void 0!==te&&te.expression.includes("$feature"))})),_||(z=z.filter(ie=>{var te;return!(null!==(te=ie.valueExpressionInfo)&&void 0!==te&&te.expression.includes("$view"))})),z.length>0){const ie={spatialReference:d,fields:(0,I.O2)(a.attributes),geometryType:h};yield S.createRenderExpressions(z,ie),S.evaluateOverrides(z,a,null!=h?h:"esriGeometryPoint",F,_)}S.applyOverrides(H,z)}return m&&S.applyDictionaryTextOverrides(H,a,m,null),H})()}static createRenderExpressions(s,a){return(0,L.A)(function*(){const d=[];for(const m of s){const h=m.valueExpressionInfo;if(!h||S._expressionToRenderExpression.has(h.expression))continue;const F=(0,N.Ad)(h.expression,a.spatialReference,a.fields);d.push(F),F.then(_=>S._expressionToRenderExpression.set(h.expression,_))}d.length>0&&(yield Promise.all(d))})()}static evaluateOverrides(s,a,d,m,h){const F={$view:{scale:null==h?void 0:h.scale}};for(const _ of s){_.value&&"object"==typeof _.value&&(0,J.IB)(_.value)&&("Color"===_.propertyName||"StrokeColor"===_.propertyName)&&(_.value=C(_.value));const H=_.valueExpressionInfo;if(!H)continue;const z=S._expressionToRenderExpression.get(H.expression);z&&(_.value=A(z,a,F,d,m))}}static applyDictionaryTextOverrides(s,a,d,m,h="Normal"){if(null!=s&&s.type)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const F=s.symbolLayers;if(!F)return;for(const _ of F)_&&"CIMVectorMarker"===_.type&&S.applyDictionaryTextOverrides(_,a,d,m,"CIMTextSymbol"===s.type?s.textCase:h)}break;case"CIMVectorMarker":{const F=s.markerGraphics;if(!F)return;for(const _ of F)_&&S.applyDictionaryTextOverrides(_,a,d,m)}break;case"CIMMarkerGraphic":{const F=s.textString;if(F&&F.includes("[")){const _=(0,I.gQ)(F,d);s.textString=(0,I.FM)(a,_,m,h)}}}}static applyOverrides(s,a,d,m){if(s.primitiveName)for(const h of a)if(h.primitiveName===s.primitiveName){const F=(0,I.YF)(h.propertyName);if(m&&m.push({cim:s,nocapPropertyName:F,value:s[F]}),d){let _=!1;for(const H of d)H.primitiveName===s.primitiveName&&(_=!0);_||d.push(h)}null!=h.value&&(s[F]=h.value)}switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(s.effects)for(const h of s.effects)S.applyOverrides(h,a,d,m);if(s.symbolLayers)for(const h of s.symbolLayers)S.applyOverrides(h,a,d,m);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(s.effects)for(const h of s.effects)S.applyOverrides(h,a,d,m);if("CIMVectorMarker"===s.type&&s.markerGraphics)for(const h of s.markerGraphics)S.applyOverrides(h,a,d,m),S.applyOverrides(h.symbol,a,d,m)}}static restoreOverrides(s){for(const a of s)a.cim[a.nocapPropertyName]=a.value}static buildOverrideKey(s){let a="";for(const d of s)void 0!==d.value&&(a+=`${d.primitiveName}${d.propertyName}${JSON.stringify(d.value)}`);return a}static toValue(s,a){if("DashTemplate"===s)return a.split(" ").map(d=>Number(d));if("Color"===s){const d=new E.A(a).toRgba();return d[3]*=255,d}return a}}S._expressionToRenderExpression=new Map},9468:(le,k,l)=>{l.d(k,{A:()=>j});var L=l(8189),I=(l(35150),l(3248),l(40707),l(5922),l(76576)),x=l(69473),O=l(57641),R=l(62931);let A=class extends O.f{get hasHighlight(){return this.children.some(V=>V.hasData)}renderChildren(V){this.attributeView.update(),V.drawPhase===x.S5.HIGHLIGHT&&this.children.some(Z=>Z.hasData)&&(super.renderChildren(V),V.context.setColorMask(!0,!0,!0,!0),(0,R.lB)(V,!0,Z=>{this._renderChildren(Z,x.RI.All)}))}};A=(0,L._)([(0,I.$)("esri.views.2d.layers.support.HighlightGraphicContainer")],A);const j=A},96081:(le,k,l)=>{l.d(k,{A:()=>R});var L=l(8189),E=l(35150),J=l(56492),G=l(48900),O=(l(3248),l(40707),l(5922),l(76576));const R=A=>{let j=class extends A{initialize(){this.addHandles((0,G.on)(()=>this.layer,"refresh",V=>{this.doRefresh(V.dataChanged).catch(Z=>{(0,J.zf)(Z)||E.A.getLogger(this).error(Z)})}),"RefreshableLayerView")}};return j=(0,L._)([(0,O.$)("esri.layers.mixins.RefreshableLayerView")],j),j}},47624:(le,k,l)=>{l.d(k,{Uh:()=>ae,ox:()=>$e});var L=l(10467),E=l(8189),J=l(81098),G=l(98877),N=l(89952),I=l(31178),x=l(5922),O=l(17715),R=l(3248),A=l(60797),j=l(56492),V=l(48900),Z=l(82663),C=l(85211),w=(l(35150),l(76576)),s=l(28067),a=l(40856),d=l(86300),m=l(14916);function h(i,o){return o?"xoffset"in o&&o.xoffset?Math.max(i,Math.abs(o.xoffset)):"yoffset"in o&&o.yoffset?Math.max(i,Math.abs(o.yoffset||0)):i:i}function _(i,o){var u;return"number"==typeof i?i:null!=i&&null!==(u=i.stops)&&void 0!==u&&u.length?function F(i){let o=0,u=0;for(let f=0;f<i.length;f++){const c=i[f].size;"number"==typeof c&&(o+=c,u++)}return o/u}(i.stops):o}function z(i){const o=null==i?void 0:i.renderer,f="touch"===(null==i?void 0:i.pointerType)?9:6;if(!o)return f;const c="visualVariables"in o?function H(i,o){if(!o)return i;const u=o.filter(g=>"size"===g.type).map(g=>{const{maxSize:U,minSize:b}=g;return(_(U,i)+_(b,i))/2});let f=0;const c=u.length;if(0===c)return i;for(let g=0;g<c;g++)f+=u[g];const p=Math.floor(f/c);return Math.max(p,i)}(f,o.visualVariables):f;if("simple"===o.type)return h(c,o.symbol);if("unique-value"===o.type){var p;let g=c;return null!==(p=o.uniqueValueInfos)&&void 0!==p&&p.forEach(U=>{g=h(g,U.symbol)}),g}if("class-breaks"===o.type){let g=c;return o.classBreakInfos.forEach(U=>{g=h(g,U.symbol)}),g}return c}var ce=l(89563),de=l(77098),ie=l(68800),te=l(63484),he=l(61320),me=l(58701),Oe=l(87293);var M,Ce=l(21152),Se=l(12849),Me=l(71065),Te=l(55739),e=(l(40707),l(50305)),v=l(32034);let y=M=class extends Me.oY{static from(i){return(0,Te.PZ)(M,i)}constructor(i){super(i),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.historicMoment=null,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}writeHistoricMoment(i,o){o.historicMoment=i&&i.getTime()}};(0,E._)([(0,C.MZ)({type:Number,json:{write:!0}})],y.prototype,"dpi",void 0),(0,E._)([(0,C.MZ)()],y.prototype,"floors",void 0),(0,E._)([(0,C.MZ)({type:String,json:{write:!0}})],y.prototype,"gdbVersion",void 0),(0,E._)([(0,C.MZ)({types:Ce.yR,json:{read:he.rS,write:!0}})],y.prototype,"geometry",void 0),(0,E._)([(0,C.MZ)({type:Number,json:{write:!0}})],y.prototype,"geometryPrecision",void 0),(0,E._)([(0,C.MZ)({type:Number,json:{write:!0}})],y.prototype,"height",void 0),(0,E._)([(0,C.MZ)({type:Date})],y.prototype,"historicMoment",void 0),(0,E._)([(0,e.K)("historicMoment")],y.prototype,"writeHistoricMoment",null),(0,E._)([(0,C.MZ)({type:[Number],json:{write:!0}})],y.prototype,"layerIds",void 0),(0,E._)([(0,C.MZ)({type:["top","visible","all","popup"],json:{write:!0}})],y.prototype,"layerOption",void 0),(0,E._)([(0,C.MZ)({type:s.A,json:{write:!0}})],y.prototype,"mapExtent",void 0),(0,E._)([(0,C.MZ)({type:Number,json:{write:!0}})],y.prototype,"maxAllowableOffset",void 0),(0,E._)([(0,C.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"returnFieldName",void 0),(0,E._)([(0,C.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"returnGeometry",void 0),(0,E._)([(0,C.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"returnM",void 0),(0,E._)([(0,C.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"returnUnformattedValues",void 0),(0,E._)([(0,C.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"returnZ",void 0),(0,E._)([(0,C.MZ)({type:v.A,json:{write:!0}})],y.prototype,"spatialReference",void 0),(0,E._)([(0,C.MZ)()],y.prototype,"sublayers",void 0),(0,E._)([(0,C.MZ)({type:Se.A,json:{write:!0}})],y.prototype,"timeExtent",void 0),(0,E._)([(0,C.MZ)({type:Number,json:{write:!0}})],y.prototype,"tolerance",void 0),(0,E._)([(0,C.MZ)({type:Number,json:{write:!0}})],y.prototype,"width",void 0),y=M=(0,E._)([(0,w.$)("esri.rest.support.IdentifyParameters")],y);const P=y;var B=l(17221),K=l(6434);let X=class extends Me.oY{constructor(i){super(i),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(i,o){return J.A.fromJSON({attributes:{...o.attributes},geometry:{...o.geometry}})}writeFeature(i,o){if(!i)return;const{attributes:u,geometry:f}=i;u&&(o.attributes={...u}),null!=f&&(o.geometry=f.toJSON(),o.geometryType=K.Y.toJSON(f.type))}};(0,E._)([(0,C.MZ)({type:String,json:{write:!0}})],X.prototype,"displayFieldName",void 0),(0,E._)([(0,C.MZ)({type:J.A})],X.prototype,"feature",void 0),(0,E._)([(0,B.w)("feature",["attributes","geometry"])],X.prototype,"readFeature",null),(0,E._)([(0,e.K)("feature")],X.prototype,"writeFeature",null),(0,E._)([(0,C.MZ)({type:Number,json:{write:!0}})],X.prototype,"layerId",void 0),(0,E._)([(0,C.MZ)({type:String,json:{write:!0}})],X.prototype,"layerName",void 0),X=(0,E._)([(0,w.$)("esri.rest.support.IdentifyResult")],X);const ge=X;function be(){return(be=(0,L.A)(function*(i,o,u){const f=(o=function Fe(i){return P.from(i)}(o)).geometry?[o.geometry]:[],c=(0,ie.Dl)(i);return c.path+="/identify",(0,de.el)(f).then(p=>{const g=function Ae(i,o){var u;const{dpi:f,gdbVersion:c,geometry:p,geometryPrecision:g,height:U,historicMoment:b,layerOption:Q,mapExtent:T,maxAllowableOffset:D,returnFieldName:$,returnGeometry:Y,returnUnformattedValues:re,returnZ:W,spatialReference:se,timeExtent:ee,tolerance:q,width:ne}=i.toJSON(),{dynamicLayers:ue,layerDefs:ve,layerIds:fe}=function Pe(i){var o;const{mapExtent:u,floors:f,width:c,sublayers:p,layerIds:g,layerOption:U,gdbVersion:b}=i,Q=null==p||null===(o=p.find(W=>null!=W.layer))||void 0===o||null===(o=o.layer)||void 0===o?void 0:o.serviceSublayers,T="popup"===U,D={},$=(0,a.X_)({extent:u,width:c,spatialReference:null==u?void 0:u.spatialReference}),Y=[],re=W=>{if(W.visible&&(0===$||(0===W.minScale||$<=W.minScale)&&(0===W.maxScale||$>=W.maxScale)))if(W.sublayers)W.sublayers.forEach(re);else{if(!1===(null==g?void 0:g.includes(W.id))||T&&(!W.popupTemplate||!W.popupEnabled))return;Y.unshift(W)}};if(null!=p&&p.forEach(re),p&&!Y.length)D.layerIds=[];else{const W=(0,Oe.Sk)(Y,Q,b),se=Y.map(ee=>{const q=(0,m.f)(f,ee);return ee.toExportImageJSON(q)});if(W)D.dynamicLayers=JSON.stringify(se);else{if(p){let q=Y.map(({id:ne})=>ne);g&&(q=q.filter(ne=>g.includes(ne))),D.layerIds=q}else null!=g&&g.length&&(D.layerIds=g);const ee=function Re(i,o){const u=!(null==i||!i.length),f=o.filter(c=>null!=c.definitionExpression||u&&null!=c.floorInfo);return f.length?f.map(c=>{const p=(0,m.f)(i,c),g=(0,te.m)(p,c.definitionExpression);return{id:c.id,definitionExpression:null!=g?g:void 0}}):null}(f,Y);if(null!=ee&&ee.length){const q={};for(const ne of ee)ne.definitionExpression&&(q[ne.id]=ne.definitionExpression);Object.keys(q).length&&(D.layerDefs=JSON.stringify(q))}}}return D}(i),ye=null!=(null==o?void 0:o.geometry)?o.geometry:null,oe={historicMoment:b,geometryPrecision:g,maxAllowableOffset:D,returnFieldName:$,returnGeometry:Y,returnUnformattedValues:re,returnZ:W,tolerance:q},pe=ye&&ye.toJSON()||p;oe.imageDisplay=`${ne},${U},${f}`,c&&(oe.gdbVersion=c),pe&&(delete pe.spatialReference,oe.geometry=JSON.stringify(pe),oe.geometryType=(0,he.$B)(pe));const Ue=null!==(u=null!=se?se:null==pe?void 0:pe.spatialReference)&&void 0!==u?u:null==T?void 0:T.spatialReference;if(Ue&&(oe.sr=(0,me.YX)(Ue)),oe.time=ee?[ee.start,ee.end].join(","):null,T){const{xmin:We,ymin:He,xmax:ze,ymax:Je}=T;oe.mapExtent=`${We},${He},${ze},${Je}`}return ve&&(oe.layerDefs=ve),ue&&!ve&&(oe.dynamicLayers=ue),oe.layers="popup"===Q?"visible":Q,fe&&!ue&&(oe.layers+=`:${fe.join(",")}`),oe}(o,{geometry:null==p?void 0:p[0]}),U=(0,ie.lF)({...c.query,f:"json",...g}),b=(0,ie.jV)(U,u);return(0,ce.A)(c.path,b).then(je).then(Q=>function Ne(i,o){if(null==o||!o.length)return i;const u=new Map;o.forEach(function f(c){u.set(c.id,c),c.sublayers&&c.sublayers.forEach(f)});for(const c of i.results)c.feature.sourceLayer=u.get(c.layerId);return i}(Q,o.sublayers))})})).apply(this,arguments)}function je(i){const o=i.data;return o.results=o.results||[],o.exceededTransferLimit=!!o.exceededTransferLimit,o.results=o.results.map(u=>ge.fromJSON(u)),o}var we=l(48218),De=l(46602),_e=l(64935);let Ee=null;function $e(i,o){return"tile"===o.type||"map-image"===o.type}let ae=class extends G.A{constructor(i){var o;super(i),o=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,j.sg)(function(){var u=(0,L.A)(function*(f){o.destroyed||o.updatingHandles.addPromise(o._updateHighlightedFeaturesGeometries(f).catch(()=>{}))});return function(f){return u.apply(this,arguments)}}())}initialize(){const i=o=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(o).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,V.on)(()=>this.highlightGraphics,"change",o=>i(o.added),{onListenerAdd:o=>i(o)})])}fetchPopupFeaturesAtLocation(i,o){var u=this;return(0,L.A)(function*(){var f,c;const{layerView:{layer:p,view:{scale:g}}}=u;if(!i)throw new x.A("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:p});const U=function Ve(i,o,u){const f=[];if(!i)return f;const c=p=>{if(p.visible&&(0===p.minScale||o<=p.minScale)&&(0===p.maxScale||o>=p.maxScale))if(p.sublayers)p.sublayers.forEach(c);else if(p.popupEnabled){const b=(0,_e.D8)(p,{...u,defaultPopupTemplateEnabled:!1});null!=b&&f.unshift({sublayer:p,popupTemplate:b})}};return i.map(c),f}(p.sublayers,g,o);if(!U.length)return[];const b=yield function Ze(i,o){return xe.apply(this,arguments)}(p,U);if(!((null===(f=null===(c=p.capabilities)||void 0===c||null===(c=c.operations)||void 0===c?void 0:c.supportsIdentify)||void 0===f||f)&&p.version>=10.5||b))throw new x.A("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:p});return b?u._fetchPopupFeaturesUsingQueries(i,U,o):u._fetchPopupFeaturesUsingIdentify(i,U,o)})()}clearHighlights(){var i;null===(i=this.highlightGraphics)||void 0===i||i.removeAll()}highlight(i){var o,u;const f=this.highlightGraphics;if(!f)return(0,O.hA)();let c=null;if(i instanceof J.A?c=[i]:I.A.isCollection(i)&&i.length>0?c=i.toArray():Array.isArray(i)&&i.length>0&&(c=i),c=null===(o=c)||void 0===o?void 0:o.filter(N.Ru),null===(u=c)||void 0===u||!u.length)return(0,O.hA)();for(const p of c){const g=p.sourceLayer;null!=g&&"geometryType"in g&&"point"===g.geometryType&&(p.visible=!1)}return f.addMany(c),(0,O.hA)(()=>{var p;return f.removeMany(null!==(p=c)&&void 0!==p?p:[])})}_updateHighlightedFeaturesSymbols(i){var o=this;return(0,L.A)(function*(){const{layerView:{view:u},highlightGraphics:f,highlightGraphicUpdated:c}=o;if(f&&c)for(const p of i){const g=p.sourceLayer&&"renderer"in p.sourceLayer&&p.sourceLayer.renderer;p.sourceLayer&&"geometryType"in p.sourceLayer&&"point"===p.sourceLayer.geometryType&&g&&"getSymbolAsync"in g&&g.getSymbolAsync(p).then(function(){var U=(0,L.A)(function*(b){var Q;b||(b=new De.A);let T=null;const D="visualVariables"in g?null===(Q=g.visualVariables)||void 0===Q?void 0:Q.find($=>"size"===$.type):void 0;D&&(Ee||(Ee=(yield l.e(7522).then(l.bind(l,77522))).getSize),T=Ee(D,p,{view:u.type,scale:u.scale,shape:"simple-marker"===b.type?b.style:null})),T||(T="width"in b&&"height"in b&&null!=b.width&&null!=b.height?Math.max(b.width,b.height):"size"in b?b.size:16),f.includes(p)&&(p.symbol=new De.A({style:"square",size:T,xoffset:"xoffset"in b?b.xoffset:0,yoffset:"yoffset"in b?b.yoffset:0}),c(p,"symbol"),p.visible=!0)});return function(b){return U.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(i){var o=this;return(0,L.A)(function*(){const{layerView:{layer:u,view:f},highlightGraphics:c,highlightGraphicUpdated:p}=o;if(o._highlightGeometriesResolution=i,!p||null==c||!c.length||!u.capabilities.operations.supportsQuery)return;const g=o._getTargetResolution(i),U=new Map;for(const T of c)(!o._featuresResolutions.has(T)||o._featuresResolutions.get(T)>g)&&(0,A.tE)(U,T.sourceLayer,()=>new Map).set(T.getObjectId(),T);const b=Array.from(U,([T,D])=>{const $=T.createQuery();return $.objectIds=[...D.keys()],$.outFields=[T.objectIdField],$.returnGeometry=!0,$.maxAllowableOffset=g,$.outSpatialReference=f.spatialReference,T.queryFeatures($)}),Q=yield Promise.all(b);if(!o.destroyed)for(const{features:T}of Q)for(const D of T){const Y=U.get(D.sourceLayer).get(D.getObjectId());Y&&c.includes(Y)&&(Y.geometry=D.geometry,p(Y,"geometry"),o._featuresResolutions.set(Y,g))}})()}_getTargetResolution(i){const o=i*(0,Z.GA)(this.layerView.view.spatialReference),u=o/16;return u<=10?0:i/o*u}_fetchPopupFeaturesUsingIdentify(i,o,u){var f=this;return(0,L.A)(function*(){const c=yield f._createIdentifyParameters(i,o,u);if(null==c)return[];const{results:p}=yield function Ge(i,o,u){return be.apply(this,arguments)}(f.layerView.layer.parsedUrl,c,u);return p.map(g=>g.feature)})()}_createIdentifyParameters(i,o,u){var f=this;return(0,L.A)(function*(){const{floors:c,layer:p,timeExtent:g,view:{spatialReference:U,scale:b}}=f.layerView;if(!o.length)return null;yield Promise.all(o.map(({sublayer:re})=>re.load(u).catch(()=>{})));const Q=Math.min((0,R.A)("mapservice-popup-identify-max-tolerance"),p.allSublayers.reduce((re,W)=>W.renderer?z({renderer:W.renderer,pointerType:null==u?void 0:u.pointerType}):re,2)),T=f.createFetchPopupFeaturesQueryGeometry(i,Q),D=(0,a.i1)(b,U),$=Math.round(T.width/D),Y=new s.A({xmin:T.center.x-D*$,ymin:T.center.y-D*$,xmax:T.center.x+D*$,ymax:T.center.y+D*$,spatialReference:T.spatialReference});return new P({floors:c,gdbVersion:"gdbVersion"in p?p.gdbVersion:void 0,geometry:i,height:$,layerOption:"popup",mapExtent:Y,returnGeometry:!0,spatialReference:U,sublayers:p.sublayers,timeExtent:g,tolerance:Q,width:$})})()}_fetchPopupFeaturesUsingQueries(i,o,u){var f=this;return(0,L.A)(function*(){const{layerView:{floors:c,timeExtent:p}}=f,g=o.map(function(){var U=(0,L.A)(function*({sublayer:b,popupTemplate:Q}){var T;if(yield b.load(u).catch(()=>{}),b.capabilities&&!b.capabilities.operations.supportsQuery)return[];const D=b.createQuery(),$=z({renderer:b.renderer,pointerType:null==u?void 0:u.pointerType}),Y=f.createFetchPopupFeaturesQueryGeometry(i,$),re=new Set,[W]=yield Promise.all([(0,_e.TO)(b,Q),null===(T=b.renderer)||void 0===T?void 0:T.collectRequiredFields(re,b.fieldsIndex)]);(0,j.Te)(u),(0,d._w)(re,b.fieldsIndex,W);const se=Array.from(re).sort();if(D.geometry=Y,D.outFields=se,D.timeExtent=p,c){const fe=c.clone(),ye=(0,m.f)(fe,b);null!=ye&&(D.where=D.where?`(${D.where}) AND (${ye})`:ye)}const ee=f._getTargetResolution(Y.width/$),q=yield function Be(i){var o;return null!==(o=i.expressionInfos)&&void 0!==o&&o.length||Array.isArray(i.content)&&i.content.some(u=>"expression"===u.type)?(0,we.lw)():Promise.resolve()}(Q);(0,j.Te)(u);const ne="point"===b.geometryType||q&&q.arcadeUtils.hasGeometryOperations(Q);ne||(D.maxAllowableOffset=ee);let{features:ue}=yield b.queryFeatures(D,u);const ve=ne?0:ee;ue=yield function Ke(i,o,u){return Ie.apply(this,arguments)}(b,ue,u);for(const fe of ue)f._featuresResolutions.set(fe,ve);return ue});return function(b){return U.apply(this,arguments)}}());return(yield Promise.allSettled(g)).reduce((U,b)=>"fulfilled"===b.status?[...U,...b.value]:U,[]).filter(N.Ru)})()}};function xe(){return(xe=(0,L.A)(function*(i,o){var u;if(null!==(u=i.capabilities)&&void 0!==u&&null!==(u=u.operations)&&void 0!==u&&u.supportsQuery)return!0;try{return yield Promise.any(o.map(({sublayer:f})=>f.load().then(()=>f.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function Ie(){return(Ie=(0,L.A)(function*(i,o,u){const f=i.renderer;return f&&"defaultSymbol"in f&&!f.defaultSymbol&&(o=f.valueExpression?yield Promise.all(o.map(c=>f.getSymbolAsync(c,u).then(p=>p?c:null))).then(c=>c.filter(p=>null!=p)):o.filter(c=>null!=f.getSymbol(c))),o})).apply(this,arguments)}(0,E._)([(0,C.MZ)({constructOnly:!0})],ae.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,E._)([(0,C.MZ)({constructOnly:!0})],ae.prototype,"layerView",void 0),(0,E._)([(0,C.MZ)({constructOnly:!0})],ae.prototype,"highlightGraphics",void 0),(0,E._)([(0,C.MZ)({constructOnly:!0})],ae.prototype,"highlightGraphicUpdated",void 0),(0,E._)([(0,C.MZ)({constructOnly:!0})],ae.prototype,"updatingHandles",void 0),ae=(0,E._)([(0,w.$)("esri.views.layers.support.MapService")],ae)},64935:(le,k,l)=>{l.d(k,{D8:()=>N,TO:()=>J});var L=l(10467),E=l(86300);function J(x){return G.apply(this,arguments)}function G(){return(G=(0,L.A)(function*(x,O=x.popupTemplate){var R,A;if(null==O)return[];const j=yield O.getRequiredFields(x.fieldsIndex),{lastEditInfoEnabled:V}=O,{objectIdField:Z,typeIdField:C,globalIdField:S,relationships:w}=x;if(j.includes("*"))return["*"];const s=V?(0,E.eX)(x):[],a=(0,E.DB)(x.fieldsIndex,[...j,...s]);return C&&a.push(C),a&&Z&&null!==(R=x.fieldsIndex)&&void 0!==R&&R.has(Z)&&!a.includes(Z)&&a.push(Z),a&&S&&null!==(A=x.fieldsIndex)&&void 0!==A&&A.has(S)&&!a.includes(S)&&a.push(S),w&&w.forEach(d=>{var m;const{keyField:h}=d;a&&h&&null!==(m=x.fieldsIndex)&&void 0!==m&&m.has(h)&&!a.includes(h)&&a.push(h)}),a})).apply(this,arguments)}function N(x,O){return x.popupTemplate?x.popupTemplate:null!=O&&O.defaultPopupTemplateEnabled&&null!=x.defaultPopupTemplate?x.defaultPopupTemplate:null}},23868:(le,k,l)=>{l.d(k,{V:()=>G}),l(21152);var E=l(82663),J=l(28067);function G(x,O,R,A=new J.A){var j;let V=0;if("2d"===R.type)V=O*(null!==(j=R.resolution)&&void 0!==j?j:0);else if("3d"===R.type){const a=R.overlayPixelSizeInMapUnits(x),d=R.basemapSpatialReference;V=null==d||d.equals(R.spatialReference)?O*a:(0,E.GA)(d)/(0,E.GA)(R.spatialReference)}const Z=x.x-V,C=x.y-V,S=x.x+V,w=x.y+V,{spatialReference:s}=R;return A.xmin=Math.min(Z,S),A.ymin=Math.min(C,w),A.xmax=Math.max(Z,S),A.ymax=Math.max(C,w),A.spatialReference=s,A}new J.A}}]);