"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5903],{37049:(le,q,_)=>{_.d(q,{A:()=>V});var v=_(10467);class V{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(L,N,Z){this._layerById[N]=Z,this._layerByName[L]=Z}featureSetByName(L,N=!0,Z=["*"]){var W=this;return(0,v.A)(function*(){return void 0===W._layerByName[L]?null:W._layerByName[L]})()}featureSetById(L,N=!0,Z=["*"]){var W=this;return(0,v.A)(function*(){return void 0===W._layerById[L]?null:W._layerById[L]})()}castToText(L=!1){return"object, FeatureSetCollection"}}},15903:(le,q,_)=>{_.r(q),_.d(q,{constructAssociationMetaDataFeatureSetFromUrl:()=>He,constructFeatureSet:()=>de,constructFeatureSetFromPortalItem:()=>it,constructFeatureSetFromRelationship:()=>qe,constructFeatureSetFromUrl:()=>De,convertToFeatureSet:()=>nt,createFeatureSetCollectionFromMap:()=>tt,createFeatureSetCollectionFromService:()=>rt,initialiseMetaDataCache:()=>$e});var v=_(10467),V=_(89563),J=_(37049),L=_(42686),N=_(888),Z=_(81098),W=_(36455),w=_(93571),C=_(31033),b=_(85922),k=_(71505),O=_(58314),F=_(7981),T=_(97089),G=_(7425),p=_(40013);class A{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new A;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,n,r){const u=new A;u.field=e;const i=p.WhereClause.create(t,n,r),h=function P(R){if("function"===R.parseTree.type){if(0===R.parseTree.args.value.length)return{name:R.parseTree.name,expr:null};if(R.parseTree.args.value.length>1)throw new C.L8(C.Z7.MissingStatisticParameters);const e=p.WhereClause.create((0,T.Mi)(R.parseTree.args.value[0],F.zl.Standardised,R.parameters),R.fieldsIndex,R.timeZone);return{name:R.parseTree.name,expr:e}}return null}(i);if(null===h)throw new C.L8(C.Z7.UnsupportedSqlFunction,{function:""});const f=h.name.toUpperCase().trim();if("MIN"===f){if(u.typeofstat="MIN",u.workingexpr=h.expr,null===i)throw new C.L8(C.Z7.InvalidFunctionParameters,{function:"min"})}else if("MAX"===f){if(u.typeofstat="MAX",u.workingexpr=h.expr,null===i)throw new C.L8(C.Z7.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===f)u.typeofstat="COUNT",u.workingexpr=h.expr;else if("STDEV"===f){if(u.typeofstat="STDDEV",u.workingexpr=h.expr,null===i)throw new C.L8(C.Z7.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===f){if(u.typeofstat="SUM",u.workingexpr=h.expr,null===i)throw new C.L8(C.Z7.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===f){if(u.typeofstat="AVG",u.workingexpr=h.expr,null===i)throw new C.L8(C.Z7.InvalidFunctionParameters,{function:f})}else if("AVG"===f){if(u.typeofstat="AVG",u.workingexpr=h.expr,null===i)throw new C.L8(C.Z7.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==f)throw new C.L8(C.Z7.UnsupportedSqlFunction,{function:f});if(u.typeofstat="VAR",u.workingexpr=h.expr,null===i)throw new C.L8(C.Z7.InvalidFunctionParameters,{function:"var"})}return u}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var m=_(55144),s=_(87257),c=_(16924),l=_(29752),d=_(32034),y=_(29141),I=_(73258);function E(R){if(!R)return"COUNT";switch(R.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class M extends b.A{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){var t=this;return(0,v.A)(function*(){if(null===t._wset){const n=yield t._getFilteredSet("",null,null,null,e);return t._wset=n,t._wset}return t._wset})()}_isInFeatureSet(){return F.J6.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,n=1;const r=this._parent?this._parent.getFieldsIndex():new I.A([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let i=!1;for(let h=0;h<this._config.groupbyfields.length;h++)if(this._config.groupbyfields[h].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}if(!1===i)for(let h=0;h<this._config.statsfields.length;h++)if(this._config.statsfields[h].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}!1===i?t=!0:(this.objectIdField="ROW__ID"+n.toString(),n++)}for(const i of this._config.statsfields){const h=new A;h.field=i.name,h.tofieldname=i.name,h.workingexpr=i.expression instanceof p.WhereClause?i.expression:p.WhereClause.create(i.expression,r,this.dateFieldsTimeZoneDefaultUTC),h.typeofstat=E(i.statistic),this._decodedStatsfield.push(h)}this._decodedGroupbyfield=[];for(const i of this._config.groupbyfields){const h={name:i.name,singlefield:null,tofieldname:i.name,expression:i.expression instanceof p.WhereClause?i.expression:p.WhereClause.create(i.expression,r,this.dateFieldsTimeZoneDefaultUTC),sqlType:null};this._decodedGroupbyfield.push(h)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const i of this._parent.fields)e[i.name.toUpperCase()]=1;this.types=null,this.subtypes=null,this.subtypeField=""}else this.geometryType=F.ik.point,this.typeIdField="",this.types=null,this.subtypes=null,this.subtypeField="",this.spatialReference=new d.A({wkid:4326});this.fields=[];const u=new A;u.field=this._nextUniqueName(e),u.tofieldname=this.objectIdField,u.workingexpr=p.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC),u.typeofstat="MIN",this._decodedStatsfield.push(u);for(const i of this._decodedGroupbyfield){const h=new y.A;if(i.name=this._nextUniqueName(e),h.name=i.tofieldname,h.alias=h.name,(0,T.DA)(i.expression)){const f=this._parent.getField((0,T.YY)(i.expression,F.zl.Standardised));if(!f)throw new C.dr(C.D_.AggregationFieldNotFound);i.name=f.name,i.singlefield=f.name,this.phsyicalgroupbyfields.push(f.name),h.type=f.type,i.sqlType=f.type}else{h.type=this._convertToEsriFieldType((0,T.IY)(i.expression,this._parent.fields));const f=new y.A;f.name=i.name,f.alias=f.name,this.phsyicalgroupbyfields.push(i.name),this._adaptedFields.push(new W.Gr(f,i.expression)),this._candosimplegroupby=!1,i.sqlType=h.type}this.fields.push(h)}if(this._adaptedFields.length>0)for(const i of this._parent.fields)this._adaptedFields.push(new W.IO(i));for(let i=0;i<this._decodedStatsfield.length;i++){const h=new y.A;let f=null;const D=this._decodedStatsfield[i];D.field=this._nextUniqueName(e),D.tofieldname===this.objectIdField&&(this._internalObjectIdField=D.field),h.name=D.tofieldname,h.alias=h.name;const S=null!==D.workingexpr&&(0,T.DA)(D.workingexpr)?(0,T.YY)(D.workingexpr,F.zl.Standardised):"";switch(this._decodedStatsfield[i].typeofstat){case"SUM":if(""!==S){if(f=this._parent.getField(S),!f)throw new C.dr(C.D_.AggregationFieldNotFound);h.type=f.type}else h.type="double";break;case"MIN":case"MAX":if(""!==S){if(f=this._parent.getField(S),!f)throw new C.dr(C.D_.AggregationFieldNotFound);h.type=f.type}else h.type="double";break;case"COUNT":h.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==S&&(f=this._parent.getField(S),!f))throw new C.dr(C.D_.AggregationFieldNotFound);h.type="double"}this.fields.push(h)}}_canDoAggregates(){return(0,v.A)(function*(){return!1})()}_getFeatures(e,t,n,r){var u=this;return(0,v.A)(function*(){const i=u._maxQuery;return!0===u._checkIfNeedToExpandKnownPage(e,i)?(yield u._expandPagedSet(e,i,0,0,r),u._getFeatures(e,t,n,r)):"success"})()}_getFilteredSet(e,t,n,r,u){var i=this;return(0,v.A)(function*(){if(""!==e)return new k.A([],[],!0,null);let h=null;const f={ordered:!1,nowhereclause:!1};if(yield i._ensureLoaded(),null!==n)for(let S=0;S<i._decodedStatsfield.length;S++)if(!0===(0,T.Ju)(n,i._decodedStatsfield[S].tofieldname)){f.nowhereclause=!0,n=null;break}if(null!==r){f.ordered=!0;for(let S=0;S<i._decodedStatsfield.length;S++)if(!0===r.scanForField(i._decodedStatsfield[S].tofieldname)){r=null,f.ordered=!1;break}if(null!==r)for(const S of i._decodedGroupbyfield)if(null===S.singlefield&&!0===r.scanForField(S.tofieldname)){r=null,f.ordered=!1;break}}if(!1!==i._candosimplegroupby&&(yield i._parent._canDoAggregates(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,null))){let S=null;n&&(S=i._reformulateWhereClauseWithoutGroupByFields(n));let U=null;r&&(U=i._reformulateOrderClauseWithoutGroupByFields(r));const K=yield i._parent._getAggregatePagesDataSourceDefinition(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,S,U,i._internalObjectIdField);return i._checkCancelled(u),h=!0===f.nowhereclause?new k.A(K._candidates.slice(0).concat(K._known.slice(0)),[],!0===f.ordered&&K._ordered,i._clonePageDefinition(K.pagesDefinition)):new k.A(K._candidates.slice(0),K._known.slice(0),!0===f.ordered&&K._ordered,i._clonePageDefinition(K.pagesDefinition)),h}let D=i._parent;if(i._adaptedFields.length>0&&(D=new W.a({parentfeatureset:i._parent,adaptedFields:i._adaptedFields,extraFilter:null})),!0===f.nowhereclause)h=new k.A(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new w.A({parentfeatureset:D,orderbyclause:new O.A(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}});else{let S=D;if(null!==n){let U=null;n&&(U=i._reformulateWhereClauseWithoutGroupByFields(n)),S=new N.A({parentfeatureset:S,whereclause:U})}h=new k.A(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new w.A({parentfeatureset:S,orderbyclause:new O.A(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}})}return h})()}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,T.bD)(e,t.tofieldname,(0,T.YY)(t.workingexpr,F.zl.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,T.bD)(e,t.tofieldname,(0,T.YY)(t.expression,F.zl.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const n of this._decodedGroupbyfield)n.tofieldname!==n.name&&t.push({field:n.tofieldname,newfield:n.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,n){var r=this;return(0,v.A)(function*(){return!0===r._checkIfNeedToExpandCandidatePage(e,r._maxQuery)?(yield r._expandPagedSet(e,r._maxQuery,0,0,n),r._refineSetBlock(e,t,n)):(r._checkCancelled(n),r._refineKnowns(e,t),e)})()}_expandPagedSet(e,t,n,r,u){return this._expandPagedSetFeatureSet(e,t,n,r,u)}_getPhysicalPage(e,t,n){var r=this;return(0,v.A)(function*(){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return r._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,n,[]);const u=yield r._getAgregagtePhysicalPage(e,t,n);for(const i of u){const h={geometry:i.geometry,attributes:{}},f={};for(const D in i.attributes)f[D.toLowerCase()]=i.attributes[D];for(const D of r._decodedGroupbyfield)h.attributes[D.tofieldname]=f[D.name.toLowerCase()];for(const D of r._decodedStatsfield)h.attributes[D.tofieldname]=f[D.field.toLowerCase()];r._featureCache[h.attributes[r.objectIdField]]=new Z.A(h)}return u.length})()}_sequentialGetPhysicalItem(e,t,n,r){return new Promise((u,i)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(n)),!0===e.pagesDefinition.internal.fullyResolved||0===t?u(r.length):this._nextAggregateItem(e,t,n,r,h=>{u(null===h?r.length:this._sequentialGetPhysicalItem(e,t-=1,n,r))},i)})}_nextAggregateItem(e,t,n,r,u,i){try{(0,L.a2)(e.pagesDefinition.internal.iterator.next()).then(h=>{if(null===h)if(null!==e.pagesDefinition.internal.workingItem){const f=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);r.push(f),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(f.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,u(null)}else e.pagesDefinition.internal.fullyResolved=!0,u(null);else{const f=this._generateAggregateHash(h);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[h],id:f};else{if(f!==e.pagesDefinition.internal.workingItem.id){const D=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return r.push(D),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(D.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[h],id:f},void u(D)}e.pagesDefinition.internal.workingItem.features.push(h)}this._nextAggregateItem(e,t,n,r,u,i)}},i)}catch(h){i(h)}}_calculateFieldStat(e,t,n){const r=[];for(let u=0;u<e.features.length;u++)if(null!==t.workingexpr){const i=t.workingexpr.calculateValue(e.features[u]);null!==i&&r.push(i instanceof s.n||i instanceof l.k?i.toNumber():i instanceof c.g?i.toMilliseconds():i)}else r.push(null);switch(t.typeofstat){case"MIN":n.attributes[t.tofieldname]=(0,G.tQ)("min",r,-1);break;case"MAX":n.attributes[t.tofieldname]=(0,G.tQ)("max",r,-1);break;case"SUM":n.attributes[t.tofieldname]=(0,G.tQ)("sum",r,-1);break;case"COUNT":n.attributes[t.tofieldname]=r.length;break;case"VAR":n.attributes[t.tofieldname]=(0,G.tQ)("var",r,-1);break;case"STDDEV":n.attributes[t.tofieldname]=(0,G.tQ)("stddev",r,-1);break;case"AVG":n.attributes[t.tofieldname]=(0,G.tQ)("avg",r,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const r of this._decodedGroupbyfield){const u=r.singlefield?e.features[0].attributes[r.singlefield]:p.WhereClause.convertValueToStorageFormat(r.expression.calculateValue(e.features[0]),r.sqlType);t.attributes[r.tofieldname]=u}for(const r of this._decodedStatsfield)this._calculateFieldStat(e,r,t);const n=[];for(let r=0;r<this._decodedStatsfield.length;r++)n.push(this._calculateFieldStat(e,this._decodedStatsfield[r],t));return this._featureCache[t.attributes[this.objectIdField]]=new Z.A({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const n of this._decodedGroupbyfield){const r=n.singlefield?e.attributes[n.singlefield]:n.expression.calculateValue(e);t+=null==r?":":":"+r.toString()}return(0,m.d)(t,m.T.String)}_stat(){return(0,v.A)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,v.A)(function*(){return null})()}static registerAction(){b.A._featuresetFunctions.groupby=function(e,t){return new M({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var B=_(57120),g=_(53437),x=_(77469),j=_(84462),z=_(53787),ie=_(61320),H=_(58701),se=_(35940),ee=_(11943),ce=_(5922),ye=_(3248),me=_(56492),_e=_(6829),he=_(93164),pe=_(34687),je=_(11170),Ue=_(93327),fe=_(87086);function ve(){return ve=(0,v.A)(function*(R,e,t,n){return function ke(R,e,t,n){return Ie.apply(this,arguments)}(e,yield function Ge(R,e,t,n){return Fe.apply(this,arguments)}(R,e,t,n),t,n)}),ve.apply(this,arguments)}function Fe(){return(Fe=(0,v.A)(function*(R,e,t,n){var r;const u={...n},i=function Ke(R,e){var t,n;let r=fe.A.from(R);r.sourceSpatialReference=null!==(t=null!==(n=r.sourceSpatialReference)&&void 0!==n?n:null==e?void 0:e.sourceSpatialReference)&&void 0!==t?t:null,(null!=e&&e.gdbVersion||null!=e&&e.dynamicDataSource)&&(r=r===R?r.clone():r,r.gdbVersion=R.gdbVersion||e.gdbVersion,r.dynamicDataSource=R.dynamicDataSource?he.L.from(R.dynamicDataSource):e.dynamicDataSource);const u=null==e?void 0:e.infoFor3D;if(null!=u&&be(R,u)){var i,h;r=r===R?r.clone():r,r.formatOf3DObjects=null;const{supportedFormats:f,queryFormats:D}=u,S=null!==(i=(0,_e.R_)("model/gltf-binary",f))&&void 0!==i?i:(0,_e.E1)("glb",f),U=null!==(h=(0,_e.R_)("model/gltf+json",f))&&void 0!==h?h:(0,_e.E1)("gtlf",f);for(const K of D){if(K===S){r.formatOf3DObjects=K;break}K!==U||r.formatOf3DObjects||(r.formatOf3DObjects=K)}if(!r.formatOf3DObjects)throw new ce.A("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==r.outFields||!r.outFields.includes("*")){r=r===R?r.clone():r,null==r.outFields&&(r.outFields=[]);const{originX:K,originY:Q,originZ:Y,translationX:$,translationY:X,translationZ:ae,scaleX:ne,scaleY:oe,scaleZ:te,rotationX:ue,rotationY:st,rotationZ:at,rotationDeg:lt}=u.transformFieldRoles;r.outFields.push(K,Q,Y,$,X,ae,ne,oe,te,ue,st,at,lt)}}return r}(e,t),h=null!=(null===(r=e.outStatistics)||void 0===r?void 0:r[0]),f=(0,ye.A)("featurelayer-pbf-statistics"),D=!h||f;let S;if("pbf"===(null==t?void 0:t.format)&&D)try{S=yield(0,je.S)(R,i,u)}catch(U){if("query:parsing-pbf"!==U.name)throw U;t.format="json"}return"json"!==(null==t?void 0:t.format)&&D||(S=yield(0,pe.e)(R,i,u)),function We(R,e){if(null!=R&&null!=e)for(const t of e){const n=R.get(t.name);n&&Object.assign(t,n.toJSON())}}(null==t?void 0:t.fieldsIndex,S.fields),S})).apply(this,arguments)}function Ie(){return(Ie=(0,v.A)(function*(R,e,t,n){var r;const u=null==t?void 0:t.infoFor3D;if(!be(R,u)||null==u||!e.assetMaps||null===(r=e.features)||void 0===r||!r.length)return Ue.A.fromJSON(e);const{meshFeatureSetFromJSON:i}=yield(0,me.qr)(Promise.all([_.e(5434),_.e(3647),_.e(9750),_.e(3051),_.e(8864),_.e(6443)]).then(_.bind(_,71698)),n);return i(R,u,e)})).apply(this,arguments)}function be(R,e){return null!=e&&!0===R.returnGeometry&&"xyFootprint"!==R.multipatchOption&&!R.outStatistics}_(23098),_(40707),_(45272),_(70994),_(52466);var Ze=_(33063),ze=(_(21152),_(35150),_(55861),_(93615),_(20914),_(47258),_(55912),_(82663),_(87477),_(87342)),Le=(_(2296),_(69287),_(28067),_(59487)),Me=(_(61569),_(16842));class ge extends b.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return F.gO}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,F.JB)(e.toJSON());return(0,m.d)(t,m.T.String)}loadImpl(){var e=this;return(0,v.A)(function*(){return!0===e._layer.loaded?(e._initialiseFeatureSet(),e):(yield e._layer.load(),e._initialiseFeatureSet(),e)})()}_initialiseFeatureSet(){var e,t,n,r;if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this.hasZ=!0===(null===(e=this._layer)||void 0===e||null===(e=e.capabilities)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.supportsZ),this.hasM=!0===(null===(t=this._layer)||void 0===t||null===(t=t.capabilities)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.supportsM),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const u=[],i=[];for(const h of this.fields)if("oid"===h.type)u.push(h),i.push(h.name);else for(const f of this._overrideFields)if(f.toLowerCase()===h.name.toLowerCase()){u.push(h),i.push(h.name);break}this.fields=u,this._overrideFields=i}if(this._layer.source&&this._layer.source.sourceJSON){const u=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=F.zl.StandardisedNoInterval,null!=u&&u>=10.61&&(this._databaseType=F.zl.Standardised)):null!=u&&(u>=10.5&&(this._databaseType=F.zl.StandardisedNoInterval,this._requestStandardised=!0),u>=10.61&&(this._databaseType=F.zl.Standardised))}this.objectIdField=this._layer.objectIdField;for(const u of this.fields)"global-id"===u.type&&(this.globalIdField=u.name);this._layer instanceof ee.default?(this.subtypeField=null!==(n=this._layer.subtypeField)&&void 0!==n?n:"",this.subtypes=this._layer.subtypes,this.types=null,this.typeIdField=null):(this.typeIdField=null!==(r=this._layer.typeIdField)&&void 0!==r?r:"",this.types=this._layer.types,this.subtypeField=this._layer.subtypeField,this.subtypes=this._layer.subtypes)}_isInFeatureSet(){return F.J6.InFeatureSet}_refineSetBlock(e){return(0,v.A)(function*(){return e})()}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,v.A)(function*(){if(null===t._wset){yield t._ensureLoaded();const n=yield t._getFilteredSet("",null,null,null,e);return t._wset=n,n}return t._wset})()}_runDatabaseProbe(e){var t=this;return(0,v.A)(function*(){yield t._ensureLoaded();const n=new fe.A;t.datesInUnknownTimezone&&(n.timeReferenceUnknownClient=!0),n.where=e.replace("OBJECTID",t._layer.objectIdField);try{return yield t._layer.queryObjectIds(n),!0}catch{return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){var t;const n=null===(t=this._layer)||void 0===t||null===(t=t.capabilities)||void 0===t?void 0:t.query;return!e.outStatistics&&!0===(null==n?void 0:n.supportsFormatPBF)&&!0===(null==n?void 0:n.supportsQuantizationEditMode)}queryPBF(e){var t=this;return(0,v.A)(function*(){return e.quantizationParameters={mode:"edit"},(yield function Be(R,e,t,n){return ve.apply(this,arguments)}(t._layer.parsedUrl,e,{format:"pbf"},{})).unquantize()})()}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){var e;return{title:null!==(e=this._layer.title)&&void 0!==e?e:"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){e.returnZ=this.hasZ,e.returnM=this.hasM;const n="execute"===t?pe.s:"executeForCount"===t?Ze.I:ze.V,r="execute"===t&&this.pbfSupportedForQuery(e);let u=null;if(this.recentlyUsedQueries){const i=this.convertQueryToLruCacheKey(e);u=this.recentlyUsedQueries.getFromCache(i),null===u&&(u=!0!==r?n(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(i,u),u=u.catch(h=>{var f;throw null!==(f=this.recentlyUsedQueries)&&void 0!==f&&f.removeFromCache(i),h}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===u&&(u=!0!==r?n(this._layer.parsedUrl.path,e):this.queryPBF(e)),u}_getFilteredSet(e,t,n,r,u){var i=this;return(0,v.A)(function*(){const h=yield i.databaseType();if(i.isTable()&&t&&null!==e&&""!==e)return new k.A([],[],!0,null);if(i._canUsePagination())return i._getFilteredSetUsingPaging(e,t,n,r,u);let f="",D=!1;null!==r&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(f=r.constructClause(),D=!0);const S=new fe.A;i.datesInUnknownTimezone&&(S.timeReferenceUnknownClient=!0),S.where=null===n?null===t?"1=1":"":(0,T.YY)(n,h),i._requestStandardised&&(S.sqlFormat="standard"),S.spatialRelationship=i._makeRelationshipEnum(e),S.outSpatialReference=i.spatialReference,S.orderByFields=""!==f?f.split(","):null,S.geometry=null===t?null:t,S.relationParameter=i._makeRelationshipParam(e);let U=yield i.executeQuery(S,"executeForIds");return null===U&&(U=[]),i._checkCancelled(u),new k.A([],U,D,null)})()}_expandPagedSet(e,t,n,r,u){return this._expandPagedSetFeatureSet(e,t,n,r,u)}_getFilteredSetUsingPaging(e,t,n,r,u){var i=this;return(0,v.A)(function*(){var h;let f="",D=!1;null!==r&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(f=r.constructClause(),D=!0);const S=yield i.databaseType();let U=null===n?null===t?"1=1":"":(0,T.YY)(n,S);i._layer.definitionExpression&&i._useDefinitionExpression&&(U=""!==U?"(("+i._layer.definitionExpression+") AND ("+U+"))":i._layer.definitionExpression);let K=i._maxQueryRate();const Q=null===(h=i._layer.capabilities)||void 0===h?void 0:h.query.maxRecordCount;null!=Q&&Q<K&&(K=Q);let Y=null;if(!0===i._pageJustIds)Y=new k.A([],["GETPAGES"],D,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:i._layer.objectIdField,resultRecordCount:K,resultOffset:0,geometry:null===t?null:t,where:U,orderByFields:f,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{var $;let X=!0;!0===i._removeGeometry&&(X=!1);const ae=null!==($=i._overrideFields)&&void 0!==$?$:i._fieldsIncludingObjectId(["*"]);Y=new k.A([],["GETPAGES"],D,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:ae.join(","),resultRecordCount:K,resultOffset:0,geometry:null===t?null:t,where:U,orderByFields:f,returnGeometry:X,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield i._expandPagedSet(Y,K,0,1,u),Y})()}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,n){var r=this;return(0,v.A)(function*(){const u=e.pagesDefinition.internal.lastRetrieved,i=u,h=e.pagesDefinition.internal.lastPage,f=new fe.A;r._requestStandardised&&(f.sqlFormat="standard"),r.datesInUnknownTimezone&&(f.timeReferenceUnknownClient=!0),f.spatialRelationship=e.pagesDefinition.spatialRel,f.relationParameter=e.pagesDefinition.relationParam,f.outFields=e.pagesDefinition.outFields.split(","),f.num=e.pagesDefinition.resultRecordCount,f.start=e.pagesDefinition.internal.lastPage,f.geometry=e.pagesDefinition.geometry,f.where=e.pagesDefinition.where,f.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,f.returnGeometry=e.pagesDefinition.returnGeometry,f.outSpatialReference=r.spatialReference;const D=yield r.executeQuery(f,"execute");if(r._checkCancelled(n),e.pagesDefinition.internal.lastPage!==h)return"done";const S=r._layer.objectIdField;for(let U=0;U<D.features.length;U++)e.pagesDefinition.internal.set[i+U]=D.features[U].attributes[S];if(!1===r._pageJustIds)for(let U=0;U<D.features.length;U++)r._featureCache[D.features[U].attributes[S]]=D.features[U];return(void 0===D.exceededTransferLimit&&D.features.length!==e.pagesDefinition.resultRecordCount||!1===D.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=u+D.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let n=!1;for(const r of t)if(r.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}return!1===n&&t.push(this.objectIdField),t}_getFeatures(e,t,n,r){var u=this;return(0,v.A)(function*(){var i;const h=[];if(-1!==t&&void 0===u._featureCache[t]&&h.push(t),!0===u._checkIfNeedToExpandKnownPage(e,u._maxProcessingRate()))return yield u._expandPagedSet(e,u._maxProcessingRate(),0,0,r),u._getFeatures(e,t,n,r);let f=0;for(let K=e._lastFetchedIndex;K<e._known.length;K++){if(e._lastFetchedIndex+=1,f++,void 0===u._featureCache[e._known[K]]){let Q=!1;if(null!=u._layer._mode){const Y=u._layer._mode;if(void 0!==Y._featureMap[e._known[K]]){const $=Y._featureMap[e._known[K]];null!==$&&(Q=!0,u._featureCache[e._known[K]]=$)}}if(!1===Q&&(e._known[K]!==t&&h.push(e._known[K]),h.length>=u._maxProcessingRate()-1))break}if(f>=n&&0===h.length)break}if(0===h.length)return"success";const D=new fe.A;u._requestStandardised&&(D.sqlFormat="standard"),u.datesInUnknownTimezone&&(D.timeReferenceUnknownClient=!0),D.objectIds=h,D.outFields=null!==(i=u._overrideFields)&&void 0!==i?i:u._fieldsIncludingObjectId(["*"]),D.returnGeometry=!0,!0===u._removeGeometry&&(D.returnGeometry=!1),D.outSpatialReference=u.spatialReference;const S=yield u.executeQuery(D,"execute");if(u._checkCancelled(r),void 0!==S.error)throw new C.dr(C.D_.RequestFailed,{reason:S.error});const U=u._layer.objectIdField;for(let K=0;K<S.features.length;K++)u._featureCache[S.features[K].attributes[U]]=S.features[K];return"success"})()}_getDistinctPages(e,t,n,r,u,i,h,f,D){var S=this;return(0,v.A)(function*(){var U,K;yield S._ensureLoaded();const Q=yield S.databaseType();let Y=n.parseTree.column;const $=null!==(U=S._layer.fields)&&void 0!==U?U:[];for(let te=0;te<$.length;te++)if($[te].name.toLowerCase()===Y.toLowerCase()){Y=$[te].name;break}const X=new fe.A;S._requestStandardised&&(X.sqlFormat="standard"),S.datesInUnknownTimezone&&(X.timeReferenceUnknownClient=!0);let ae=null===i?null===u?"1=1":"":(0,T.YY)(i,Q);S._layer.definitionExpression&&S._useDefinitionExpression&&(ae=""!==ae?"(("+S._layer.definitionExpression+") AND ("+ae+"))":S._layer.definitionExpression),X.where=ae,X.spatialRelationship=S._makeRelationshipEnum(r),X.relationParameter=S._makeRelationshipParam(r),X.geometry=null===u?null:u,X.returnDistinctValues=!0,X.returnGeometry=!1,X.outFields=[Y];const ne=yield S.executeQuery(X,"execute");if(S._checkCancelled(D),!ne.hasOwnProperty("features"))throw new C.dr(C.D_.InvalidStatResponse);let oe=!1;for(let te=0;te<$.length;te++)if($[te].name===Y){"date"===$[te].type&&(oe=!0);break}for(let te=0;te<ne.features.length;te++){if(oe){const ue=ne.features[te].attributes[Y];f.push(null!==ue?new Date(ue):ue)}else f.push(ne.features[te].attributes[Y]);if(f.length>=h)break}return 0===ne.features.length?f:ne.features.length===(null===(K=S._layer.capabilities)||void 0===K?void 0:K.query.maxRecordCount)&&f.length<h?{calculated:!0,result:yield S._getDistinctPages(e+ne.features.length,t,n,r,u,i,h,f,D)}:f})()}_distinctStat(e,t,n,r,u,i,h){var f=this;return(0,v.A)(function*(){return{calculated:!0,result:yield f._getDistinctPages(0,e,t,n,r,u,i,[],h)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(e,t,n,r){var u=this;return(0,v.A)(function*(){const i=yield u.databaseType(),h=new fe.A;if(u._requestStandardised&&(h.sqlFormat="standard"),u.isTable()&&n&&null!==t&&""!==t)return{calculated:!0,result:0};let f=null===r?null===n?"1=1":"":(0,T.YY)(r,i);return u._layer.definitionExpression&&u._useDefinitionExpression&&(f=""!==f?"(("+u._layer.definitionExpression+") AND ("+f+"))":u._layer.definitionExpression),h.where=f,u.datesInUnknownTimezone&&(h.timeReferenceUnknownClient=!0),h.where=f,h.spatialRelationship=u._makeRelationshipEnum(t),h.relationParameter=u._makeRelationshipParam(t),h.geometry=null===n?null:n,h.returnGeometry=!1,{calculated:!0,result:yield u.executeQuery(h,"executeForCount")}})()}_stats(e,t,n,r,u,i,h){var f=this;return(0,v.A)(function*(){var D;yield f._ensureLoaded();const S=f._layer.capabilities&&f._layer.capabilities.query&&!0===f._layer.capabilities.query.supportsSqlExpression,U=f._layer.capabilities&&f._layer.capabilities.query&&!0===f._layer.capabilities.query.supportsStatistics,K=f._layer.capabilities&&f._layer.capabilities.query&&!0===f._layer.capabilities.query.supportsDistinct;if("count"===e)return K?f._countstat(e,n,r,u):{calculated:!1};if(!1===U||!1===(0,T.DA)(t)&&!1===S||!1===t.isStandardized)return""!==n||null!==u?{calculated:!1}:f._manualStat(e,t,i,h);if("distinct"===e)return!1===K?""!==n||null!==u?{calculated:!1}:f._manualStat(e,t,i,h):f._distinctStat(e,t,n,r,u,i,h);const Q=yield f.databaseType();if(f.isTable()&&r&&null!==n&&""!==n)return{calculated:!0,result:null};const Y=new fe.A;f._requestStandardised&&(Y.sqlFormat="standard");let $=null===u?null===r?"1=1":"":(0,T.YY)(u,Q);f._layer.definitionExpression&&f._useDefinitionExpression&&($=""!==$?"(("+f._layer.definitionExpression+") AND ("+$+"))":f._layer.definitionExpression),Y.where=$,Y.spatialRelationship=f._makeRelationshipEnum(n),Y.relationParameter=f._makeRelationshipParam(n),Y.geometry=null===r?null:r,f.datesInUnknownTimezone&&(Y.timeReferenceUnknownClient=!0);const X=new Me.A;X.statisticType=(0,G.Dp)(e),X.onStatisticField=(0,T.YY)(t,Q),X.outStatisticFieldName="ARCADE_STAT_RESULT",Y.returnGeometry=!1;let ae="ARCADE_STAT_RESULT";Y.outStatistics=[X];const ne=yield f.executeQuery(Y,"execute");if(!ne.hasOwnProperty("features")||0===ne.features.length)throw new C.dr(C.D_.InvalidStatResponse);let oe=!1;const te=null!==(D=ne.fields)&&void 0!==D?D:[];for(let ue=0;ue<te.length;ue++)if("ARCADE_STAT_RESULT"===te[ue].name.toUpperCase()){ae=te[ue].name,"date"===te[ue].type&&(oe=!0);break}if(oe){let ue=ne.features[0].attributes[ae];return null!==ue&&(ue=new Date(ne.features[0].attributes[ae])),{calculated:!0,result:ue}}return{calculated:!0,result:ne.features[0].attributes[ae]}})()}_stat(e,t,n,r,u,i,h){return this._stats(e,t,n,r,u,i,h)}_canDoAggregates(e,t){var n=this;return(0,v.A)(function*(){var r;yield n._ensureLoaded();let u=!1;const i=null===(r=n._layer.capabilities)||void 0===r?void 0:r.query,h=!0===(null==i?void 0:i.supportsSqlExpression);if(null!=i&&!0===i.supportsStatistics&&!0===i.supportsOrderBy&&(u=!0),u)for(let D=0;D<t.length-1;D++){var f;(!1===(null===(f=t[D].workingexpr)||void 0===f?void 0:f.isStandardized)||!1===(0,T.DA)(t[D].workingexpr)&&!1===h)&&(u=!1)}return!1!==u})()}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,n,r,u,i,h){var f=this;return(0,v.A)(function*(){var D;yield f._ensureLoaded();const S=yield f.databaseType();let U="",K=!1,Q=!1;null!==i&&f._layer.capabilities&&f._layer.capabilities.query&&!0===f._layer.capabilities.query.supportsOrderBy&&(U=i.constructClause(),Q=!0),f._layer.capabilities&&f._layer.capabilities.query&&!1===f._layer.capabilities.query.supportsPagination&&(Q=!1,K=!0,U=f._layer.objectIdField);const Y=[];for(let ne=0;ne<t.length;ne++){const oe=new Me.A;oe.onStatisticField=null!==t[ne].workingexpr?(0,T.YY)(t[ne].workingexpr,S):"",oe.outStatisticFieldName=t[ne].field,oe.statisticType=t[ne].toStatisticsName(),Y.push(oe)}""===U&&(U=e.join(","));let $=f._maxQueryRate();const X=null===(D=f._layer.capabilities)||void 0===D?void 0:D.query.maxRecordCount;null!=X&&X<$&&($=X);let ae=null===u?null===r?"1=1":"":(0,T.YY)(u,S);return f._layer.definitionExpression&&f._useDefinitionExpression&&(ae=""!==ae?"(("+f._layer.definitionExpression+") AND ("+ae+"))":f._layer.definitionExpression),new k.A([],["GETPAGES"],Q,{groupbypage:!0,spatialRel:f._makeRelationshipEnum(n),relationParam:f._makeRelationshipParam(n),outFields:["*"],useOIDpagination:K,generatedOid:h,resultRecordCount:$,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:Y,geometry:null===r?null:r,where:ae,orderByFields:U,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(e,t,n){var r=this;return(0,v.A)(function*(){let u=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(u=""!==u?"("+u+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const i=e.pagesDefinition.internal.lastRetrieved,h=i,f=e.pagesDefinition.internal.lastPage,D=new fe.A;if(r._requestStandardised&&(D.sqlFormat="standard"),D.where=u,D.spatialRelationship=e.pagesDefinition.spatialRel,D.relationParameter=e.pagesDefinition.relationParam,D.outFields=e.pagesDefinition.outFields,D.outStatistics=e.pagesDefinition.outStatistics,D.geometry=e.pagesDefinition.geometry,D.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,D.num=e.pagesDefinition.resultRecordCount,D.start=e.pagesDefinition.internal.lastPage,D.returnGeometry=e.pagesDefinition.returnGeometry,r.datesInUnknownTimezone&&(D.timeReferenceUnknownClient=!0),D.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,r.isTable()&&D.geometry&&D.spatialRelationship)return[];const S=yield r.executeQuery(D,"execute");if(r._checkCancelled(n),!S.hasOwnProperty("features"))throw new C.dr(C.D_.InvalidStatResponse);const U=[];if(e.pagesDefinition.internal.lastPage!==f)return[];S.features.length>0&&void 0===S.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let K=0;K<S.features.length;K++)e.pagesDefinition.internal.set[h+K]=S.features[K].attributes[e.pagesDefinition.generatedOid];for(let K=0;K<S.features.length;K++)U.push(new Z.A({attributes:S.features[K].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===S.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=S.features[S.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===S.exceededTransferLimit&&S.features.length!==e.pagesDefinition.resultRecordCount||!1===S.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+S.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,U})()}static create(e,t,n,r,u){const i=new se.default({url:e,outFields:null===t?["*"]:t});return new ge({layer:i,spatialReference:n,lrucache:r,interceptor:u})}relationshipMetaData(){var e;return this._layer&&this._layer.source&&null!==(e=this._layer.source.sourceJSON)&&void 0!==e&&e.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,F.Qi)(this._layer.parsedUrl.path)}queryAttachments(e,t,n,r,u){var i=this;return(0,v.A)(function*(){const h=i._layer.capabilities;if(null!=h&&h.data.supportsAttachment&&null!=h&&h.operations.supportsQueryAttachments){const f={objectIds:[e],returnMetadata:u};(t&&t>0||n&&n>0)&&(f.size=[t&&t>0?t:0,n&&n>0?n:t+1]),r&&r.length>0&&(f.attachmentTypes=r),i.featureSetQueryInterceptor&&i.featureSetQueryInterceptor.preLayerQueryCallback({layer:i._layer,query:f,method:"attachments"});const D=yield i._layer.queryAttachments(f),S=[];return D&&D[e]&&D[e].forEach(U=>{var K;const Q=i._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+U.id.toString();let Y=null;u&&U.exifInfo&&(Y=z.A.convertJsonToArcade(U.exifInfo,"system",!0)),S.push(new j.A(U.id,U.name,U.contentType,U.size,Q,Y,null!==(K=U.keywords)&&void 0!==K?K:null))}),S}return[]})()}queryRelatedFeatures(e){var t=this;return(0,v.A)(function*(){var n;const r={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:null===(n=e.outFields)||void 0===n?void 0:n.join(","),returnGeometry:e.returnGeometry.toString()};null!=e.resultOffset&&(r.resultOffset=e.resultOffset.toString()),null!=e.resultRecordCount&&(r.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(r.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(r.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(r.outSR=(0,H.YX)(e.outSpatialReference)),t.featureSetQueryInterceptor&&t.featureSetQueryInterceptor.preRequestCallback({layer:t._layer,queryPayload:r,method:"relatedrecords",url:t._layer.parsedUrl.path+"/queryRelatedRecords"});const u=yield(0,V.A)(t._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:r});if(u.data){const i={},h=u.data;if(null!=h&&h.relatedRecordGroups){const f=h.spatialReference;for(const D of h.relatedRecordGroups){const S=D.objectId,U=[];for(const K of D.relatedRecords){K.geometry&&(K.geometry.spatialReference=f);const Q=new Z.A({geometry:K.geometry?(0,ie.rS)(K.geometry):null,attributes:K.attributes});U.push(Q)}i[S]={features:U,exceededTransferLimit:!0===h.exceededTransferLimit}}}return i}throw new C.dr(C.D_.InvalidRequest)})()}getFeatureByObjectId(e,t){var n=this;return(0,v.A)(function*(){const r=new fe.A;r.outFields=t,r.returnGeometry=!1,r.outSpatialReference=n.spatialReference,r.where=n.objectIdField+"="+e.toString(),n.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),n.featureSetQueryInterceptor&&n.featureSetQueryInterceptor.preLayerQueryCallback({layer:n._layer,query:r,method:"execute"});const u=yield(0,pe.s)(n._layer.parsedUrl.path,r);return 1===u.features.length?u.features[0]:null})()}getIdentityUser(){var e=this;return(0,v.A)(function*(){yield e.load();const t=null==x.id?void 0:x.id.findCredential(e._layer.url);return t?t.userId:null})()}getOwningSystemUrl(){var e=this;return(0,v.A)(function*(){yield e.load();const t=null==x.id?void 0:x.id.findServerInfo(e._layer.url);if(t)return t.owningSystemUrl;let n=e._layer.url;const r=n.toLowerCase().indexOf("/rest/services");if(n=r>-1?n.substring(0,r):n,n){n+="/rest/info";try{var u;const i=yield(0,V.A)(n,{query:{f:"json"}});let h="";return null!==(u=i.data)&&void 0!==u&&u.owningSystemUrl&&(h=i.data.owningSystemUrl),h}catch{return""}}return""})()}getDataSourceFeatureSet(){var e,t,n,r;const u=new ge({layer:this._layer,spatialReference:null!==(e=this.spatialReference)&&void 0!==e?e:void 0,outFields:null!==(t=this._overrideFields)&&void 0!==t?t:void 0,includeGeometry:!this._removeGeometry,lrucache:null!==(n=this.recentlyUsedQueries)&&void 0!==n?n:void 0,interceptor:null!==(r=this.featureSetQueryInterceptor)&&void 0!==r?r:void 0});return u._useDefinitionExpression=!1,u}get preferredTimeZone(){var e;return null!==(e=this._layer.preferredTimeZone)&&void 0!==e?e:null}get dateFieldsTimeZone(){var e;return null!==(e=this._layer.dateFieldsTimeZone)&&void 0!==e?e:null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone}get editFieldsInfo(){var e;return null!==(e=this._layer.editFieldsInfo)&&void 0!==e?e:null}get timeInfo(){var e;return null!==(e=this._layer.timeInfo)&&void 0!==e?e:null}getFeatureSetInfo(){var e=this;return(0,v.A)(function*(){var t,n,r;if(e.fsetInfo)return e.fsetInfo;let u=null,{parsedUrl:{path:i},serviceItemId:h=null}=e._layer;if(i){var f,D,S,U;const Q=yield(0,V.A)(i,{responseType:"json",query:{f:"json"}});u=null!==(f=null==Q||null===(D=Q.data)||void 0===D?void 0:D.name)&&void 0!==f?f:null,h=null!==(S=null==Q||null===(U=Q.data)||void 0===U?void 0:U.serviceItemId)&&void 0!==S?S:null}const K=e._layer.title&&null!==(null!==(t=e._layer.parent)&&void 0!==t?t:null);return e.featureSetInfo={layerId:e._layer.layerId,layerName:""===u?null:u,itemId:""===h?null:h,serviceLayerUrl:""===i?null:i,webMapLayerId:K&&null!==(n=e._layer.id)&&void 0!==n?n:null,webMapLayerTitle:K&&null!==(r=e._layer.title)&&void 0!==r?r:null,className:null,objectClassId:null},e.fsetInfo})()}}var Je=_(6491);class Qe extends b.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return F.gO}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var e=this;return(0,v.A)(function*(){var t;return yield Promise.all([e._layer.load(),null===(t=e._relatedLayer)||void 0===t?void 0:t.load()]),e._initialiseFeatureSet(),e})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const t=[],n=[];for(const r of this.fields)if("oid"===r.type)t.push(r),n.push(r.name);else for(const u of this._overrideFields)if(u.toLowerCase()===r.name.toLowerCase()){t.push(r),n.push(r.name);break}this.fields=t,this._overrideFields=n}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types,this.subtypeField=this._relatedLayer.subtypeField,this.subtypes=this._relatedLayer.subtypes}databaseType(){var e=this;return(0,v.A)(function*(){return yield e._relatedLayer.databaseType(),e._databaseType=e._relatedLayer._databaseType,e._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return F.J6.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,v.A)(function*(){if(null===t._wset){yield t._ensureLoaded();const n=yield t._getFilteredSet("",null,null,null,e);return t._wset=n,n}return t._wset})()}_changeFeature(e){const t={};for(const n of this.fields)t[n.name]=e.attributes[n.name];return new Z.A({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,n,r,u){var i=this;return(0,v.A)(function*(){var h,f;if(yield i.databaseType(),i.isTable()&&t&&null!==e&&""!==e)return new k.A([],[],!0,null);const D=i._layer.nativeCapabilities();if(!1===D.canQueryRelated)return new k.A([],[],!0,null);if(null!==(h=D.capabilities)&&void 0!==h&&h.queryRelated&&D.capabilities.queryRelated.supportsPagination)return i._getFilteredSetUsingPaging(e,t,n,r,u);let S="",U=!1;null!==r&&null!==(f=D.capabilities)&&void 0!==f&&f.queryRelated&&!0===D.capabilities.queryRelated.supportsOrderBy&&(S=r.constructClause(),U=!0);const K=new Le.default;K.objectIds=[i._findObjectId];const Q=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._relatedLayer.fields?i._relatedLayer.fields.map(te=>te.name):["*"]);K.outFields=Q,K.relationshipId=i.relationship.id,K.where="1=1";let Y=!0;!0===i._removeGeometry&&(Y=!1),K.returnGeometry=Y,i._requestStandardised&&(K.sqlFormat="standard"),K.outSpatialReference=i.spatialReference,K.orderByFields=""!==S?S.split(","):null;const $=yield D.source.queryRelatedFeatures(K);i._checkCancelled(u);const X=$[i._findObjectId]?$[i._findObjectId].features:[],ae=[];for(let te=0;te<X.length;te++)i._featureCache[X[te].attributes[i._relatedLayer.objectIdField]]=X[te],ae.push(X[te].attributes[i._relatedLayer.objectIdField]);const ne=t&&null!==e&&""!==e,oe=null!=n;return new k.A(ne||oe?ae:[],ne||oe?[]:ae,U,null)})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let n=!1;for(const r of t)if(r.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}return!1===n&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,n,r,u){var i=this;return(0,v.A)(function*(){var h,f;let D="",S=!1;const U=i._layer.nativeCapabilities();null!==r&&null!=U&&null!==(h=U.capabilities)&&void 0!==h&&h.queryRelated&&!0===U.capabilities.queryRelated.supportsOrderBy&&(D=r.constructClause(),S=!0),yield i.databaseType();let Q=i._maxQueryRate();const Y=null===(f=U.capabilities)||void 0===f?void 0:f.query.maxRecordCount;null!=Y&&Y<Q&&(Q=Y);const $=t&&null!==e&&""!==e,X=null!=n;let ae=null,ne=!0;!0===i._removeGeometry&&(ne=!1);const oe=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._relatedLayer.fields?i._relatedLayer.fields.map(te=>te.name):["*"]);return ae=new k.A($||X?["GETPAGES"]:[],$||X?[]:["GETPAGES"],S,{outFields:oe.join(","),resultRecordCount:Q,resultOffset:0,objectIds:[i._findObjectId],where:"1=1",orderByFields:D,returnGeometry:ne,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield i._expandPagedSet(ae,Q,0,0,u),ae})()}_expandPagedSet(e,t,n,r,u){return this._expandPagedSetFeatureSet(e,t,n,r,u)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,n){var r=this;return(0,v.A)(function*(){const u=e.pagesDefinition.internal.lastRetrieved,i=u,h=e.pagesDefinition.internal.lastPage,f=r._layer.nativeCapabilities(),D=new Le.default;!0===r._requestStandardised&&(D.sqlFormat="standard"),D.relationshipId=r.relationship.id,D.objectIds=e.pagesDefinition.objectIds,D.resultOffset=e.pagesDefinition.internal.lastPage,D.resultRecordCount=e.pagesDefinition.resultRecordCount,D.outFields=e.pagesDefinition.outFields.split(","),D.where=e.pagesDefinition.where,D.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,D.returnGeometry=e.pagesDefinition.returnGeometry,D.outSpatialReference=r.spatialReference;const S=yield f.source.queryRelatedFeatures(D);if(r._checkCancelled(n),e.pagesDefinition.internal.lastPage!==h)return 0;const U=S[r._findObjectId]?S[r._findObjectId].features:[];for(let Q=0;Q<U.length;Q++)e.pagesDefinition.internal.set[i+Q]=U[Q].attributes[r._relatedLayer.objectIdField];for(let Q=0;Q<U.length;Q++)r._featureCache[U[Q].attributes[r._relatedLayer.objectIdField]]=U[Q];return U.length!==e.pagesDefinition.resultRecordCount&&(!S[r._findObjectId]||!1===S[r._findObjectId].exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=u+U.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,U.length})()}_getFeatures(e,t,n,r){var u=this;return(0,v.A)(function*(){const i=[];-1!==t&&void 0===u._featureCache[t]&&i.push(t);const h=u._maxQueryRate();if(!0===u._checkIfNeedToExpandKnownPage(e,h))return yield u._expandPagedSet(e,h,0,0,r),u._getFeatures(e,t,n,r);let f=0;for(let D=e._lastFetchedIndex;D<e._known.length&&(f++,f<=n&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[D]&&void 0===u._featureCache[e._known[D]]&&(e._known[D]!==t&&i.push(e._known[D]),i.length>n)))&&!(f>=n&&0===i.length);D++);if(0===i.length)return"success";throw new C.dr(C.D_.MissingFeatures)})()}_refineSetBlock(e,t,n){return(0,v.A)(function*(){return e})()}_stat(e,t,n,r,u,i,h){return(0,v.A)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(e,t,n,r,u){return(0,v.A)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,n,r,u){return this._relatedLayer.queryAttachments(e,t,n,r,u)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){var e,t;return null!==(e=null===(t=this._relatedLayer)||void 0===t?void 0:t.preferredTimeZone)&&void 0!==e?e:null}get dateFieldsTimeZone(){var e,t;return null!==(e=null===(t=this._relatedLayer)||void 0===t?void 0:t.dateFieldsTimeZone)&&void 0!==e?e:null}get datesInUnknownTimezone(){var e;return null===(e=this._relatedLayer)||void 0===e?void 0:e.datesInUnknownTimezone}get editFieldsInfo(){var e,t;return null!==(e=null===(t=this._relatedLayer)||void 0===t?void 0:t.editFieldsInfo)&&void 0!==e?e:null}get timeInfo(){var e,t;return null!==(e=null===(t=this._relatedLayer)||void 0===t?void 0:t.timeInfo)&&void 0!==e?e:null}getFeatureSetInfo(){var e=this;return(0,v.A)(function*(){var t;return null!==(t=e.fsetInfo)&&void 0!==t?t:e._layer.featureSetInfo})()}}var re=_(89812),Ve=_(46577);function $e(){null===re.A.applicationCache&&(re.A.applicationCache=new re.A)}function Se(R,e){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,v.A)(function*(R,e){if(re.A.applicationCache){const t=re.A.applicationCache.getLayerInfo(R);if(t){const u=yield t;return new se.default({url:R,outFields:e,sourceJSON:u})}const n=new se.default({url:R,outFields:e}),r=(0,v.A)(function*(){return yield n.load(),n.sourceJSON})();if(re.A.applicationCache){re.A.applicationCache.setLayerInfo(R,r);try{return yield r,n}catch(u){throw re.A.applicationCache.clearLayerInfo(R),u}}return yield r,n}return new se.default({url:R,outFields:e})})).apply(this,arguments)}function De(R,e,t,n,r){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,v.A)(function*(R,e,t,n,r,u=null){return de(yield Se(R,["*"]),e,t,n,r,u)})).apply(this,arguments)}function de(R,e=null,t=null,n=!0,r=null,u=null){if(R instanceof se.default||(0,L.a0)(R)){const h={layer:R,spatialReference:e,outFields:t,includeGeometry:n,lrucache:r,interceptor:u};return R.url||!R.source?new ge(h):new Je.A(h)}const i=de(R.parent,e,t,n,r,u);return i.filter(p.WhereClause.create(R.parent.subtypeField+"="+R.subtypeCode.toString(),R.parent.fieldsIndex,i.dateFieldsTimeZoneDefaultUTC))}function Ee(){return(Ee=(0,v.A)(function*(R){if(null!==re.A.applicationCache){const t=re.A.applicationCache.getLayerInfo(R);if(null!==t)return t}const e=(0,v.A)(function*(){const t=yield(0,V.A)(R,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==re.A.applicationCache){re.A.applicationCache.setLayerInfo(R,e);try{return yield e}catch(t){throw re.A.applicationCache.clearLayerInfo(R),t}}return e})).apply(this,arguments)}function Oe(){return(Oe=(0,v.A)(function*(R,e){const t="QUERYDATAELEMTS:"+e.toString()+":"+R;if(null!==re.A.applicationCache){const r=re.A.applicationCache.getLayerInfo(t);if(null!==r)return r}const n=(0,v.A)(function*(){const r=yield(0,V.A)(R+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([e.toString()]),f:"json"}});if(r.data){var u;const i=r.data;if(null!==(u=i.layerDataElements)&&void 0!==u&&u[0])return i.layerDataElements[0]}throw new C.dr(C.D_.DataElementsNotFound)})();if(null!==re.A.applicationCache){re.A.applicationCache.setLayerInfo(t,n);try{return yield n}catch(r){throw re.A.applicationCache.clearLayerInfo(t),r}}return n})).apply(this,arguments)}function Ne(R){return Te.apply(this,arguments)}function Te(){return(Te=(0,v.A)(function*(R){if(null!==re.A.applicationCache){const t=re.A.applicationCache.getLayerInfo(R);if(null!==t)return t}const e=(0,v.A)(function*(){const t=yield(0,V.A)(R,{responseType:"json",query:{f:"json"}});if(t.data){const n=t.data;return n.layers||(n.layers=[]),n.tables||(n.tables=[]),n}return{layers:[],tables:[]}})();if(null!==re.A.applicationCache){re.A.applicationCache.setLayerInfo(R,e);try{return yield e}catch(t){throw re.A.applicationCache.clearLayerInfo(R),t}}return e})).apply(this,arguments)}function He(R,e){return Re.apply(this,arguments)}function Re(){return Re=(0,v.A)(function*(R,e){var t;const n={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},r=yield Ne(R);if(n.metadata=r,void 0!==(null===(t=r.controllerDatasetLayers)||void 0===t?void 0:t.utilityNetworkLayerId)&&null!==r.controllerDatasetLayers.utilityNetworkLayerId){if(r.layers)for(const Q of r.layers)n.layerNameLkp[Q.id]=Q.name;if(r.tables)for(const Q of r.tables)n.layerNameLkp[Q.id]=Q.name;const U=r.controllerDatasetLayers.utilityNetworkLayerId;n.networkId=U;const K=yield function Xe(R,e){return Oe.apply(this,arguments)}(R,U);if(K){var u,i;n.queryelem=K,null!==(u=n.queryelem)&&void 0!==u&&u.dataElement&&void 0!==n.queryelem.dataElement.schemaGeneration&&(n.unVersion=n.queryelem.dataElement.schemaGeneration),n.lkp={},n.queryelem.dataElement.domainNetworks||(n.queryelem.dataElement.domainNetworks=[]);for(const Y of n.queryelem.dataElement.domainNetworks){for(const $ of null!==(h=Y.edgeSources)&&void 0!==h?h:[]){var h,f;const X={layerId:$.layerId,sourceId:$.sourceId,className:null!==(f=n.layerNameLkp[$.layerId])&&void 0!==f?f:null};X.className&&(n.lkp[X.className]=X)}for(const $ of null!==(D=Y.junctionSources)&&void 0!==D?D:[]){var D,S;const X={layerId:$.layerId,sourceId:$.sourceId,className:null!==(S=n.layerNameLkp[$.layerId])&&void 0!==S?S:null};X.className&&(n.lkp[X.className]=X)}}if(n.queryelem.dataElement.terminalConfigurations)for(const Y of n.queryelem.dataElement.terminalConfigurations)for(const $ of Y.terminals)n.terminals.push({terminalId:$.terminalId,terminalName:$.terminalName});const Q=yield function Ye(R){return Ee.apply(this,arguments)}(R+"/"+U);if(void 0!==(null===(i=Q.systemLayers)||void 0===i?void 0:i.associationsTableId)&&null!==Q.systemLayers.associationsTableId){const Y=[];n.unVersion>=4&&(Y.push("STATUS"),Y.push("PERCENTALONG"));let $=yield De(R+"/"+Q.systemLayers.associationsTableId.toString(),e,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...Y],!1,null,null);return yield $.load(),n.unVersion>=4&&($=$.filter(p.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",$.getFieldsIndex(),$.dateFieldsTimeZoneDefaultUTC)),yield $.load()),{lkp:n.lkp,associations:$,unVersion:n.unVersion,terminals:n.terminals}}return{associations:null,unVersion:n.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:n.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:n.unVersion,lkp:null,terminals:[]}}),Re.apply(this,arguments)}function qe(R,e,t){return we.apply(this,arguments)}function we(){return(we=(0,v.A)(function*(R,e,t,n=null,r=null,u=!0,i=null,h=null){let f=R.serviceUrl();if(!f)return null;f="/"===f.charAt(f.length-1)?f+e.relatedTableId.toString():f+"/"+e.relatedTableId.toString();const D=yield De(f,n,r,u,i,h);return new Qe({layer:R,relatedLayer:D,relationship:e,objectId:t,spatialReference:n,outFields:r,includeGeometry:u,lrucache:i,interceptor:h})})).apply(this,arguments)}N.A.registerAction(),M.registerAction(),w.A.registerAction(),B.A.registerAction(),g.A.registerAction();class et extends J.A{constructor(e,t=null,n=null,r=null){super(),this._map=e,this._overridespref=t,this._lrucache=n,this._interceptor=r,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,n=null){const r=de(e,this._overridespref,null===n?["*"]:n,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:r,opitem:e,includeGeometry:t,outFields:JSON.stringify(n)}),r}featureSetByName(e,t=!0,n=null){var r=this;return(0,v.A)(function*(){if(void 0!==r._map.loaded&&void 0!==r._map.load&&!1===r._map.loaded)return yield r._map.load(),r.featureSetByName(e,t,n);null===n&&(n=["*"]),n=(n=n.slice(0)).sort();const u=JSON.stringify(n);for(let h=0;h<r._instantLayers.length;h++){const f=r._instantLayers[h];if(f.opitem.title===e&&f.includeGeometry===t&&f.outFields===u)return r._instantLayers[h].featureset}const i=r._map.allLayers.find(h=>{if(h instanceof se.default){if(h.title===e)return!0}else if((0,L.a0)(h)&&h.title===e)return!0;return!1});if(i)return r._makeAndAddFeatureSet(i,t,n);if(r._map.tables){const h=r._map.tables.find(f=>!!(f.title&&f.title===e||f.title&&f.title===e));if(h){if(h instanceof se.default)return r._makeAndAddFeatureSet(h,t,n);if(!h._materializedTable){const f=h.outFields?h:{...h,outFields:["*"]};h._materializedTable=new se.default(f)}return yield h._materializedTable.load(),r._makeAndAddFeatureSet(h._materializedTable,t,n)}}return null})()}featureSetById(e,t=!0,n=["*"]){var r=this;return(0,v.A)(function*(){if(void 0!==r._map.loaded&&void 0!==r._map.load&&!1===r._map.loaded)return yield r._map.load(),r.featureSetById(e,t,n);null===n&&(n=["*"]),n=(n=n.slice(0)).sort();const u=JSON.stringify(n);for(let h=0;h<r._instantLayers.length;h++){const f=r._instantLayers[h];if(f.opitem.id===e&&f.includeGeometry===t&&f.outFields===u)return r._instantLayers[h].featureset}const i=r._map.allLayers.find(h=>{if(h instanceof se.default){if(h.id===e)return!0}else if((0,L.a0)(h)&&h.id===e)return!0;return!1});if(i)return r._makeAndAddFeatureSet(i,t,n);if(r._map.tables){const h=r._map.tables.find(f=>f.id===e);if(h){if(h instanceof se.default)return r._makeAndAddFeatureSet(h,t,n);if(!h._materializedTable){const f={...h,outFields:["*"]};h._materializedTable=new se.default(f)}return yield h._materializedTable.load(),r._makeAndAddFeatureSet(h._materializedTable,t,n)}}return null})()}}class Pe extends J.A{constructor(e,t=null,n=null,r=null){super(),this._url=e,this._overridespref=t,this._lrucache=n,this._interceptor=r,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,n=null){const r=de(e,this._overridespref,null===n?["*"]:n,t,this._lrucache);return this._instantLayers.push({featureset:r,opitem:e,includeGeometry:t,outFields:JSON.stringify(n)}),r}_loadMetaData(){var e=this;return(0,v.A)(function*(){const t=yield Ne(e._url);return e.metadata=t,t})()}load(){return this._loadMetaData()}clone(){return new Pe(this._url,this._overridespref,this._lrucache,this._interceptor)}featureSetByName(e,t=!0,n=null){var r=this;return(0,v.A)(function*(){null===n&&(n=["*"]),n=(n=n.slice(0)).sort();const u=JSON.stringify(n);for(let S=0;S<r._instantLayers.length;S++){const U=r._instantLayers[S];if(U.opitem.title===e&&U.includeGeometry===t&&U.outFields===u)return r._instantLayers[S].featureset}const i=yield r._loadMetaData();let h=null;for(const S of null!==(f=i.layers)&&void 0!==f?f:[]){var f;S.name===e&&(h=S)}if(!h)for(const S of null!==(D=i.tables)&&void 0!==D?D:[]){var D;S.name===e&&(h=S)}if(h){const S=yield Se(r._url+"/"+h.id,["*"]);return r._makeAndAddFeatureSet(S,t,n)}return null})()}featureSetById(e,t=!0,n=["*"]){var r=this;return(0,v.A)(function*(){null===n&&(n=["*"]),n=(n=n.slice(0)).sort();const u=JSON.stringify(n);e=null!=e?e.toString():"";for(let S=0;S<r._instantLayers.length;S++){const U=r._instantLayers[S];if(U.opitem.id===e&&U.includeGeometry===t&&U.outFields===u)return r._instantLayers[S].featureset}const i=yield r._loadMetaData();let h=null;for(const S of null!==(f=i.layers)&&void 0!==f?f:[]){var f;null!=S.id&&S.id.toString()===e&&(h=S)}if(!h)for(const S of null!==(D=i.tables)&&void 0!==D?D:[]){var D;null!=S.id&&S.id.toString()===e&&(h=S)}if(h){const S=yield Se(r._url+"/"+h.id,["*"]);return r._makeAndAddFeatureSet(S,t,n)}return null})()}}function tt(R,e,t=null,n=null){return new et(R,e,t,n)}function rt(R,e,t=null,n=null){return new Pe(R,e,t,n)}function nt(R,e,t,n,r){if(null===R)return null;if(R instanceof se.default){switch(e){case"datasource":return de(R,r,R.outFields,!0,t,n).getDataSourceFeatureSet();case"parent":case"root":return de(R,r,R.outFields,!0,t,n)}return null}if((0,L.a0)(R)){switch(e){case"datasource":return de(R,r,R.outFields,!0,t,n).getDataSourceFeatureSet();case"parent":case"root":return de(R,r,R.outFields,!0,t,n)}return null}if((0,L.a1)(R)){switch(e){case"datasource":return de(R.parent,r,R.parent.outFields,!0,t,n).getDataSourceFeatureSet();case"parent":case"root":return de(R,r,R.parent.outFields,!0,t,n)}return null}if(R instanceof b.A)switch(e){case"datasource":return R.getDataSourceFeatureSet();case"parent":return R;case"root":return R.getRootFeatureSet()}return null}function it(R,e,t,n,r,u,i){return xe.apply(this,arguments)}function xe(){return(xe=(0,v.A)(function*(R,e,t,n,r,u,i,h=null){if(re.A.applicationCache){const S=re.A.applicationCache.getLayerInfo(R+":"+u.url);if(S){const U=yield S;return de(new se.default({url:(0,F.Qi)(U.url)+"/"+e,outFields:["*"]}),t,n,r,i,h)}}const f=new Ve.default({id:R,portal:u}).load();re.A.applicationCache&&re.A.applicationCache.setLayerInfo(R+":"+u.url,f);try{var D;const S=yield f;return de(new se.default({url:(0,F.Qi)(null!==(D=S.url)&&void 0!==D?D:"")+"/"+e,outFields:["*"]}),t,n,r,i,h)}catch(S){throw re.A.applicationCache&&re.A.applicationCache.clearLayerInfo(R+":"+u.url),S}})).apply(this,arguments)}},36455:(le,q,_)=>{_.d(q,{Gr:()=>p,IO:()=>F,a:()=>P,bV:()=>G,p8:()=>T});var v=_(10467),V=_(81098),J=_(73446),L=_(31033),N=_(85922),Z=_(71505),W=_(7981),w=_(97089),C=_(11432),b=_(40013),k=_(32034);class O{constructor(m){this.field=m,this.sqlRewritable=!1}postInitialization(m,s){}}class F extends O{constructor(m){super(m),this.sqlRewritable=!0}extractValue(m){return m.attributes[this.field.name]}rewriteSql(m){return{rewritten:this.sqlRewritable,where:m}}}class T extends O{constructor(m,s,c){super((0,W.ke)(m)),this.originalField=m,this.sqlRewritable=!0,this.field.name=s,this.field.alias=c}rewriteSql(m,s){return{rewritten:this.sqlRewritable,where:(0,w.bD)(m,this.field.name,this.originalField.name,s.getFieldsIndex())}}extractValue(m){return m.attributes[this.originalField.name]}}let G=(()=>{class A extends O{constructor(s,c,l){super(s),this.codefield=c,this.lkp=l,this.reverseLkp={};for(const d in l)this.reverseLkp[l[d]]=d;this.sqlRewritable=!0}rewriteSql(s,c){const l=this.evaluateNodeToWhereClause(s.parseTree,W.zl.Standardised,this.field.name,this.codefield instanceof b.WhereClause?(0,w.YY)(this.codefield,W.zl.Standardised):this.codefield,s.parameters);return l.includes(A.BADNESS)?{rewritten:!1,where:s}:{rewritten:this.sqlRewritable,where:b.WhereClause.create(l,c._parent.getFieldsIndex(),c.dateFieldsTimeZoneDefaultUTC)}}evaluateNodeToWhereClause(s,c,l=null,d=null,y){let I,E,M,B;switch(s.type){case"interval":return(0,w.oj)(this.evaluateNodeToWhereClause(s.value,c,l,d,y),s.qualifier,s.op);case"case-expression":{let g=" CASE ";"simple"===s.format&&(g+=this.evaluateNodeToWhereClause(s.operand,c,l,A.BADNESS,y));for(let x=0;x<s.clauses.length;x++)g+=" WHEN "+this.evaluateNodeToWhereClause(s.clauses[x].operand,c,l,A.BADNESS,y)+" THEN "+this.evaluateNodeToWhereClause(s.clauses[x].value,c,l,A.BADNESS,y);return null!==s.else&&(g+=" ELSE "+this.evaluateNodeToWhereClause(s.else,c,l,A.BADNESS,y)),g+=" END ",g}case"parameter":{const g=y[s.value.toLowerCase()];if("string"==typeof g)return"'"+g.toString().replaceAll("'","''")+"'";if((0,W.$P)(g)||(0,W.Lk)(g))return(0,w.bm)(g,c);if((0,W.eg)(g))return(0,w.F1)(g,c);if((0,W.rX)(g))return(0,w.R8)(g,c);if((0,W.f0)(g))return(0,w.Nf)(g,c);if(g instanceof Array){const x=[];for(let j=0;j<g.length;j++)"string"==typeof g[j]?x.push("'"+g[j].toString().replaceAll("'","''")+"'"):(0,W.$P)(g[j])||(0,W.Lk)(g[j])?x.push((0,w.bm)(g[j],c)):(0,W.eg)(g[j])?x.push((0,w.F1)(g[j],c)):(0,W.rX)(g[j])?x.push((0,w.R8)(g[j],c)):(0,W.f0)(g[j])?x.push((0,w.Nf)(g[j],c)):x.push(g[j].toString());return x}return g.toString()}case"expression-list":E=[];for(const g of s.value)E.push(this.evaluateNodeToWhereClause(g,c,l,d,y));return E;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(s.expr,c,l,A.BADNESS,y)+" ) ";case"binary-expression":switch(s.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" AND "+this.evaluateNodeToWhereClause(s.right,c,l,d,y)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" OR "+this.evaluateNodeToWhereClause(s.right,c,l,d,y)+") ";case"IS":if("null"!==s.right.type)throw new L.L8(L.Z7.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" IS NULL )";case"ISNOT":if("null"!==s.right.type)throw new L.L8(L.Z7.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" IS NOT NULL )";case"IN":if(I=[],"expression-list"===s.right.type){if("column-reference"===s.left.type&&s.left.column.toUpperCase()===this.field.name.toUpperCase()){const g=[];let x=!0;for(const j of s.right.value){if("string"!==j.type){x=!1;break}if(void 0===this.lkp[j.value]){x=!1;break}g.push(this.lkp[j.value].toString())}if(x)return" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" IN ("+g.join(",")+")) "}return I=this.evaluateNodeToWhereClause(s.right,c,l,d,y)," ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" IN ("+I.join(",")+")) "}return B=this.evaluateNodeToWhereClause(s.right,c,l,d,y),B instanceof Array?" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" IN ("+B.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" IN ("+B+")) ";case"NOT IN":if(I=[],"expression-list"===s.right.type){if("column-reference"===s.left.type&&s.left.column.toUpperCase()===this.field.name.toUpperCase()){const g=[];let x=!0;for(const j of s.right.value){if("string"!==j.type){x=!1;break}if(void 0===this.lkp[j.value]){x=!1;break}g.push(this.lkp[j.value].toString())}if(x)return" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" NOT IN ("+g.join(",")+")) "}return I=this.evaluateNodeToWhereClause(s.right,c,l,d,y)," ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" NOT IN ("+I.join(",")+")) "}return B=this.evaluateNodeToWhereClause(s.right,c,l,d,y),B instanceof Array?" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" NOT IN ("+B.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(s.left,c,l,d,y)+" NOT IN ("+B+")) ";case"BETWEEN":return M=this.evaluateNodeToWhereClause(s.right,c,l,A.BADNESS,y)," ("+this.evaluateNodeToWhereClause(s.left,c,l,A.BADNESS,y)+" BETWEEN "+M[0]+" AND "+M[1]+" ) ";case"NOTBETWEEN":return M=this.evaluateNodeToWhereClause(s.right,c,l,A.BADNESS,y)," ("+this.evaluateNodeToWhereClause(s.left,c,l,A.BADNESS,y)+" NOT BETWEEN "+M[0]+" AND "+M[1]+" ) ";case"LIKE":return""!==s.escape?" ("+this.evaluateNodeToWhereClause(s.left,c,l,A.BADNESS,y)+" LIKE "+this.evaluateNodeToWhereClause(s.right,c,l,A.BADNESS,y)+" ESCAPE '"+s.escape+"') ":" ("+this.evaluateNodeToWhereClause(s.left,c,l,A.BADNESS,y)+" LIKE "+this.evaluateNodeToWhereClause(s.right,c,l,A.BADNESS,y)+") ";case"NOT LIKE":return""!==s.escape?" ("+this.evaluateNodeToWhereClause(s.left,c,l,A.BADNESS,y)+" NOT LIKE "+this.evaluateNodeToWhereClause(s.right,c,l,A.BADNESS,y)+" ESCAPE '"+s.escape+"') ":" ("+this.evaluateNodeToWhereClause(s.left,c,l,A.BADNESS,y)+" NOT LIKE "+this.evaluateNodeToWhereClause(s.right,c,l,A.BADNESS,y)+") ";case"<>":case"=":if("column-reference"===s.left.type&&"string"===s.right.type){if(s.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[s.right.value.toString()])return" ("+d+" "+s.operator+" "+this.lkp[s.right.value.toString()].toString()+") "}else if("column-reference"===s.right.type&&"string"===s.left.type&&s.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[s.right.value.toString()].toString()+" "+s.operator+" "+d+") ";return" ("+this.evaluateNodeToWhereClause(s.left,c,l,A.BADNESS,y)+" "+s.operator+" "+this.evaluateNodeToWhereClause(s.right,c,l,A.BADNESS,y)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(s.left,c,l,A.BADNESS,y)+" "+s.operator+" "+this.evaluateNodeToWhereClause(s.right,c,l,A.BADNESS,y)+") "}case"null":return"null";case"boolean":return!0===s.value?"1":"0";case"string":return"'"+s.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${s.value}'`;case"date":return`date '${s.value}'`;case"time":return`time '${s.value}'`;case"number":return s.value.toString();case"current-time":return(0,w.C6)("date"===s.mode,c);case"column-reference":return l&&l.toLowerCase()===s.column.toLowerCase()?"("+d+")":s.column;case"data-type":return s.value;case"function":{const g=this.evaluateNodeToWhereClause(s.args,c,l,A.BADNESS,y);return(0,w.F6)(s.name,g,c)}}throw new L.L8(L.Z7.UnsupportedSyntax,{node:s.type})}extractValue(s){return this.codefield instanceof b.WhereClause?this.reverseLkp[b.WhereClause.convertValueToStorageFormat(this.codefield.calculateValueCompiled(s))]:this.reverseLkp[s.attributes[this.codefield]]}}return A.BADNESS="_!!!_BAD_LKP_!!!!",A})();class p extends O{constructor(m,s){super(m),this._sql=s}rewriteSql(m,s){return{rewritten:!0,where:(0,w.bD)(m,this.field.name,(0,w.YY)(this._sql,W.zl.Standardised),s.getFieldsIndex())}}extractValue(m){return b.WhereClause.convertValueToStorageFormat(this._sql.calculateValueCompiled(m),this.field.type)}}class P extends N.A{static findField(m,s){for(const c of m)if(c.name.toLowerCase()===s.toString().toLowerCase())return c;return null}constructor(m){super(m),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=m.extraFilter,this._parent=m.parentfeatureset,this._maxProcessing=30,this.adaptedFields=m.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new k.A({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=W.ik.point,this.typeIdField="",this.types=null,this.subtypeField=null,this.subtypes=null),this.fields=[];for(const m of this.adaptedFields)m.postInitialization(this,this._parent),this.fields.push(m.field)}_getSet(m){var s=this;return(0,v.A)(function*(){if(null===s._wset){var c;yield s._ensureLoaded();let l=null;return l=s._extraFilter?yield s._getFilteredSet("",null,null,null,m):yield null===(c=s._parent)||void 0===c?void 0:c._getSet(m),s._checkCancelled(m),(0,C.Lw)(l),s._wset=new Z.A(l._candidates.slice(0),l._known.slice(0),l._ordered,s._clonePageDefinition(l.pagesDefinition)),s._wset}return s._wset})()}_isInFeatureSet(m){return this._parent._isInFeatureSet(m)}_getFeatures(m,s,c,l){var d=this;return(0,v.A)(function*(){var y;const I=[];-1!==s&&void 0===d._featureCache[s]&&I.push(s);const E=d._maxQueryRate();if(!0===d._checkIfNeedToExpandKnownPage(m,E))return yield d._expandPagedSet(m,E,0,0,l),d._getFeatures(m,s,c,l);let M=0;for(let j=m._lastFetchedIndex;j<m._known.length&&(M++,M<=c&&(m._lastFetchedIndex+=1),!(void 0===d._featureCache[m._known[j]]&&(m._known[j]!==s&&I.push(m._known[j]),I.length>=E)));j++);if(0===I.length)return"success";m=new Z.A([],I,m._ordered,null);const B=Math.min(I.length,c);yield null===(y=d._parent)||void 0===y?void 0:y._getFeatures(m,-1,B,l),d._checkCancelled(l);const g=[];for(let j=0;j<B;j++){var x;const z=null===(x=d._parent)||void 0===x?void 0:x._featureFromCache(I[j]);void 0!==z&&g.push({geometry:z.geometry,attributes:z.attributes,id:I[j]})}for(const j of g){const z=[];for(const ie of d.adaptedFields)z[ie.field.name]=ie.extractValue(j);d._featureCache[j.id]=new V.A({attributes:z,geometry:(0,J.Yq)(j.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,v.A)(function*(){throw new L.dr(L.D_.NeverReach)})()}_getFilteredSet(m,s,c,l,d){var y=this;return(0,v.A)(function*(){let I=!1;const E=y._reformulateWithoutAdaptions(c);I=E.cannot,c=E.where;let M=!1;if(null!==l){M=!0;const x=[];for(const j of y.adaptedFields)if(!(j instanceof F)&&!0===l.scanForField(j.field.name)){if(!(j instanceof T)){l=null,M=!1;break}x.push({field:j.field.name,newfield:j.originalField.name})}l&&x.length>0&&(l=l.replaceFields(x))}null!==c?null!==y._extraFilter&&(c=(0,w.kg)(y._extraFilter,c)):c=y._extraFilter,yield y._ensureLoaded();const B=yield y._parent._getFilteredSet(m,s,c,l,d);let g;return y._checkCancelled(d),g=!0===I?new Z.A(B._candidates.slice(0).concat(B._known.slice(0)),[],!0===M&&B._ordered,y._clonePageDefinition(B.pagesDefinition)):new Z.A(B._candidates.slice(0),B._known.slice(0),!0===M&&B._ordered,y._clonePageDefinition(B.pagesDefinition)),g})()}_reformulateWithoutAdaptions(m){const s={cannot:!1,where:m};if(null!==m)for(const c of this.adaptedFields)if(!0===(0,w.Ju)(m,c.field.name)){const l=c.rewriteSql(m,this);if(!0!==l.rewritten){s.cannot=!0,s.where=null;break}s.where=l.where}return s}_stat(m,s,c,l,d,y,I){var E=this;return(0,v.A)(function*(){let M=!1,B=E._reformulateWithoutAdaptions(s);if(M=B.cannot,s=B.where,B=E._reformulateWithoutAdaptions(d),M=M||B.cannot,null!==(d=B.where)?null!==E._extraFilter&&(d=(0,w.kg)(E._extraFilter,d)):d=E._extraFilter,!0===M)return null===d&&""===c&&null===l?E._manualStat(m,s,y,I):{calculated:!1};const g=yield E._parent._stat(m,s,c,l,d,y,I);return!1===g.calculated?null===d&&""===c&&null===l?E._manualStat(m,s,y,I):{calculated:!1}:g})()}_canDoAggregates(m,s,c,l,d){var y=this;return(0,v.A)(function*(){if(null===y._parent)return!1;for(let M=0;M<m.length;M++)for(const B of y.adaptedFields)if(m[M].toLowerCase()===B.field.name.toLowerCase()&&!(B instanceof F))return!1;const I=[];for(let M=0;M<s.length;M++){const B=s[M];if(null!==B.workingexpr){const g=y._reformulateWithoutAdaptions(B.workingexpr);if(g.cannot)return!1;const x=B.clone();x.workingexpr=g.where,I.push(x)}else I.push(B)}const E=y._reformulateWithoutAdaptions(d);return!E.cannot&&(null!==(d=E.where)?null!==y._extraFilter&&(d=(0,w.kg)(y._extraFilter,d)):d=y._extraFilter,y._parent._canDoAggregates(m,I,c,l,d))})()}_getAggregatePagesDataSourceDefinition(m,s,c,l,d,y,I){var E=this;return(0,v.A)(function*(){if(null===E._parent)throw new L.dr(L.D_.NeverReach);const M=[];for(let g=0;g<s.length;g++){const x=s[g];if(null!==x.workingexpr){const j=E._reformulateWithoutAdaptions(x.workingexpr);if(j.cannot)throw new L.dr(L.D_.NeverReach);const z=x.clone();z.workingexpr=j.where,M.push(z)}else M.push(x)}const B=E._reformulateWithoutAdaptions(d);if(B.cannot)throw new L.dr(L.D_.NeverReach);return null!==(d=B.where)?null!==E._extraFilter&&(d=(0,w.kg)(E._extraFilter,d)):d=E._extraFilter,E._parent._getAggregatePagesDataSourceDefinition(m,M,c,l,d,y,I)})()}}},888:(le,q,_)=>{_.d(q,{A:()=>b});var v=_(10467),V=_(31033),J=_(85922),L=_(71505),N=_(7981),Z=_(97089),W=_(56492),w=_(40013),C=_(32034);class b extends J.A{constructor(O){super(O),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=O.parentfeatureset,O.whereclause instanceof w.WhereClause?(this._whereclause=O.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=O.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new C.A({wkid:4326}),this.geometryType=N.ik.point)}_getSet(O){var F=this;return(0,v.A)(function*(){if(null===F._wset){yield F._ensureLoaded();const T=yield F._parent._getFilteredSet("",null,F._whereclause,null,O);return F._checkCancelled(O),F._wset=null!==F._whereClauseFunction?new L.A(T._candidates.slice(0).concat(T._known.slice(0)),[],T._ordered,F._clonePageDefinition(T.pagesDefinition)):new L.A(T._candidates.slice(0),T._known.slice(0),T._ordered,F._clonePageDefinition(T.pagesDefinition)),F._wset}return F._wset})()}_isInFeatureSet(O){var F;let T=null===(F=this._parent)||void 0===F?void 0:F._isInFeatureSet(O);return T===N.J6.NotInFeatureSet?T:(T=this._idstates[O],void 0===T?N.J6.Unknown:T)}_getFeature(O,F,T){return this._parent._getFeature(O,F,T)}_getFeatures(O,F,T,G){return this._parent._getFeatures(O,F,T,G)}_featureFromCache(O){return this._parent._featureFromCache(O)}executeWhereClause(O){var F,T;return null!==(F=null===(T=this._whereclause)||void 0===T?void 0:T.testFeature(O))&&void 0!==F&&F}executeWhereClauseDeferred(O){var F=this;return(0,v.A)(function*(){if(null!==F._whereClauseFunction){const T=F._whereClauseFunction(O);return(0,W.$X)(T),T}return F.executeWhereClause(O)})()}_fetchAndRefineFeatures(O,F,T){var G=this;return(0,v.A)(function*(){var p;const P=new L.A([],O,!1,null),A=Math.min(F,O.length);if(yield null===(p=G._parent)||void 0===p?void 0:p._getFeatures(P,-1,A,T),G._checkCancelled(T),null==G._whereClauseFunction){for(let l=0;l<A;l++){var m;const d=null===(m=G._parent)||void 0===m?void 0:m._featureFromCache(O[l]);G._idstates[O[l]]=!0===G.executeWhereClause(d)?N.J6.InFeatureSet:N.J6.NotInFeatureSet}return"success"}const s=[];for(let l=0;l<A;l++){var c;const d=null===(c=G._parent)||void 0===c?void 0:c._featureFromCache(O[l]);s.push(yield G.executeWhereClauseDeferred(d))}for(let l=0;l<F;l++)G._idstates[O[l]]=!0===s[l]?N.J6.InFeatureSet:N.J6.NotInFeatureSet;return"success"})()}_getFilteredSet(O,F,T,G,p){var P=this;return(0,v.A)(function*(){null!==P._whereClauseFunction||(null!==T?null!==P._whereclause&&(T=(0,Z.kg)(P._whereclause,T)):T=P._whereclause),yield P._ensureLoaded();const A=yield P._parent._getFilteredSet(O,F,T,G,p);let m;return P._checkCancelled(p),m=null!==P._whereClauseFunction?new L.A(A._candidates.slice(0).concat(A._known.slice(0)),[],A._ordered,P._clonePageDefinition(A.pagesDefinition)):new L.A(A._candidates.slice(0),A._known.slice(0),A._ordered,P._clonePageDefinition(A.pagesDefinition)),m})()}_stat(O,F,T,G,p,P,A){var m=this;return(0,v.A)(function*(){if(null!==m._whereClauseFunction)return null===p&&""===T&&null===G?m._manualStat(O,F,P,A):{calculated:!1};let s=m._whereclause;null!==p&&null!==m._whereclause&&(s=(0,Z.kg)(m._whereclause,p));const c=yield m._parent._stat(O,F,T,G,s,P,A);return!1===c.calculated?null===p&&""===T&&null===G?m._manualStat(O,F,P,A):{calculated:!1}:c})()}_canDoAggregates(O,F,T,G,p){var P=this;return(0,v.A)(function*(){return null===P._whereClauseFunction&&(null!==p?null!==P._whereclause&&(p=(0,Z.kg)(P._whereclause,p)):p=P._whereclause,null!==P._parent&&P._parent._canDoAggregates(O,F,T,G,p))})()}_getAggregatePagesDataSourceDefinition(O,F,T,G,p,P,A){var m=this;return(0,v.A)(function*(){if(null===m._parent)throw new V.dr(V.D_.NeverReach);return null!==p?null!==m._whereclause&&(p=(0,Z.kg)(m._whereclause,p)):p=m._whereclause,m._parent._getAggregatePagesDataSourceDefinition(O,F,T,G,p,P,A)})()}static registerAction(){J.A._featuresetFunctions.filter=function(O){if("function"==typeof O)return new b({parentfeatureset:this,whereclause:O});let F=null;return O instanceof w.WhereClause&&(F=O),new b({parentfeatureset:this,whereclause:F})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},93571:(le,q,_)=>{_.d(q,{A:()=>W});var v=_(10467),V=_(42686),J=_(31033),L=_(85922),N=_(71505),Z=_(58314);class W extends L.A{constructor(C){super(C),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=C.orderbyclause,this._parent=C.parentfeatureset}_getSet(C){var b=this;return(0,v.A)(function*(){if(null===b._wset){yield b._ensureLoaded();const k=yield b._getFilteredSet("",null,null,b._orderbyclause,C);return b._checkCancelled(C),b._wset=k,b._wset}return b._wset})()}manualOrderSet(C,b){var k=this;return(0,v.A)(function*(){var O;const F=yield k.getIdColumnDictionary(C,[],-1,b);null===(O=k._orderbyclause)||void 0===O||O.order(F);const T=new N.A([],[],!0,null);for(let G=0;G<F.length;G++)T._known.push(F[G].id);return T})()}getIdColumnDictionary(C,b,k,O){var F=this;return(0,v.A)(function*(){if(k<C._known.length-1){const T=F._maxQueryRate();if("GETPAGES"===C._known[k+1])return yield(0,V.a2)(F._parent._expandPagedSet(C,T,0,0,O)),F.getIdColumnDictionary(C,b,k,O);let G=k+1;const p=[];for(;G<C._known.length&&"GETPAGES"!==C._known[G];)p.push(C._known[G]),G++;k+=p.length;const P=yield(0,V.a2)(F._parent._getFeatureBatch(p,O));F._checkCancelled(O);for(const A of P)b.push({id:A.attributes[F.objectIdField],feature:A});return F.getIdColumnDictionary(C,b,k,O)}return C._candidates.length>0?(yield(0,V.a2)(F._refineSetBlock(C,F._maxProcessingRate(),O)),F._checkCancelled(O),F.getIdColumnDictionary(C,b,k,O)):b})()}_isInFeatureSet(C){return this._parent._isInFeatureSet(C)}_getFeatures(C,b,k,O){return this._parent._getFeatures(C,b,k,O)}_featureFromCache(C){if(void 0===this._featureCache[C]){const b=this._parent._featureFromCache(C);return void 0===b?void 0:null===b?null:(this._featureCache[C]=b,b)}return this._featureCache[C]}_fetchAndRefineFeatures(){return(0,v.A)(function*(){throw new J.dr(J.D_.NeverReach)})()}_getFilteredSet(C,b,k,O,F){var T=this;return(0,v.A)(function*(){yield T._ensureLoaded();const G=yield T._parent._getFilteredSet(C,b,k,null===O?T._orderbyclause:O,F);T._checkCancelled(F);const p=new N.A(G._candidates.slice(0),G._known.slice(0),G._ordered,T._clonePageDefinition(G.pagesDefinition));let P=!0;if(G._candidates.length>0&&(P=!1),!1===p._ordered){let A=yield T.manualOrderSet(p,F);return!1===P&&(null===b&&null===k||(A=new N.A(A._candidates.slice(0).concat(A._known.slice(0)),[],A._ordered,T._clonePageDefinition(A.pagesDefinition)))),A}return p})()}static registerAction(){L.A._featuresetFunctions.orderBy=function(C){return""===C?this:new W({parentfeatureset:this,orderbyclause:new Z.A(C)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},53437:(le,q,_)=>{_.d(q,{A:()=>Z});var v=_(10467),V=_(31033),J=_(85922),L=_(71505),N=_(7981);class Z extends J.A{constructor(w){super(w),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=w.topnum,this._parent=w.parentfeatureset}_getSet(w){var C=this;return(0,v.A)(function*(){if(null===C._wset){yield C._ensureLoaded();const b=yield C._parent._getSet(w);return C._wset=new L.A(b._candidates.slice(0),b._known.slice(0),!1,C._clonePageDefinition(b.pagesDefinition)),C._setKnownLength(C._wset)>C._topnum&&(C._wset._known=C._wset._known.slice(0,C._topnum)),C._setKnownLength(C._wset)>=C._topnum&&(C._wset._candidates=[]),C._wset}return C._wset})()}_setKnownLength(w){return w._known.length>0&&"GETPAGES"===w._known[w._known.length-1]?w._known.length-1:w._known.length}_isInFeatureSet(w){const C=this._parent._isInFeatureSet(w);if(C===N.J6.NotInFeatureSet)return C;const b=this._idstates[w];return b===N.J6.InFeatureSet||b===N.J6.NotInFeatureSet?b:C===N.J6.InFeatureSet&&void 0===b?this._countedin<this._topnum?(this._idstates[w]=N.J6.InFeatureSet,this._countedin++,N.J6.InFeatureSet):(this._idstates[w]=N.J6.NotInFeatureSet,N.J6.NotInFeatureSet):N.J6.Unknown}_expandPagedSet(w,C,b,k,O){var F=this;return(0,v.A)(function*(){if(null===F._parent)throw new V.dr(V.D_.NotImplemented);if(C>F._topnum&&(C=F._topnum),F._countedin>=F._topnum&&w.pagesDefinition.internal.set.length<=w.pagesDefinition.resultOffset){let G=w._known.length;return G>0&&"GETPAGES"===w._known[G-1]&&(w._known.length=G-1),G=w._candidates.length,G>0&&"GETPAGES"===w._candidates[G-1]&&(w._candidates.length=G-1),"success"}const T=yield F._parent._expandPagedSet(w,C,b,k,O);return F._setKnownLength(w)>F._topnum&&(w._known.length=F._topnum),F._setKnownLength(w)>=F._topnum&&(w._candidates.length=0),T})()}_getFeatures(w,C,b,k){var O=this;return(0,v.A)(function*(){const F=[],T=O._maxQueryRate();if(!0===O._checkIfNeedToExpandKnownPage(w,T))return yield O._expandPagedSet(w,T,0,0,k),O._getFeatures(w,C,b,k);-1!==C&&void 0===O._featureCache[C]&&F.push(C);let G=0;for(let A=w._lastFetchedIndex;A<w._known.length&&(G++,G<=b&&(w._lastFetchedIndex+=1),!(void 0===O._featureCache[w._known[A]]&&(w._known[A]!==C&&F.push(w._known[A]),F.length>T)));A++);if(0===F.length)return"success";const p=new L.A([],F,!1,null),P=Math.min(F.length,b);yield O._parent._getFeatures(p,-1,P,k);for(let A=0;A<P;A++){const m=O._parent._featureFromCache(F[A]);void 0!==m&&(O._featureCache[F[A]]=m)}return"success"})()}_getFilteredSet(w,C,b,k,O){var F=this;return(0,v.A)(function*(){yield F._ensureLoaded();const T=yield F._getSet(O);return new L.A(T._candidates.slice(0).concat(T._known.slice(0)),[],!1,F._clonePageDefinition(T.pagesDefinition))})()}_refineKnowns(w,C){let b=0,k=null;const O=[];for(let F=0;F<w._candidates.length;F++){const T=this._isInFeatureSet(w._candidates[F]);if(T===N.J6.InFeatureSet){if(w._known.push(w._candidates[F]),b+=1,null===k?k={start:F,end:F}:k.end===F-1?k.end=F:(O.push(k),k={start:F,end:F}),w._known.length>=this._topnum)break}else if(T===N.J6.NotInFeatureSet)null===k?k={start:F,end:F}:k.end===F-1?k.end=F:(O.push(k),k={start:F,end:F}),b+=1;else if(T===N.J6.Unknown)break;if(b>=C)break}null!==k&&O.push(k);for(let F=O.length-1;F>=0;F--)w._candidates.splice(O[F].start,O[F].end-O[F].start+1);this._setKnownLength(w)>this._topnum&&(w._known=w._known.slice(0,this._topnum)),this._setKnownLength(w)>=this._topnum&&(w._candidates=[])}_stat(){return(0,v.A)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,v.A)(function*(){return!1})()}static registerAction(){J.A._featuresetFunctions.top=function(w){return new Z({parentfeatureset:this,topnum:w})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},6491:(le,q,_)=>{_.d(q,{A:()=>T});var v=_(10467),V=_(81098),J=_(31033),L=_(85922),N=_(71505),Z=_(7981),W=_(97089),w=_(68643),C=_(35940),b=_(11943),k=_(47063),O=_(29141),F=_(87086);class T extends L.A{constructor(p){super(p),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,p.spatialReference&&(this.spatialReference=p.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=p.layer,this._wset=null,!0===p.isTable&&(this._forceIsTable=!0),void 0!==p.outFields&&(this._overrideFields=p.outFields),void 0!==p.includeGeometry&&(this._removeGeometry=!1===p.includeGeometry)}_maxQueryRate(){return Z.gO}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var p=this;return(0,v.A)(function*(){return!0===p._layer.loaded?(p._initialiseFeatureSet(),p):(yield p._layer.load(),p._initialiseFeatureSet(),p)})()}get gdbVersion(){return""}_initialiseFeatureSet(){var p,P,A,m;if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const s=[],c=[];for(const l of this.fields)if("oid"===l.type)s.push(l),c.push(l.name);else for(const d of this._overrideFields)if(d.toLowerCase()===l.name.toLowerCase()){s.push(l),c.push(l.name);break}this.fields=s,this._overrideFields=c}this.objectIdField=this._layer.objectIdField;for(const s of this.fields)"global-id"===s.type&&(this.globalIdField=s.name);this._databaseType=Z.zl.Standardised,this.hasZ=!0===(null===(p=this._layer)||void 0===p||null===(p=p.capabilities)||void 0===p||null===(p=p.data)||void 0===p?void 0:p.supportsZ),this.hasM=!0===(null===(P=this._layer)||void 0===P||null===(P=P.capabilities)||void 0===P||null===(P=P.data)||void 0===P?void 0:P.supportsM),this._layer instanceof b.default?(this.subtypeField=null!==(A=this._layer.subtypeField)&&void 0!==A?A:"",this.subtypes=this._layer.subtypes,this.types=null,this.typeIdField=null):(this.typeIdField=null!==(m=this._layer.typeIdField)&&void 0!==m?m:"",this.types=this._layer.types,this.subtypeField=this._layer.subtypeField,this.subtypes=this._layer.subtypes)}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return Z.J6.InFeatureSet}_candidateIdTransform(p){return p}_getSet(p){var P=this;return(0,v.A)(function*(){if(null===P._wset){yield P._ensureLoaded();const A=yield P._getFilteredSet("",null,null,null,p);return P._wset=A,A}return P._wset})()}_changeFeature(p){const P={};for(const A of this.fields)P[A.name]=p.attributes[A.name];return new V.A({geometry:!0===this._removeGeometry?null:p.geometry,attributes:P})}_getFilteredSet(p,P,A,m,s){var c=this;return(0,v.A)(function*(){let l="",d=!1;if(null!==m&&(l=m.constructClause(),d=!0),c.isTable()&&P&&null!==p&&""!==p)return new N.A([],[],!0,null);const y=new F.A;y.returnZ=c.hasZ,y.returnM=c.hasM,y.where=null===A?null===P?"1=1":"":(0,W.YY)(A,Z.zl.Standardised),y.spatialRelationship=c._makeRelationshipEnum(p),y.outSpatialReference=c.spatialReference,y.orderByFields=""!==l?l.split(","):null,y.geometry=null===P?null:P,y.returnGeometry=!0,y.relationParameter=c._makeRelationshipParam(p);const I=yield c._layer.queryFeatures(y);if(null===I)return new N.A([],[],d,null);c._checkCancelled(s);const E=[];return I.features.forEach(M=>{const B=M.attributes[c._layer.objectIdField];E.push(B),c._featureCache[B]=c._changeFeature(M)}),new N.A([],E,d,null)})()}_makeRelationshipEnum(p){if(p.includes("esriSpatialRelRelation"))return"relation";switch(p){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return p}_makeRelationshipParam(p){return p.includes("esriSpatialRelRelation")?p.split(":")[1]:""}_queryAllFeatures(){var p=this;return(0,v.A)(function*(){if(p._wset)return p._wset;const P=new F.A;if(P.where="1=1",yield p._ensureLoaded(),p._layer.source&&p._layer.source.items){const s=[];return p._layer.source.items.forEach(c=>{const l=c.attributes[p._layer.objectIdField];s.push(l),p._featureCache[l]=p._changeFeature(c)}),p._wset=new N.A([],s,!1,null),p._wset}P.returnZ=p.hasZ,P.returnM=p.hasM;const A=yield p._layer.queryFeatures(P),m=[];return A.features.forEach(s=>{const c=s.attributes[p._layer.objectIdField];m.push(c),p._featureCache[c]=p._changeFeature(s)}),p._wset=new N.A([],m,!1,null),p._wset})()}_getFeatures(p,P,A){var m=this;return(0,v.A)(function*(){const s=[];-1!==P&&void 0===m._featureCache[P]&&s.push(P);for(let c=p._lastFetchedIndex;c<p._known.length&&(p._lastFetchedIndex+=1,!(void 0===m._featureCache[p._known[c]]&&(p._known[c]!==P&&s.push(p._known[c]),s.length>A)));c++);if(0===s.length)return"success";throw new J.dr(J.D_.MissingFeatures)})()}_refineSetBlock(p){return(0,v.A)(function*(){return p})()}_stat(){return(0,v.A)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,v.A)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(p){const P={};for(const A in p)P[A]=p[A];return P}nativeCapabilities(){var p;return{title:null!==(p=this._layer.title)&&void 0!==p?p:"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(p,P){var A,m,s,c,l,d,y;let I=p.layerDefinition.objectIdField;const E=null!==(A=p.layerDefinition.typeIdField)&&void 0!==A?A:"",M=[];if(p.layerDefinition.types)for(const ee of p.layerDefinition.types)M.push(k.A.fromJSON(ee));let B=p.layerDefinition.geometryType;void 0===B&&(B=p.featureSet.geometryType||"");let g=p.featureSet.features;const x=P.toJSON();if(!I){let ee=!1;for(const ce of p.layerDefinition.fields)if("oid"===ce.type||"esriFieldTypeOID"===ce.type){I=ce.name,ee=!0;break}if(!1===ee){let ce="FID",ye=!0,me=0;for(;ye;){let he=!0;for(const pe of p.layerDefinition.fields)if(pe.name===ce){he=!1;break}!0===he?ye=!1:(me++,ce="FID"+me.toString())}p.layerDefinition.fields.push({type:"esriFieldTypeOID",name:ce,alias:ce});const _e=[];for(let he=0;he<g.length;he++)_e.push({geometry:p.featureSet.features[he].geometry,attributes:p.featureSet.features[he].attributes?this._cloneAttr(p.featureSet.features[he].attributes):{}}),_e[he].attributes[ce]=he;g=_e,I=ce}}const j=[];for(const ee of p.layerDefinition.fields)j.push(ee instanceof O.A?ee:O.A.fromJSON(ee));let z=B;switch(z||(z=""),z){case"esriGeometryPoint":z="point";break;case"esriGeometryPolyline":z="polyline";break;case"esriGeometryPolygon":z="polygon";break;case"esriGeometryEnvelope":z="extent";break;case"esriGeometryMultipoint":z="multipoint";break;case"":case"esriGeometryNull":z="esriGeometryNull"}if("esriGeometryNull"!==z)for(const ee of g)ee.geometry&&!(ee.geometry instanceof w.A)&&(ee.geometry.type=z,void 0===ee.geometry.spatialReference&&(ee.geometry.spatialReference=x));else for(const ee of g)ee.geometry&&(ee.geometry=null);const ie={outFields:["*"],source:g,fields:j,hasZ:!0===(null==p||null===(m=p.layerDefinition)||void 0===m?void 0:m.hasZ)||!0===(null==p||null===(s=p.featureSet)||void 0===s?void 0:s.hasZ),hasM:!0===(null==p||null===(c=p.layerDefinition)||void 0===c?void 0:c.hasM)||!0===(null==p||null===(l=p.featureSet)||void 0===l?void 0:l.hasM),types:M,typeIdField:E,objectIdField:I,spatialReference:P},H="esriGeometryNull"===z||null===z;H||(ie.geometryType=z);const se=new C.default(ie);return!(null==p||null===(d=p.layerDefinition)||void 0===d)&&d.subtypeField&&!(null==p||null===(y=p.layerDefinition)||void 0===y)&&y.subtypes&&se.read({subtypes:p.layerDefinition.subtypes,subtypeField:p.layerDefinition.subtypeField}),new T({layer:se,spatialReference:P,isTable:H})}queryAttachments(){return(0,v.A)(function*(){return[]})()}getFeatureByObjectId(p){var P=this;return(0,v.A)(function*(){const A=new F.A;A.where=P.objectIdField+"="+p.toString(),A.returnZ=P.hasZ,A.returnM=P.hasM;const m=yield P._layer.queryFeatures(A);return 1===m.features.length?m.features[0]:null})()}getOwningSystemUrl(){return(0,v.A)(function*(){return""})()}getIdentityUser(){return(0,v.A)(function*(){return""})()}get preferredTimeZone(){var p;return null!==(p=this._layer.preferredTimeZone)&&void 0!==p?p:null}get dateFieldsTimeZone(){var p;return null!==(p=this._layer.dateFieldsTimeZone)&&void 0!==p?p:null}get datesInUnknownTimezone(){var p;return null===(p=this._layer)||void 0===p?void 0:p.datesInUnknownTimezone}get editFieldsInfo(){var p;return null===(p=this._layer)||void 0===p?void 0:p.editFieldsInfo}get timeInfo(){var p;return null===(p=this._layer)||void 0===p?void 0:p.timeInfo}getFeatureSetInfo(){var p=this;return(0,v.A)(function*(){var P,A,m;const s=p._layer.title&&p._layer.parent;return null!==(P=p.fsetInfo)&&void 0!==P?P:{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:s&&null!==(A=p._layer.id)&&void 0!==A?A:null,webMapLayerTitle:s&&null!==(m=p._layer.title)&&void 0!==m?m:null,className:null,objectClassId:null}})()}}},58314:(le,q,_)=>{function v(J,L){return J===L?0:null===J?-1:null===L?1:J<L?-1:1}_.d(q,{A:()=>V});class V{constructor(L){const N=L.split(",");this._fields=[],this._directions=[];for(let Z=0;Z<N.length;Z++){const W=N[Z].match(/\S+/g);this._fields.push(W[0]),2===W.length?"asc"===W[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let L="";for(let N=0;N<this._fields.length;N++)0!==N&&(L+=","),L+=this._fields[N],L+=1===this._directions[N]?" ASC":" DESC";return L}order(L){L.sort((N,Z)=>{for(let W=0;W<this._fields.length;W++){const w=this.featureValue(N.feature,this._fields[W],W),C=this.featureValue(Z.feature,this._fields[W],W);let b=0;if(b=1===this._directions[W]?v(w,C):-1*v(w,C),0!==b)return b}return 0})}scanForField(L){for(let N=0;N<this._fields.length;N++)if(this._fields[N].toLowerCase().trim()===L.toLowerCase().trim())return!0;return!1}replaceFields(L){let N="";for(let Z=0;Z<this._fields.length;Z++){0!==Z&&(N+=",");let W=this._fields[Z];for(const w of L)if(W.toLowerCase()===w.field.toLowerCase()){W=w.newfield;break}N+=W,N+=1===this._directions[Z]?" ASC":" DESC"}return new V(N)}featureValue(L,N,Z){const W=L.attributes[N];if(void 0!==W)return W;for(const w in L.attributes)if(N.toLowerCase()===w.toLowerCase())return this._fields[Z]=w,L.attributes[w];return null}}},47063:(le,q,_)=>{_.d(q,{A:()=>T});var v=_(8189),V=_(90660),J=_(71065),L=_(85211),w=(_(3248),_(35150),_(40707),_(17221)),C=_(76576),b=_(50305),k=_(84546),O=_(69741);let F=class extends((0,V.O)(J.oY)){constructor(G){super(G),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(G){const p={};for(const P of Object.keys(G))p[P]=(0,k.rS)(G[P]);return p}writeDomains(G,p){const P={};for(const m of Object.keys(G)){var A;G[m]&&(P[m]=null===(A=G[m])||void 0===A?void 0:A.toJSON())}p.domains=P}};(0,v._)([(0,L.MZ)({json:{write:!0}})],F.prototype,"id",void 0),(0,v._)([(0,L.MZ)({json:{write:!0}})],F.prototype,"name",void 0),(0,v._)([(0,L.MZ)({json:{write:!0}})],F.prototype,"domains",void 0),(0,v._)([(0,w.w)("domains")],F.prototype,"readDomains",null),(0,v._)([(0,b.K)("domains")],F.prototype,"writeDomains",null),(0,v._)([(0,L.MZ)({type:[O.A],json:{write:!0}})],F.prototype,"templates",void 0),F=(0,v._)([(0,C.$)("esri.layers.support.FeatureType")],F);const T=F},6829:(le,q,_)=>{_.d(q,{E1:()=>W,Fm:()=>w,JZ:()=>A,R_:()=>Z,fu:()=>V,oF:()=>J,rq:()=>C});const v=[["binary","application/octet-stream","bin",""]];function V(m,s){var c;return null!=F(s.name,null!==(c=null==m?void 0:m.supportedFormats)&&void 0!==c?c:[])}function J(m,s){var c;if(!m)return!1;const l=C(s,null!==(c=m.supportedFormats)&&void 0!==c?c:[]);return null!=l&&m.editFormats.includes(l)}function Z(m,s){return T(function O(m,s){const c=m.toLowerCase();return b(s).find(l=>G(l)===c)}(m,s))}function W(m,s){return T(F(m,s))}function w(m,s){return G(function k(m,s){return b(s).find(c=>T(c)===m)}(m,s))}function C(m,s){var c;return null!==(c=W(m.name,s))&&void 0!==c?c:Z(m.type,s)}function b(m){return[...v,...m]}function F(m,s){const c=m.toLowerCase();return b(s).find(l=>function p(m){var s;return null!==(s=null==m?void 0:m[2].split(",").map(c=>c.toLowerCase()))&&void 0!==s?s:[]}(l).some(d=>c.endsWith(d)))}function T(m){return null==m?void 0:m[0]}function G(m){return null==m?void 0:m[1].toLowerCase()}function A(m){var s;return null===(s=m.tables)||void 0===s?void 0:s.find(c=>"assetMaps"===c.role)}},1832:(le,q,_)=>{function v(V){const J={};for(const L in V){if("declaredClass"===L)continue;const N=V[L];if(null!=N&&"function"!=typeof N)if(Array.isArray(N)){J[L]=[];for(let Z=0;Z<N.length;Z++)J[L][Z]=v(N[Z])}else"object"==typeof N?N.toJSON&&(J[L]=JSON.stringify(N)):J[L]=N}return J}_.d(q,{z:()=>v})},33063:(le,q,_)=>{_.d(q,{I:()=>N});var v=_(10467),V=_(68800),J=_(1277),L=_(87086);function N(W,w,C){return Z.apply(this,arguments)}function Z(){return(Z=(0,v.A)(function*(W,w,C){const b=(0,V.Dl)(W);return(0,J.gW)(b,L.A.from(w),{...C}).then(k=>k.data.count)})).apply(this,arguments)}},87342:(le,q,_)=>{_.d(q,{V:()=>N});var v=_(10467),V=_(68800),J=_(1277),L=_(87086);function N(W,w,C){return Z.apply(this,arguments)}function Z(){return(Z=(0,v.A)(function*(W,w,C){const b=(0,V.Dl)(W);return(0,J.Pk)(b,L.A.from(w),{...C}).then(k=>k.data.objectIds)})).apply(this,arguments)}},34687:(le,q,_)=>{_.d(q,{e:()=>w,s:()=>Z});var v=_(10467),V=_(68800),J=_(1277),L=_(93327),N=_(87086);function Z(b,k,O){return W.apply(this,arguments)}function W(){return(W=(0,v.A)(function*(b,k,O){const F=yield w(b,k,O);return L.A.fromJSON(F)})).apply(this,arguments)}function w(b,k,O){return C.apply(this,arguments)}function C(){return(C=(0,v.A)(function*(b,k,O){const F=(0,V.Dl)(b),T={...O},G=N.A.from(k),{data:p}=yield(0,J.eW)(F,G,G.sourceSpatialReference,T);return p})).apply(this,arguments)}},11170:(le,q,_)=>{_.d(q,{S:()=>m});var v=_(10467),V=_(68800),J=_(11432),L=_(23743),N=_(31732);function Z(c,l){return l}function W(c,l,d,y){switch(d){case 0:return k(c,l+y,0);case 1:return"lowerLeft"===c.originPosition?k(c,l+y,1):function O({translate:c,scale:l},d,y){return c[y]-d*l[y]}(c,l+y,1)}}function w(c,l,d,y){return 2===d?k(c,l,2):W(c,l,d,y)}function C(c,l,d,y){return 2===d?0===l?0:k(c,l,3):W(c,l,d,y)}function b(c,l,d,y){return 3===d?0===l?0:k(c,l,3):w(c,l,d,y)}function k({translate:c,scale:l},d,y){return c[y]+d*l[y]}class F{constructor(l){this._options=l,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=Z,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(l){if(this._options.applyTransform&&(l.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!l.hasZ)return;const d=(0,L.N)(l.geometryType,this._options.sourceSpatialReference,l.spatialReference);if(null!=d)for(const y of l.features)d(y.geometry)}createSpatialReference(){return{}}addField(l,d){const y=l.fields;(0,J.Lw)(y),y.push(d);const I=y.map(E=>E.name);this._attributesConstructor=function(){for(const E of I)this[E]=null}}addFeature(l,d){l.features.push(d)}prepareFeatures(l){switch(this._transform=l.transform,this._options.applyTransform&&l.transform&&(this._applyTransform=this._deriveApplyTransform(l)),this._mValueOffset=null,this._vertexDimension=2,l.hasZ&&this._vertexDimension++,l.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),l.geometryType){case"esriGeometryPoint":this.addCoordinate=(d,y,I)=>this.addCoordinatePoint(d,y,I),this.createGeometry=d=>this.createPointGeometry(d);break;case"esriGeometryPolygon":this.addCoordinate=(d,y,I)=>this._addCoordinatePolygon(d,y,I),this.createGeometry=d=>this._createPolygonGeometry(d);break;case"esriGeometryPolyline":this.addCoordinate=(d,y,I)=>this._addCoordinatePolyline(d,y,I),this.createGeometry=d=>this._createPolylineGeometry(d);break;case"esriGeometryMultipoint":this.addCoordinate=(d,y,I)=>this._addCoordinateMultipoint(d,y,I),this.createGeometry=d=>this._createMultipointGeometry(d)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(l,d,y){0===this._lengths.length&&(this._toAddInCurrentPath=d),this._lengths.push(d)}addQueryGeometry(l,d){const{queryGeometry:y,queryGeometryType:I}=d,E=(0,N.Ch)(y.clone(),y,!1,!1,this._transform),M=(0,N.zv)(E,I,!1,!1);l.queryGeometryType=I,l.queryGeometry={...M}}createPointGeometry(l){const d={x:0,y:0,spatialReference:l.spatialReference};return l.hasZ&&(d.z=0),l.hasM&&(d.m=0),d}addCoordinatePoint(l,d,y){switch(d=this._applyTransform(this._transform,d,y,0),y){case 0:l.x=d;break;case 1:l.y=d;break;case 2:"z"in l?l.z=d:l.m=d;break;case 3:l.m=d}}_transformPathLikeValue(l,d){let y=0;return d<=1&&(y=this._previousCoordinate[d],this._previousCoordinate[d]+=l),null===this._mValueOffset||0!==l||d%this._mValueOffset?this._applyTransform(this._transform,l,d,y):0}_addCoordinatePolyline(l,d,y){this._dehydratedAddPointsCoordinate(l.paths,d,y)}_addCoordinatePolygon(l,d,y){this._dehydratedAddPointsCoordinate(l.rings,d,y)}_addCoordinateMultipoint(l,d,y){0===y&&l.points.push([]);const I=this._transformPathLikeValue(d,y);l.points[l.points.length-1].push(I)}_createPolygonGeometry(l){return{rings:[[]],spatialReference:l.spatialReference,hasZ:!!l.hasZ,hasM:!!l.hasM}}_createPolylineGeometry(l){return{paths:[[]],spatialReference:l.spatialReference,hasZ:!!l.hasZ,hasM:!!l.hasM}}_createMultipointGeometry(l){return{points:[],spatialReference:l.spatialReference,hasZ:!!l.hasZ,hasM:!!l.hasM}}_dehydratedAddPointsCoordinate(l,d,y){0===y&&0==this._toAddInCurrentPath--&&(l.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const I=this._transformPathLikeValue(d,y),E=l[l.length-1];0===y&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),E.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=I}_deriveApplyTransform(l){const{hasZ:d,hasM:y}=l;return d&&y?b:d?w:y?C:W}}var T=_(1277),p=(_(93327),_(87086));function m(c,l,d){return s.apply(this,arguments)}function s(){return(s=(0,v.A)(function*(c,l,d){const y=(0,V.Dl)(c),I={...d},E=p.A.from(l),M=!E.quantizationParameters,{data:B}=yield(0,T.IJ)(y,E,new F({sourceSpatialReference:E.sourceSpatialReference,applyTransform:M}),I);return B})).apply(this,arguments)}},1277:(le,q,_)=>{_.d(q,{IJ:()=>G,Jf:()=>s,Pk:()=>A,eW:()=>F,gW:()=>m,kS:()=>P});var v=_(10467),V=_(89563),J=_(45272),L=_(61320),N=_(77098),Z=_(58701),W=_(1832),w=_(78304),C=_(98789);const b="Layer does not support extent calculation.";function O(I,E){var M;const B=I.geometry,g=I.toJSON();delete g.compactGeometryEnabled,delete g.defaultSpatialReferenceEnabled;const x=g;let j,z,ie;if(null!=B&&(z=B.spatialReference,ie=(0,Z.YX)(z),x.geometryType=(0,L.$B)(B),x.geometry=function k(I,E){if(E&&"extent"===I.type)return`${I.xmin},${I.ymin},${I.xmax},${I.ymax}`;if(E&&"point"===I.type)return`${I.x},${I.y}`;const M=I.toJSON();return delete M.spatialReference,JSON.stringify(M)}(B,I.compactGeometryEnabled),x.inSR=ie),g.groupByFieldsForStatistics&&(x.groupByFieldsForStatistics=g.groupByFieldsForStatistics.join(",")),g.objectIds&&(x.objectIds=g.objectIds.join(",")),g.orderByFields&&(x.orderByFields=g.orderByFields.join(",")),!g.outFields||!g.returnDistinctValues&&(null!=E&&E.returnCountOnly||null!=E&&E.returnExtentOnly||null!=E&&E.returnIdsOnly)?delete x.outFields:x.outFields=g.outFields.includes("*")?"*":g.outFields.join(","),g.outSR?(x.outSR=(0,Z.YX)(g.outSR),j=I.outSpatialReference):B&&(g.returnGeometry||g.returnCentroid)&&(x.outSR=x.inSR,j=z),g.returnGeometry&&delete g.returnGeometry,g.outStatistics&&(x.outStatistics=JSON.stringify(g.outStatistics)),g.fullText&&(x.fullText=JSON.stringify(g.fullText)),g.pixelSize&&(x.pixelSize=JSON.stringify(g.pixelSize)),g.quantizationParameters&&(I.defaultSpatialReferenceEnabled&&null!=z&&null!=(null===(M=I.quantizationParameters)||void 0===M?void 0:M.extent)&&z.equals(I.quantizationParameters.extent.spatialReference)&&delete g.quantizationParameters.extent.spatialReference,x.quantizationParameters=JSON.stringify(g.quantizationParameters)),g.parameterValues&&(x.parameterValues=JSON.stringify(g.parameterValues)),g.rangeValues&&(x.rangeValues=JSON.stringify(g.rangeValues)),g.dynamicDataSource&&(x.layer=JSON.stringify({source:g.dynamicDataSource}),delete g.dynamicDataSource),g.timeExtent){const H=g.timeExtent,{start:se,end:ee}=H;null==se&&null==ee||(x.time=se===ee?se:`${null!=se?se:"null"},${null!=ee?ee:"null"}`),delete g.timeExtent}return I.defaultSpatialReferenceEnabled&&null!=z&&null!=j&&z.equals(j)&&(x.defaultSR=x.inSR,delete x.inSR,delete x.outSR),x}function F(I,E,M,B){return T.apply(this,arguments)}function T(){return(T=(0,v.A)(function*(I,E,M,B){const g=null!=E.timeExtent&&E.timeExtent.isEmpty?{data:{features:[]}}:yield l(I,E,"json",B);return(0,C.q)(E,M,g.data),g})).apply(this,arguments)}function G(I,E,M,B){return p.apply(this,arguments)}function p(){return(p=(0,v.A)(function*(I,E,M,B){if(null!=E.timeExtent&&E.timeExtent.isEmpty)return{data:M.createFeatureResult()};const g=yield P(I,E,B),x=g;return x.data=(0,w.m)(g.data,M),x})).apply(this,arguments)}function P(I,E,M){return l(I,E,"pbf",M)}function A(I,E,M){return null!=E.timeExtent&&E.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):l(I,E,"json",M,{returnIdsOnly:!0})}function m(I,E,M){return null!=E.timeExtent&&E.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):l(I,E,"json",M,{returnIdsOnly:!0,returnCountOnly:!0})}function s(I,E,M){return c.apply(this,arguments)}function c(){return(c=(0,v.A)(function*(I,E,M){if(null!=E.timeExtent&&E.timeExtent.isEmpty)return{data:{count:0,extent:null}};const B=yield l(I,E,"json",M,{returnExtentOnly:!0,returnCountOnly:!0}),g=B.data;if(g.hasOwnProperty("extent"))return B;if(g.features)throw new Error(b);if(g.hasOwnProperty("count"))throw new Error(b);return B})).apply(this,arguments)}function l(I,E,M){return d.apply(this,arguments)}function d(){return(d=(0,v.A)(function*(I,E,M,B={},g={}){const x="string"==typeof I?(0,J.An)(I):I,j=E.geometry?[E.geometry]:[],z=yield(0,N.el)(j,null,{signal:B.signal}),ie=null==z?void 0:z[0];null!=ie&&((E=E.clone()).geometry=ie);const H=(0,W.z)({...x.query,f:M,...g,...O(E,g)});return(0,V.A)((0,J.fj)(x.path,function y(I,E){return null!=I.formatOf3DObjects&&!(E.returnCountOnly||E.returnExtentOnly||E.returnIdsOnly)}(E,g)?"query3d":"query"),{...B,responseType:"pbf"===M?"array-buffer":"json",query:{...H,...B.query}})})).apply(this,arguments)}},98789:(le,q,_)=>{_.d(q,{q:()=>V});var v=_(23743);function V(J,L,N){if(null==N||!N.features||!N.hasZ)return;const Z=(0,v.N)(N.geometryType,L,J.outSpatialReference);if(null!=Z)for(const W of N.features)Z(W.geometry)}},70994:(le,q,_)=>{_.d(q,{A:()=>F});var b,v=_(8189),V=_(71065),J=_(85211),L=_(55739),W=(_(40707),_(3248),_(76576));const k={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let O=b=class extends V.oY{constructor(T){super(T),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:T}=this,G=function w(T){const{exifInfo:G,exifName:p,tagName:P}=T;if(!G||!p||!P)return null;const A=G.find(m=>m.name===p);return A?function C(T){const{tagName:G,tags:p}=T;if(!p||!G)return null;const P=p.find(A=>A.name===G);return(null==P?void 0:P.value)||null}({tagName:P,tags:A.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:T});return k[G]||null}clone(){return new b({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,v._)([(0,J.MZ)({type:String})],O.prototype,"contentType",void 0),(0,v._)([(0,J.MZ)()],O.prototype,"exifInfo",void 0),(0,v._)([(0,J.MZ)({readOnly:!0})],O.prototype,"orientationInfo",null),(0,v._)([(0,J.MZ)({type:L.jz})],O.prototype,"id",void 0),(0,v._)([(0,J.MZ)({type:String})],O.prototype,"globalId",void 0),(0,v._)([(0,J.MZ)({type:String})],O.prototype,"keywords",void 0),(0,v._)([(0,J.MZ)({type:String})],O.prototype,"name",void 0),(0,v._)([(0,J.MZ)({json:{read:!1}})],O.prototype,"parentGlobalId",void 0),(0,v._)([(0,J.MZ)({json:{read:!1}})],O.prototype,"parentObjectId",void 0),(0,v._)([(0,J.MZ)({type:L.jz})],O.prototype,"size",void 0),(0,v._)([(0,J.MZ)({json:{read:!1}})],O.prototype,"url",void 0),O=b=(0,v._)([(0,W.$)("esri.layers.support.AttachmentInfo")],O);const F=O},93327:(le,q,_)=>{_.d(q,{A:()=>m});var p,v=_(8189),V=_(21152),J=_(81098),L=_(49976),N=_(71065),Z=_(77806),W=_(85211),b=(_(3248),_(35150),_(17221)),k=_(76576),O=_(50305),F=_(32034),T=_(61320),G=_(29141);const P=new L.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let A=p=class extends N.oY{constructor(s){super(s),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(s,c){const l=F.A.fromJSON(c.spatialReference),d=[];for(let I=0;I<s.length;I++){var y;const E=s[I],M=J.A.fromJSON(E),B=null===(y=E.geometry)||void 0===y?void 0:y.spatialReference;null==M.geometry||B||(M.geometry.spatialReference=l);const g=E.aggregateGeometries,x=M.aggregateGeometries;if(g&&null!=x)for(const j in x){const z=x[j],ie=g[j];null==z||(null==ie?void 0:ie.spatialReference)||(z.spatialReference=l)}d.push(M)}return d}writeGeometryType(s,c,l,d){if(s)return void P.write(s,c,l,d);const{features:y}=this;if(y)for(const I of y)if(null!=(null==I?void 0:I.geometry))return void P.write(I.geometry.type,c,l,d)}readQueryGeometry(s,c){if(!s)return null;const l=!!s.spatialReference,d=(0,T.rS)(s);return d&&!l&&c.spatialReference&&(d.spatialReference=F.A.fromJSON(c.spatialReference)),d}writeSpatialReference(s,c){if(s)return void(c.spatialReference=s.toJSON());const{features:l}=this;if(l)for(const d of l)if(d&&null!=d.geometry&&d.geometry.spatialReference)return void(c.spatialReference=d.geometry.spatialReference.toJSON())}clone(){return new p(this.cloneProperties())}cloneProperties(){return(0,Z.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(s){const c=this.write();if(c.features&&Array.isArray(s)&&s.length>0)for(let l=0;l<c.features.length;l++){const d=c.features[l];if(d.geometry){const y=null==s?void 0:s[l];d.geometry=(null==y?void 0:y.toJSON())||d.geometry}}return c}quantize(s){const{scale:[c,l],translate:[d,y]}=s,M=this.features,B=this._getQuantizationFunction(this.geometryType,g=>Math.round((g-d)/c),g=>Math.round((y-g)/l));for(let g=0,x=M.length;g<x;g++)null!=B&&B(M[g].geometry)||(M.splice(g,1),g--,x--);return this.transform=s,this}unquantize(){var s,c;const{geometryType:l,features:d,transform:y}=this;if(!y)return this;const{translate:[I,E],scale:[M,B]}=y;let j=null,z=null;if(this.hasZ&&null!=(null==y||null===(s=y.scale)||void 0===s?void 0:s[2])){const{translate:[,,H],scale:[,,se]}=y;j=ee=>ee*se+H}if(this.hasM&&null!=(null==y||null===(c=y.scale)||void 0===c?void 0:c[3])){const{translate:[,,,H],scale:[,,,se]}=y;z=ee=>null==ee?ee:ee*se+H}const ie=this._getHydrationFunction(l,H=>H*M+I,H=>E-H*B,j,z);for(const{geometry:H}of d)null!=H&&ie&&ie(H);return this.transform=null,this}_quantizePoints(s,c,l){let d,y;const I=[];for(let E=0,M=s.length;E<M;E++){const B=s[E];if(E>0){const g=c(B[0]),x=l(B[1]);g===d&&x===y||(I.push([g-d,x-y]),d=g,y=x)}else d=c(B[0]),y=l(B[1]),I.push([d,y])}return I.length>0?I:null}_getQuantizationFunction(s,c,l){return"point"===s?d=>(d.x=c(d.x),d.y=l(d.y),d):"polyline"===s||"polygon"===s?d=>{const y=(0,T.Bi)(d)?d.rings:d.paths,I=[];for(let E=0,M=y.length;E<M;E++){const g=this._quantizePoints(y[E],c,l);g&&I.push(g)}return I.length>0?((0,T.Bi)(d)?d.rings=I:d.paths=I,d):null}:"multipoint"===s?d=>{const y=this._quantizePoints(d.points,c,l);return y&&y.length>0?(d.points=y,d):null}:"extent"===s?d=>d:null}_getHydrationFunction(s,c,l,d,y){return"point"===s?I=>{I.x=c(I.x),I.y=l(I.y),d&&(I.z=d(I.z))}:"polyline"===s||"polygon"===s?I=>{const E=(0,T.Bi)(I)?I.rings:I.paths;let M,B;for(let g=0,x=E.length;g<x;g++){const j=E[g];for(let z=0,ie=j.length;z<ie;z++){const H=j[z];z>0?(M+=H[0],B+=H[1]):(M=H[0],B=H[1]),H[0]=c(M),H[1]=l(B)}}if(d&&y)for(let g=0,x=E.length;g<x;g++){const j=E[g];for(let z=0,ie=j.length;z<ie;z++){const H=j[z];H[2]=d(H[2]),H[3]=y(H[3])}}else if(d)for(let g=0,x=E.length;g<x;g++){const j=E[g];for(let z=0,ie=j.length;z<ie;z++){const H=j[z];H[2]=d(H[2])}}else if(y)for(let g=0,x=E.length;g<x;g++){const j=E[g];for(let z=0,ie=j.length;z<ie;z++){const H=j[z];H[2]=y(H[2])}}}:"extent"===s?I=>{I.xmin=c(I.xmin),I.ymin=l(I.ymin),I.xmax=c(I.xmax),I.ymax=l(I.ymax),d&&null!=I.zmax&&null!=I.zmin&&(I.zmax=d(I.zmax),I.zmin=d(I.zmin)),y&&null!=I.mmax&&null!=I.mmin&&(I.mmax=y(I.mmax),I.mmin=y(I.mmin))}:"multipoint"===s?I=>{const E=I.points;let M,B;for(let g=0,x=E.length;g<x;g++){const j=E[g];g>0?(M+=j[0],B+=j[1]):(M=j[0],B=j[1]),j[0]=c(M),j[1]=l(B)}if(d&&y)for(let g=0,x=E.length;g<x;g++){const j=E[g];j[2]=d(j[2]),j[3]=y(j[3])}else if(d)for(let g=0,x=E.length;g<x;g++){const j=E[g];j[2]=d(j[2])}else if(y)for(let g=0,x=E.length;g<x;g++){const j=E[g];j[2]=y(j[2])}}:null}};(0,v._)([(0,W.MZ)({type:String,json:{write:!0}})],A.prototype,"displayFieldName",void 0),(0,v._)([(0,W.MZ)({type:Boolean,json:{write:{overridePolicy:s=>({enabled:s})}}})],A.prototype,"exceededTransferLimit",void 0),(0,v._)([(0,W.MZ)({type:[J.A],json:{write:!0}})],A.prototype,"features",void 0),(0,v._)([(0,b.w)("features")],A.prototype,"readFeatures",null),(0,v._)([(0,W.MZ)({type:[G.A],json:{write:!0}})],A.prototype,"fields",void 0),(0,v._)([(0,W.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:P.read}}})],A.prototype,"geometryType",void 0),(0,v._)([(0,O.K)("geometryType")],A.prototype,"writeGeometryType",null),(0,v._)([(0,W.MZ)({type:Boolean,json:{write:{overridePolicy:s=>({enabled:s})}}})],A.prototype,"hasM",void 0),(0,v._)([(0,W.MZ)({type:Boolean,json:{write:{overridePolicy:s=>({enabled:s})}}})],A.prototype,"hasZ",void 0),(0,v._)([(0,W.MZ)({types:V.yR,json:{write:!0}})],A.prototype,"queryGeometry",void 0),(0,v._)([(0,b.w)("queryGeometry")],A.prototype,"readQueryGeometry",null),(0,v._)([(0,W.MZ)({type:F.A,json:{write:!0}})],A.prototype,"spatialReference",void 0),(0,v._)([(0,O.K)("spatialReference")],A.prototype,"writeSpatialReference",null),(0,v._)([(0,W.MZ)({json:{write:!0}})],A.prototype,"transform",void 0),A=p=(0,v._)([(0,k.$)("esri.rest.support.FeatureSet")],A),A.prototype.toJSON.isDefaultToJSON=!0;const m=A}}]);