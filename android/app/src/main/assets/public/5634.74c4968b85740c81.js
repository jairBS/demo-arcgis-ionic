"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5634],{50501:(ne,H,l)=>{l.d(H,{K:()=>A});const A=(m=>["operational-layers","basemap","ground"])()},81687:(ne,H,l)=>{l.d(H,{ui:()=>we,Yj:()=>xe,id:()=>De,kF:()=>k,fV:()=>me,C1:()=>Ae,hG:()=>re,hn:()=>pe,ke:()=>oe,Ih:()=>le,M6:()=>W,Qo:()=>he,Fm:()=>Ee,PY:()=>E,OZ:()=>D});var A=l(12849),m=l(50501),$=l(28067),j=l(32034),U=l(88135),z=(l(89952),l(77806),l(97442)),B=l(88485),q=l(46873);const E={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:m.K}}},W={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(p,h)=>!h.disablePopup},write:{enabled:!0,writer(p,h,f){h[f]=!p}}}},k={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:m.K}}},D={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:U.w}}},me={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:m.K}}},xe={value:null,type:B.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:m.K}}};function he(p){return{type:p,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const Y={write:{enabled:!0,layerContainerTypes:m.K},read:!0},oe={type:Number,json:{origins:{"web-document":Y,"portal-item":{write:!0}}}},le={...oe,json:{...oe.json,origins:{"web-document":{...Y,write:{enabled:!0,layerContainerTypes:m.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(p,h,f)=>{var M;return f&&"service"!==f.origin||!h.drawingInfo||void 0===h.drawingInfo.transparency?null!==(M=h.layerDefinition)&&void 0!==M&&M.drawingInfo&&void 0!==h.layerDefinition.drawingInfo.transparency?(0,q.D)(h.layerDefinition.drawingInfo.transparency):void 0:(0,q.D)(h.drawingInfo.transparency)}}}},we={type:A.A,readOnly:!0,get(){var p,h,f;const M=null!=(null===(p=this.layer)||void 0===p?void 0:p.timeInfo)?this.layer:null!=(null===(h=this.i3slayer)||void 0===h?void 0:h.timeInfo)?this.i3slayer:null;if(null==M)return null;const{datesInUnknownTimezone:P,timeOffset:K,useViewTime:X}=M,ee=null===(f=this.view)||void 0===f?void 0:f.timeExtent;let se=M.timeExtent;P&&(se=function V(p){if(!p)return p;const{start:h,end:f}=p;return new A.A({start:null!=h?(0,z.S1)(h,h.getTimezoneOffset(),"minutes"):h,end:null!=f?(0,z.S1)(f,f.getTimezoneOffset(),"minutes"):f})}(se));let J=X?ee&&se?ee.intersection(se):ee||se:se;if(!J||J.isEmpty||J.isAllTime)return J;K&&(J=J.offset(-K.value,K.unit)),P&&(J=function g(p){if(!p)return p;const{start:h,end:f}=p;return new A.A({start:null!=h?(0,z.S1)(h,-h.getTimezoneOffset(),"minutes"):h,end:null!=f?(0,z.S1)(f,-f.getTimezoneOffset(),"minutes"):f})}(J));const R=this._get("timeExtent");return J.equals(R)?R:J}},Ee={type:$.A,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(p,h)=>{const f=$.A.fromJSON(p);return null!=h.spatialReference&&"object"==typeof h.spatialReference&&(f.spatialReference=j.A.fromJSON(h.spatialReference)),f}}}},read:!1}},De={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},pe={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:m.K}}},name:"layerDefinition.minScale",write:!0}},re={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:m.K}}},name:"layerDefinition.maxScale",write:!0}},Ae={json:{write:{ignoreOrigin:!0,layerContainerTypes:m.K},origins:{"web-map":{read:!1,write:!1}}}}},88485:(ne,H,l)=>{l.d(H,{A:()=>q});var v,A=l(8189),m=l(49976),$=l(71065),j=l(11432),U=l(85211),x=(l(3248),l(35150),l(40707),l(17221)),_=l(76576),T=l(50305),L=l(10467),c=l(86300);let S=v=class extends $.oY{constructor(E){super(E)}collectRequiredFields(E,W){var k=this;return(0,L.A)(function*(){return(0,c.Dx)(E,W,k.expression)})()}clone(){return new v({expression:this.expression,title:this.title})}equals(E){return this.expression===E.expression&&this.title===E.title}};(0,A._)([(0,U.MZ)({type:String,json:{write:!0}})],S.prototype,"expression",void 0),(0,A._)([(0,U.MZ)({type:String,json:{write:!0}})],S.prototype,"title",void 0),S=v=(0,A._)([(0,_.$)("esri.layers.support.FeatureExpressionInfo")],S);const b=S;var w,N=l(82575);const g=(0,m.O)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),V=new m.J({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let B=w=class extends $.oY{constructor(E){super(E),this.offset=null}readFeatureExpressionInfo(E,W){return null!=E?E:W.featureExpression&&0===W.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(E,W,k,D){W[k]=E.write({},D),"0"===E.expression&&(W.featureExpression={value:0})}get mode(){const{offset:E,featureExpressionInfo:W}=this;return this._isOverridden("mode")?this._get("mode"):null!=E||W?"relative-to-ground":"on-the-ground"}set mode(E){this._override("mode",E)}set unit(E){this._set("unit",E)}write(E,W){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(E,W):null}clone(){return new w({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(E){return this.mode===E.mode&&this.offset===E.offset&&this.unit===E.unit&&(0,j.CM)(this.featureExpressionInfo,E.featureExpressionInfo)}};(0,A._)([(0,U.MZ)({type:b,json:{write:!0}})],B.prototype,"featureExpressionInfo",void 0),(0,A._)([(0,x.w)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],B.prototype,"readFeatureExpressionInfo",null),(0,A._)([(0,T.K)("featureExpressionInfo",{featureExpressionInfo:{type:b},"featureExpression.value":{type:[0]}})],B.prototype,"writeFeatureExpressionInfo",null),(0,A._)([(0,U.MZ)({type:g.apiValues,nonNullable:!0,json:{type:g.jsonValues,read:g.read,write:{writer:g.write,isRequired:!0}}})],B.prototype,"mode",null),(0,A._)([(0,U.MZ)({type:Number,json:{write:!0}})],B.prototype,"offset",void 0),(0,A._)([(0,U.MZ)({type:N.KQ,json:{type:String,read:V.read,write:V.write}})],B.prototype,"unit",null),B=w=(0,A._)([(0,_.$)("esri.layers.support.ElevationInfo")],B);const q=B},82575:(ne,H,l)=>{l.d(H,{Ao:()=>$,KQ:()=>U});var A=l(48716);function $(O){return 1/(A.j[O]||1)}const U=function j(){const O=Object.keys(A.j);return O.sort(),O}()},89063:(ne,H,l)=>{l.d(H,{A:()=>$e});var A=l(10467),m=l(8189),$=l(81098),j=l(98877),U=l(48900),O=l(85211),z=(l(3248),l(35150)),_=(l(40707),l(76576)),T=l(67685);function c(o){return"constant"===o.kind?o.value[0]:o.values[o.values.length-1]}function v(o){const a=o.toRgba();return[a[0]/255,a[1]/255,a[2]/255,a[3]]}function b(o){if(!o.hasVisualVariables("size"))return{kind:"constant",value:[(0,T.Lz)(o.trailWidth)]};const a=o.getVisualVariablesForType("size")[0],s=[],i=[];let u;if(a.stops){for(const d of a.stops)s.push(d.value),i.push((0,T.Lz)(d.size));u=a.stops.length}else s.push(a.minDataValue,a.maxDataValue),i.push((0,T.Lz)(a.minSize),(0,T.Lz)(a.maxSize)),u=2;return{kind:"ramp",stops:s,values:i,count:u}}function w(o){if(!o.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const a=o.getVisualVariablesForType("opacity")[0],s=[],i=[];for(const u of a.stops)s.push(u.value),i.push(u.opacity);return{kind:"ramp",stops:s,values:i,count:a.stops.length}}function g(o,a,s,i){switch(a){case"int":o.setUniform1iv(s,i);break;case"float":o.setUniform1fv(s,i);break;case"vec2":o.setUniform2fv(s,i);break;case"vec3":o.setUniform3fv(s,i);break;case"vec4":o.setUniform4fv(s,i)}}function V(o,a,s,i){"constant"===i.kind?g(o,s,`u_${a}`,i.value):(g(o,"float",`u_${a}_stops`,i.stops),g(o,s,`u_${a}_values`,i.values),o.setUniform1i(`u_${a}_count`,i.count))}function q(o,a){return o===a||null!=o&&null!=a&&o.equals(a)}function E(o,a){if(!function B(o,a){let s=!0;return s=s&&o.collisions===a.collisions,s=s&&o.density===a.density,s=s&&o.interpolate===a.interpolate,s=s&&o.lineCollisionWidth===a.lineCollisionWidth,s=s&&o.lineSpacing===a.lineSpacing,s=s&&o.maxTurnAngle===a.maxTurnAngle,s=s&&o.minSpeedThreshold===a.minSpeedThreshold,s=s&&o.segmentLength===a.segmentLength,s=s&&o.smoothing===a.smoothing,s=s&&o.velocityScale===a.velocityScale,s=s&&o.verticesPerLine===a.verticesPerLine,s}(o.simulationSettings,a.simulationSettings)||!q(o.timeExtent,a.timeExtent))return!1;let s=!0;return s=s&&o.loadImagery===a.loadImagery,s=s&&o.createFlowMesh===a.createFlowMesh,s=s&&o.color.kind===a.color.kind,s=s&&o.opacity.kind===a.opacity.kind,s=s&&o.size.kind===a.size.kind,s}var W=l(56492),k=l(32788),D=l(50915),me=l(26136),xe=l(4931),he=l(45513),Y=l(30454);class oe{constructor(a){this._params=a,this.animated=!1}isCompatible(a){if(!(a instanceof oe&&q(this._params.timeExtent,a._params.timeExtent)))return!1;let s=!0;return s=s&&this._params.loadImagery===a._params.loadImagery,s=s&&this._params.color.kind===a._params.color.kind,s=s&&this._params.opacity.kind===a._params.opacity.kind,s}load(a,s){var i=this;return(0,A.A)(function*(){const{extent:u,size:d}=a;(0,W.Te)(s);const y=yield i._params.loadImagery(u,d[0],d[1],i._params.timeExtent,s);return new De(y,{color:i._params.color,opacity:i._params.opacity})})()}render(a,s,i){const{context:u}=a,{program:d}=i;u.setFaceCullingEnabled(!1),u.setBlendingEnabled(!0),u.setBlendFunction(D.dn.ONE,D.dn.ONE_MINUS_SRC_ALPHA),u.useProgram(d),d.setUniformMatrix3fv("u_dvsMat3",s.dvsMat3),u.bindTexture(i.texture,0),d.setUniform1i("u_texture",0),d.setUniform1f("u_Min",i.min),d.setUniform1f("u_Max",i.max),V(d,"color","vec4",this._params.color),V(d,"opacity","float",this._params.opacity),u.bindVAO(i.vertexArray),u.drawArrays(D.WR.TRIANGLE_STRIP,0,4)}}const le=new Map;le.set("a_position",0),le.set("a_texcoord",1);const we={geometry:[new Y._("a_position",2,D.pe.UNSIGNED_SHORT,0,8),new Y._("a_texcoord",2,D.pe.UNSIGNED_SHORT,4,8)]},Ee={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:le};class De{constructor(a,s){this._flowData=a,this._values=s}attach(a){const{context:s}=a,{width:i,height:u}=this._flowData,d=k.g.createVertex(s,D._U.STATIC_DRAW,new Uint16Array([0,0,0,1,i,0,1,1,0,u,0,0,i,u,1,0])),y=new he.Z(s,le,we,{geometry:d}),I=[];"ramp"===this._values.color.kind&&I.push("vvColor"),"ramp"===this._values.opacity.kind&&I.push("vvOpacity");const C=a.painter.materialManager.getProgram(Ee,I);let Q=1e6,ue=-1e6;for(let G=0;G<u;G++)for(let Z=0;Z<i;Z++)if(0!==this._flowData.mask[G*i+Z]){const _e=this._flowData.data[2*(G*i+Z)],ve=this._flowData.data[2*(G*i+Z)+1],ge=Math.sqrt(_e*_e+ve*ve);Q=Math.min(Q,ge),ue=Math.max(ue,ge)}const ie=new Uint8Array(4*i*u);for(let G=0;G<u;G++)for(let Z=0;Z<i;Z++)if(0!==this._flowData.mask[G*i+Z]){const _e=this._flowData.data[2*(G*i+Z)],ve=this._flowData.data[2*(G*i+Z)+1],ge=(Math.sqrt(_e*_e+ve*ve)-Q)/(ue-Q);ie[4*(G*i+Z)]=255*ge,ie[4*(G*i+Z)+1]=0,ie[4*(G*i+Z)+2]=0,ie[4*(G*i+Z)+3]=255}else ie[4*(G*i+Z)]=0,ie[4*(G*i+Z)+1]=0,ie[4*(G*i+Z)+2]=0,ie[4*(G*i+Z)+3]=0;const ce=new xe.R;ce.internalFormat=D.Ab.RGBA,ce.wrapMode=D.pF.CLAMP_TO_EDGE,ce.flipped=!0,ce.width=i,ce.height=u;const Ge=new me.g(s,ce,ie);this.vertexArray=y,this.program=C,this.texture=Ge,this.min=Q,this.max=ue,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}class pe{constructor(a){this._params=a}get animated(){return this._params.flowSpeed>0}isCompatible(a){return a instanceof pe&&E(this._params,a._params)}load(a,s){var i=this;return(0,A.A)(function*(){const{extent:u,size:d}=a;(0,W.Te)(s);const y=yield i._params.loadImagery(u,d[0],d[1],i._params.timeExtent,s),{vertexData:I,indexData:C}=yield i._params.createFlowMesh("Particles",i._params.simulationSettings,y,s);return new h(I,C,{color:i._params.color,opacity:i._params.opacity,size:i._params.size})})()}render(a,s,i){const{context:u}=a,{program:d}=i;u.setFaceCullingEnabled(!1),u.setBlendingEnabled(!0),u.setBlendFunction(D.dn.ONE,D.dn.ONE_MINUS_SRC_ALPHA),u.useProgram(d),d.setUniform1f("u_time",s.time),d.setUniform1f("u_trailLength",this._params.trailLength),d.setUniform1f("u_flowSpeed",this._params.flowSpeed),d.setUniform1f("u_featheringSize",this._params.featheringSize),d.setUniform1f("u_featheringOffset",this._params.featheringOffset),d.setUniform1f("u_introFade",this._params.introFade?1:0),d.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),d.setUniform1f("u_decayRate",this._params.decayRate),d.setUniformMatrix3fv("u_dvsMat3",s.dvsMat3),d.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),V(d,"color","vec4",this._params.color),V(d,"opacity","float",this._params.opacity),V(d,"size","float",this._params.size),u.bindVAO(i.vertexArray),u.drawElements(D.WR.TRIANGLES,i.indexCount,D.pe.UNSIGNED_INT,0)}}const re=new Map;re.set("a_xyts0",0),re.set("a_xyts1",1),re.set("a_typeIdDurationSeed",2),re.set("a_extrudeInfo",3);const Ae={geometry:[new Y._("a_xyts0",4,D.pe.FLOAT,0,64),new Y._("a_xyts1",4,D.pe.FLOAT,16,64),new Y._("a_typeIdDurationSeed",4,D.pe.FLOAT,32,64),new Y._("a_extrudeInfo",4,D.pe.FLOAT,48,64)]},p={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:re};class h{constructor(a,s,i){this._vertexData=a,this._indexData=s,this._values=i}attach(a){const{context:s}=a,i=k.g.createVertex(s,D._U.STATIC_DRAW,this._vertexData),u=k.g.createIndex(s,D._U.STATIC_DRAW,this._indexData),d=new he.Z(s,re,Ae,{geometry:i},u),y=[];"ramp"===this._values.color.kind&&y.push("vvColor"),"ramp"===this._values.opacity.kind&&y.push("vvOpacity"),"ramp"===this._values.size.kind&&y.push("vvSize");const I=a.painter.materialManager.getProgram(p,y);this.vertexArray=d,this.program=I,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}class f{constructor(a){this._styles=a}get animated(){return this._styles.reduce((a,s)=>a||s.animated,!1)}isCompatible(a){if(!(a instanceof f)||this._styles.length!==a._styles.length)return!1;const s=this._styles.length;for(let i=0;i<s;i++)if(!this._styles[i].isCompatible(a._styles[i]))return!1;return!0}load(a,s){var i=this;return(0,A.A)(function*(){const u=yield Promise.all(i._styles.map(d=>d.load(a,s)));return new M(u)})()}render(a,s,i){for(let u=0;u<this._styles.length;u++)this._styles[u].render(a,s,i.resources[u])}}class M{constructor(a){this.resources=a}attach(a){for(const s of this.resources)s.attach(a)}detach(){for(const a of this.resources)a.detach()}get ready(){return this.resources.reduce((a,s)=>a&&s.ready,!0)}}class P{constructor(a){this._params=a}get animated(){return this._params.flowSpeed>0}isCompatible(a){return a instanceof P&&E(this._params,a._params)}load(a,s){var i=this;return(0,A.A)(function*(){const{extent:u,size:d}=a;(0,W.Te)(s);const y=yield i._params.loadImagery(u,d[0],d[1],i._params.timeExtent,s),{vertexData:I,indexData:C}=yield i._params.createFlowMesh("Streamlines",i._params.simulationSettings,y,s);return new se(I,C,{color:i._params.color,opacity:i._params.opacity,size:i._params.size})})()}render(a,s,i){const{context:u}=a,{program:d}=i;u.setFaceCullingEnabled(!1),u.setBlendingEnabled(!0),u.setBlendFunction(D.dn.ONE,D.dn.ONE_MINUS_SRC_ALPHA),u.useProgram(d),d.setUniform1f("u_time",s.time),d.setUniform1f("u_trailLength",this._params.trailLength),d.setUniform1f("u_flowSpeed",this._params.flowSpeed),d.setUniform1f("u_featheringSize",this._params.featheringSize),d.setUniform1f("u_featheringOffset",this._params.featheringOffset),d.setUniform1f("u_introFade",this._params.introFade?1:0),d.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),d.setUniform1f("u_decayRate",this._params.decayRate),d.setUniformMatrix3fv("u_dvsMat3",s.dvsMat3),d.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),V(d,"color","vec4",this._params.color),V(d,"opacity","float",this._params.opacity),V(d,"size","float",this._params.size),u.bindVAO(i.vertexArray),u.drawElements(D.WR.TRIANGLES,i.indexCount,D.pe.UNSIGNED_INT,0)}}const K=new Map;K.set("a_positionAndSide",0),K.set("a_timeInfo",1),K.set("a_extrude",2),K.set("a_speed",3);const X={geometry:[new Y._("a_positionAndSide",3,D.pe.FLOAT,0,36),new Y._("a_timeInfo",3,D.pe.FLOAT,12,36),new Y._("a_extrude",2,D.pe.FLOAT,24,36),new Y._("a_speed",1,D.pe.FLOAT,32,36)]},ee={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:K};class se{constructor(a,s,i){this._vertexData=a,this._indexData=s,this._values=i}attach(a){const{context:s}=a,i=k.g.createVertex(s,D._U.STATIC_DRAW,this._vertexData),u=k.g.createIndex(s,D._U.STATIC_DRAW,this._indexData),d=new he.Z(s,K,X,{geometry:i},u),y=[];"ramp"===this._values.color.kind&&y.push("vvColor"),"ramp"===this._values.opacity.kind&&y.push("vvOpacity"),"ramp"===this._values.size.kind&&y.push("vvSize");const I=a.painter.materialManager.getProgram(ee,y);this.vertexArray=d,this.program=I,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}var Ie=l(91551),Te=l(12273),Re=l(67448);class Ue extends Re.A{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:(0,Te.vt)(),displayViewMat3:(0,Te.vt)()}}dispose(){}prepareState(a){const{context:s}=a;s.setColorMask(!0,!0,!0,!0),s.setStencilFunction(D.MT.EQUAL,0,255)}draw(a,s){const{requestRender:i,allowDelayedRender:u}=a,{displayData:d}=s;if(null==d||("loaded"===d.state.name&&d.attach(a),"attached"!==d.state.name))return;const y=d.state.resources;!u||y.ready||null==i?(this._visualState.time=a.time/1e3,this._visualState.dvsMat3=s.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=a.state.displayViewMat3,d.flowStyle.render(a,this._visualState,y),d.flowStyle.animated&&null!=i&&i()):i()}}var be=l(69473),Ce=l(54382);class Fe extends Ce.A{constructor(){super(...arguments),this.flowStyle=null}doRender(a){super.doRender(a)}prepareRenderPasses(a){const s=a.registerRenderPass({name:"flow",brushes:[Ue],target:()=>this.children,drawPhase:be.S5.MAP});return[...super.prepareRenderPasses(a),s]}}l(21152);var Me=l(69287),Le=l(13303);class ze{constructor(a,s,i,u){this.state={name:"created"},this.flowStyle=a,this.extent=s,this.size=i,this.pixelRatio=u}load(){var a=this;return(0,A.A)(function*(){const s=new AbortController;a.state={name:"loading",abortController:s};const i={extent:a.extent,size:a.size,pixelRatio:a.pixelRatio},u=yield a.flowStyle.load(i,s.signal);a.state={name:"loaded",resources:u}})()}attach(a){if("loaded"!==this.state.name)return void z.A.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const s=this.state.resources;s.attach(a),this.state={name:"attached",resources:s}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(a){return!!this.flowStyle.isCompatible(a.flowStyle)&&!(!this.extent.equals(a.extent)||this.size[0]!==a.size[0]||this.size[1]!==a.size[1]||this.pixelRatio!==a.pixelRatio||(this.flowStyle=a.flowStyle,0))}}var ye=l(31610),Ve=l(63888);class je extends Ve.q{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(a){this._displayData=a,this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(a){const{displayData:s}=this;if(null==s)return;const d=[0,0];a.toScreen(d,[s.extent.xmin,s.extent.ymax]);const y=(s.extent.xmax-s.extent.xmin)/s.size[0]/a.resolution,I=(0,Me.kU)(a.rotation),{displayViewScreenMat3:C}=this.transforms;(0,ye.kN)(C,[-1,1,0]),(0,ye.hs)(C,C,[2/(a.size[0]*a.pixelRatio),-2/(a.size[1]*a.pixelRatio),1]),(0,ye.Tl)(C,C,[d[0],d[1],0]),(0,ye.e$)(C,C,I),(0,ye.hs)(C,C,[y*a.pixelRatio,y*a.pixelRatio,1])}_createTransforms(){return{displayViewScreenMat3:(0,Te.vt)()}}}var Ne=l(28067);let de=class extends j.A{constructor(o){super(o),this._flowDisplayObject=new je,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(o){const{flowStyle:a}=this.flowContainer;if(null==a)return void this._clear();const{extent:s,rotation:i,resolution:u,pixelRatio:d}=o.state,y=function Ke(o,a){const s=new Le.A({x:(o.xmax+o.xmin)/2,y:(o.ymax+o.ymin)/2,spatialReference:o.spatialReference}),i=o.xmax-o.xmin,u=o.ymax-o.ymin,d=Math.abs(Math.cos((0,Me.kU)(a))),y=Math.abs(Math.sin((0,Me.kU)(a))),I=d*i+y*u,C=y*i+d*u,Q=new Ne.A({xmin:s.x-I/2,ymin:s.y-C/2,xmax:s.x+I/2,ymax:s.y+C/2,spatialReference:o.spatialReference});return Q.centerAt(s),Q}(s,i);y.expand(1.15);const I=[Math.round((y.xmax-y.xmin)/u),Math.round((y.ymax-y.ymin)/u)],C=new ze(a,y,I,d);if(null!=this._loading){if(this._loading.update(C))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(C)||(C.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},Q=>{(0,W.zf)(Q)||(z.A.getLogger(this).error("A resource failed to load.",Q),this._loading=null)}),this._loading=C)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}};(0,m._)([(0,O.MZ)()],de.prototype,"_loading",void 0),(0,m._)([(0,O.MZ)()],de.prototype,"flowContainer",void 0),(0,m._)([(0,O.MZ)()],de.prototype,"updating",null),de=(0,m._)([(0,_.$)("esri.views.2d.engine.flow.FlowStrategy")],de);const We=de;let ae=class extends j.A{constructor(){var o;super(...arguments),o=this,this._loadImagery=(a,s,i,u,d)=>(0,Ie.pH)(this.layer,a,s,i,u,d),this._createFlowMesh=(a,s,i,u)=>this.layer.createFlowMesh({meshType:a,flowData:i,simulationSettings:s},{signal:u}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=(0,A.A)(function*(){o._updateVisualization()})}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:o}=this,a=()=>{this._loadImagery=(s,i,u,d,y)=>(0,Ie.pH)(o,s,i,u,d,y),this._updateVisualization()};this.addHandles("multidimensionalDefinition"in o?(0,U.wB)(()=>o.multidimensionalDefinition,a):[(0,U.wB)(()=>o.mosaicRule,a),(0,U.wB)(()=>o.rasterFunction,a),(0,U.wB)(()=>o.definitionExpression,a)]),this.container=new Fe,this._strategy=new We({flowContainer:this.container}),this._updateVisualization()}detach(){var o;this._strategy.destroy(),null!==(o=this.container)&&void 0!==o&&o.removeAllChildren(),this.container=null,this.removeHandles()}update(o){o.stationary?this._strategy.update(o):this.layerView.requestUpdate()}hitTest(o){return new $.A({attributes:{},geometry:o.clone(),layer:this.layer})}moveEnd(){}doRefresh(){return(0,A.A)(function*(){})()}_updateVisualization(){const o=this.layer.renderer;if(null==o||"flow"!==o.type)return;const a=function Pe(o,a){const{flowSpeed:s,trailLength:i}=o,u=function L(o){const a=c(b(o)),s=a,u=Math.max(a/2,5),d=Math.round((0,T.Lz)(o.maxPathLength)/u)+1,{density:I}=o;return{smoothing:(0,T.Lz)(o.smoothing),interpolate:!0,velocityScale:"flow-from"===o.flowRepresentation?1:-1,verticesPerLine:d,minSpeedThreshold:.001,segmentLength:u,maxTurnAngle:1,collisions:!0,lineCollisionWidth:s,lineSpacing:10,density:I}}(o);let d=null;const y={opacity:w(o),size:b(o)};let I=function N(o){if(!o.hasVisualVariables("color"))return{kind:"constant",value:v(o.color)};const a=o.getVisualVariablesForType("color")[0],s=[],i=[];for(const u of a.stops)s.push(u.value),Array.prototype.push.apply(i,v(u.color));return{kind:"ramp",stops:s,values:i,count:a.stops.length}}(o);"none"===o.background?y.color=I:("constant"===I.kind&&(I={kind:"ramp",stops:[0,1],values:[0,0,0,1,I.value[0],I.value[1],I.value[2],I.value[3]],count:2}),d=new oe({loadImagery:a.loadImagery,timeExtent:a.timeExtent,color:I,opacity:{kind:"constant",value:[1]}}),y.color={kind:"constant",value:[.1,.1,.1,1]});const C={loadImagery:a.loadImagery,createFlowMesh:a.createFlowMesh,simulationSettings:u,timeExtent:a.timeExtent,trailLength:i,flowSpeed:s,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:y.color,opacity:y.opacity,size:y.size},Q="butt"===o.trailCap||c(b(o))<=4?new P(C):new pe(C);return null!=d?new f([d,Q]):Q}(o,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=a,this.layerView.requestUpdate()}};(0,m._)([(0,O.MZ)()],ae.prototype,"_strategy",void 0),(0,m._)([(0,O.MZ)()],ae.prototype,"attached",void 0),(0,m._)([(0,O.MZ)()],ae.prototype,"container",void 0),(0,m._)([(0,O.MZ)()],ae.prototype,"layer",void 0),(0,m._)([(0,O.MZ)()],ae.prototype,"layerView",void 0),(0,m._)([(0,O.MZ)()],ae.prototype,"type",void 0),(0,m._)([(0,O.MZ)()],ae.prototype,"updating",null),(0,m._)([(0,O.MZ)()],ae.prototype,"timeExtent",void 0),ae=(0,m._)([(0,_.$)("esri.views.2d.engine.flow.FlowView2D")],ae);const $e=ae},21941:(ne,H,l)=>{l.d(H,{A:()=>F});var A=l(67448),m=l(50915);const $=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),j=new Float32Array([0,92/255,230/255,1]),U={beaufort_ft:$,beaufort_m:$,beaufort_km:$,beaufort_mi:$,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:j,single_arrow:j,wind_speed:new Float32Array([0,0,0,1])},O=[0,20];class F extends A.A{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:x}){x.setBlendingEnabled(!0),x.setBlendFunctionSeparate(m.dn.ONE,m.dn.ONE_MINUS_SRC_ALPHA,m.dn.ONE,m.dn.ONE_MINUS_SRC_ALPHA),x.setColorMask(!0,!0,!0,!0),x.setStencilWriteMask(0),x.setStencilTestEnabled(!0),x.setStencilOp(m.eA.KEEP,m.eA.KEEP,m.eA.REPLACE)}draw(x,_){if(null==_.source||0===_.source.validPixelCount)return;const{context:T,timeline:L}=x;if(L.begin(this.name),T.setStencilFunction(m.MT.EQUAL,_.stencilRef,255),_.updateVectorFieldVAO(x),"scalar"===x.renderPass){const c=_.vaoData.scalar;c&&this._drawScalars(x,_,c.vao,c.elementCount)}else{const c=_.vaoData.magdir;c&&this._drawTriangles(x,_,c.vao,c.elementCount)}L.end(this.name)}_drawTriangles(x,_,T,L){const{context:c,painter:v,requestRender:S,allowDelayedRender:b}=x,{symbolizerParameters:N}=_,w=N.dataRange?["dataRange"]:[];"geographic"===N.rotationType&&w.push("rotationGeographic");const g=v.materialManager.getProgram(this._desc.magdir,w);if(b&&null!=S&&!g.compiled)return void S();c.useProgram(g);const{coordScale:V,opacity:B,transforms:q}=_;g.setUniform2fv("u_coordScale",V),g.setUniform1f("u_opacity",B),g.setUniformMatrix3fv("u_dvsMat3",q.displayViewScreenMat3);const{style:E,dataRange:W,rotation:k,symbolPercentRange:D}=N;g.setUniform4fv("u_colors",U[E]),g.setUniform2fv("u_dataRange",W||O),g.setUniform1f("u_rotation",k),g.setUniform2fv("u_symbolPercentRange",D);const me=this._getSymbolSize(x,_);g.setUniform2fv("u_symbolSize",me),c.bindVAO(T),c.drawElements(m.WR.TRIANGLES,L,m.pe.UNSIGNED_INT,0)}_drawScalars(x,_,T,L){const{context:c,painter:v,requestRender:S,allowDelayedRender:b}=x,{symbolizerParameters:N}=_,w=[];"wind_speed"===N.style?w.push("innerCircle"):N.dataRange&&w.push("dataRange"),"geographic"===N.rotationType&&w.push("rotationGeographic");const g=v.materialManager.getProgram(this._desc.scalar,w);if(b&&null!=S&&!g.compiled)return void S();c.useProgram(g);const{coordScale:V,opacity:B,transforms:q}=_;g.setUniform2fv("u_coordScale",V),g.setUniform1f("u_opacity",B),g.setUniformMatrix3fv("u_dvsMat3",q.displayViewScreenMat3);const{dataRange:E,symbolPercentRange:W}=N;g.setUniform2fv("u_dataRange",E||O),g.setUniform2fv("u_symbolPercentRange",W);const k=this._getSymbolSize(x,_);g.setUniform2fv("u_symbolSize",k),c.bindVAO(T),c.drawElements(m.WR.TRIANGLES,L,m.pe.UNSIGNED_INT,0)}_getSymbolSize(x,_){const T=_.key?2**(x.displayLevel-_.key.level):_.resolution/x.state.resolution,{symbolTileSize:L}=_.symbolizerParameters;return[L/(Math.round((_.width-_.offset[0])/L)*L)/T,L/(Math.round((_.height-_.offset[1])/L)*L)/T]}}},74856:(ne,H,l)=>{l.d(H,{X:()=>T}),l(3248);var m=l(31610),$=l(12273),j=l(88532),U=l(50444),O=l(63888),F=l(24370),z=l(32788),x=l(50915),_=l(45513);class T extends O.q{constructor(c=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=c}destroy(){var c,v;null!=this.vaoData&&(null!==(c=this.vaoData.magdir)&&void 0!==c&&c.vao.dispose(),null!==(v=this.vaoData.scalar)&&void 0!==v&&v.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(c){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(c)&&(this._symbolizerParameters=c,this.invalidateVAO())}get source(){return this._source}set source(c){this._source=c,this.invalidateVAO()}invalidateVAO(){var c,v;this._vaoInvalidated||null==this.vaoData||(null!==(c=this.vaoData.magdir)&&void 0!==c&&c.vao.dispose(),null!==(v=this.vaoData.scalar)&&void 0!==v&&v.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(c){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,null!=this.source&&null==this.vaoData){const{style:v}=this.symbolizerParameters;switch(v){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const S=(0,U.gf)(this.source,this.symbolizerParameters),b=this._createVectorFieldVAO(c.context,S);this.vaoData={magdir:b}}break;case"simple_scalar":{const S=(0,U.Ud)(this.source,this.symbolizerParameters),b=this._createVectorFieldVAO(c.context,S);this.vaoData={scalar:b}}break;case"wind_speed":{const S=(0,U.gf)(this.source,this.symbolizerParameters),b=this._createVectorFieldVAO(c.context,S),N=(0,U.Ud)(this.source,this.symbolizerParameters),w=this._createVectorFieldVAO(c.context,N);this.vaoData={magdir:b,scalar:w}}}}this.ready(),this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:(0,$.vt)()}}setTransform(c){const v=(0,m.D_)(this.transforms.displayViewScreenMat3),[S,b]=c.toScreenNoRotation([0,0],[this.x,this.y]),N=this.resolution/this.pixelRatio/c.resolution,w=N*this.width,g=N*this.height,V=Math.PI*this.rotation/180;(0,m.Tl)(v,v,(0,j.fA)(S,b)),(0,m.Tl)(v,v,(0,j.fA)(w/2,g/2)),(0,m.e$)(v,v,-V),(0,m.Tl)(v,v,(0,j.fA)(-w/2,-g/2)),(0,m.Oe)(v,v,(0,j.fA)(w,g)),(0,m.lw)(this.transforms.displayViewScreenMat3,c.displayViewMat3,v)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(c,v){const{vertexData:S,indexData:b}=v,N=z.g.createVertex(c,x._U.STATIC_DRAW,new Float32Array(S)),w=z.g.createIndex(c,x._U.STATIC_DRAW,new Uint32Array(b)),g=(0,F.ES)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:x.pe.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:x.pe.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:x.pe.FLOAT,normalized:!1}]});return{vao:new _.Z(c,g.attributes,g.bufferLayouts,{geometry:N},w),elementCount:b.length}}}},96081:(ne,H,l)=>{l.d(H,{A:()=>x});var A=l(8189),m=l(35150),$=l(56492),j=l(48900),z=(l(3248),l(40707),l(5922),l(76576));const x=_=>{let T=class extends _{initialize(){this.addHandles((0,j.on)(()=>this.layer,"refresh",L=>{this.doRefresh(L.dataChanged).catch(c=>{(0,$.zf)(c)||m.A.getLogger(this).error(c)})}),"RefreshableLayerView")}};return T=(0,A._)([(0,z.$)("esri.layers.mixins.RefreshableLayerView")],T),T}},64935:(ne,H,l)=>{l.d(H,{D8:()=>U,TO:()=>$});var A=l(10467),m=l(86300);function $(F){return j.apply(this,arguments)}function j(){return(j=(0,A.A)(function*(F,z=F.popupTemplate){var x,_;if(null==z)return[];const T=yield z.getRequiredFields(F.fieldsIndex),{lastEditInfoEnabled:L}=z,{objectIdField:c,typeIdField:v,globalIdField:S,relationships:b}=F;if(T.includes("*"))return["*"];const N=L?(0,m.eX)(F):[],w=(0,m.DB)(F.fieldsIndex,[...T,...N]);return v&&w.push(v),w&&c&&null!==(x=F.fieldsIndex)&&void 0!==x&&x.has(c)&&!w.includes(c)&&w.push(c),w&&S&&null!==(_=F.fieldsIndex)&&void 0!==_&&_.has(S)&&!w.includes(S)&&w.push(S),b&&b.forEach(g=>{var V;const{keyField:B}=g;w&&B&&null!==(V=F.fieldsIndex)&&void 0!==V&&V.has(B)&&!w.includes(B)&&w.push(B)}),w})).apply(this,arguments)}function U(F,z){return F.popupTemplate?F.popupTemplate:null!=z&&z.defaultPopupTemplateEnabled&&null!=F.defaultPopupTemplate?F.defaultPopupTemplate:null}}}]);