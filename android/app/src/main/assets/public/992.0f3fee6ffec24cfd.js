"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[992],{48716:(Se,re,y)=>{y.d(re,{j:()=>O});var M=y(82663),f=y(47258);const O={unknown:1,inches:(0,M.oU)(1,"meters","inches"),feet:(0,M.oU)(1,"meters","feet"),"us-feet":(0,M.oU)(1,"meters","us-feet"),yards:(0,M.oU)(1,"meters","yards"),miles:(0,M.oU)(1,"meters","miles"),"nautical-miles":(0,M.oU)(1,"meters","nautical-miles"),millimeters:(0,M.oU)(1,"meters","millimeters"),centimeters:(0,M.oU)(1,"meters","centimeters"),decimeters:(0,M.oU)(1,"meters","decimeters"),meters:(0,M.oU)(1,"meters","meters"),kilometers:(0,M.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,M.vl)(1,"meters",f.$O.radius)}},28291:(Se,re,y)=>{y.d(re,{YS:()=>Oe,n_:()=>ii,Wn:()=>ti});var M=y(47669),f=y(23070),O=y(69473);class I{constructor(i){this.registryName=i,this.postProcessingEnabled=!1,this.overrideStencilRef=null,this.drawPhase=O.S5.MAP|O.S5.HITTEST|O.S5.HIGHLIGHT|O.S5.DEBUG,this.symbologyPlane=O.uC.FILL}startup(){}shutdown(i){}postProcess(i,r){}}var l=y(8189),u=y(24821),s=y(3902),B=y(4196),k=y(16585);class R extends u.ZA{}(0,l._)([(0,u.C5)(0,s.ZY)],R.prototype,"pos",void 0);class G extends u.k2{}(0,l._)([(0,u.Pi)(s.nt)],G.prototype,"dotSize",void 0);class K extends u.k2{}(0,l._)([(0,u.Pi)(s.z7)],K.prototype,"locations",void 0),(0,l._)([(0,u.Pi)(s.nt)],K.prototype,"pixelRatio",void 0),(0,l._)([(0,u.Pi)(s.nt)],K.prototype,"tileZoomFactor",void 0);class q extends u.A{vertex(i){const r=new s.U(1,0,0,0,-1,0,0,1,1).multiply(new s.eB(i.pos.xy.divide(M.CQ),1)),n=(0,s.US)(this.draw.locations,r.xy),o=(0,s.T9)(this.instance.dotSize.divide(2),new s.nt(1));let c=new s.nt(0);c=c.add((0,s.PM)(n.a,new s.nt(1e-6)).multiply(2));let p=o.add(this.instance.dotSize);const g=this.view.displayViewScreenMat3.multiply(new s.eB(i.pos.add(.5),1)),_=new s.Zb(g.xy,c,1),S=this.instance.dotSize.divide(p),w=new s.nt(-1).divide(o.divide(p));return p=p.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:_,glPointSize:p,color:n,ratio:S,invEdgeRatio:w}}fragment(i){const r=(0,s.Bw)(i.glPointCoord.subtract(.5)).multiply(2),n=(0,s.TF)(new s.nt(0),new s.nt(1),i.invEdgeRatio.multiply(r.subtract(i.ratio)).add(1)),o=new u.mm;return o.glFragColor=i.color.multiply(n),o}}(0,l._)([(0,u.Pi)(G)],q.prototype,"instance",void 0),(0,l._)([(0,u.Pi)(K)],q.prototype,"draw",void 0),(0,l._)([(0,u.Pi)(k.o)],q.prototype,"view",void 0),(0,l._)([(0,l.a)(0,(0,u.hF)(R))],q.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.hF)(class L extends B.DM{}))],q.prototype,"fragment",null);var F=y(6702),h=y(875);class V extends B.rz{}(0,l._)([(0,u.C5)(3,s.nt)],V.prototype,"inverseArea",void 0);class W extends u.k2{}(0,l._)([(0,u.Pi)(s.My.ofType(s.Zb,2))],W.prototype,"isActive",void 0),(0,l._)([(0,u.Pi)(s.My.ofType(s.Zb,8))],W.prototype,"colors",void 0),(0,l._)([(0,u.Pi)(s.nt)],W.prototype,"dotValue",void 0);class ee extends u.k2{}(0,l._)([(0,u.Pi)(s.z7)],ee.prototype,"dotTexture0",void 0),(0,l._)([(0,u.Pi)(s.z7)],ee.prototype,"dotTexture1",void 0),(0,l._)([(0,u.Pi)(s.nt)],ee.prototype,"tileZoomFactor",void 0),(0,l._)([(0,u.Pi)(s.nt)],ee.prototype,"pixelRatio",void 0),(0,l._)([(0,u.Pi)(s.nt)],ee.prototype,"tileDotsOverArea",void 0);class oe extends B.f_{_dotThreshold(i,r,n){return i.divide(r).divide(n)}vertex(i){const r=new s.U(2/M.CQ,0,0,0,-2/M.CQ,0,-1,1,1).multiply(new s.eB(i.pos,1)),n=this.clip(i.id),o=new s.Zb(r.xy,n,1),c=this.storage.getVVData(i.id).multiply(this.instance.isActive.get(0)).multiply(i.inverseArea),p=this.storage.getDataDrivenData0(i.id).multiply(this.instance.isActive.get(1)).multiply(i.inverseArea),g=this.draw.tileZoomFactor.multiply(M.CQ).divide(this.draw.pixelRatio),_=this._dotThreshold(c,this.instance.dotValue,this.draw.tileDotsOverArea),S=this._dotThreshold(p,this.instance.dotValue,this.draw.tileDotsOverArea),w=i.pos.add(.5).divide(g);return{glPosition:o,color:new s.Zb(0,0,0,0),textureCoords:w,thresholds0:_,thresholds1:S}}fragment(i){const r=new u.mm,n=(0,s.US)(this.draw.dotTexture0,i.textureCoords),o=(0,s.US)(this.draw.dotTexture1,i.textureCoords),c=i.thresholds0.subtract(n),p=i.thresholds1.subtract(o);let g;const _=s.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),S=s.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const w=(0,s.PM)(new s.nt(0),c),P=(0,s.PM)(new s.nt(0),p),z=(0,s.Om)(w,c).add((0,s.Om)(P,p)),T=(0,s.PM)(z,new s.nt(0)),N=new s.nt(1).subtract(T),j=z.add(T),$=c.multiply(w).divide(j),se=p.multiply(P).divide(j),Q=_.multiply($).add(S.multiply(se));g=N.multiply(Q)}else{const w=(0,s.T9)((0,h.xf)(c),(0,h.xf)(p)),P=(0,s.PM)(w,new s.nt(0)),z=new s.nt(1).subtract(P),T=(0,s.PM)(w,c),N=(0,s.PM)(w,p),j=_.multiply(T).add(S.multiply(N));g=z.multiply(j)}return r.glFragColor=g,r}hittest(i){return(0,F.My)(this.hittestRequest)}}(0,l._)([u.E8],oe.prototype,"blending",void 0),(0,l._)([(0,u.Pi)(W)],oe.prototype,"instance",void 0),(0,l._)([(0,u.Pi)(ee)],oe.prototype,"draw",void 0),(0,l._)([(0,l.a)(0,(0,u.hF)(V))],oe.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.hF)(B.DM))],oe.prototype,"fragment",null);var d=y(40707),a=y(50915);const v={[a.pe.BYTE]:1,[a.pe.UNSIGNED_BYTE]:1,[a.pe.SHORT]:2,[a.pe.UNSIGNED_SHORT]:2,[a.pe.INT]:4,[a.pe.UNSIGNED_INT]:4,[a.pe.FLOAT]:4};var m=y(32788),x=y(45513),E=y(30454);class C{constructor(i,r){this._boundPart=null;const n=[];for(const c of r.vertex){const p=m.g.createVertex(i,a._U.STATIC_DRAW,c);n.push(p)}const o=[];for(const c of r.index||[]){const p=m.g.createIndex(i,a._U.STATIC_DRAW,c);o.push(p)}this.groups=[];for(const c of r.groups){let p;if(null!=c.index){if(!r.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:z}=r.index[c.index];2===z?p=a.pe.UNSIGNED_SHORT:4===z&&(p=a.pe.UNSIGNED_INT)}const g=null!=c.index?o[c.index]:null,_=new Map,S={},w={};for(const z of c.attributes){const{name:T,count:N,type:j,offset:$,normalized:se,divisor:Q,stride:ne,vertex:le,location:de}=z,J=`vertex-buffer-${le}`;let fe=S[J];fe||(fe=S[J]=[]);const Me=new E._(T,N,j,$,ne,se,Q);fe.push(Me),_.set(T,de),w[J]=n[le]}const P=new x.Z(i,_,S,w,g);this.groups.push({...c,vertexArray:P,locations:_,layout:S,indexing:p})}this.parts=r.parts}bind(i,r){this._boundPart=r;const{group:n}=this.parts[this._boundPart],{vertexArray:o}=this.groups[n];i.bindVAO(o)}draw(i){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:r,count:n}=this.parts[this._boundPart],{group:o}=this.parts[this._boundPart],{indexing:c,primitive:p}=this.groups[o];c?i.drawElements(p,n,c,r*v[c]):i.drawArrays(p,r,n)}unbind(i){this._boundPart=null,i.bindVAO(null)}destroy(){for(const{vertexArray:i}of this.groups)i.dispose()}}var Z=y(1416);class Y extends C{static create(i,r){const n=[];let{stride:o,hash:c}=r.layout;if(null==o){o=0;for(const{count:z,type:T,offset:N}of r.layout.attributes){if(null!=N)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");o+=z*v[T]}}let p=0,g=0;for(const{count:z,name:T,offset:N,type:j,normalized:$}of r.layout.attributes)null!=N&&(g=N),n.push({name:T,location:p,vertex:0,count:z,type:j,offset:g,stride:o,divisor:0,normalized:null!=$&&$}),p++,g+=z*v[j];const _={attributes:n,primitive:r.primitive};null!=r.index&&(_.index=0);let{count:S}=r;if(null==S&&(S=r.index?r.index.length:r.vertex.byteLength/o,Math.floor(S)!==S))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${o}.`);const P={vertex:[r.vertex],parts:[{start:0,count:S,group:0,primitive:r.primitive}],groups:[_]};return null!=r.index&&(P.index=[r.index]),null==c&&(c=(0,Z.hU)(n)),new Y(i,P,{hash:c,attributes:n,stride:o})}constructor(i,r,n){super(i,r),this.layout=n}bind(i,r=0){super.bind(i,r)}}var H=y(79061),ae=y(17107),ie=y(49950),we=y(26136),Ve=y(4931);class ft{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(i){if(null==this._dotFBO){const r=M.CQ,n=M.CQ,o=new Ve.R(r,n);o.samplingMode=a.Cj.NEAREST,o.wrapMode=a.pF.CLAMP_TO_EDGE;const c=new ae.l(i,new ie.q(a.yQ.DEPTH_STENCIL,r,n));this._dotFBO=new H.H(i,o,c)}return this._dotFBO}getDotDensityMesh(i){if(null==this._dotMesh){const r=M.CQ,n=r*r,o=2,c=new Int16Array(n*o);for(let _=0;_<r;_++)for(let S=0;S<r;S++)c[o*(S+_*r)]=S,c[o*(S+_*r)+1]=_;const p=[{count:2,type:a.pe.UNSIGNED_SHORT,name:"a_position",offset:0}],g={hash:(0,Z.hU)(p),attributes:p,stride:4};this._dotMesh=Y.create(i,{primitive:a.WR.POINTS,vertex:c,count:n,layout:g})}return this._dotMesh}getDotDensityTextures(i,r,n){if(this._dotTextureSize===r&&this._seed===n||(this._disposeTextures(),this._dotTextureSize=r,this._seed=n),null===this._dotTextures){const o=new d.A(n);this._dotTextures=[this._allocDotDensityTexture(i,r,o),this._allocDotDensityTexture(i,r,o)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let i=0;i<this._dotTextures.length;i++)this._dotTextures[i].dispose();this._dotTextures=null}}_allocDotDensityTexture(i,r,n){const o=new Float32Array(r*r*4);for(let p=0;p<o.length;p++)o[p]=n.getFloat();const c=new Ve.R;return c.dataType=a.ld.FLOAT,c.samplingMode=a.Cj.NEAREST,c.width=r,c.height=r,new we.g(i,c,o)}}var ce=y(73624),Ke=y(35891),vt=y(61254);function Te(b){const i=1/b;return{antialiasing:i,blur:0+i}}var bt=y(80302),St=y(3772),Vt=y(61312),Pt=y(89148),Tt=y(35150),$e=y(11432),We=y(5922);class ke{constructor(i,r,n,o){this.dataType=i,this.samplingMode=r,this.pixelFormat=n,this.internalFormat=o}}class At{destroy(){this._accumulateFramebuffer=(0,$e.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,$e.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(i){if(null==this._qualityProfile){const r=function Ct(b,i){const{textureFloat:r,colorBufferFloat:n}=b.capabilities,o=null==r?void 0:r.textureFloatLinear,c=null==n?void 0:n.textureFloat,p=null==n?void 0:n.textureHalfFloat,g=null==n?void 0:n.floatBlend,_=b.driverTest.floatBufferBlend.result;if(!c&&!p)throw new We.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(g&&_||p))throw new We.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(_?"":" This device claims support for EXT_float_blend, but does not actually support it."));const w=p,P=o,z=!(null==n||!n.R32F),T=!(null==n||!n.R16F);if(c&&g&&_&&P)return P||i.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new ke(a.ld.FLOAT,P?a.Cj.LINEAR:a.Cj.NEAREST,z?a.Ab.RED:a.Ab.RGBA,z?a.H0.R32F:a.Ab.RGBA);if(w)return new ke(a.ld.HALF_FLOAT,a.Cj.LINEAR,T?a.Ab.RED:a.Ab.RGBA,T?a.H0.R16F:a.Ab.RGBA);throw new We.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(i,Tt.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...r,defines:{usesHalfFloatPrecision:r.dataType!==a.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(i,r,n){if(null==this._accumulateFramebuffer){const{dataType:o,samplingMode:c,pixelFormat:p,internalFormat:g}=this.loadQualityProfile(i),_=new Ve.R(r,n);_.pixelFormat=p,_.internalFormat=g,_.dataType=o,_.samplingMode=c,_.wrapMode=a.pF.CLAMP_TO_EDGE;const S=new ie.q(a.yQ.DEPTH_STENCIL,r,n);this._accumulateFramebuffer=new H.H(i,_,S)}else{const{width:o,height:c}=this._accumulateFramebuffer;o===r&&c===n||this._accumulateFramebuffer.resize(r,n)}return this._accumulateFramebuffer}ensureResolveGradientTexture(i,r,n){if(null==this._resolveGradientTexture){const o=new Ve.R;o.wrapMode=a.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new we.g(i,o)}else this._prevGradientHash!==r&&(this._resolveGradientTexture.resize(n.length/4,1),this._resolveGradientTexture.setData(n),this._prevGradientHash=r);return this._resolveGradientTexture}}function Qe(b){return b?.25:1}class Xe extends B.rz{}(0,l._)([(0,u.C5)(5,s.ZY)],Xe.prototype,"offset",void 0);class Ze extends u.k2{}(0,l._)([(0,u.Pi)(s.nt)],Ze.prototype,"radius",void 0),(0,l._)([(0,u.Pi)(s.nt)],Ze.prototype,"isFieldActive",void 0);class Ce extends B.f_{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(i){const{radius:r,isFieldActive:n}=this.kernelControls,o=i.offset,c=n.multiply(this.storage.getVVData(i.id).x).add(new s.nt(1).subtract(n)),p=this.view.displayViewScreenMat3.multiply(new s.eB(i.pos,1)).add(this.view.displayViewMat3.multiply(new s.eB(o,0)).multiply(r)),g=this.clip(i.id);return{glPosition:new s.Zb(p.xy,g,1),offset:o,fieldValue:c,color:new s.Zb(0),...this.maybeRunHittest(i,{},null)}}fragment(i){const{offset:r,fieldValue:n}=i,o=(0,s.Bw)(r),c=(0,s.PM)(o,new s.nt(1)),p=new s.nt(1).subtract(o.multiply(o)),g=p.multiply(p),_=c.multiply(g).multiply(n).multiply(new s.nt(Qe(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new s.Zb(_),i)}hittest(i){const{viewMat3:r,tileMat3:n}=this.view,o=r.multiply(n).multiply(new s.eB(i.pos,1));return(0,F.g$)(o.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,l._)([u.E8],Ce.prototype,"usesHalfFloatPrecision",void 0),(0,l._)([(0,u.Pi)(Ze)],Ce.prototype,"kernelControls",void 0),(0,l._)([(0,l.a)(0,(0,u.hF)(Xe))],Ce.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.hF)(class Rt extends B.DM{}))],Ce.prototype,"fragment",null);class qe extends u.ZA{}(0,l._)([(0,u.C5)(0,s.ZY)],qe.prototype,"pos",void 0);class Fe extends u.k2{}(0,l._)([(0,u.Pi)(s.z7)],Fe.prototype,"texture",void 0),(0,l._)([(0,u.Pi)(s.ZY)],Fe.prototype,"minAndInvRange",void 0),(0,l._)([(0,u.Pi)(s.nt)],Fe.prototype,"normalization",void 0);class Je extends u.k2{}(0,l._)([(0,u.Pi)(s.z7)],Je.prototype,"texture",void 0);class ze extends u.A{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(i){return{glPosition:new s.Zb(i.pos.multiply(2).subtract(1),1,1),uv:i.pos}}fragment(i){const{accumulatedDensity:r,gradient:n}=this;let o=(0,s.US)(r.texture,i.uv).r.multiply(new s.nt(Qe(this.usesHalfFloatPrecision)));o=o.multiply(r.normalization),o=o.subtract(r.minAndInvRange.x).multiply(r.minAndInvRange.y);const c=(0,s.US)(n.texture,new s.ZY(o,.5)),p=new u.mm;return p.glFragColor=new s.Zb(c.rgb.multiply(c.a),c.a),p}}function et(b){return b.key.level+1}(0,l._)([u.E8],ze.prototype,"usesHalfFloatPrecision",void 0),(0,l._)([(0,u.Pi)(Fe)],ze.prototype,"accumulatedDensity",void 0),(0,l._)([(0,u.Pi)(Je)],ze.prototype,"gradient",void 0),(0,l._)([(0,l.a)(0,(0,u.hF)(qe))],ze.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.hF)(class Ot extends u.HS{}))],ze.prototype,"fragment",null);const tt={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:et,compare:a.MT.GEQUAL,mask:255,op:{fail:a.eA.KEEP,zFail:a.eA.KEEP,zPass:a.eA.REPLACE}}}},Dt={...tt,stencil:!1},Bt={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function it(b,i){const{referenceScale:r,radius:n}=b;return n*(0!==r?r/i.scale:1)}var pe=y(90731),He=y(28580),st=y(79677),rt=y(35255);class Ye extends u.k2{getVVRotationMat4(i){return(0,s.Tk)((0,h.M8)(i),s.$I.identity(),()=>{const r=this._getNormalizedAngle(i).multiply(pe.os),n=(0,s.F8)(r),o=(0,s.gn)(r);return new s.$I(o,n,0,0,n.multiply(new s.nt(-1)),o,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(i){return(0,s.Tk)((0,h.M8)(i),s.U.identity(),()=>{const r=this._getNormalizedAngle(i).multiply(pe.os),n=(0,s.F8)(r),o=(0,s.gn)(r);return new s.U(o,n,0,n.multiply(new s.nt(-1)),o,0,0,0,1)})}_getNormalizedAngle(i){const r=(0,s.LC)(this.rotationType,new s.nt(pe.H_.Arithmatic));return(0,s.Tk)(r,new s.nt(90).subtract(i),i)}}(0,l._)([(0,u.Pi)(s.nt)],Ye.prototype,"rotationType",void 0);var ot=y(2098),nt=y(14082),at=y(25688),lt=y(47150),Pe=y(95171);class he extends B.rz{}(0,l._)([(0,u.C5)(3,s.Zb)],he.prototype,"color",void 0),(0,l._)([(0,u.C5)(4,s.ZY)],he.prototype,"offset",void 0),(0,l._)([(0,u.C5)(5,s.ZY)],he.prototype,"textureUV",void 0),(0,l._)([(0,u.C5)(6,s.nt)],he.prototype,"fontSize",void 0),(0,l._)([(0,u.C5)(7,s.nt)],he.prototype,"referenceSize",void 0),(0,l._)([(0,u.C5)(8,s.nt)],he.prototype,"haloFontSize",void 0),(0,l._)([(0,u.C5)(9,s.Zb)],he.prototype,"haloColor",void 0),(0,l._)([(0,u.C5)(10,s.ZY)],he.prototype,"zoomRange",void 0),(0,l._)([(0,u.C5)(11,s.nt)],he.prototype,"clipAngle",void 0),(0,l._)([(0,u.C5)(12,s.Zb)],he.prototype,"referenceSymbol",void 0);class je extends u.Y7{}(0,l._)([(0,u.C5)(13,s.ZY)],je.prototype,"offsetNextVertex1",void 0),(0,l._)([(0,u.C5)(14,s.ZY)],je.prototype,"offsetNextVertex2",void 0);class ue extends B.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(i,r,n){const o=r.multiply(1.4173228346456692),c=(0,s.tn)(this.view.rotation.subtract(o)),p=(0,s.jk)(new s.nt(360).subtract(c),c);let g=new s.nt(0);const _=(0,s.RI)(this.view.currentZoom.multiply(M.fq)).divide(M.fq),S=i.x,w=i.y,P=new s.nt(1).subtract((0,s.PM)(S,_)).multiply(2),z=(0,s.PM)(new s.nt(90),p).multiply(2),T=new s.nt(2).multiply(new s.nt(1).subtract((0,s.PM)(_,w)));return g=g.add(n.multiply(P)),g=g.add(n.multiply(z)),g=g.add(T),g}vertex(i,r){const n=(0,h.mh)(i.bitset,pe.bg),o=new s.nt(1).subtract(n);let c=i.fontSize,p=c.divide(pe.au);const g=this.isHaloPass?i.haloColor:this._getVertexColor(i),_=this.isLabel?g.multiply(this.storage.getAnimationValue(i.id)):g,S=this.view.displayViewScreenMat3.multiply(new s.eB(i.pos,1));let w=i.offset,P=new s.nt(1),z=s.U.identity();if(this.isLabel){if(!i.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const ne=i.referenceSymbol,le=ne.xy,de=ne.z,J=this._unpackDirection(ne.w),fe=(0,Pe.Mg)(this,i.id,de).divide(2),Me=J.multiply(fe.add(M.C2));w=w.add(le).add(Me)}else P=(0,Pe.Mg)(this,i.id,i.referenceSize).divide(i.referenceSize),c=c.multiply(P),p=p.multiply(P),w=w.multiply(P),z=(0,Pe.TL)(this,i.id),w=z.multiply(new s.eB(w,0)).xy;const T=(0,h.mh)(i.bitset,pe.ti),N=this._getViewRotationMatrix(T).multiply(new s.eB(w,0));let j=this.isLabel?this.clipLabel(i.zoomRange,i.clipAngle,T):this.clip(i.id,i.zoomRange);j=j.add(this.isBackgroundPass?o.multiply(2):n.multiply(2));const $=new s.Zb(S.xy.add(N.xy),j,1),se=i.textureUV.divide(this.mosaicInfo.size);let Q=new s.nt(0);return this.isHaloPass&&(Q=i.haloFontSize.divide(p).divide(pe.$w)),{glPosition:$,color:_,size:p,textureUV:se,antialiasingWidth:new s.nt(.105*pe.au).divide(c).divide(this.view.pixelRatio),haloDistanceOffset:Q,...this.maybeRunHittest(i,r,{vvSizeAdjustment:P,vvRotation:z})}}_getViewRotationMatrix(i){const r=this.view.displayViewMat3,n=this.view.displayMat3,o=new s.nt(1).subtract(i);return r.multiply(i).add(n.multiply(o))}fragment(i){const r=new s.nt(.25),n=new s.nt(1).subtract(r),o=(0,s.US)(this.mosaicInfo.texture,i.textureUV).a;let c=n.subtract(i.haloDistanceOffset);this.highlight&&(c=c.divide(2));const p=i.antialiasingWidth,g=(0,s.TF)(c.subtract(p),c.add(p),o);return this.getFragmentOutput(i.color.multiply(g),i)}hittest(i,r,{vvSizeAdjustment:n,vvRotation:o}){const c=o.multiply(new s.eB(i.offset.multiply(n),0)),p=o.multiply(new s.eB(r.offsetNextVertex1.multiply(n),0)),g=o.multiply(new s.eB(r.offsetNextVertex2.multiply(n),0)),{viewMat3:_,tileMat3:S}=this.view,w=_.multiply(S).multiply(new s.eB(i.pos,1)),P=w.add(S.multiply(c)).xy,z=w.add(S.multiply(p)).xy,T=w.add(S.multiply(g)).xy;return(0,F.Bo)(this.hittestRequest.position,P.xy,z.xy,T.xy)}_unpackDirection(i){const r=new s.Ai(i),n=(0,s.Sj)(r,new s.Ai(2)),o=(0,s.nf)(r,new s.Ai(3));return new s.ZY(new s.nt(n).subtract(1),new s.nt(o).subtract(1))}_getVertexColor(i){let r=i.color;if(this.visualVariableColor){const n=this.storage.getColorValue(i.id);r=this.visualVariableColor.getColor(n,i.color,new s.x(!1))}if(this.visualVariableOpacity){const n=this.storage.getOpacityValue(i.id),o=this.visualVariableOpacity.getOpacity(n);r=r.multiply(o)}return r}}(0,l._)([(0,u.uK)(st._)],ue.prototype,"visualVariableColor",void 0),(0,l._)([(0,u.uK)(rt.i)],ue.prototype,"visualVariableOpacity",void 0),(0,l._)([(0,u.uK)(Ye)],ue.prototype,"visualVariableRotation",void 0),(0,l._)([(0,u.uK)(ot.n)],ue.prototype,"visualVariableSizeMinMaxValue",void 0),(0,l._)([(0,u.uK)(nt.F)],ue.prototype,"visualVariableSizeScaleStops",void 0),(0,l._)([(0,u.uK)(at.N)],ue.prototype,"visualVariableSizeStops",void 0),(0,l._)([(0,u.uK)(lt.d)],ue.prototype,"visualVariableSizeUnitValue",void 0),(0,l._)([(0,u.Pi)(He.b)],ue.prototype,"mosaicInfo",void 0),(0,l._)([u.E8],ue.prototype,"isHaloPass",void 0),(0,l._)([u.E8],ue.prototype,"isBackgroundPass",void 0),(0,l._)([u.E8],ue.prototype,"isLabel",void 0),(0,l._)([(0,l.a)(0,(0,u.hF)(he)),(0,l.a)(1,(0,u.hF)(je))],ue.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.hF)(class Ut extends B.DM{}))],ue.prototype,"fragment",null);var Ee=y(95827),Ht=y(84289);class De extends Ee.Xc{}(0,l._)([(0,u.C5)(9,s.nt)],De.prototype,"accumulatedDistance",void 0),(0,l._)([(0,u.C5)(10,s.ZY)],De.prototype,"segmentDirection",void 0),(0,l._)([(0,u.C5)(11,s.Zb)],De.prototype,"tlbr",void 0);class Ne extends Ee.cM{_getLineWidthRatio(i,r){const n=new s.nt(Ht.$),o=(0,h.mh)(i.bitset,pe.kx);return o.multiply((0,s.T9)(r,new s.nt(.25))).add(new s.nt(1).subtract(o)).divide(n)}_getSDFAlpha(i){const{halfWidth:r,normal:n,tlbr:o,patternSize:c,accumulatedDistance:p,lineWidthRatio:g}=i,_=c.x.multiply(new s.nt(2)).multiply(g),S=(0,s.jc)(p.divide(_)),w=new s.nt(.25).multiply(n.y).add(new s.nt(.5)),P=(0,s.jh)(o.xy,o.zw,new s.ZY(S,w)),z=(0,h.Rj)((0,s.US)(this.mosaicInfo.texture,P)).subtract(new s.nt(.5)).multiply(r),T=(0,s.qE)(new s.nt(.5).subtract(z),new s.nt(0),new s.nt(1));return new s.Zb(T)}_getPatternColor(i){const{halfWidth:r,normal:n,color:o,accumulatedDistance:c,patternSize:p,sampleAlphaOnly:g,tlbr:_}=i,S=p.y.multiply(new s.nt(2).multiply(r).divide(p.x)),w=(0,s.jc)(c.divide(S)),P=new s.nt(.5).multiply(n.y).add(new s.nt(.5)),z=(0,s.jh)(_.xy,_.zw,new s.ZY(P,w));let T=(0,s.US)(this.mosaicInfo.texture,z);return null!=this.visualVariableColor&&(T=(0,s.Tk)((0,s.MM)(g,new s.nt(.5)),new s.Zb(o.a),o)),T}vertex(i,r){const{segmentDirection:n,tlbr:o,bitset:c}=i,p=(0,Ee.$0)(this,i),g=i.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,s.Om)(n,p.scaledOffset)),_=new s.ZY(o.z.subtract(o.x),o.w.subtract(o.y)),S=o.divide(this.mosaicInfo.size.xyxy),w=(0,h.mh)(c,pe.b5),P=(0,h.mh)(c,pe.cn),z=(0,s.Tk)((0,s.MM)(w,new s.nt(.5)),this._getLineWidthRatio(i,p.scaledHalfWidth),new s.nt(1));return{...p,tlbr:S,patternSize:_,accumulatedDistance:g,isSDF:w,sampleAlphaOnly:P,lineWidthRatio:z,...this.maybeRunHittest(i,r,p.halfWidth)}}fragment(i){const{color:r,opacity:n,isSDF:o}=i,c=(0,Ee.xw)(i,this.antialiasingControls.blur),p=(0,s.Tk)((0,s.MM)(o,new s.nt(.5)),this._getSDFAlpha(i),this._getPatternColor(i)),g=r.multiply(n).multiply(c).multiply(p);return this.getFragmentOutput(g,i)}}(0,l._)([(0,u.Pi)(He.b)],Ne.prototype,"mosaicInfo",void 0),(0,l._)([(0,l.a)(0,(0,u.hF)(De)),(0,l.a)(1,(0,u.hF)(B.$Z))],Ne.prototype,"vertex",null);var Ae=y(93300);class ye extends B.rz{}(0,l._)([(0,u.C5)(3,s.Zb)],ye.prototype,"color",void 0),(0,l._)([(0,u.C5)(4,s.Zb)],ye.prototype,"outlineColor",void 0),(0,l._)([(0,u.C5)(5,s.ZY)],ye.prototype,"offset",void 0),(0,l._)([(0,u.C5)(6,s.ZY)],ye.prototype,"textureUV",void 0),(0,l._)([(0,u.C5)(7,s.Zb)],ye.prototype,"sizing",void 0),(0,l._)([(0,u.C5)(8,s.nt)],ye.prototype,"placementAngle",void 0),(0,l._)([(0,u.C5)(9,s.nt)],ye.prototype,"sizeRatio",void 0),(0,l._)([(0,u.C5)(10,s.ZY)],ye.prototype,"zoomRange",void 0);class Re extends u.Y7{}function ve(b,i,r,n){return i.multiply(b.x).add(r.multiply(b.y)).add(n.multiply(b.z))}function Ge(b){return b.multiply(b).divide(128)}(0,l._)([(0,u.C5)(12,s.ZY)],Re.prototype,"offsetNextVertex1",void 0),(0,l._)([(0,u.C5)(13,s.ZY)],Re.prototype,"offsetNextVertex2",void 0),(0,l._)([(0,u.C5)(14,s.ZY)],Re.prototype,"textureUVNextVertex1",void 0),(0,l._)([(0,u.C5)(15,s.ZY)],Re.prototype,"textureUVNextVertex2",void 0);class me extends B.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(i,r){const n=Ge(i.sizing.x),o=Ge(i.sizing.y),c=Ge(i.sizing.z),p=i.placementAngle,g=(0,h.mh)(i.bitset,Ae.c.bitset.isSDF),_=(0,h.mh)(i.bitset,Ae.c.bitset.isMapAligned),S=(0,h.mh)(i.bitset,Ae.c.bitset.scaleSymbolsProportionally),w=(0,h.K5)(i.bitset,Ae.c.bitset.colorLocked),P=(0,Pe.cF)(this,i.id),z=(0,Pe.G7)(this,i.id,i.color,w).multiply(P),T=this.view.displayViewScreenMat3.multiply(new s.eB(i.pos.xy,1)),N=(0,Pe.Mg)(this,i.id,c).divide(c),j=n.multiply(N),$=i.offset.xy.multiply(N);let se=o.multiply(S.multiply(N.subtract(1)).add(1));se=(0,s.jk)(se,(0,s.T9)(j.subtract(.99),new s.nt(0)));const Q=(0,s.T9)(se,new s.nt(1)),ne=(0,s.jk)(se,new s.nt(1)),le=s.U.fromRotation(p.multiply(pe.rp)),de=(0,Pe.TL)(this,i.id),J=this._getViewRotationMatrix(_).multiply(de).multiply(le).multiply(new s.eB($.xy,0)),fe=this.clip(i.id,i.zoomRange),Me=new s.Zb(T.xy.add(J.xy),fe,1),Be=i.textureUV.divide(this.mosaicInfo.size),Le=i.outlineColor.multiply(ne),Ue=(0,h.mh)(i.bitset,Ae.c.bitset.overrideOutlineColor),Ie=i.sizeRatio.multiply(j).multiply(.5);return{glPosition:Me,color:z,textureUV:Be,outlineColor:Le,outlineSize:Q,distanceToPx:Ie,isSDF:g,overrideOutlineColor:Ue,...this.maybeRunHittest(i,r,{pos:i.pos,size:j,sizeCorrection:N,isMapAligned:_,outlineSize:Q,distanceToPx:Ie,isSDF:g})}}fragment(i){const r=this._getColor(i.textureUV,i);return this.getFragmentOutput(r,i)}hittest(i,r,n){return(0,s.Tk)((0,s.Xe)(n.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(i,r,n),this._hittestMarker(i,r,n))}_getViewRotationMatrix(i){const r=this.view.displayViewMat3,n=this.view.displayMat3,o=new s.nt(1).subtract(i);return r.multiply(i).add(n.multiply(o))}_getViewScreenMatrix(i){const r=this.view.viewMat3.multiply(this.view.tileMat3),n=this.view.tileMat3,o=new s.nt(1).subtract(i);return r.multiply(i).add(n.multiply(o))}_getColor(i,r){return(0,s.Tk)((0,s.LC)(r.isSDF,new s.nt(1)),this._getSDFColor(i,r),this._getSpriteColor(i,r))}_getSpriteColor(i,r){return(0,s.US)(this.mosaicInfo.texture,i).multiply(r.color)}_getSDFColor(i,r){const n=(0,s.US)(this.mosaicInfo.texture,i),o=new s.nt(.5).subtract((0,h.Rj)(n)).multiply(r.distanceToPx).multiply(pe.V5),c=(0,s.qE)(new s.nt(.5).subtract(o),new s.nt(0),new s.nt(1)),p=r.color.multiply(c);let g=r.outlineSize;this.highlight&&(g=(0,s.T9)(g,r.overrideOutlineColor.multiply(4)));const _=g.multiply(.5),S=(0,s.tn)(o).subtract(_),w=(0,s.qE)(new s.nt(.5).subtract(S),new s.nt(0),new s.nt(1)),P=(0,s.jh)(r.outlineColor,r.color,r.overrideOutlineColor).multiply(w);return new s.nt(1).subtract(P.a).multiply(p).add(P)}_hittestSmallMarker(i,r,n){const{position:o,distance:c,smallSymbolDistance:p}=this.hittestRequest,g=c.subtract(p),{viewMat3:_,tileMat3:S}=this.view,w=_.multiply(S).multiply(new s.eB(n.pos,1)).xy,P=n.size.multiply(.5);return(0,s.Io)(w,o).subtract(P).add(g)}_hittestMarker(i,r,n){const{pos:o,sizeCorrection:p,isMapAligned:g,outlineSize:_,isSDF:S,distanceToPx:w}=n,P=new s.eB(i.offset.multiply(p),0),z=new s.eB(r.offsetNextVertex1.multiply(p),0),T=new s.eB(r.offsetNextVertex2.multiply(p),0),{viewMat3:N,tileMat3:j}=this.view,$=N.multiply(j).multiply(new s.eB(o,1)),se=this._getViewScreenMatrix(g),Q=$.add(se.multiply(P)).xy,ne=$.add(se.multiply(z)).xy,le=$.add(se.multiply(T)).xy,de=this.hittestRequest.position,J=this.hittestRequest.distance,fe=(0,F.Bs)(de.add(new s.ZY((0,s.ze)(J),(0,s.ze)(J))),Q,ne,le),Me=(0,F.Bs)(de.add(new s.ZY(0,(0,s.ze)(J))),Q,ne,le),Be=(0,F.Bs)(de.add(new s.ZY(J,(0,s.ze)(J))),Q,ne,le),Le=(0,F.Bs)(de.add(new s.ZY((0,s.ze)(J),0)),Q,ne,le),Ue=(0,F.Bs)(de,Q,ne,le),Ie=(0,F.Bs)(de.add(new s.ZY(J,0)),Q,ne,le),pt=(0,F.Bs)(de.add(new s.ZY((0,s.ze)(J),J)),Q,ne,le),ht=(0,F.Bs)(de.add(new s.ZY(0,J)),Q,ne,le),mt=(0,F.Bs)(de.add(new s.ZY(J,J)),Q,ne,le),ge=i.textureUV.divide(this.mosaicInfo.size),be=r.textureUVNextVertex1.divide(this.mosaicInfo.size),xe=r.textureUVNextVertex2.divide(this.mosaicInfo.size),_e={color:new s.Zb(1),outlineColor:new s.Zb(1),overrideOutlineColor:new s.nt(1),outlineSize:_,distanceToPx:w,isSDF:S};let te=new s.nt(0);return te=te.add((0,F.kW)(fe).multiply(this._getColor(ve(fe,ge,be,xe),_e).a)),te=te.add((0,F.kW)(Me).multiply(this._getColor(ve(Me,ge,be,xe),_e).a)),te=te.add((0,F.kW)(Be).multiply(this._getColor(ve(Be,ge,be,xe),_e).a)),te=te.add((0,F.kW)(Le).multiply(this._getColor(ve(Le,ge,be,xe),_e).a)),te=te.add((0,F.kW)(Ue).multiply(this._getColor(ve(Ue,ge,be,xe),_e).a)),te=te.add((0,F.kW)(Ie).multiply(this._getColor(ve(Ie,ge,be,xe),_e).a)),te=te.add((0,F.kW)(pt).multiply(this._getColor(ve(pt,ge,be,xe),_e).a)),te=te.add((0,F.kW)(ht).multiply(this._getColor(ve(ht,ge,be,xe),_e).a)),te=te.add((0,F.kW)(mt).multiply(this._getColor(ve(mt,ge,be,xe),_e).a)),(0,s.PM)(te,new s.nt(.05)).multiply((0,F.My)(this.hittestRequest))}}(0,l._)([(0,u.uK)(st._)],me.prototype,"visualVariableColor",void 0),(0,l._)([(0,u.uK)(rt.i)],me.prototype,"visualVariableOpacity",void 0),(0,l._)([(0,u.uK)(Ye)],me.prototype,"visualVariableRotation",void 0),(0,l._)([(0,u.uK)(ot.n)],me.prototype,"visualVariableSizeMinMaxValue",void 0),(0,l._)([(0,u.uK)(nt.F)],me.prototype,"visualVariableSizeScaleStops",void 0),(0,l._)([(0,u.uK)(at.N)],me.prototype,"visualVariableSizeStops",void 0),(0,l._)([(0,u.uK)(lt.d)],me.prototype,"visualVariableSizeUnitValue",void 0),(0,l._)([(0,u.Pi)(He.b)],me.prototype,"mosaicInfo",void 0),(0,l._)([(0,l.a)(0,(0,u.hF)(ye)),(0,l.a)(1,(0,u.hF)(Re))],me.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.hF)(class jt extends B.DM{}))],me.prototype,"fragment",null);var Gt=y(1119),Kt=y(77989);class $t{constructor(){this.computeAttributes={}}get locationsMap(){const i=new Map;for(const r in this.locations)i.set(r,this.locations[r].index);return i}get optionPropertyKeys(){if(!this._optionPropertyKeys){const i=new Set(Object.keys(this.options));this._optionPropertyKeys=i}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const i=this.locationsMap,r=Array.from(i.entries()).map(([o,c])=>`${o}.${c}`).join("."),n=(0,Gt.Wm)(r);this._locationInfo={hash:n,locations:i}}return this._locationInfo}get renamedLocationsMap(){const i=new Map;for(const[r,n]of this.locationsMap.entries())i.set("a_"+r,n);return i}getShaderKey(i,r,n){const o=Object.keys(n).filter(p=>n[p]).map(p=>`${p}_${n[p].toString()}`).join("."),c=Object.keys(r).filter(p=>this.optionPropertyKeys.has(p)).join(".");return`${i.hash}.${o}.${c}`}getProgram(i,r,n,o){let c="",p="";for(const g in n)if(n[g]){const _="boolean"==typeof n[g]?`#define ${g}\n`:`#define ${g} ${n[g]}\n`;c+=_,p+=_}return c+=this.vertexShader,p+=this.fragmentShader,new Kt.K(c,p,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(r),this._transformFeedbackBindings)}_getUniformBindings(i){const r=[];for(const n in this.required){const o=this.required[n];r.push({uniformHydrated:null,shaderModulePath:n,uniformName:n,uniformType:o.type,uniformArrayElementType:ut(o),uniformArrayLength:dt(o)})}for(const n in i){const o=this.options[n];if(i[n])for(const c in o){const p=o[c];r.push({uniformHydrated:null,shaderModulePath:`${n}.${c}`,uniformName:c,uniformType:p.type,uniformArrayElementType:ut(p),uniformArrayLength:dt(p)})}}return r}}const ut=b=>{var i;return"array"===b.type?null===(i=b.elementType)||void 0===i?void 0:i.type:void 0},dt=b=>"array"===b.type?b.size:void 0;var ct=y(73539);const kt={hittestDist:s.nt,hittestPos:s.ZY},Qt={filterFlags:s.z7,animation:s.z7,visualVariableData:s.z7,dataDriven0:s.z7,dataDriven1:s.z7,dataDriven2:s.z7,gpgpu:s.z7,size:s.nt},Xt={displayViewScreenMat3:s.U,displayViewMat3:s.U,displayMat3:s.U,viewMat3:s.U,tileMat3:s.U,displayZoomFactor:s.nt,requiredZoomFactor:s.nt,tileOffset:s.ZY,currentScale:s.nt,currentZoom:s.nt,metersPerSRUnit:s.nt};class qt extends $t{constructor(){super(...arguments),this.vertexShader=(0,ct.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,ct.Q)("materials/pie/pie.frag"),this.required={...Qt,...Xt,outlineWidth:s.nt,colors:s.My,defaultColor:s.Zb,othersColor:s.Zb,outlineColor:s.Zb,donutRatio:s.nt,sectorThreshold:s.nt},this.options={hittestUniforms:kt,visualVariableSizeMinMaxValue:{minMaxValueAndSize:s.Zb},visualVariableSizeScaleStops:{sizes:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8},values:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8}},visualVariableSizeStops:{sizes:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8},values:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:s.nt},visualVariableOpacity:{opacities:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8},opacityValues:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8}}},this.locations={pos:{index:0,type:s.ZY},id:{index:1,type:s.eB},bitset:{index:2,type:s.nt},offset:{index:3,type:s.ZY},texCoords:{index:4,type:s.ZY},size:{index:5,type:s.ZY},referenceSize:{index:6,type:s.nt},zoomRange:{index:7,type:s.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(i){this.required.colors={...s.My.ofType(s.Zb,i),type:"array",elementType:s.Zb,size:i}}}const Oe={fill:new class _t extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.FillMeshWriter,this.shaders={geometry:new Ke.z}}render(i,r){const{context:n,painter:o}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target)},defines:(0,f.vT)(i),optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("fill"),patternFill:new class Mt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.PatternFillMeshWriter,this.shaders={geometry:new Vt.vx}}render(i,r){const{context:n,painter:o}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey),localTileOffset:(0,f.Pr)(r.target)},defines:{...(0,f.vT)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("patternFill"),complexFill:new class gt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.ComplexFillMeshWriter,this.shaders={geometry:new vt.Ps}}render(i,r){const{context:n,painter:o}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey),localTileOffset:(0,f.Pr)(r.target)},defines:{...(0,f.vT)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("complexFill"),outlineFill:new class wt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.OutlineFillMeshWriter,this.shaders={geometry:new St.nj}}render(i,r){const{context:n,painter:o,pixelRatio:c}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),antialiasingControls:Te(c)},defines:{...(0,f.vT)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("outlineFill"),patternOutlineFill:new class zt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.PatternOutlineFillMeshWriter,this.shaders={geometry:new Pt.tA}}render(i,r){const{context:n,painter:o,pixelRatio:c}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),antialiasingControls:Te(c),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey),localTileOffset:(0,f.Pr)(r.target)},defines:{...(0,f.vT)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("patternOutlineFill"),complexOutlineFill:new class xt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.ComplexOutlineFillMeshWriter,this.shaders={geometry:new bt.RH}}render(i,r){const{context:n,painter:o,pixelRatio:c}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),antialiasingControls:Te(c),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey),localTileOffset:(0,f.Pr)(r.target)},defines:{...(0,f.vT)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("complexOutlineFill"),marker:new class Nt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.MarkerMeshWriter,this.shaders={geometry:new me},this.symbologyPlane=O.uC.MARKER}render(i,r){const{context:n,painter:o}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey,!0)},defines:{...(0,f.vT)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("marker"),pieChart:new class Jt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.PieChartMeshWriter,this.shaders={geometry:new qt},this.symbologyPlane=O.uC.MARKER}render(i,r){var n,o;const{context:c,painter:p}=i,{instance:g,target:_}=r,S=this.shaders.geometry,w=g.getInput(),P=w.numberOfFields,z=(0,f.Eq)(i),T=(0,f.QA)(i,_),N=(0,f.vT)(i);S.setNumberOfFields(P),p.setShader({shader:S,uniforms:{...(0,f.r3)(i,r.target,w.geometry),...T.storage,...T.view,hittestUniforms:T.hittestRequest?{hittestDist:null===(n=T.hittestRequest)||void 0===n?void 0:n.distance,hittestPos:null===(o=T.hittestRequest)||void 0===o?void 0:o.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!w.geometry.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!w.geometry.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!w.geometry.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!w.geometry.visualVariableSizeUnitValue,VV_OPACITY:!!w.geometry.visualVariableOpacity,HITTEST:z,highlight:T.highlight?1:0,...N,numberOfFields:P},optionalAttributes:{},useComputeBuffer:z}),p.setPipelineState((0,f.Qu)(i)),p.submitDraw(c,r)}}("pieChart"),line:new class Zt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.LineMeshWriter,this.shaders={geometry:new Ee.cM},this.symbologyPlane=O.uC.LINE}render(i,r){const{context:n,painter:o,pixelRatio:c}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),antialiasingControls:Te(c)},defines:{...(0,f.vT)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("line"),texturedLine:new class Yt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.TexturedLineMeshWriter,this.shaders={geometry:new Ne},this.symbologyPlane=O.uC.LINE}render(i,r){const{context:n,painter:o,pixelRatio:c}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),antialiasingControls:Te(c),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey)},defines:{...(0,f.vT)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}}("texturedLine"),text:new class ei extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.TextMeshWriter,this.shaders={geometry:new ue},this.symbologyPlane=O.uC.TEXT}render(i,r){const{context:n,painter:o}=i,c=(0,f.vT)(i),p={shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey)},defines:{...c,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)};o.setShader(p),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r),o.setShader({...p,defines:{...c,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),o.submitDraw(n,r),o.setShader({...p,defines:{...c,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),o.submitDraw(n,r)}}("text"),label:new class Wt extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.LabelMeshWriter,this.shaders={geometry:new ue},this.drawPhase=O.S5.LABEL|O.S5.LABEL_ALPHA,this.symbologyPlane=O.uC.TEXT}render(i,r){const{context:n,painter:o}=i,c=(0,f.vT)(i),p={...(0,f.Qu)(i)},g={shader:this.shaders.geometry,uniforms:{...(0,f.r3)(i,r.target,r.instance.getInput().geometry),...(0,f.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey)},defines:{...c,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:!1};o.setShader(g),o.setPipelineState(p),o.submitDraw(n,r),o.setShader({...g,defines:{...c,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),o.setPipelineState(p),o.submitDraw(n,r),o.setShader({...g,defines:{...c,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),o.setPipelineState(p),o.submitDraw(n,r)}}("label"),heatmap:new class It extends I{constructor(){super(...arguments),this.meshWriter=ce.Y.HeatmapMeshWriter,this.shaders={accumulate:new Ce,resolve:new ze},this.postProcessingEnabled=!0,this._isBound=!1,this._resources=new Map,this.overrideStencilRef=et}shutdown(i){var r;super.shutdown(i),null!==(r=this._resources.get(i))&&void 0!==r&&r.destroy(),this._resources.delete(i),this._prevFBO=null,this._unbind()}render(i,r){const{context:n,painter:o,state:c}=i,p=r.instance.getInput(),{isFieldActive:g}=p,_=this._getOrCreateResourcesRecord(n),S=_.loadQualityProfile(n);if((0,f.dJ)(i))return;(0,f.Eq)(i)||this._bind(i,_,p),o.setShader({shader:this.shaders.accumulate,uniforms:{...(0,f.QA)(i,r.target),kernelControls:{radius:it(p,c),isFieldActive:g?1:0}},defines:{...(0,f.vT)(i),...S.defines},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,f.Eq)(i)});const w=(0,f.Eq)(i)?Dt:tt;o.setPipelineState(w),o.submitDraw(n,r)}postProcess(i,r){if((0,f.Eq)(i)||(0,f.dJ)(i))return;const{context:n,painter:o}=i,c=this._resources.get(n);if(null==this._prevFBO||null==this._prevViewport||null==c||!c.initialized)return;const{defines:p}=c.loadQualityProfile(n),{minDensity:g,maxDensity:_,radius:S}=r.getInput(),z=c.accumulateFramebuffer,T=c.resolveGradientTexture;o.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:z.colorTexture},minAndInvRange:[g,1/(_-g)],normalization:3/(S*S*Math.PI)},gradient:{texture:{unit:9,texture:T}}},defines:p,optionalAttributes:{},useComputeBuffer:!1}),n.bindFramebuffer(this._prevFBO),n.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),n.bindTexture(z.colorTexture,8),n.bindTexture(T,9),o.setPipelineState(Bt),o.submitDrawQuad(n),this._unbind()}_getOrCreateResourcesRecord(i){let r=this._resources.get(i);return null==r&&(r=new At,this._resources.set(i,r)),r}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(i,r,n){if(this._isBound)return;const{context:o,state:c,pixelRatio:p}=i,g=o.getBoundFramebufferObject(),_=o.getViewport();this._prevFBO=g,this._prevViewport=_;const{gradient:S,gradientHash:w}=n;r.ensureResolveGradientTexture(o,w,S);const{width:P,height:z}=_,T=function Ft(b,i){const r=i>1.5?.25:.5;return b<1/(2*r)?1:r}(it(n,c),p),$=r.ensureAccumulateFBO(o,P*T,z*T);o.blitFramebuffer(g,$,0,0,g.width,g.height,0,0,$.width,$.height,a.hn.STENCIL_BUFFER_BIT,a.Cj.NEAREST),o.bindFramebuffer($),o.setViewport(0,0,$.width,$.height),o.setColorMask(!0,!0,!0,!0),o.setClearColor(0,0,0,0),o.clear(a.hn.COLOR_BUFFER_BIT),this._isBound=!0}}("heatmap"),dotDensity:new class yt extends I{constructor(){super(...arguments),this.shaders={polygon:new oe,point:new q,fill:new Ke.z},this.meshWriter=ce.Y.DotDensityMeshWriter,this._resources=new Map}render(i,r){(0,f.dJ)(i)||(0,f.Eq)(i)?this._renderPolygons(i,r):this._renderDotDensity(i,r)}_renderPolygons(i,r){const{context:n,painter:o}=i;o.setShader({shader:this.shaders.fill,uniforms:{...(0,f.QA)(i,r.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,f.vT)(i)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,f.Eq)(i)}),o.setPipelineState((0,f.Qu)(i)),o.submitDraw(n,r)}_renderDotDensity(i,r){const{context:n,painter:o,requiredLevel:c}=i,p=r.instance.getInput(),g=this._getOrCreateResourcesRecord(n),_=g.getDotDensityTextures(n,M.CQ,p.seed),S=1/2**(c-r.target.key.level),w=M.CQ,P=w*window.devicePixelRatio*w*window.devicePixelRatio,N=p.dotValue*(p.dotScale?i.state.scale/p.dotScale:1)*(1/S*(1/S));o.setShader({shader:this.shaders.polygon,uniforms:{...(0,f.QA)(i,r.target),instance:{isActive:p.isActive,colors:p.colors,dotValue:Math.max(1,N)},draw:{dotTexture0:{unit:M.Cp,texture:_[0]},dotTexture1:{unit:M.vN,texture:_[1]},tileZoomFactor:S,pixelRatio:window.devicePixelRatio,tileDotsOverArea:P/(M.CQ*window.devicePixelRatio*M.CQ*window.devicePixelRatio)}},defines:{...(0,f.vT)(i),blending:p.blending},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState((0,f.Qu)(i));const j=n.getViewport();n.setViewport(0,0,M.CQ,M.CQ);const $=n.getBoundFramebufferObject(),se=g.getFBO(n);n.bindFramebuffer(se),n.setClearColor(0,0,0,0),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.updatePipelineState(n),n.clear(a.hn.COLOR_BUFFER_BIT),o.submitDraw(n,r),n.bindFramebuffer($),n.setViewport(j.x,j.y,j.width,j.height);const Q=g.getFBO(n).colorTexture;o.setShader({shader:this.shaders.point,uniforms:{view:(0,f.L4)(i,r.target),instance:{dotSize:p.dotSize},draw:{locations:{unit:M.Cp,texture:Q},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,f.vT)(i)},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.submitDrawMesh(n,g.getDotDensityMesh(n))}shutdown(i){var r;super.shutdown(i),null!==(r=this._resources.get(i))&&void 0!==r&&r.destroy(),this._resources.delete(i)}_getOrCreateResourcesRecord(i){let r=this._resources.get(i);return null==r&&(r=new ft,this._resources.set(i,r)),r}}("dotDensity")};function ti(){for(const b in Oe)Oe[b].startup()}function ii(b){for(const i in Oe)Oe[i].shutdown(b)}},84836:(Se,re,y)=>{y.d(re,{Jz:()=>L,T9:()=>l});var M=y(89952),f=y(69473),O=y(79213),I=y(54551);function l(h,V){return{type:"simple",filters:V,capabilities:{maxTextureSize:(0,I.C)().maxTextureSize},bindings:s(h)}}function u(h){switch(h){case"opacity":return f.Gn.OPACITY;case"color":return f.Gn.COLOR;case"rotation":return f.Gn.ROTATION;case"size":return f.Gn.SIZE;default:return null}}function s(h){if(!h)return[];switch(h.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return L(h);case"dot-density":return function B(h){const V=[];for(const U of h.attributes)V.push({binding:V.length,expression:U.valueExpression,field:U.field});return V}(h);case"pie-chart":return function k(h){const V=L(h);let U=4;for(const W of h.attributes)V.push({binding:U++,expression:W.valueExpression,field:W.field});return V}(h);case"heatmap":return function R({valueExpression:h,field:V}){return h||V?[{binding:0,expression:h,field:V}]:[]}(h)}}function L(h){var V;return"visualVariables"in h&&null!==(V=h.visualVariables)&&void 0!==V&&V.length?(0,O.R)(h.visualVariables).map(U=>function F(h){switch(h.type){case"size":return function G(h){return"$view.scale"===h.valueExpression?null:{binding:u(h.type),field:h.field,normalizationField:h.normalizationField,expression:h.valueExpression,valueRepresentation:h.valueRepresentation}}(h);case"color":return function K(h){return{binding:u(h.type),field:h.field,normalizationField:h.normalizationField,expression:h.valueExpression}}(h);case"opacity":return function X(h){return{binding:u(h.type),field:h.field,normalizationField:h.normalizationField,expression:h.valueExpression}}(h);case"rotation":return function q(h){return{binding:u(h.type),expression:h.valueExpression,field:h.field}}(h)}}(U)).filter(M.Ru):[]}},13220:(Se,re,y)=>{y.d(re,{Dk:()=>U,K4:()=>ee,j0:()=>W});var M=y(67685),f=y(82663),O=y(48716),I=y(47669),l=y(90731),u=y(29822),s=y(79213);const B=1.25,k=128,R=128;function L(d){var a;if(null===(a=d.stops)||void 0===a||!a.length)return null;const v=d.stops.sort((C,Z)=>C.value-Z.value),m=(0,u.r)(v,8);return{values:m.map(({value:C})=>C),colors:m.map(({color:C})=>(0,u.p)(C))}}function G(d){var a;if(null===(a=d.stops)||void 0===a||!a.length)return null;const v=d.stops.sort((x,E)=>x.value-E.value),m=(0,u.r)(v,8);return{opacityValues:m.map(({value:x})=>x),opacities:m.map(({opacity:x})=>x)}}function K(d){return{rotationType:"geographic"===d.rotationType?l.H_.Geographic:l.H_.Arithmatic}}function X(d){var a;if(null===(a=d.stops)||void 0===a||!a.length)return null;if(d.stops.some(x=>x.useMaxValue||x.useMinValue))return(x,E)=>{const C=x.statisticsByLevel.get(E.key.level),Z=d.stops.map(H=>{var ae,ie,we,Ve;return{value:H.useMaxValue?null!==(ae=null==C||null===(ie=C.get(d.field))||void 0===ie?void 0:ie.maxValue)&&void 0!==ae?ae:0:H.useMinValue?null!==(we=null==C||null===(Ve=C.get(d.field))||void 0===Ve?void 0:Ve.minValue)&&void 0!==we?we:0:H.value,size:H.size?(0,M.Lz)(H.size):I.qM}}).sort((H,ae)=>H.value-ae.value),Y=(0,u.r)(Z,8);return{values:Y.map(({value:H})=>H),sizes:Y.map(({size:H})=>H)}};const v=d.stops.sort((x,E)=>x.value-E.value),m=(0,u.r)(v,8);return{values:m.map(({value:x})=>x),sizes:m.map(({size:x})=>(0,M.Lz)(x))}}function F(d){return a=>{const{state:v}=a;return{unitValueToPixelsRatio:(0,f.GA)(v.spatialReference)/O.j[d.valueUnit]/v.resolution}}}function h(d,a){const v=a.length;if(d<a[0].value||1===v)return a[0].size;for(let m=1;m<v;m++)if(d<a[m].value)return a[m-1].size+(d-a[m-1].value)/(a[m].value-a[m-1].value)*(a[m].size-a[m-1].size);return a[v-1].size}function V(d){const{minDataValue:a,maxDataValue:v,minSize:m,maxSize:x}=d;if("object"==typeof m&&"object"==typeof x)return(E,C)=>{const Z=E.state.scale,Y=(0,M.Lz)(h(Z,m.stops)),H=(0,M.Lz)(h(Z,x.stops));return{minMaxValueAndSize:[a,v,Y,H]}};if("object"==typeof m||"object"==typeof x)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[a,v,(0,M.Lz)(m),(0,M.Lz)(x)]}}const U={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function W(d,a=R,v=B){if(d.visualVariableSizeMinMaxValue)return d.visualVariableSizeMinMaxValue instanceof Function?k:Math.max(d.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*v,a);if(d.visualVariableSizeScaleStops){if(d.visualVariableSizeScaleStops instanceof Function)return k;const m=d.visualVariableSizeScaleStops.sizes;return Math.max(m[m.length-1]*v,a)}if(d.visualVariableSizeStops){if(d.visualVariableSizeStops instanceof Function)return k;const m=d.visualVariableSizeStops.sizes;return Math.max(m[m.length-1]*v,a)}return d.visualVariableSizeUnitValue?2*k:0}function ee(d){const a={...U};if(!d||!("visualVariables"in d)||!d.visualVariables)return a;for(const v of(0,s.R)(d.visualVariables))switch(v.type){case"color":a.visualVariableColor=L(v);break;case"opacity":a.visualVariableOpacity=G(v);break;case"rotation":a.visualVariableRotation=K(v);break;case"size":switch(oe(v)){case"field-stops":a.visualVariableSizeStops=X(v);break;case"scale-stops":"outline"===v.target?a.visualVariableSizeOutlineScaleStops=X(v):a.visualVariableSizeScaleStops=X(v);break;case"min-max":a.visualVariableSizeMinMaxValue=V(v);break;case"unit-value":a.visualVariableSizeUnitValue=F(v)}break;default:console.error("Unable to handle VV type")}return a}function oe(d){if("number"==typeof d.minDataValue&&"number"==typeof d.maxDataValue&&null!=d.minSize&&null!=d.maxSize)return"min-max";if((d.expression&&"view.scale"===d.expression||d.valueExpression&&"$view.scale"===d.valueExpression)&&Array.isArray(d.stops))return"scale-stops";if((null!=d.field||d.expression&&"view.scale"!==d.expression||d.valueExpression&&"$view.scale"!==d.valueExpression)&&(Array.isArray(d.stops)||"levels"in d&&d.levels))return"field-stops";if((null!=d.field||d.expression&&"view.scale"!==d.expression||d.valueExpression&&"$view.scale"!==d.valueExpression)&&null!=d.valueUnit)return"unit-value";throw new Error("InternalError: Found unknown sizeVV type")}},29822:(Se,re,y)=>{function M(O,I){const l=O.slice(0,I),u=I-l.length;for(let s=0;s<u;s++)l.push(l[l.length-1]);return l}function f(O){if(!O)return[0,0,0,0];const{r:I,g:l,b:u,a:s}=O;return[I*(s/255),l*(s/255),u*(s/255),s]}y.d(re,{p:()=>f,r:()=>M})},34155:(Se,re,y)=>{y.d(re,{EM:()=>W,Gn:()=>X,IQ:()=>oe,Jk:()=>k,NZ:()=>U,TY:()=>s,Zi:()=>G,oF:()=>F});var M=y(10467),f=y(26747),O=y(46988),I=y(28291),l=y(13220),u=y(99845);function s(d){var a,v;return d.minScale||d.maxScale?{minScale:null!==(a=d.minScale)&&void 0!==a?a:0,maxScale:null!==(v=d.maxScale)&&void 0!==v?v:0}:null}function B(d){if(null==d)return null;if(Array.isArray(d)){const[a,v,m,x]=d;return[a,v,m,255*x]}return"string"==typeof d?d:{...d,defaultValue:B(null==d?void 0:d.defaultValue)}}function k(d,a){return R.apply(this,arguments)}function R(){return(R=(0,M.A)(function*(d,a){const{cimResourceManager:v,cimAnalyzer:m,scaleExpression:x}=a.schemaOptions;yield Promise.all(f.wp.fetchResources(d.symbol,v,[]));const E=m.analyzeSymbolReference(d,!1),C={scaleInfo:s(d),scaleExpression:x},Z=[];for(const Y of E)switch(Y.type){case"marker":Z.push(...L(Y,a,C));break;case"fill":Z.push(...q(Y,a,C));break;case"line":Z.push(...h(Y,a,C));break;case"text":Z.push(...ee(Y,a,C))}return Z})).apply(this,arguments)}function L(d,a,v){const{uniforms:m,schemaOptions:x}=a,{store:E}=x,C=d.isOutline?{...l.Dk,visualVariableSizeScaleStops:m.visualVariableSizeOutlineScaleStops}:{visualVariableColor:m.visualVariableColor,visualVariableOpacity:m.visualVariableOpacity,visualVariableSizeMinMaxValue:m.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:m.visualVariableSizeScaleStops,visualVariableSizeStops:m.visualVariableSizeStops,visualVariableSizeUnitValue:m.visualVariableSizeUnitValue,visualVariableRotation:m.visualVariableRotation};return G(E.ensureInstance(I.YS.marker,{geometry:C},{zoomRange:!!v.scaleInfo}),d,m,v)}function G(d,a,v,{scaleInfo:m,scaleExpression:x}){var E,C;const Z=(0,u.I)(v);return[d.createMeshInfo({params:{size:a.size,scaleX:a.scaleX,anchorX:a.anchorPoint.x,anchorY:a.anchorPoint.y,angle:a.rotation,color:null!==(E=B(a.color))&&void 0!==E?E:[0,0,0,0],colorLocked:a.colorLocked,frameHeight:a.frameHeight,widthRatio:a.widthRatio,scaleInfo:m,offsetX:a.offsetX,offsetY:a.offsetY,outlineColor:null!==(C=B(a.outlineColor))&&void 0!==C?C:[0,0,0,0],outlineSize:a.outlineWidth,referenceSize:a.referenceSize||O.D.CIMVectorMarker.size,rotateClockwise:a.rotateClockwise,scaleFactor:null!=x?x:1,sizeRatio:a.sizeRatio,alignment:a.alignment,isAbsoluteAnchorPoint:a.isAbsoluteAnchorPoint,scaleSymbolsProportionally:a.scaleSymbolsProportionally,sprite:a.spriteRasterizationParam,hasSizeVV:Z,placement:a.markerPlacement,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,transforms:a.transform,minPixelBuffer:(0,l.j0)(v)}})]}function X(d,a,{scaleInfo:v}){var m;return[d.createMeshInfo({params:{color:null!==(m=B(a.color))&&void 0!==m?m:[0,0,0,0],scaleInfo:v,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null}})]}function q(d,a,v){if(!d.spriteRasterizationParam)return function K(d,a,v){const{uniforms:m,schemaOptions:x}=a,{store:E}=x;return X(E.ensureInstance(I.YS.fill,{geometry:{visualVariableColor:d.colorLocked?null:m.visualVariableColor,visualVariableOpacity:m.visualVariableOpacity}},{zoomRange:!!v.scaleInfo}),d,v)}(d,a,v);const{uniforms:m,schemaOptions:x}=a,{store:E}=x;return F(E.ensureInstance(I.YS.complexFill,{geometry:{visualVariableColor:d.colorLocked?null:m.visualVariableColor,visualVariableOpacity:m.visualVariableOpacity}},{zoomRange:!!v.scaleInfo}),d,null!=m.visualVariableColor,v)}function F(d,a,v,{scaleInfo:m}){var x;if(!a.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const C=a.sampleAlphaOnly&&!(a.hasUnresolvedReplacementColor&&(!v||a.colorLocked)),Z=a.spriteRasterizationParam;return[d.createMeshInfo({params:{color:null!==(x=B(a.color))&&void 0!==x?x:[0,0,0,0],height:a.height,aspectRatio:a.scaleX,offsetX:a.offsetX,offsetY:a.offsetY,scaleX:1,scaleY:1,angle:a.angle,applyRandomOffset:a.applyRandomOffset,sampleAlphaOnly:C,scaleProportionally:"CIMHatchFill"===Z.resource.type,sprite:Z,scaleInfo:m,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null}})]}function h(d,a,v){const{uniforms:m,schemaOptions:x}=a,{store:E}=x,C=d.isOutline?{...l.Dk,visualVariableSizeScaleStops:m.visualVariableSizeOutlineScaleStops}:{visualVariableColor:d.colorLocked?null:m.visualVariableColor,visualVariableOpacity:m.visualVariableOpacity,visualVariableSizeMinMaxValue:m.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:m.visualVariableSizeScaleStops,visualVariableSizeStops:m.visualVariableSizeStops,visualVariableSizeUnitValue:m.visualVariableSizeUnitValue},Z={geometry:C},Y=!!(C.visualVariableSizeMinMaxValue||C.visualVariableSizeScaleStops||C.visualVariableSizeStops||C.visualVariableSizeUnitValue);return d.spriteRasterizationParam?W(E.ensureInstance(I.YS.texturedLine,Z,{zoomRange:!!v.scaleInfo}),d,Y,v):U(E.ensureInstance(I.YS.line,Z,{zoomRange:!!v.scaleInfo}),d,Y,v)}function V(d,a,{scaleInfo:v}){var m;return{params:{color:null!==(m=B(d.color))&&void 0!==m?m:[0,0,0,0],width:d.width,referenceWidth:d.referenceWidth,capType:d.cap,joinType:d.join,miterLimit:d.miterLimit,scaleInfo:v,hasSizeVV:a,effects:d.effects?{type:"cim-effect-infos",effectInfos:d.effects}:null}}}function U(d,a,v,m){if(a.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");return[d.createMeshInfo({params:V(a,v,m).params})]}function W(d,a,v,m){const{spriteRasterizationParam:x,scaleDash:E,sampleAlphaOnly:C}=a;if(!x)throw new Error("InternalError: Sprite should be defined");return[d.createMeshInfo({params:{...V(a,v,m).params,shouldScaleDash:null!=E&&E,shouldSampleAlphaOnly:C,isSDF:"CIMPictureStroke"!==x.resource.type,sprite:x}})]}function ee(d,a,v){const{uniforms:m,schemaOptions:x}=a,{store:E}=x;return oe(E.ensureInstance(I.YS.text,{geometry:{visualVariableColor:d.colorLocked?null:m.visualVariableColor,visualVariableOpacity:m.visualVariableOpacity,visualVariableRotation:m.visualVariableRotation,visualVariableSizeMinMaxValue:m.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:m.visualVariableSizeScaleStops,visualVariableSizeStops:m.visualVariableSizeStops,visualVariableSizeUnitValue:m.visualVariableSizeUnitValue}},{zoomRange:!!v.scaleInfo,referenceSymbol:!1,clipAngle:!1}),d,m,v)}function oe(d,a,v,{scaleInfo:m,scaleExpression:x}){var E,C,Z,Y,H;return[d.createMeshInfo({params:{boxBackgroundColor:B(a.backgroundColor),boxBorderLineColor:B(a.borderLineColor),boxBorderLineSize:null!==(E=a.borderLineWidth)&&void 0!==E?E:0,color:null!==(C=B(a.color))&&void 0!==C?C:[0,0,0,0],offsetX:a.offsetX,offsetY:a.offsetY,postAngle:a.angle,fontSize:a.size,referenceSize:a.referenceSize,decoration:a.decoration,haloColor:null!==(Z=B(a.outlineColor))&&void 0!==Z?Z:[0,0,0,0],haloFontSize:a.outlineSize,lineWidth:a.lineWidth||512,lineHeightRatio:1,horizontalAlignment:null!==(Y=a.horizontalAlignment)&&void 0!==Y?Y:"center",verticalAlignment:null!==(H=a.verticalAlignment)&&void 0!==H?H:"baseline",useCIMAngleBehavior:!1,glyphs:a.textRasterizationParam,scaleInfo:m,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,placement:a.markerPlacement,transforms:a.transform,scaleFactor:null!=x?x:1,minPixelBuffer:(0,l.j0)(v),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})]}},99845:(Se,re,y)=>{function M(O){return!!(O.visualVariableSizeMinMaxValue||O.visualVariableSizeScaleStops||O.visualVariableSizeStops||O.visualVariableSizeUnitValue||O.visualVariableSizeOutlineScaleStops)}function f(O){return!!O.visualVariableRotation}y.d(re,{I:()=>M,N:()=>f})},79213:(Se,re,y)=>{y.d(re,{R:()=>B,e:()=>F});var M=y(5922),f=y(35150),O=y(67685),I=y(54551);const l=8,u=l-2,s=()=>f.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function B(h){return h.map(V=>function k(h){return("size"===h.type||"color"===h.type||"opacity"===h.type)&&null!=h.stops}(V)?function R(h){var V;return h.stops=function X(h,V){return V.length<=l?V:(s().warn(`Found ${V.length} Visual Variable stops, but MapView only supports ${l}. Displayed stops will be simplified.`),V.length>2*l?function G(h,V){const[U,...W]=V,ee=W.pop(),oe=W[0].value,d=W[W.length-1].value,a=(d-oe)/u,v=[];for(let m=oe;m<d;m+=a){let x=0;for(;m>=W[x].value;)x++;const E=W[x],C=V[x-1],Y=E.value===C.value?1:(m-C.value)/(E.value-C.value);if("color"===h){const H=W[x],ae=V[x-1],ie=H.color.clone();ie.r=L(ae.color.r,ie.r,Y),ie.g=L(ae.color.g,ie.g,Y),ie.b=L(ae.color.b,ie.b,Y),ie.a=L(ae.color.a,ie.a,Y),v.push({value:m,color:ie,label:H.label})}else if("size"===h){const H=W[x],ae=V[x-1],ie=(0,O.cr)(H.size),we=L((0,O.cr)(ae.size),ie,Y);v.push({value:m,size:we,label:H.label})}else{const H=W[x],ae=L(V[x-1].opacity,H.opacity,Y);v.push({value:m,opacity:ae,label:H.label})}}return[U,...v,ee]}(h,V):function K(h){const[V,...U]=h,W=U.pop();for(;U.length>u;){let ee=0,oe=0;for(let d=1;d<U.length;d++){const m=Math.abs(U[d].value-U[d-1].value);m>oe&&(oe=m,ee=d)}U.splice(ee,1)}return[V,...U,W]}(V))}(h.type,null!==(V=h.stops)&&void 0!==V?V:[]),h}(V.clone()):V)}function L(h,V,U){return(1-U)*h+U*V}function F(h){if(!h)return!0;switch(h.type){case"dot-density":break;case"heatmap":if(!function q(){const{supportsColorBufferFloat:h,supportsColorBufferFloatBlend:V,supportsColorBufferHalfFloat:U}=(0,I.C)();return h&&V||U}()){const V=(0,I.C)(),U=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(W=>!V[W]).join(", ");return s().errorOnce(new M.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${U}`)),!1}}return!0}},31411:(Se,re,y)=>{y.d(re,{A:()=>B});var M=y(10467),f=y(35547),O=y(56330);function I(k){return k.some(R=>R.globalId)}function l(k){return k.filter(R=>!R.error).map(R=>{var L;return null!==(L=R.objectId)&&void 0!==L?L:R.globalId}).filter(R=>null!=R)}function u(k,R){const L=new Set(k);for(const G of R.values())L.add(G);return L}function s(k,R){const L=new Set(k);for(const G of R.values())L.delete(G);return L}class B{constructor(R){this.updateTracking=new f.F({debugName:"FeatureCommandQueue"}),this._hasGlobalIds=!1,this._queueProcessor=new O.e({concurrency:1,process:R.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}push(R){var L=this;return(0,M.A)(function*(){return L.updateTracking.addPromise(L._doPush(R))})()}_doPush(R){var L=this;return(0,M.A)(function*(){const G=L._queueProcessor,K=G.last(),X=[];switch(R.type){case"update":if((null==K?void 0:K.type)===R.type)return;X.push(G.push(R));break;case"edit":{const q="processed-edit"===(null==K?void 0:K.type)?K:null;q&&G.popLast();const F=L._mergeEdits(q,R);for(const h of F)h&&X.push(G.push(h));break}}yield Promise.all(X)})()}_mergeEdits(R,L){var G,K;const{addedFeatures:X,deletedFeatures:q,updatedFeatures:F}=L.edits;if(this._hasGlobalIds=this._hasGlobalIds||I(X)||I(F)||I(q),this._hasGlobalIds)return[R,{type:"processed-edit",edits:{addOrModified:[...X,...F],removed:q}}];const h=new Set(l(null!==(G=null==R?void 0:R.edits.addOrModified)&&void 0!==G?G:[])),V=new Set(l(null!==(K=null==R?void 0:R.edits.removed)&&void 0!==K?K:[])),U=new Set([...l(X),...l(F)]),W=new Set(l(q));return[{type:"processed-edit",edits:{addOrModified:Array.from(u(s(h,W),U)).map(ee=>({objectId:ee})),removed:Array.from(u(s(V,U),W)).map(ee=>({objectId:ee}))}}]}}}}]);