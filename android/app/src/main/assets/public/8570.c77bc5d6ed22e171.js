"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8570,1447],{10442:(ve,G,a)=>{a.d(G,{a:()=>f,b:()=>z,c:()=>C,d:()=>q,e:()=>W,f:()=>H,n:()=>D,s:()=>K,t:()=>Z}),a(3248);var Q=a(96196);function q(c,m,u){f(c.typedBuffer,m.typedBuffer,u,c.typedBufferStride,m.typedBufferStride)}function f(c,m,u,y=3,B=y){if(c.length/y!==Math.ceil(m.length/B))return c;const $=c.length/y,S=u[0],d=u[1],l=u[2],A=u[4],T=u[5],ee=u[6],J=u[8],ae=u[9],Y=u[10],te=u[12],ce=u[13],ye=u[14];let re=0,se=0;for(let ie=0;ie<$;ie++){const me=m[re],X=m[re+1],le=m[re+2];c[se]=S*me+A*X+J*le+te,c[se+1]=d*me+T*X+ae*le+ce,c[se+2]=l*me+ee*X+Y*le+ye,re+=B,se+=y}return c}function C(c,m,u){z(c.typedBuffer,m.typedBuffer,u,c.typedBufferStride,m.typedBufferStride)}function z(c,m,u,y=3,B=y){if(c.length/y!==Math.ceil(m.length/B))return void(0,Q.j)().error("source and destination buffers need to have the same number of elements");const $=c.length/y,S=u[0],d=u[1],l=u[2],A=u[3],T=u[4],ee=u[5],J=u[6],ae=u[7],Y=u[8];let te=0,ce=0;for(let ye=0;ye<$;ye++){const re=m[te],se=m[te+1],ie=m[te+2];c[ce]=S*re+A*se+J*ie,c[ce+1]=d*re+T*se+ae*ie,c[ce+2]=l*re+ee*se+Y*ie,te+=B,ce+=y}}function H(c,m,u){K(c.typedBuffer,m,u,c.typedBufferStride)}function K(c,m,u,y=3){const B=Math.min(c.length/y,m.count),$=m.typedBuffer,S=m.typedBufferStride;let d=0,l=0;for(let A=0;A<B;A++)c[l]=u*$[d],c[l+1]=u*$[d+1],c[l+2]=u*$[d+2],d+=S,l+=y}function Z(c,m,u,y=3,B=y){const $=c.length/y;if($!==Math.ceil(m.length/B))return c;let S=0,d=0;for(let l=0;l<$;l++)c[d]=m[S]+u[0],c[d+1]=m[S+1]+u[1],c[d+2]=m[S+2]+u[2],S+=B,d+=y;return c}function W(c,m){D(c.typedBuffer,m.typedBuffer,c.typedBufferStride,m.typedBufferStride)}function D(c,m,u=3,y=u){const B=Math.min(c.length/u,m.length/y);let $=0,S=0;for(let d=0;d<B;d++){const l=m[$],A=m[$+1],T=m[$+2],ee=l*l+A*A+T*T;if(ee>0){const J=1/Math.sqrt(ee);c[S]=J*l,c[S+1]=J*A,c[S+2]=J*T}$+=y,S+=u}}Object.freeze(Object.defineProperty({__proto__:null,normalize:D,normalizeView:W,scale:K,scaleView:H,shiftRight:function L(c,m,u){const y=Math.min(c.count,m.count),B=c.typedBuffer,$=c.typedBufferStride,S=m.typedBuffer,d=m.typedBufferStride;let l=0,A=0;for(let T=0;T<y;T++)B[A]=S[l]>>u,B[A+1]=S[l+1]>>u,B[A+2]=S[l+2]>>u,l+=d,A+=$},transformMat3:z,transformMat3View:C,transformMat4:f,transformMat4View:q,translate:Z},Symbol.toStringTag,{value:"Module"}))},38352:(ve,G,a)=>{a.d(G,{A:()=>D});var v=a(8189),Q=a(90660),q=a(71065),f=a(85211),K=(a(3248),a(35150),a(40707),a(15463)),Z=a(76576);let W=class extends((0,Q.O)(q.oY)){constructor(L){super(L),this.type="georeferenced",this.origin=null}};(0,v._)([(0,K.e)({georeferenced:"georeferenced"},{readOnly:!0})],W.prototype,"type",void 0),(0,v._)([(0,f.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],W.prototype,"origin",void 0),W=(0,v._)([(0,Z.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],W);const D=W},58315:(ve,G,a)=>{a.d(G,{A:()=>L});var v=a(8189),Q=a(90660),q=a(71065),f=a(85211),K=(a(3248),a(35150),a(40707),a(15463)),Z=a(76576),W=a(25866);let D=class extends((0,Q.O)(q.oY)){constructor(k){super(k),this.type="local",this.origin=(0,W.vt)()}};(0,v._)([(0,K.e)({local:"local"},{readOnly:!0})],D.prototype,"type",void 0),(0,v._)([(0,f.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],D.prototype,"origin",void 0),D=(0,v._)([(0,Z.$)("esri.geometry.support.MeshLocalVertexSpace")],D);const L=D},96196:(ve,G,a)=>{a.d(G,{j:()=>Q});var v=a(35150);const Q=()=>v.A.getLogger("esri.views.3d.support.buffer.math")},33019:(ve,G,a)=>{a.d(G,{Bq:()=>H,Qp:()=>z,WN:()=>$,dK:()=>S,eN:()=>c,fH:()=>B,in:()=>m,yr:()=>K});var v=a(10467),Q=a(89563),q=a(89952),f=a(56492),C=a(6829);class z{constructor(l,A,T){this.assetName=l,this.assetMimeType=A,this.parts=T}equals(l){return this===l||this.assetName===l.assetName&&this.assetMimeType===l.assetMimeType&&(0,q.aI)(this.parts,l.parts,(A,T)=>A.equals(T))}isOnService(l){return this.parts.every(A=>A.isOnService(l))}makeHash(){let l="";for(const A of this.parts)l+=A.partHash;return l}toBlob(l){var A=this;return(0,v.A)(function*(){const{parts:T}=A;if(1===T.length)return T[0].toBlob(l);const ee=yield Promise.all(T.map(J=>J.toBlob(l)));return(0,f.Te)(l),new Blob(ee)})()}}class H{constructor(l,A){this.partUrl=l,this.partHash=A}equals(l){return this===l||this.partUrl===l.partUrl&&this.partHash===l.partHash}isOnService(l){return this.partUrl.startsWith(`${l.path}/assets/`)}toBlob(l){var A=this;return(0,v.A)(function*(){const{data:T}=yield(0,Q.A)(A.partUrl,{responseType:"blob"});return(0,f.Te)(l),T})()}}function K(d){return function L(d){return!!d&&(Array.isArray(d)?d.some(k):k(d))}(null==d?void 0:d.source)}function Z(d){return!!Array.isArray(d)&&d.every(l=>l instanceof z)}const W=/^(model\/gltf\+json)|(model\/gltf-binary)$/,D=/\.(gltf|glb)/i;function k(d){if(d instanceof File){const{type:l,name:A}=d;return W.test(l)||D.test(A)}return W.test(d.assetMimeType)||D.test(d.assetName)}function c(d,l){if(!d)return!1;const{source:A}=d;return function u(d,l){return Array.isArray(d)?d.length>0&&d.every(T=>y(T,l)):y(d,l)}(A,l)}function m(d,l){if(d===l)return!0;const{source:A}=d,{source:T}=l;if(A===T)return!0;if(Z(A)&&Z(T)){if(A.length!==T.length)return!1;const ee=(Y,te)=>Y.assetName<te.assetName?-1:Y.assetName>te.assetName?1:0,J=[...A].sort(ee),ae=[...T].sort(ee);for(let Y=0;Y<J.length;++Y)if(!J[Y].equals(ae[Y]))return!1;return!0}return!1}function y(d,l){return d instanceof z&&d.isOnService(l)}function B(d,l){var A;return d instanceof File?(0,C.rq)(d,l):null!==(A=(0,C.R_)(d.assetMimeType,l))&&void 0!==A?A:(0,C.E1)(d.assetName,l)}function $(d){return Array.isArray(d)?d:[d]}function S(d){return!!d.original}},78559:(ve,G,a)=>{a.d(G,{CK:()=>D,Hq:()=>W,MW:()=>L,TE:()=>k,Uj:()=>c,by:()=>m,kp:()=>K});var v=a(23159),Q=a(35150),q=a(13303),f=a(38352),C=a(58315),z=a(10442);function H(){return Q.A.getLogger("esri.geometry.Mesh")}function K(u){var y;const{vertexSpace:B}=u;if(null!=B.origin)return u.clone();const{anchor:$}=u,S=$.clone(),d=new f.A({origin:[S.x,S.y,S.z]}),l=u.cloneWithVertexSpace(d),{position:A}=l.vertexAttributes;return l.vertexAttributes.position=(0,z.t)(new Float64Array(A.length),A,[-S.x,-S.y,-(null!==(y=S.z)&&void 0!==y?y:0)]),l.vertexAttributesChanged(),l}function W(u){return null!=u.origin}function D(u){return W(u.vertexSpace)}function L(u,y){if(!W(u))return null;const[B,$,S]=u.origin;return new q.A({x:B,y:$,z:S,spatialReference:y})}function k(u,y){const{x:B,y:$,z:S,spatialReference:d}=u,l=[B,$,null!=S?S:0];if(void 0!==(null==y?void 0:y.geographic)){if((0,v.io)(H(),"option: geographic",{replacement:"use vertexSpace option instead",version:"4.29",warnOnce:!0}),null==y||!y.vertexSpace)return null!=y&&y.geographic?new C.A({origin:l}):new f.A({origin:l});H().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")}if(null==y||!y.vertexSpace)return d.isGeographic||d.isWebMercator?new C.A({origin:l}):new f.A({origin:l});switch(y.vertexSpace){case"local":return new C.A({origin:l});case"georeferenced":return new f.A({origin:l});case"georeferenced-absolute":return new f.A}}function c(u){return u.isGeographic||u.isWebMercator?"local":"georeferenced"}function m(u,y){return"local"===u?new C.A({origin:y}):new f.A({origin:y})}},78200:(ve,G,a)=>{a.d(G,{F:()=>v});const v={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},13828:(ve,G,a)=>{a.r(G),a.d(G,{applyEdits:()=>d,checkEditingCapabilities:()=>Se,isFeatureIdentifierArrayWithGlobalId:()=>S,isFeatureIdentifierArrayWithObjectId:()=>B,isFeatureIdentifierWithGlobalId:()=>$,isFeatureIdentifierWithObjectId:()=>y,normalizeCollections:()=>X,normalizeEdits:()=>le,normalizeGeometries:()=>ie,shallowCloneFeature:()=>Ie,uploadAssets:()=>Re});var v=a(10467),Q=a(81098),q=a(31178),f=a(5922),C=a(77806),z=a(35150),H=a(56492),K=a(45272),Z=a(43085),W=a(77098),D=a(58701),L=a(58277),k=a(86300),c=a(6829),m=a(58443);function u(s){return null!=(null==s?void 0:s.applyEdits)}function y(s){return"object"==typeof s&&null!=s&&"objectId"in s&&!!s.objectId}function B(s){return s.every(y)}function $(s){return"object"==typeof s&&null!=s&&"globalId"in s&&!!s.globalId}function S(s){return s.every($)}function d(s,i,p){return l.apply(this,arguments)}function l(){return l=(0,v.A)(function*(s,i,p,R={}){var _;let b;const U=null!==(_=R.gdbVersion)&&void 0!==_?_:"gdbVersion"in s?s.gdbVersion:null;(0,L.Mk)(s)&&s.url?b=(0,L.Zk)(s.url,s.layerId,U,"original-and-current-features"===R.returnServiceEditsOption):(b=(0,H.Tw)(),b.promise.then(x=>{(x.addedFeatures.length||x.updatedFeatures.length||x.deletedFeatures.length||x.addedAttachments.length||x.updatedAttachments.length||x.deletedAttachments.length)&&s.emit("edits",x)}),s.emit("apply-edits",{result:b.promise}));try{var j;const{results:I,edits:x}=yield function A(s,i,p,R){return T.apply(this,arguments)}(s,i,p,R),w=t=>t.filter(r=>!r.error).map(C.o8),e={edits:x,addedFeatures:w(I.addFeatureResults),updatedFeatures:w(I.updateFeatureResults),deletedFeatures:w(I.deleteFeatureResults),addedAttachments:w(I.addAttachmentResults),updatedAttachments:w(I.updateAttachmentResults),deletedAttachments:w(I.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:I.editMoment?new Date(I.editMoment):null,globalIdToObjectId:R.globalIdToObjectId};return null!==(j=I.editedFeatureResults)&&void 0!==j&&j.length&&(e.editedFeatures=I.editedFeatureResults),b.resolve(e),I}catch(I){throw b.reject(I),I}}),l.apply(this,arguments)}function T(){return T=(0,v.A)(function*(s,i,p,R){var _,b,P,U,j,I;if(yield s.load(),!u(i))throw new f.A(`${s.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:s});if(!(0,m.tk)(s))throw new f.A(`${s.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:s});const{edits:x,options:w}=yield function ee(s,i,p){return J.apply(this,arguments)}(s,p,R);return null!==(_=x.addFeatures)&&void 0!==_&&_.length||null!==(b=x.updateFeatures)&&void 0!==b&&b.length||null!==(P=x.deleteFeatures)&&void 0!==P&&P.length||null!==(U=x.addAttachments)&&void 0!==U&&U.length||null!==(j=x.updateAttachments)&&void 0!==j&&j.length||null!==(I=x.deleteAttachments)&&void 0!==I&&I.length?{edits:x,results:yield i.applyEdits(x,w)}:{edits:x,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),T.apply(this,arguments)}function J(){return J=(0,v.A)(function*(s,i,p){const R=(0,m.BR)(s),P=null!=s.infoFor3D;if(Se(i,R,p,!(!i||!(i.addFeatures||i.updateFeatures||i.deleteFeatures)),!(!i||!(i.addAttachments||i.updateAttachments||i.deleteAttachments)),`${s.type}-layer`),!R.data.isVersioned&&null!=p&&p.gdbVersion)throw new f.A(`${s.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!R.editing.supportsRollbackOnFailure&&null!=p&&p.rollbackOnFailureEnabled)throw new f.A(`${s.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const U={...p};if(null!=U.rollbackOnFailureEnabled||R.editing.supportsRollbackOnFailure||(U.rollbackOnFailureEnabled=!0),U.rollbackOnFailureEnabled||"original-and-current-features"!==U.returnServiceEditsOption||(!1===U.rollbackOnFailureEnabled&&z.A.getLogger("esri.layers.graphics.editingSupport").warn(`${s.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),U.rollbackOnFailureEnabled=!0),!R.editing.supportsReturnServiceEditsInSourceSpatialReference&&U.returnServiceEditsInSourceSR)throw new f.A(`${s.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(U.returnServiceEditsInSourceSR&&"original-and-current-features"!==U.returnServiceEditsOption)throw new f.A(`${s.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const j=le(i,R,`${s.type}-layer`),I=(null==p?void 0:p.globalIdUsed)||P,x=s.fields.filter(w=>"big-integer"===w.type||"oid"===w.type&&(w.length||0)>=8);if(I){const{globalIdField:w}=s;if(null==w)throw new f.A(`${s.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");j.addFeatures.forEach(e=>function se(s,i){const{attributes:p}=s;null==p[i]&&(p[i]=(0,Z.yS)())}(e,w))}return j.addFeatures.forEach(w=>function te(s,i,p,R){ae(s,i,p,R),Y(s,i)}(w,s,I,x)),j.updateFeatures.forEach(w=>function ye(s,i,p,R){ae(s,i,p,R),Y(s,i);const _=(0,m.BR)(i);if("geometry"in s&&null!=s.geometry&&(null==_||!_.editing.supportsGeometryUpdate))throw new f.A(`${i.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(w,s,I,x)),j.deleteFeatures.forEach(w=>function ce(s,i,p,R){ae(s,i,p,R)}(w,s,I,x)),j.addAttachments.forEach(w=>re(w,s)),j.updateAttachments.forEach(w=>re(w,s)),P&&(yield function Pe(s,i){return Fe.apply(this,arguments)}(j,s)),{edits:yield ie(j),options:U}}),J.apply(this,arguments)}function ae(s,i,p,R){if(p){if("attributes"in s&&!s.attributes[i.globalIdField])throw new f.A(`${i.type}-layer:invalid-parameter`,`Feature should have '${i.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in s)&&!s.globalId)throw new f.A(`${i.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(R.length&&"attributes"in s)for(const P of R){const U=s.attributes[P.name];if(void 0!==U&&!(0,k.OG)(P,U))throw new f.A(`${i.type}-layer:invalid-parameter`,`Big-integer field '${P.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:s})}if("geometry"in s&&null!=s.geometry){var _,b;if(s.geometry.hasZ&&!1===(null===(_=i.capabilities)||void 0===_?void 0:_.data.supportsZ))throw new f.A(`${i.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(s.geometry.hasM&&!1===(null===(b=i.capabilities)||void 0===b?void 0:b.data.supportsM))throw new f.A(`${i.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function Y(s,i){var p;if("geometry"in s&&"mesh"===(null===(p=s.geometry)||void 0===p?void 0:p.type)&&null!=i.infoFor3D&&null!=i.spatialReference){const{geometry:R}=s,{spatialReference:_,vertexSpace:b}=R,P=i.spatialReference,U="local"===b.type,j=(0,D.EA)(P),I=(0,D.aI)(P,_),x=I||(0,D.oT)(P)&&((0,D.oT)(_)||(0,D.K8)(_));if(!(U&&j&&x||!U&&!j&&I))throw new f.A(`${i.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${b.type} vertex space and a spatial reference wkid:${_.wkid} to a layer with a spatial reference wkid:${P.wkid} is not supported.`)}}function re(s,i){var p;const{feature:R,attachment:_}=s;if(!R||"attributes"in R&&!R.attributes[i.globalIdField])throw new f.A(`${i.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in R)&&!R.globalId)throw new f.A(`${i.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!_.globalId)throw new f.A(`${i.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!_.data&&!_.uploadId)throw new f.A(`${i.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(_.data instanceof File&&_.data.name||_.name))throw new f.A(`${i.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if((null===(p=i.capabilities)||void 0===p||!p.editing.supportsUploadWithItemId)&&_.uploadId)throw new f.A(`${i.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof _.data){const b=(0,K.r$)(_.data);if(b&&!b.isBase64)throw new f.A(`${i.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function ie(s){return me.apply(this,arguments)}function me(){return(me=(0,v.A)(function*(s){var i,p;const R=null!==(i=s.addFeatures)&&void 0!==i?i:[],_=null!==(p=s.updateFeatures)&&void 0!==p?p:[],b=R.concat(_).map(I=>I.geometry),P=yield(0,W.el)(b),U=R.length,j=_.length;return P.slice(0,U).forEach((I,x)=>R[x].geometry=I),P.slice(U,U+j).forEach((I,x)=>_[x].geometry=I),s})).apply(this,arguments)}function X(s){var i,p;return{addFeatures:Array.from(null!==(i=null==s?void 0:s.addFeatures)&&void 0!==i?i:[]),updateFeatures:Array.from(null!==(p=null==s?void 0:s.updateFeatures)&&void 0!==p?p:[]),deleteFeatures:s&&q.A.isCollection(s.deleteFeatures)?s.deleteFeatures.toArray():s.deleteFeatures||[],addAttachments:s.addAttachments||[],updateAttachments:s.updateAttachments||[],deleteAttachments:s.deleteAttachments||[]}}function le(s,i,p){var R,_,b;const P=X(s);if(null!==(R=P.addFeatures)&&void 0!==R&&R.length&&!i.operations.supportsAdd)throw new f.A(`${p}:unsupported-operation`,"Layer does not support adding features.");if(null!==(_=P.updateFeatures)&&void 0!==_&&_.length&&!i.operations.supportsUpdate)throw new f.A(`${p}:unsupported-operation`,"Layer does not support updating features.");if(null!==(b=P.deleteFeatures)&&void 0!==b&&b.length&&!i.operations.supportsDelete)throw new f.A(`${p}:unsupported-operation`,"Layer does not support deleting features.");return P.addFeatures=P.addFeatures.map(Ie),P.updateFeatures=P.updateFeatures.map(Ie),P.addAssetFeatures=[],P}function Se(s,i,p,R,_,b){if(!s||!R&&!_)throw new f.A(`${b}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!i.editing.supportsGlobalId&&null!=p&&p.globalIdUsed)throw new f.A(`${b}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!i.editing.supportsGlobalId&&_)throw new f.A(`${b}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if((null==p||!p.globalIdUsed)&&_)throw new f.A(`${b}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}function Ie(s){const i=new Q.A;return s.attributes||(s.attributes={}),i.geometry=s.geometry,i.attributes=s.attributes,i}function Fe(){return(Fe=(0,v.A)(function*(s,i){var p,R;if(null==i.infoFor3D)return;const{infoFor3D:_}=i,b=null!==(p=(0,c.R_)("model/gltf-binary",_.supportedFormats))&&void 0!==p?p:(0,c.E1)("glb",_.supportedFormats);if(!b||!_.editFormats.includes(b))throw new f.A(`${i.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");null!==(R=s.addAssetFeatures)&&void 0!==R||(s.addAssetFeatures=[]);const{addAssetFeatures:P}=s;for(const I of null!==(U=s.addFeatures)&&void 0!==U?U:[]){var U;be(I)&&P.push(I)}for(const I of null!==(j=s.updateFeatures)&&void 0!==j?j:[]){var j;be(I)&&P.push(I)}})).apply(this,arguments)}function be(s){var i;return"mesh"===(null==s||null===(i=s.geometry)||void 0===i?void 0:i.type)}function Re(s,i,p,R){if(!u(i))throw new f.A(`${s.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:s});if(!i.uploadAssets)throw new f.A(`${s.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:s});return i.uploadAssets(p,R)}},28570:(ve,G,a)=>{a.r(G),a.d(G,{default:()=>w});var v=a(10467),Q=a(8189),f=(a(21152),a(77469)),C=a(89563),z=a(12849),H=a(89952),K=a(5922),Z=a(3248),W=a(49976),D=a(55098),L=a(35150),k=a(89221),c=a(56492),m=a(45272),u=a(43085),y=a(85211),B=a(76576),$=a(28067),S=a(78559),d=a(33019),l=a(81098),A=a(82663),T=a(11817),ee=a(61320),J=a(58701),ae=a(13828);function Y(e,t,r){return te.apply(this,arguments)}function te(){return(te=(0,v.A)(function*(e,t,r){const{geometry:n}=t,o={...t.attributes};if(null!=r&&"mesh"===(null==n?void 0:n.type)){var E;const{transformFieldRoles:g}=r,{origin:F,spatialReference:h,transform:O,vertexSpace:M}=n,N="local"===M.type,ne=e.spatialReference,ue=ne.isGeographic,Ae=(0,J.aI)(ne,h),Me=Ae||(0,J.oT)(ne)&&((0,J.oT)(h)||(0,J.K8)(h));if(!(N&&ue&&Me||!N&&!ue&&Ae))return null;const V=(0,T.projectWithoutEngine)(F,h,ne);if(null==V)return null;if(o[g.originX]=V.x,o[g.originY]=V.y,o[g.originZ]=null!==(E=V.z)&&void 0!==E?E:0,null!=O){const{translation:_e,scale:he,rotation:oe}=O,ge=N?1:(0,A.KX)(h)/(0,A.KX)(ne);o[g.translationX]=_e[0]*ge,o[g.translationY]=_e[2]*ge,o[g.translationZ]=-_e[1]*ge,o[g.scaleX]=he[0],o[g.scaleY]=he[2],o[g.scaleZ]=he[1],o[g.rotationX]=oe[0],o[g.rotationY]=oe[2],o[g.rotationZ]=-oe[1],o[g.rotationDeg]=oe[3]}return{attributes:o}}return null==n?{attributes:o}:"mesh"===n.type||"extent"===n.type?null:{geometry:n.toJSON(),attributes:o}})).apply(this,arguments)}function ye(){return(ye=(0,v.A)(function*(e,t){var r,n,o;const E=yield Promise.all((null!==(r=t.addAttachments)&&void 0!==r?r:[]).map(h=>re(e,h))),g=yield Promise.all((null!==(n=t.updateAttachments)&&void 0!==n?n:[]).map(h=>re(e,h))),F=null!==(o=t.deleteAttachments)&&void 0!==o?o:[];return E.length||g.length||F.length?{adds:E,updates:g,deletes:[...F]}:null})).apply(this,arguments)}function re(e,t){return se.apply(this,arguments)}function se(){return(se=(0,v.A)(function*(e,t){var r;const{feature:n,attachment:o}=t,{globalId:E,name:g,contentType:F,data:h,uploadId:O}=o,M={globalId:E};if(n&&("attributes"in n?M.parentGlobalId=null===(r=n.attributes)||void 0===r?void 0:r[e.globalIdField]:n.globalId&&(M.parentGlobalId=n.globalId)),O)M.uploadId=O;else if(h){const N=yield(0,m._0)(h);N&&(M.contentType=N.mediaType,M.data=N.data),h instanceof File&&(M.name=h.name)}return g&&(M.name=g),F&&(M.contentType=F),M})).apply(this,arguments)}function X(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new K.A("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}function le(e,t){return new l.A({attributes:e.attributes,geometry:(0,ee.rS)({...e.geometry,spatialReference:t})})}function Se(e,t){var r,n,o;return{adds:(null==e||null===(r=e.adds)||void 0===r?void 0:r.map(E=>le(E,t)))||[],updates:(null==e||null===(n=e.updates)||void 0===n?void 0:n.map(E=>({original:le(E[0],t),current:le(E[1],t)})))||[],deletes:(null==e||null===(o=e.deletes)||void 0===o?void 0:o.map(E=>le(E,t)))||[],spatialReference:t}}var Pe=a(89962),Fe=a(5931),be=a(68438),Re=a(47516),s=a(6829),i=a(34687),p=a(28872),R=a(87086),_=a(30448),b=a(32034);const P=new W.J({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),U=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),j=new W.J({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let I=class extends D.A{constructor(){var e;super(...arguments),e=this,this.type="feature-layer",this.refresh=(0,c.sg)((0,v.A)(function*(){var t,r;yield e.load();const n=null===(t=e.sourceJSON.editingInfo)||void 0===t?void 0:t.lastEditDate;if(null==n)return{dataChanged:!0,updates:{}};try{yield e._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const o=n!==(null===(r=e.sourceJSON.editingInfo)||void 0===r?void 0:r.lastEditDate);return{dataChanged:o,updates:o?{editingInfo:e.sourceJSON.editingInfo,extent:e.sourceJSON.extent}:null}})),this._ongoingAssetUploads=new Map}load(e){const r=this._fetchService(this.layer.sourceJSON,{...e}).then(()=>this.layer.setUserPrivileges(this.sourceJSON.serviceItemId,e)).then(()=>this._ensureLatestMetadata(e));return this.addResolvingPromise(r),Promise.resolve(this)}get queryTask(){var e,t;const{capabilities:r,parsedUrl:n,dynamicDataSource:o,infoFor3D:E,gdbVersion:g,spatialReference:F,fieldsIndex:h}=this.layer,O=(0,Z.A)("featurelayer-pbf")&&(null==r?void 0:r.query.supportsFormatPBF)&&null==E,M=null!==(e=null==r||null===(t=r.operations)||void 0===t?void 0:t.supportsQueryAttachments)&&void 0!==e&&e;return new Fe.A({url:n.path,pbfSupported:O,fieldsIndex:h,infoFor3D:E,dynamicDataSource:o,gdbVersion:g,sourceSpatialReference:F,queryAttachmentsSupported:M})}addAttachment(e,t){var r=this;return(0,v.A)(function*(){yield r.load();const{layer:n}=r;yield(0,Re.VA)(n,"editing");const o=e.attributes[n.objectIdField],E=n.parsedUrl.path+"/"+o+"/addAttachment",g=r._getLayerRequestOptions(),F=r._getFormDataForAttachment(t,g.query);try{return X((yield(0,C.A)(E,{body:F})).data.addAttachmentResult)}catch(h){throw r._createAttachmentErrorResult(o,h)}})()}updateAttachment(e,t,r){var n=this;return(0,v.A)(function*(){yield n.load();const{layer:o}=n;yield(0,Re.VA)(o,"editing");const E=e.attributes[o.objectIdField],g=o.parsedUrl.path+"/"+E+"/updateAttachment",F=n._getLayerRequestOptions({query:{attachmentId:t}}),h=n._getFormDataForAttachment(r,F.query);try{return X((yield(0,C.A)(g,{body:h})).data.updateAttachmentResult)}catch(O){throw n._createAttachmentErrorResult(E,O)}})()}applyEdits(e,t){var r=this;return(0,v.A)(function*(){var n,o,E,g,F,h,O;yield r.load();const{layer:M}=r;yield(0,Re.VA)(M,"editing");const N=M.infoFor3D,ne=null!=N,ue=ne||null!==(n=null==t?void 0:t.globalIdUsed)&&void 0!==n&&n,Ae=ne?yield r._uploadMeshesAndGetAssetMapEditsJSON(e):null,Me=null!==(o=null===(E=e.addFeatures)||void 0===E?void 0:E.map(fe=>Y(r.layer,fe,N)))&&void 0!==o?o:[],V=(yield Promise.all(Me)).filter(H.Ru),_e=null!==(g=null===(F=e.updateFeatures)||void 0===F?void 0:F.map(fe=>Y(r.layer,fe,N)))&&void 0!==g?g:[],he=(yield Promise.all(_e)).filter(H.Ru),oe=function ie(e,t,r){if(!t||0===t.length)return[];if(r&&(0,ae.isFeatureIdentifierArrayWithGlobalId)(t))return t.map(o=>o.globalId);if((0,ae.isFeatureIdentifierArrayWithObjectId)(t))return t.map(o=>o.objectId);const n=r?e.globalIdField:e.objectIdField;return n?t.map(o=>o.getAttribute(n)):[]}(r.layer,e.deleteFeatures,ue);(0,p.u)(V,he,M.spatialReference);const ge=yield function ce(e,t){return ye.apply(this,arguments)}(r.layer,e),de=M.capabilities.editing.supportsAsyncApplyEdits&&ne,Ee=(null==t?void 0:t.gdbVersion)||M.gdbVersion,pe={gdbVersion:Ee,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:ue,returnEditMoment:null==t?void 0:t.returnEditMoment,usePreviousEditMoment:null==t?void 0:t.usePreviousEditMoment,async:de};yield(0,_.ZJ)(r.layer.url,Ee,!0);const Ue=(0,_.w5)(r.layer.url,Ee||null);if(yield(0,_.We)(M.url,Ee,M.historicMoment))throw new K.A("feature-layer-source:historic-version","Editing a historic version is not allowed");null!=t&&t.returnServiceEditsOption?(pe.edits=JSON.stringify([{id:M.layerId,adds:V,updates:he,deletes:oe,attachments:ge,assetMaps:Ae}]),pe.returnServiceEditsOption=P.toJSON(null==t?void 0:t.returnServiceEditsOption),pe.returnServiceEditsInSourceSR=null==t?void 0:t.returnServiceEditsInSourceSR):(pe.adds=V.length?JSON.stringify(V):null,pe.updates=he.length?JSON.stringify(he):null,pe.deletes=oe.length?ue?JSON.stringify(oe):oe.join(","):null,pe.attachments=ge&&JSON.stringify(ge),pe.assetMaps=null!=Ae?JSON.stringify(Ae):void 0);const Oe=r._getLayerRequestOptions({method:"post",query:pe});Ue&&(Oe.authMode="immediate",Oe.query.returnEditMoment=!0,Oe.query.sessionId=_.TA);const De=null!=t&&t.returnServiceEditsOption?M.url:M.parsedUrl.path;let Te;try{Te=de?yield r._asyncApplyEdits(De+"/applyEdits",Oe):yield(0,C.A)(De+"/applyEdits",Oe)}catch(fe){if(!function Ie(e){const t=e.details.raw,n=+t.extendedCode;return 500==+t.code&&(-2147217144===n||-2147467261===n)}(fe))throw fe;Oe.authMode="immediate",Te=de?yield r._asyncApplyEdits(De+"/applyEdits",Oe):yield(0,C.A)(De+"/applyEdits",Oe)}if((null===(h=M.capabilities.operations)||void 0===h||!h.supportsEditing)&&null!==(O=M.effectiveCapabilities)&&void 0!==O&&null!==(O=O.operations)&&void 0!==O&&O.supportsEditing){const fe=null==f.id?void 0:f.id.findCredential(M.url);yield null==fe?void 0:fe.refreshToken()}return r._createEditsResult(Te)})()}deleteAttachments(e,t){var r=this;return(0,v.A)(function*(){yield r.load();const{layer:n}=r;yield(0,Re.VA)(n,"editing");const o=e.attributes[n.objectIdField],E=n.parsedUrl.path+"/"+o+"/deleteAttachments";try{return(yield(0,C.A)(E,r._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(X)}catch(g){throw r._createAttachmentErrorResult(o,g)}})()}fetchRecomputedExtents(e={}){var t=this;return this.load({signal:e.signal}).then((0,v.A)(function*(){const n=t._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:o,url:E}=t.layer,{data:g}=yield(0,C.A)(`${E}/${o}`,n),{id:F,extent:h,fullExtent:O,timeExtent:M}=g,N=h||O;return{id:F,fullExtent:N&&$.A.fromJSON(N),timeExtent:M&&z.A.fromJSON({start:M[0],end:M[1]})}}))}queryAttachments(e,t={}){var r=this;return(0,v.A)(function*(){yield r.load();const n=r._getLayerRequestOptions(t);return r.queryTask.executeAttachmentQuery(e,n)})()}queryFeatures(e,t){var r=this;return(0,v.A)(function*(){var n;yield r.load();const o=yield r.queryTask.execute(e,{...t,query:r._createRequestQueryOptions(t)});return null!==(n=e.outStatistics)&&void 0!==n&&n.length&&o.features.length&&o.features.forEach(E=>{var g;const F=E.attributes;null===(g=e.outStatistics)||void 0===g||g.forEach(({outStatisticFieldName:h})=>{if(h){const O=h.toLowerCase();O&&O in F&&h!==O&&(F[h]=F[O],delete F[O])}})}),o})()}queryFeaturesJSON(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeJSON(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryObjectIds(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeForIds(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryFeatureCount(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeForCount(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryExtent(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeForExtent(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryRelatedFeatures(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeRelationshipQuery(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryRelatedFeaturesCount(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeRelationshipQueryForCount(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryTopFeatures(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeTopFeaturesQuery(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryTopObjectIds(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeForTopIds(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryTopExtents(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeForTopExtents(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryTopCount(e,t){var r=this;return(0,v.A)(function*(){return yield r.load(),r.queryTask.executeForTopCount(e,{...t,query:r._createRequestQueryOptions(t)})})()}fetchPublishingStatus(){var e=this;return(0,v.A)(function*(){if(!(0,be.Wo)(e.layer.url))return"unavailable";const t=(0,m.fj)(e.layer.url,"status"),r=yield(0,C.A)(t,{query:{f:"json"}});return j.fromJSON(r.data.status)})()}uploadAssets(e,t){var r=this;return(0,v.A)(function*(){const{uploadAssets:n}=yield Promise.all([a.e(2076),a.e(2403)]).then(a.bind(a,22403));return n(e,{layer:r.layer,ongoingUploads:r._ongoingAssetUploads},t)})()}_asyncApplyEdits(e,t){return(0,v.A)(function*(){const r=(yield(0,C.A)(e,t)).data.statusUrl;for(;;){const n=(yield(0,C.A)(r,{query:{f:"json"},responseType:"json"})).data;switch(n.status){case"Completed":return(0,C.A)(n.resultUrl,{query:{f:"json"},responseType:"json"});case"CompletedWithErrors":throw new K.A("async-applyEdits-failed","asynchronous applyEdits call failed.");case"Failed ImportChanges":case"InProgress":case"Pending":case"ExportAttachments":case"ExportChanges":case"ExportingData":case"ExportingSnapshot":case"ImportAttachments":case"ProvisioningReplica":case"UnRegisteringReplica":break;default:throw new K.A("async-applyEdits-failed","asynchronous applyEdits call failed (undefined response status)")}yield(0,c.Pl)(x)}})()}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...null==e?void 0:e.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}_fetchService(e,t){var r=this;return(0,v.A)(function*(){if(!e){const o={};(0,Z.A)("featurelayer-advanced-symbols")&&(o.returnAdvancedSymbols=!0),null!=t&&t.cacheBust&&(o._ts=Date.now());const{data:E}=yield(0,C.A)(r.layer.parsedUrl.path,r._getLayerRequestOptions({query:o,signal:null==t?void 0:t.signal}));e=E}r.sourceJSON=yield r._patchServiceJSON(e,null==t?void 0:t.signal);const n=e.type;if(!U.has(n))throw new K.A("feature-layer-source:unsupported-type",`Source type "${n}" is not supported`)})()}_patchServiceJSON(e,t){var r=this;return(0,v.A)(function*(){var n;if("Table"!==e.type&&e.geometryType&&(null==e||null===(n=e.drawingInfo)||void 0===n||!n.renderer)&&!e.defaultSymbol){const o=(0,Pe.F0)(e.geometryType).renderer;(0,k.sM)("drawingInfo.renderer",o,e)}if("esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),null==e.extent)try{const{data:o}=yield(0,C.A)(r.layer.url,r._getLayerRequestOptions({signal:t}));o.spatialReference&&(e.extent={xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:o.spatialReference})}catch(o){(0,c.QP)(o)}return e})()}_ensureLatestMetadata(e){var t=this;return(0,v.A)(function*(){if(t.layer.userHasUpdateItemPrivileges&&t.sourceJSON.cacheMaxAge>0)return t._fetchService(null,{...e,cacheBust:!0})})()}_uploadMeshesAndGetAssetMapEditsJSON(e){var t=this;return(0,v.A)(function*(){const{addAssetFeatures:r}=e;if(null==r||!r.length)return null;const n=yield t._filterRedundantAssetMaps(r);if(null==r||!r.length)return null;const o=new Array,E=new Map;for(const g of n){const{geometry:F}=g,{vertexSpace:h}=F;if((0,S.Hq)(h))o.push(F);else{const O=(0,S.kp)(F);E.set(O,F),g.geometry=O,o.push(O)}}yield t.uploadAssets(o);for(const[g,F]of E)F.addExternalSources(g.metadata.externalSources.items);return{adds:t._getAssetMapEditsJSON(n),updates:[],deletes:[]}})()}_getAssetMapEditsJSON(e){const t=new Array,r=this.layer.globalIdField,n=this.layer.parsedUrl;for(const E of e){var o;const g=E.geometry,{metadata:F}=g,h=F.getExternalSourcesOnService(n),O=E.getAttribute(r);if(0===h.length){L.A.getLogger(this).error(`Skipping feature ${O}. The mesh it is associated with has not been uploaded to the service and cannot be mapped to it.`);continue}const{source:M}=null!==(o=h.find(d.dK))&&void 0!==o?o:h[0];for(const N of M)1===N.parts.length?t.push({globalId:(0,u.yS)(),parentGlobalId:O,assetName:N.assetName,assetHash:N.parts[0].partHash,flags:[]}):L.A.getLogger(this).error(`Skipping asset ${N.assetName}. It does not have exactly one part, so we cannot map it to a feature.`)}return t}_createEditsResult(e){const t=e.data,{layerId:r}=this.layer,n=[];let o=null;if(Array.isArray(t))for(const O of t){var E,g,F;n.push({id:O.id,editedFeatures:O.editedFeatures}),O.id===r&&(o={addResults:null!==(E=O.addResults)&&void 0!==E?E:[],updateResults:null!==(g=O.updateResults)&&void 0!==g?g:[],deleteResults:null!==(F=O.deleteResults)&&void 0!==F?F:[],attachments:O.attachments,editMoment:O.editMoment})}else o=t;const h=function me(e){var t,r,n,o,E,g;const F=null==e?void 0:e.assetMaps;if(F){for(const M of F.addResults)M.success||L.A.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${M.globalId}.`);for(const M of F.updateResults)M.success||L.A.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${M.globalId}.`)}const h=null==e?void 0:e.attachments,O={addFeatureResults:null!==(t=null==e||null===(r=e.addResults)||void 0===r?void 0:r.map(X))&&void 0!==t?t:[],updateFeatureResults:null!==(n=null==e||null===(o=e.updateResults)||void 0===o?void 0:o.map(X))&&void 0!==n?n:[],deleteFeatureResults:null!==(E=null==e||null===(g=e.deleteResults)||void 0===g?void 0:g.map(X))&&void 0!==E?E:[],addAttachmentResults:null!=h&&h.addResults?h.addResults.map(X):[],updateAttachmentResults:null!=h&&h.updateResults?h.updateResults.map(X):[],deleteAttachmentResults:null!=h&&h.deleteResults?h.deleteResults.map(X):[]};return null!=e&&e.editMoment&&(O.editMoment=e.editMoment),O}(o);if(n.length>0){h.editedFeatureResults=[];for(const O of n){const{editedFeatures:M}=O,N=null!=M&&M.spatialReference?new b.A(M.spatialReference):null;h.editedFeatureResults.push({layerId:O.id,editedFeatures:Se(M,N)})}}return h}_createAttachmentErrorResult(e,t){var r;const n=(null===(r=t.details.messages)||void 0===r?void 0:r[0])||t.message;return{objectId:e,globalId:null,error:new K.A("feature-layer-source:attachment-failure",n,{code:t.details.httpStatus||t.details.messageCode})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const n in t){const o=t[n];null!=o&&(r.set?r.set(n,o):r.append(n,o))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:n}=this.layer;return{...e,query:{gdbVersion:r,layer:n?JSON.stringify({source:n}):void 0,...t.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}_filterRedundantAssetMaps(e){var t=this;return(0,v.A)(function*(){const{layer:r}=t,{globalIdField:n,infoFor3D:o,parsedUrl:E}=r;if(null==o||null==n)return e;const g=(0,s.JZ)(o);if(null==g)return e;const F=(0,m.fj)(E.path,`../${g.id}`),h=new Array,O=new Array;for(const V of e)V.geometry.metadata.getExternalSourcesOnService(E).length>0?O.push(V):h.push(V);const M=O.map(V=>V.getAttribute(n)).filter(H.Ru);if(0===M.length)return e;const{assetMapFieldRoles:{parentGlobalId:N,assetHash:ne}}=o,ue=new R.A;ue.where=`${N} IN (${M.map(V=>`'${V}'`)})`,ue.outFields=[ne,N],ue.returnGeometry=!1;const Ae=yield(0,i.s)(F,ue),{features:Me}=Ae;return 0===Me.length?e:[...h,...O.filter(V=>{const _e=V.getAttribute(n);if(!_e)return!0;const{metadata:he}=V.geometry,oe=Me.filter(de=>de.getAttribute(N)===_e);if(0===oe.length)return!0;const ge=oe.map(de=>de.getAttribute(ne));return he.getExternalSourcesOnService(E).flatMap(({source:de})=>de.flatMap(Ee=>Ee.parts.map(pe=>pe.partHash))).some(de=>ge.every(Ee=>de!==Ee))})]})()}};(0,Q._)([(0,y.MZ)()],I.prototype,"type",void 0),(0,Q._)([(0,y.MZ)({constructOnly:!0})],I.prototype,"layer",void 0),(0,Q._)([(0,y.MZ)({readOnly:!0})],I.prototype,"queryTask",null),I=(0,Q._)([(0,B.$)("esri.layers.graphics.sources.FeatureLayerSource")],I);const x=1e3,w=I},89962:(ve,G,a)=>{a.d(G,{F0:()=>C,Vx:()=>K,e2:()=>Z,f:()=>W});var v=a(3248),Q=a(77806),q=a(78200),f=a(48254);function C(D){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===D||"esriGeometryMultipoint"===D?f.Cb:"esriGeometryPolyline"===D?f.yM:f.WR}}}const z=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let H=1;function K(D,L){if((0,v.A)("esri-csp-restrictions"))return()=>({[L]:null,...D});try{let k=`this.${L} = null;`;for(const m in D)k+=`this${z.test(m)?`.${m}`:`["${m}"]`} = ${JSON.stringify(D[m])};`;const c=new Function(`\n      return class AttributesClass$${H++} {\n        constructor() {\n          ${k};\n        }\n      }\n    `)();return()=>new c}catch{return()=>({[L]:null,...D})}}function Z(D={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,Q.o8)(D)}}]}function W(D,L){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:D},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:L,supportsDelete:L,supportsEditing:L,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:L,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:q.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:L,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);