"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4585],{45901:(ae,ht,v)=>{v.d(ht,{vt:()=>$r,UD:()=>fn});var V=v(29430),rt=v(5922),W=v(77806),c=v(8189),p=v(85211),F=(v(3248),v(35150),v(40707),v(76576)),N=v(96115),lt=v(71065);let S=class extends lt.oY{constructor(){super(...arguments),this.raster=void 0}};(0,c._)([(0,p.MZ)({json:{write:!0}})],S.prototype,"raster",void 0),S=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.AspectFunctionArguments")],S);const G=S;var pt;let at=pt=class extends G{constructor(){super(...arguments),this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new pt({raster:this.raster,raster2:this.raster2,operation:this.operation})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],at.prototype,"operation",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],at.prototype,"raster2",void 0),(0,c._)([(0,p.MZ)({readOnly:!0})],at.prototype,"rasters",null),at=pt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ArithmeticFunctionArguments")],at);const Zt=at;var Ut=v(48669),h=v(66234),Gt=v(83179);const g=new Set(["slope","aspect","curvature","hillshade","shadedrelief","statistics"]);let M=class extends lt.oY{constructor(){super(...arguments),this.functionArguments=null,this.readingBufferSize=0,this.id=-1,this.isNoopProcess=!1,this.rawInputBandIds=[],this.rawSourceRasterInfos=null,this.isInputBandIdsSwizzled=!1,this.swizzledBandSelection=[],this.isBranch=!1,this._bindingResult=null}get supportsGPU(){return this._bindingResult.supportsGPU}get flatWebGLFunctionChain(){var e;const t=this.getWebGLProcessorDefinition();if(!t)return null;const n=[t],{parameters:s}=t;let o=s.rasters||s.raster&&[s.raster];for(;null!==(i=o)&&void 0!==i&&i.length;){var i;n.unshift(...o);const u=[];for(let d=0;d<o.length;d++){const{parameters:m}=o[d],f=m.rasters||m.raster&&[m.raster];null!=f&&f.length&&u.push(...f)}o=u}for(let u=n.length-1;u>=0;u--)n[u].isNoopProcess&&n.splice(u,1);let a=!1;for(let u=0;u<n.length;u++){const d=n[u];d.id=n.length-u-1;const{rasters:m}=d.parameters;a=a||null!=m&&m.length>1}const r=n.some(({name:u})=>g.has(u.toLowerCase())),{rawSourceRasterInfos:l}=this;return{functions:n,hasBranches:a,hasFocalFunction:r,isSourceSingleBand:1===(null==l||null===(e=l[0])||void 0===e?void 0:e.bandCount)}}bind(e,t=!1,n=-1){this.id=n+1;const s=this._getRasterValues();let o=!0;for(let i=0;i<s.length;i++){const a=s[i];if(null!=a&&this._isRasterFunctionValue(a)){const r=a.bind(e,t,this.id+i);if(!r.success)return this._bindingResult=r,r;o=o&&r.supportsGPU}}return!this.rasterInfo||t?(this.sourceRasterInfos=this._getSourceRasterInfos(e),this._bindingResult=this._bindSourceRasters(),this._bindingResult.success&&this._patchRasterInfo(),this._bindingResult.supportsGPU=o&&this._bindingResult.supportsGPU,this.processInputBandIds(),this._bindingResult):(this._bindingResult={success:!0,supportsGPU:!0},this.processInputBandIds(),this._bindingResult)}process(e){var t;const n=this._getRasterValues(),s=0===n.length?null!==(t=e.pixelBlocks)&&void 0!==t?t:e.primaryPixelBlocks:n.map(o=>this._readRasterValue(o,e));return this._processPixels({...e,pixelBlocks:s})}processInputBandIds(){const e=this._getRasterValues().filter(this._isRasterFunctionValue);let t;if(e.length>1){const o=e.map(a=>a.processInputBandIds()[0]);this.rawInputBandIds=o,this.isInputBandIdsSwizzled=this.rawInputBandIds.some((a,r)=>a!==r);const i=e.filter(a=>"ExtractBand"===a.functionName);return i.length&&i.forEach((a,r)=>{a.isInputBandIdsSwizzled=!0,a.swizzledBandSelection=[r,r,r]}),this.rawInputBandIds}const n=e[0];if(n){if(t=n.processInputBandIds(),n.isInputBandIdsSwizzled)return this.rawInputBandIds=t,t}else{t=[];const{bandCount:o}=this.sourceRasterInfos[0];for(let i=0;i<o;i++)t.push(i)}const s=this._getInputBandIds(t);return this.isInputBandIdsSwizzled=s.some((o,i)=>o!==i),this.rawInputBandIds=s,this.rawInputBandIds}getPrimaryRasters(){const e=[],t=[];return this._getPrimaryRasters(this,e,t),{rasters:e,rasterIds:t}}getWebGLProcessorDefinition(){const e=this._getWebGLParameters(),{raster:t,rasters:n}=this.functionArguments;return n&&Array.isArray(n)&&n.length?(e.rasters=n.map(s=>this._isRasterFunctionValue(s)?s.getWebGLProcessorDefinition():"number"==typeof s?{name:"Constant",parameters:{value:s},pixelType:"f32",id:-1,isNoopProcess:!1}:{name:"Identity",parameters:{value:s},pixelType:"f32",id:-1,isNoopProcess:!1}),e.rasters.some(s=>null!=s)||(e.rasters=null)):this._isRasterFunctionValue(t)&&(e.raster=t.getWebGLProcessorDefinition()),{name:this.functionName,parameters:e,pixelType:this.outputPixelType,id:this.id,isNoopProcess:this.isNoopProcess}}getClippingGeometries(){const e=[];"Clip"===this.functionName&&e.push(this.functionArguments);const{raster:t,rasters:n}=this.functionArguments;if(n&&Array.isArray(n)&&n.length)n.forEach(s=>{if(this._isRasterFunctionValue(s)){const o=s.getClippingGeometries();e.push(...o)}});else if(this._isRasterFunctionValue(t)){const s=t.getClippingGeometries();e.push(...s)}return e}_getOutputPixelType(e){var t;return"unknown"===this.outputPixelType?e:null!==(t=this.outputPixelType)&&void 0!==t?t:e}_getWebGLParameters(){return{}}_getInputBandIds(e){return e}_removeStatsHistColormapVAT(e){e.statistics=null,e.histograms=null,e.colormap=null,e.attributeTable=null}_getRasterValues(){var e;const{rasterArgumentNames:t}=this;return"rasters"===t[0]?null!==(e=this.functionArguments.rasters)&&void 0!==e?e:[]:t.flatMap(n=>this.functionArguments[n])}_getSourceRasterInfos(e){var t;const n=this._getRasterValues(),{rasterInfos:s,rasterIds:o}=e;if(0===n.length)return s;const i=n.map(r=>r&&"object"==typeof r&&"bind"in r&&r.rasterInfo?r.rasterInfo:"string"==typeof r&&o.includes(r)?s[o.indexOf(r)]:"number"!=typeof r?s[0]:void 0),a=null!==(t=i.find(r=>r))&&void 0!==t?t:s[0];return i.forEach((r,l)=>{void 0===r&&(i[l]=a)}),i}_getPrimaryRasterId(e){return null==e?void 0:e.rasterId}_getPrimaryRasters(e,t=[],n=[]){for(let s=0;s<e.sourceRasters.length;s++){const o=e.sourceRasters[s];if("number"!=typeof o)if("bind"in o)this._getPrimaryRasters(o,t,n);else{const i=o,a=this._getPrimaryRasterId(i);if(null==a)continue;n.includes(a)||(this.mainPrimaryRasterId===a?(t.unshift(i),n.unshift(a)):(t.push(i),n.push(a)))}}}_isRasterFunctionValue(e){return null!=e&&"object"==typeof e&&"getWebGLProcessorDefinition"in e}_readRasterValue(e,t){const{primaryPixelBlocks:n}=t;if(null==e||"$$"===e){const s=n[0];return null==s?null:s.clone()}if("string"==typeof e){const s=t.primaryRasterIds.indexOf(e);return-1===s?null:n[s]}if("number"==typeof e){const s=n[0];if(null==s)return null;const{width:o,height:i,pixelType:a}=s,r=new Float32Array(o*i);r.fill(e);const u=new Array(this.sourceRasterInfos[0].bandCount).fill(r);return new h.A({width:o,height:i,pixelType:a,pixels:u})}return e.process(t)}_patchRasterInfo(){const{rasterInfo:e}=this;if(null==e||!e.keyProperties)return;const{bandCount:t,keyProperties:n,statistics:s,histograms:o}=e,i=n.BandProperties;i&&i.length!==t&&(e.keyProperties={...n,BandProperties:void 0}),s&&s.length!==t&&(e.statistics=s.length>t?s.slice(0,t):null),o&&o.length!==t&&(e.histograms=o.length>t?o.slice(0,t):null),n.BAND_COUNT&&Number(n.BAND_COUNT)!==t&&(e.keyProperties={...n,BAND_COUNT:"string"==typeof n.BAND_COUNT?String(t):t})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],M.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],M.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],M.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}}),(0,Ut.w)(e=>null==e?void 0:e.toLowerCase())],M.prototype,"outputPixelType",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],M.prototype,"mainPrimaryRasterId",void 0),(0,c._)([(0,p.MZ)()],M.prototype,"sourceRasters",void 0),(0,c._)([(0,p.MZ)({type:[Gt.A],json:{write:!0}})],M.prototype,"sourceRasterInfos",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],M.prototype,"rasterInfo",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],M.prototype,"readingBufferSize",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],M.prototype,"id",void 0),(0,c._)([(0,p.MZ)()],M.prototype,"isNoopProcess",void 0),(0,c._)([(0,p.MZ)()],M.prototype,"supportsGPU",null),(0,c._)([(0,p.MZ)()],M.prototype,"rawInputBandIds",void 0),(0,c._)([(0,p.MZ)()],M.prototype,"rawSourceRasterInfos",void 0),(0,c._)([(0,p.MZ)()],M.prototype,"isInputBandIdsSwizzled",void 0),(0,c._)([(0,p.MZ)()],M.prototype,"swizzledBandSelection",void 0),(0,c._)([(0,p.MZ)()],M.prototype,"isBranch",void 0),(0,c._)([(0,p.MZ)({readOnly:!0})],M.prototype,"flatWebGLFunctionChain",null),(0,c._)([(0,p.MZ)()],M.prototype,"_bindingResult",void 0),M=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.BaseRasterFunction")],M);const T=M,B={userDefined:-1,lineDetectionHorizontal:0,lineDetectionVertical:1,lineDetectionLeftDiagonal:2,lineDetectionRightDiagonal:3,gradientNorth:4,gradientWest:5,gradientEast:6,gradientSouth:7,gradientNorthEast:8,gradientNorthWest:9,smoothArithmeticMean:10,smoothing3x3:11,smoothing5x5:12,sharpening3x3:13,sharpening5x5:14,laplacian3x3:15,laplacian5x5:16,sobelHorizontal:17,sobelVertical:18,sharpen:19,sharpen2:20,pointSpread:21,none:255},tt={bitwiseAnd:11,bitwiseLeftShift:12,bitwiseNot:13,bitwiseOr:14,bitwiseRightShift:15,bitwiseXOr:16,booleanAnd:17,booleanNot:18,booleanOr:19,booleanXOr:20,equalTo:24,greaterThan:28,greaterThanEqual:29,lessThan:33,lessThanEqual:34,isNull:31,notEqual:46},ut={acos:6,asin:7,atan:8,atanh:9,cos:21,cosh:22,sin:51,sinh:52,tan:56,tanh:57,acosh:59,asinh:60,atan2:61},Ge={setNull:50,conditional:78},Le={plus:1,minus:2,times:3,sqrt:4,power:5,abs:10,divide:23,exp:25,exp10:26,exp2:27,int:30,float:32,ln:35,log10:36,log2:37,mod:44,negate:45,roundDown:48,roundUp:49,square:53,floatDivide:64,floorDivide:65,...tt,...ut,majority:38,max:39,mean:40,med:41,min:42,minority:43,range:47,stddev:54,sum:55,variety:58,majorityIgnoreNoData:66,maxIgnoreNoData:67,meanIgnoreNoData:68,medIgnoreNoData:69,minIgnoreNoData:70,minorityIgnoreNoData:71,rangeIgnoreNoData:72,stddevIgnoreNoData:73,sumIgnoreNoData:74,varietyIgnoreNoData:75,...Ge},$e=new Map([[ut.acos,{domain:[0,Math.PI],isInteger:!1}],[ut.asin,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[ut.atan,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[ut.cos,{domain:[-1,1],isInteger:!1}],[ut.sin,{domain:[-1,1],isInteger:!1}],[tt.booleanAnd,{domain:[0,1],isInteger:!0}],[tt.booleanNot,{domain:[0,1],isInteger:!0}],[tt.booleanOr,{domain:[0,1],isInteger:!0}],[tt.booleanXOr,{domain:[0,1],isInteger:!0}],[tt.equalTo,{domain:[0,1],isInteger:!0}],[tt.notEqual,{domain:[0,1],isInteger:!0}],[tt.greaterThan,{domain:[0,1],isInteger:!0}],[tt.greaterThanEqual,{domain:[0,1],isInteger:!0}],[tt.lessThan,{domain:[0,1],isInteger:!0}],[tt.lessThanEqual,{domain:[0,1],isInteger:!0}],[tt.isNull,{domain:[0,1],isInteger:!0}]]);function ze(e){return $e.get(e)}const Ve=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function Fn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]+o[r]);return a}function Mn(e,t,n){const[s]=e,i=h.A.createEmptyBand("f32",s.length);return i.set(s),i}function Pn(e,t,n){const[s]=e,o=s.length,i=h.A.createEmptyBand(n,o);for(let a=0;a<o;a++)t&&!t[a]||(i[a]=s[a]*s[a]);return i}function Tn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]-o[r]);return a}function In(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]*o[r]);return a}function Bn(e,t,n){const[s]=e,o=s.length,i=h.A.createEmptyBand(n,o);for(let a=0;a<o;a++)t&&!t[a]||(i[a]=Math.sign(s[a])*Math.floor(Math.abs(s[a])));return i}function We(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]/o[r]);return a}function Rn(e,t,n){return We(e,t,"f32")}function Cn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=Math.floor(s[r]/o[r]));return a}function Nn(e,t,n,s){const o=e[0],i=o.length,a=h.A.createEmptyBand(n,i);if(s===ut.atanh){for(let l=0;l<i;l++)if(t[l]){const u=o[l];Math.abs(u)>=1?t[l]=0:a[l]=Math.atanh(u)}return a}const r=s===ut.asin?Math.asin:Math.acos;for(let l=0;l<i;l++)if(t[l]){const u=o[l];Math.abs(u)>1?t[l]=0:a[l]=r(u)}return a}function Dn(e,t,n,s){const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s(o[r]));return a}function Sn(e,t,n,s){const[o,i]=e,a=o.length,r=h.A.createEmptyBand(n,a);for(let l=0;l<a;l++)t&&!t[l]||(r[l]=s(o[l],i[l]));return r}function kn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]&o[r]);return a}function jn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]<<o[r]);return a}function En(e,t,n){const[s]=e,o=s.length,i=h.A.createEmptyBand(n,o);for(let a=0;a<o;a++)t&&!t[a]||(i[a]=~s[a]);return i}function On(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]|o[r]);return a}function Zn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]>>o[r]);return a}function Un(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]^o[r]);return a}function Gn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]&&o[r]?1:0);return a}function Ln(e,t,n){const[s]=e,o=s.length,i=h.A.createEmptyBand(n,o);for(let a=0;a<o;a++)t&&!t[a]||(i[a]=s[a]?0:1);return i}function $n(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]||o[r]?1:0);return a}function zn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=(s[r]?1:0)^(o[r]?1:0));return a}function Vn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]===o[r]?1:0);return a}function he(e,t,n,s){const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i),r=s===Math.E;for(let l=0;l<i;l++)t&&!t[l]||(a[l]=r?Math.exp(o[l]):s**o[l]);return a}function Wn(e,t,n){return he(e,t,n,10)}function Hn(e,t,n){return he(e,t,n,2)}function Kn(e,t,n){return he(e,t,n,Math.E)}function fe(e,t,n,s){const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(o[r]<=0?t[r]=0:a[r]=s(o[r]));return a}function Xn(e,t,n){return fe(e,t,n,Math.log10)}function Jn(e,t,n){return fe(e,t,n,Math.log2)}function Yn(e,t,n){return fe(e,t,n,Math.log)}function Qn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]>o[r]?1:0);return a}function qn(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]>=o[r]?1:0);return a}function ts(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]<o[r]?1:0);return a}function es(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]<=o[r]?1:0);return a}function ns(e,t,n){const[s]=e,o=s.length,i=h.A.createEmptyBand(n,o);if(!t)return i;for(let a=0;a<o;a++)i[a]=t[a]?0:1;return i}function ss(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]%o[r]);return a}function rs(e,t,n){const[s]=e,o=s.length,i=h.A.createEmptyBand(n,o);for(let a=0;a<o;a++)t&&!t[a]||(i[a]=-s[a]);return i}function os(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t&&!t[r]||(a[r]=s[r]===o[r]?0:1);return a}function is(e,t,n){const[s,o]=e,i=s.length,a=h.A.createEmptyBand(n,i),r=new Uint8Array(i);for(let l=0;l<i;l++)null!=t&&!t[l]||0!==s[l]||(a[l]=o[l],r[l]=255);return{band:a,mask:r}}function He(e,t,n){const[s,o,i]=e,a=s.length,r=h.A.createEmptyBand(n,a);for(let l=0;l<a;l++)t&&!t[l]||(r[l]=s[l]?o[l]:i[l]);return r}function Ke(e,t,n){const s=e.length;if(s<2)return e[0];const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)if(!t||t[r]){let l=o[r];for(let u=1;u<s;u++){const d=e[u][r];l<d&&(l=d)}a[r]=l}return a}function Xe(e,t,n){const s=e.length;if(s<2)return e[0];const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)if(!t||t[r]){let l=o[r];for(let u=1;u<s;u++){const d=e[u][r];l>d&&(l=d)}a[r]=l}return a}function Je(e,t,n){const s=e.length;if(s<2)return e[0];const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)if(!t||t[r]){let l=o[r],u=l;for(let d=1;d<s;d++){const m=e[d][r];u<m?u=m:l>m&&(l=m)}a[r]=u-l}return a}function Ye(e,t,n){const s=e.length;if(s<2)return e[0];const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)if(!t||t[r]){let l=0;for(let u=0;u<s;u++)l+=e[u][r];a[r]=l/s}return a}function Qe(e,t,n){const s=e.length;if(s<2)return e[0];const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)if(!t||t[r])for(let l=0;l<s;l++)a[r]+=e[l][r];return a}function qe(e,t,n){const s=e.length;if(s<2)return e[0];const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)if(!t||t[r]){const l=new Float32Array(s);let u=0;for(let m=0;m<s;m++){const f=e[m];u+=f[r],l[m]=f[r]}u/=s;let d=0;for(let m=0;m<s;m++)d+=(l[m]-u)**2;a[r]=Math.sqrt(d/s)}return a}function tn(e,t,n){const s=e.length;if(s<2)return e[0];const o=Math.floor(s/2),[i]=e,a=i.length,r=h.A.createEmptyBand(n,a),l=new Float32Array(s),u=s%2==1;for(let d=0;d<a;d++)if(!t||t[d]){for(let m=0;m<s;m++)l[m]=e[m][d];l.sort(),r[d]=u?l[o]:(l[o]+l[o-1])/2}return r}function en(e,t,n){const[s,o]=e;if(null==o)return s;const i=s.length,a=h.A.createEmptyBand(n,i);for(let r=0;r<i;r++)t[r]&&(s[r]===o[r]?a[r]=s[r]:t[r]=0);return a}function nn(e,t,n){const s=e.length;if(s<=2)return en(e,t,n);const o=e[0].length,i=h.A.createEmptyBand(n,o),a=new Map;for(let r=0;r<o;r++)if(!t||t[r]){let l;a.clear();for(let m=0;m<s;m++)l=e[m][r],a.set(l,a.has(l)?a.get(l)+1:1);let u=0,d=0;for(const m of a.keys())u=a.get(m),u>d&&(d=u,l=m);i[r]=l}return i}function sn(e,t,n){const s=e.length;if(s<=2)return en(e,t,n);const o=e[0].length,i=h.A.createEmptyBand(n,o),a=new Map;for(let r=0;r<o;r++)if(!t||t[r]){let l;a.clear();for(let m=0;m<s;m++)l=e[m][r],a.set(l,a.has(l)?a.get(l)+1:1);let u=0,d=e.length;for(const m of a.keys())u=a.get(m),u<d&&(d=u,l=m);i[r]=l}return i}function rn(e,t,n){const s=e.length;if(s<2)return e[0];const[o]=e,i=o.length,a=h.A.createEmptyBand(n,i),r=new Set;for(let l=0;l<i;l++)if(!t||t[l]){let u;r.clear();for(let d=0;d<s;d++)u=e[d][l],r.add(u);a[l]=r.size}return a}const J=new Map,ue=new Map,C=new Map,L=new Map;function ls(e,t,n,s){let[o,i]=(0,N.hP)(n);const a=(0,N.zw)(n);a&&(o-=1e-5,i+=1e-5);for(let r=0;r<t.length;r++)if(t[r]){const l=e[r];isNaN(l)||l<o||l>i?t[r]=0:s[r]=a?Math.round(l):l}}function on(e,t,n={}){!function as(){J.size||(J.set(4,Math.sqrt),J.set(6,Math.acos),J.set(7,Math.asin),J.set(8,Math.atan),J.set(9,Math.atanh),J.set(10,Math.abs),J.set(21,Math.cos),J.set(22,Math.cosh),J.set(48,Math.floor),J.set(49,Math.ceil),J.set(51,Math.sin),J.set(52,Math.sinh),J.set(56,Math.tan),J.set(57,Math.tanh),J.set(59,Math.acosh),J.set(60,Math.asinh),J.set(65,Math.floor),ue.set(5,Math.pow),ue.set(61,Math.atan2),C.set(1,Fn),C.set(2,Tn),C.set(3,In),C.set(11,kn),C.set(12,jn),C.set(13,En),C.set(14,On),C.set(15,Zn),C.set(16,Un),C.set(17,Gn),C.set(18,Ln),C.set(19,$n),C.set(20,zn),C.set(23,We),C.set(24,Vn),C.set(25,Kn),C.set(26,Wn),C.set(27,Hn),C.set(28,Qn),C.set(29,qn),C.set(30,Bn),C.set(31,ns),C.set(32,Mn),C.set(33,ts),C.set(34,es),C.set(35,Yn),C.set(36,Xn),C.set(37,Jn),C.set(44,ss),C.set(45,rs),C.set(46,os),C.set(53,Pn),C.set(64,Rn),C.set(65,Cn),C.set(76,He),C.set(78,He),L.set(38,nn),L.set(39,Ke),L.set(40,Ye),L.set(41,tn),L.set(42,Xe),L.set(43,sn),L.set(47,Je),L.set(54,qe),L.set(55,Qe),L.set(58,rn),L.set(66,nn),L.set(67,Ke),L.set(68,Ye),L.set(69,tn),L.set(70,Xe),L.set(71,sn),L.set(72,Je),L.set(73,qe),L.set(74,Qe),L.set(75,rn))}();let s=function bn(e,t=!1){const n=e.map(r=>r.mask),s=n.filter(r=>null!=r);if(0===s.length||t&&s.length!==n.length)return new Uint8Array(e[0].pixels[0].length).fill(255);const a=new Uint8Array(s[0]);if(1===s.length)return a;if(!t){for(let r=1;r<s.length;r++){const l=s[r];for(let u=0;u<a.length;u++)a[u]&&(a[u]=l[u]?255:0)}return a}for(let r=1;r<s.length;r++){const l=s[r];for(let u=0;u<a.length;u++)0===a[u]&&(a[u]=l[u]?255:0)}return a}(e,t>=66&&t<=75);const{outputPixelType:o="f32"}=n,i=!L.has(t)||n.processAsMultiband,a=i?e[0].pixels.length:1,r=[];for(let u=0;u<a;u++){const d=L.has(t)&&!i?e.flatMap(x=>x.pixels):e.map(x=>x.pixels[u]);let m,f=!0;if(t===Ge.setNull){const x=is(d,s,o);m=x.band,s=x.mask,f=!1}else C.has(t)?m=C.get(t)(d,s,"f64"):J.has(t)?m=t===ut.asin||t===ut.acos||t===ut.atanh?Nn(d,s,"f64",t):Dn(d,s,"f64",J.get(t)):ue.has(t)?m=Sn(d,s,"f64",ue.get(t)):L.has(t)?m=L.get(t)(d,s,"f64"):(m=d[0],f=!1);if(f&&t!==tt.isNull&&!$e.has(t)){const x=h.A.createEmptyBand(o,m.length);s||(s=new Uint8Array(m.length).fill(255)),ls(m,s,o,x),m=x}r.push(m)}const l=e[0];return new h.A({width:l.width,height:l.height,pixelType:o,mask:t===tt.isNull?null:s,pixels:r})}let $t=class extends T{constructor(){super(...arguments),this.functionName="Arithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster","raster2"]}_bindSourceRasters(){const{operation:e}=this.functionArguments;if(e<1||e>6)return{success:!1,supportsGPU:!1,error:"unsupported operation"};const t=this.sourceRasterInfos[0].clone();return this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,{success:!0,supportsGPU:t.bandCount<=3}}_processPixels(e){const{pixelBlocks:t}=e;return null==(null==t?void 0:t[0])||null==(null==t?void 0:t[1])?null:function us(e,t,n){var s;return on(e,t=null!==(s=[null,1,2,3,23,5,44][t])&&void 0!==s?s:1,{outputPixelType:n})}(t,this.functionArguments.operation,this.outputPixelType)}_getWebGLParameters(){var e;const{operation:t}=this.functionArguments,n=["","plus","minus","times","divide","power","mod"][t],s=null!==(e=this.outputPixelType)&&void 0!==e?e:"f32";let[o,i]=(0,N.hP)(s);const a=(0,N.zw)(s);return a&&(o-=1e-4,i+=1e-4),{imageCount:2,operationName:n,domainRange:[o,i],isOutputRounded:a}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],$t.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Zt,json:{write:!0,name:"rasterFunctionArguments"}})],$t.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],$t.prototype,"rasterArgumentNames",void 0),$t=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ArithmeticFunction")],$t);const cs=$t;var ge;let ye=ge=class extends G{clone(){return new ge({raster:this.raster})}};ye=ge=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.AspectFunctionArguments")],ye);const ps=ye;var zt=v(14870);let bt=class extends T{constructor(){super(...arguments),this.functionName="Aspect",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){var e,t;const n=this.sourceRasterInfos[0];this.isGCS=null!==(e=null===(t=n.spatialReference)||void 0===t?void 0:t.isGeographic)&&void 0!==e&&e,this.outputPixelType=this._getOutputPixelType("f32");const s=n.clone();return s.pixelType=this.outputPixelType,s.statistics=[{min:-1,max:360,avg:180,stddev:30}],s.histograms=null,s.colormap=null,s.attributeTable=null,s.bandCount=1,this.rasterInfo=s,{success:!0,supportsGPU:!0}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return null;const{extent:s,primaryPixelSizes:o}=e,i=null==o?void 0:o[0];return(0,zt.di)(n,{resolution:null!=i?i:s?{x:s.width/n.width,y:s.height/n.height}:{x:1,y:1}})}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],bt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:ps,json:{write:!0,name:"rasterFunctionArguments"}})],bt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],bt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],bt.prototype,"isGCS",void 0),bt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.AspectFunction")],bt);const ds=bt;var Vt=v(15463),Wt=v(49976);const ms=new Set(["+","-","*","/","(",")"]);function an(e,t){return e.toLowerCase().startsWith("b")?t[parseInt(e.slice(1),10)-1]:parseFloat(e)}function fs(e,t,n,s){if("number"==typeof n&&"number"==typeof s)return n+s;let o,i,a;"number"==typeof n?(a=s,o=a.length,i=new Float32Array(o),i.fill(n)):(o=n.length,i=n,s.constructor===Number?(a=new Float32Array(o),a.fill(s)):a=s);const r=new Float32Array(o);switch(t){case"+":for(let l=0;l<o;l++)(null==e||e[l])&&(r[l]=i[l]+a[l]);break;case"-":for(let l=0;l<o;l++)(null==e||e[l])&&(r[l]=i[l]-a[l]);break;case"*":for(let l=0;l<o;l++)(null==e||e[l])&&(r[l]=i[l]*a[l]);break;case"/":for(let l=0;l<o;l++)(null==e||e[l])&&a[l]&&(r[l]=i[l]/a[l]);break;case"(":case")":throw new Error("encountered error with custom band index equation")}return r}function gs(e,t){e.splice(t,1);let n=0,s=0;do{n=0,s=0;for(let o=0;o<e.length;o++)if("("===e[o])n=o;else if(")"===e[o]){s=o;break}s===n+1&&e.splice(n,2)}while(s===n+1);return e}function ys(e){if(1===e.length)return{opIndex:0,numIndex:0};let t=0,n=0;for(let a=0;a<e.length;a++)if("("===e[a])t=a;else if(")"===e[a]){n=a;break}const s=0===n?e:e.slice(t+1,n);let o=-1;for(let a=0;a<s.length;a++)if("*"===s[a]||"/"===s[a]){o=a;break}if(o>-1)n>0&&(o+=t+1);else{for(let a=0;a<s.length;a++)if("+"===s[a]||"-"===s[a]){o=a;break}n>0&&(o+=t+1)}let i=0;for(let a=0;a<o;a++)"("===e[a]&&i++;return{opIndex:o,numIndex:o-i}}var H=v(40275);const _s=new Wt.J({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function As(e,t){if(!(0,H.AB)(e))return e;const{equation:n,method:s}=t,o=t.bandIndexes.map(d=>d-1),{pixels:i,mask:a}=e;let r;switch(s){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":r=ln(a,i[o[0]],i[o[1]]);break;case"ndwi":r=ln(a,i[o[1]],i[o[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":r=function ws(e,t,n){const s=n.length,o=new Float32Array(s);for(let i=0;i<s;i++)if(null==e||e[i]){const r=n[i];r&&(o[i]=t[i]/r)}return[o]}(a,i[o[0]],i[o[1]]);break;case"ci-g":case"ci-re":r=function bs(e,t,n){const s=t.length,o=new Float32Array(s);for(let i=0;i<s;i++)if(null==e||e[i]){const r=n[i];r&&(o[i]=t[i]/r-1)}return[o]}(a,i[o[0]],i[o[1]]);break;case"savi":r=function Fs(e,t,n,s){const o=n.length,i=new Float32Array(o);for(let a=0;a<o;a++)if(null==e||e[a]){const r=n[a],l=t[a],u=l+r+s;u&&(i[a]=(l-r)/u*(1+s))}return[i]}(a,i[o[0]],i[o[1]],o[2]+1);break;case"tsavi":r=function Ms(e,t,n,s,o,i){const a=n.length,r=new Float32Array(a),l=-o*s+i*(1+s*s);for(let u=0;u<a;u++)if(null==e||e[u]){const d=n[u],m=t[u],f=o*m+d+l;f&&(r[u]=s*(m-s*d-o)/f)}return[r]}(a,i[o[0]],i[o[1]],o[2]+1,o[3]+1,o[4]+1);break;case"msavi":r=function Ps(e,t,n){const s=n.length,o=new Float32Array(s);for(let i=0;i<s;i++)if(null==e||e[i]){const r=t[i],l=2*r+1;o[i]=.5*(l-Math.sqrt(l*l-8*(r-n[i])))}return[o]}(a,i[o[0]],i[o[1]]);break;case"gemi":r=function Ts(e,t,n){const s=n.length,o=new Float32Array(s);for(let i=0;i<s;i++)if(null==e||e[i]){const a=n[i],r=t[i];if(1!==a&&r+a+.5!==0){const l=(2*(r*r-a*a)+1.5*r+.5*a)/(r+a+.5);o[i]=l*(1-.25*l)-(a-.125)/(1-a)}}return[o]}(a,i[o[0]],i[o[1]]);break;case"pvi":r=function Is(e,t,n,s,o){const i=n.length,a=new Float32Array(i),r=1/Math.sqrt(1+s*s);for(let l=0;l<i;l++)(null==e||e[l])&&(a[l]=(t[l]-s*n[l]-o)*r);return[a]}(a,i[o[0]],i[o[1]],o[2]+1,o[3]+1);break;case"gvitm":r=function Bs(e,t){const[n,s,o,i,a,r]=t,l=n.length,u=new Float32Array(l);for(let d=0;d<l;d++)(null==e||e[d])&&(u[d]=-.2848*n[d]-.2435*s[d]-.5436*o[d]+.7243*i[d]+.084*a[d]-.18*r[d]);return[u]}(a,[i[o[0]],i[o[1]],i[o[2]],i[o[3]],i[o[4]],i[o[5]]]);break;case"sultan":r=function Rs(e,t){const[n,s,o,i,a]=t,r=n.length,l=new Float32Array(r),u=new Float32Array(r),d=new Float32Array(r);for(let m=0;m<r;m++)(null==e||e[m])&&(l[m]=a[m]?i[m]/a[m]*100:0,u[m]=n[m]?i[m]/n[m]*100:0,d[m]=o[m]?s[m]/o[m]*(i[m]/o[m])*100:0);return[l,u,d]}(a,[i[o[0]],i[o[1]],i[o[2]],i[o[3]],i[o[4]]]);break;case"vari":r=function Cs(e,t){const[n,s,o]=t,i=n.length,a=new Float32Array(i);for(let r=0;r<i;r++)if(null==e||e[r])for(r=0;r<i;r++){const l=n[r],u=s[r],d=u+l-o[r];d&&(a[r]=(u-l)/d)}return[a]}(a,[i[o[0]],i[o[1]],i[o[2]]]);break;case"mtvi2":r=function Ns(e,t){const[n,s,o]=t,i=n.length,a=new Float32Array(i);for(let r=0;r<i;r++)if(null==e||e[r])for(r=0;r<i;r++){const l=n[r],u=s[r],d=o[r],m=Math.sqrt((2*l+1)**2-(6*l-5*Math.sqrt(u))-.5);m&&(a[r]=1.5*(1.2*(l-d)-2.5*(u-d))/m)}return[a]}(a,[i[o[0]],i[o[1]],i[o[2]]]);break;case"rtvi-core":r=function Ds(e,t){const[n,s,o]=t,i=n.length,a=new Float32Array(i);for(let r=0;r<i;r++)if(null==e||e[r])for(r=0;r<i;r++){const l=n[r];a[r]=100*(l-s[r])-10*(l-o[r])}return[a]}(a,[i[o[0]],i[o[1]],i[o[2]]]);break;case"evi":r=function Ss(e,t){const[n,s,o]=t,i=n.length,a=new Float32Array(i);for(let r=0;r<i;r++)if(null==e||e[r])for(r=0;r<i;r++){const l=n[r],u=s[r],d=l+6*u-7.5*o[r]+1;d&&(a[r]=2.5*(l-u)/d)}return[a]}(a,[i[o[0]],i[o[1]],i[o[2]]]);break;case"wndwi":r=function ks(e,t,n=.5){const[s,o,i]=t,a=o.length,r=new Float32Array(a);for(let l=0;l<a;l++)if(null==e||e[l])for(l=0;l<a;l++){const u=s[l],d=o[l],m=i[l],f=u+n*d+(1-n)*m;f&&(r[l]=(u-n*d-(1-n)*m)/f)}return[r]}(a,[i[o[0]],i[o[1]],i[o[2]]],o[3]?o[3]+1:.5);break;case"bai":r=function js(e,t,n){const s=n.length,o=new Float32Array(s);for(let i=0;i<s;i++)if(null==e||e[i])for(i=0;i<s;i++){const a=(.1-t[i])**2+(.06-n[i])**2;a&&(o[i]=1/a)}return[o]}(a,i[o[0]],i[o[1]]);break;case"custom":r=function vs(e,t,n){let s,{ops:o,nums:i}=function hs(e,t){(e=e.replaceAll(" ","")).startsWith("-")&&(e="0"+e),e.startsWith("+")&&(e=e.slice(1,e.length));const n=e.split(""),s=[],o=[];let i="";for(let a=0;a<n.length;a++){const r=n[a];ms.has(r)?(i.length&&o.push(an(i,t)),s.push(r),i=""):i=i.concat(r)}return i.length&&o.push(an(i,t)),{ops:s,nums:o}}(n,t);if(0===o.length){const a=1===i.length?i[0]:t[0];if(a instanceof Float32Array)return[a];const r=new Float32Array(t[0].length);return"number"==typeof a?r.fill(a):r.set(a),[r]}for(;o.length>0;){const{numIndex:a,opIndex:r}=ys(o);if(s=fs(e,o[r],i[a],i[a+1]),1===o.length)break;o=gs(o,r),i.splice(a,2,s)}return[s]}(a,i,n);break;default:return e}const l=null!=a?new Uint8Array(a.length):null;null!=a&&null!=l&&l.set(a);const u=new h.A({width:e.width,height:e.height,pixelType:"f32",pixels:r,mask:l});return u.updateStatistics(),u}function Q(e){const t=new Float32Array(9);return t[3*e[0]]=1,t[3*e[1]+1]=1,t[3*e[2]+2]=1,t}function ln(e,t,n){const s=n.length,o=new Float32Array(s);for(let i=0;i<s;i++)if(null==e||e[i]){const a=t[i],r=n[i],l=a+r;l&&(o[i]=(a-r)/l)}return[o]}var ve;let se=ve=class extends G{constructor(){super(...arguments),this.method="custom"}clone(){return new ve({method:this.method,bandIndexes:this.bandIndexes,raster:(0,W.o8)(this.raster)})}};(0,c._)([(0,p.MZ)({json:{type:String,write:!0}})],se.prototype,"bandIndexes",void 0),(0,c._)([(0,Vt.e)(_s)],se.prototype,"method",void 0),se=ve=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.BandArithmeticFunctionArguments")],se);const Es=se,Os=new Set(["vari","mtvi2","rtvi-core","evi"]);let Ht=class extends T{constructor(){super(...arguments),this.functionName="BandArithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const e=this.sourceRasterInfos[0];if(e.bandCount<2)return{success:!1,supportsGPU:!1,error:"band-arithmetic-function: source raster has insufficient amount of raster bands"};const t=e.clone();return t.pixelType=this.outputPixelType,t.bandCount="sultan"===this.functionArguments.method?3:1,this._removeStatsHistColormapVAT(t),t.keyProperties={...t.keyProperties,BandProperties:void 0},this.rasterInfo=t,{success:!0,supportsGPU:!["custom","gvitm","sultan"].includes(this.functionArguments.method)}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return n;const{method:s,bandIndexes:o}=this.functionArguments;return As(n,{method:s,bandIndexes:o.split(" ").map(a=>parseFloat(a)),equation:o})}_getWebGLParameters(){const e=this.functionArguments.bandIndexes.split(" ").map(a=>parseFloat(a)-1);2===e.length&&e.push(0);const t=this.isInputBandIdsSwizzled?[0,1,2]:e;let n,s;const o=new Float32Array(3),{method:i}=this.functionArguments;switch(i){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":n=Q([t[0],t[1],0]),s="ndxi";break;case"ndwi":n=Q([t[1],t[0],0]),s="ndxi";break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":n=Q([t[0],t[1],0]),s="sr";break;case"ci-g":case"ci-re":n=Q([t[0],t[1],0]),s="ci";break;case"savi":n=Q([t[0],t[1],0]),s="savi",o[0]=e[2]+1;break;case"tsavi":n=Q([t[0],t[1],0]),s="tsavi",o[0]=e[2]+1,o[1]=e[3]+1,o[2]=e[4]+1;break;case"msavi":n=Q([t[0],t[1],0]),s="msavi";break;case"gemi":n=Q([t[0],t[1],0]),s="gemi";break;case"pvi":n=Q([t[0],t[1],0]),s="tsavi",o[0]=e[2]+1,o[1]=e[3]+1;break;case"vari":n=Q([t[0],t[1],t[2]]),s="vari";break;case"mtvi2":n=Q([t[0],t[1],t[2]]),s="mtvi";break;case"rtvi-core":n=Q([t[0],t[1],t[2]]),s="rtvicore";break;case"evi":n=Q([t[0],t[1],t[2]]),s="evi";break;case"wndwi":n=Q([t[0],t[1],0]),s="wndwi",o[0]=e[3]?e[3]+1:.5;break;case"bai":n=Q([t[1],t[0],0]),s="bai";break;default:n=Q([0,1,2]),s="custom"}return{bandIndexMat3:n,indexType:s,adjustments:o}}_getInputBandIds(e){if("custom"===this.functionArguments.method)return e;const t=this.functionArguments.bandIndexes.split(" ").map(a=>parseFloat(a)-1),n=e.length,s=t.map(a=>a>=n?n-1:a),o=Os.has(this.functionArguments.method)?3:2,i=s.slice(0,o).map(a=>e[a]);return 2===i.length&&i.push(0),i}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Ht.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Es,json:{write:!0,name:"rasterFunctionArguments"}})],Ht.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Ht.prototype,"rasterArgumentNames",void 0),Ht=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.BandArithmeticFunction")],Ht);const Zs=Ht;var _e,Us=v(21152),Gs=v(61320);const un=new Wt.J({1:"outside",2:"inside"},{useNumericKeys:!0});let re=_e=class extends G{constructor(){super(...arguments),this.clippingType="outside"}clone(){return new _e({clippingGeometry:this.clippingGeometry.clone(),clippingType:this.clippingType})}};(0,c._)([(0,p.MZ)({types:Us.yR,json:{read:Gs.rS,write:!0}})],re.prototype,"clippingGeometry",void 0),(0,c._)([(0,p.MZ)({json:{read:un.read,write:un.write}})],re.prototype,"clippingType",void 0),re=_e=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ClipFunctionArguments")],re);const Ls=re;let Ft=class extends T{constructor(){super(...arguments),this.functionName="Clip",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const e=this.sourceRasterInfos[0].clone();return this.outputPixelType=this._getOutputPixelType(e.pixelType),e.pixelType=this.outputPixelType,this.rasterInfo=e,{success:!0,supportsGPU:!0}}_processPixels(e){var t;return null===(t=e.pixelBlocks)||void 0===t?void 0:t[0]}_getWebGLParameters(){const{clippingGeometry:e,clippingType:t}=this.functionArguments;return{clippingGeometry:e.toJSON(),clippingType:t}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Ft.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Ls,json:{write:!0,name:"rasterFunctionArguments"}})],Ft.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Ft.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)()],Ft.prototype,"isNoopProcess",void 0),Ft=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ClipFunction")],Ft);const $s=Ft;var Ae,ce=v(17221),ct=v(32681),cn=v(54485);let dt=Ae=class extends G{castColormapName(e){if(!e)return null;const t=e.toLowerCase();return ct.L7.includes(t)?t:null}readColorRamp(e){return(0,cn.r)(e)}readColorRampName(e,t){if(!e)return null;const n=ct.kH.jsonValues.find(s=>s.toLowerCase()===e.toLowerCase());return n?ct.kH.fromJSON(n):null}clone(){var e;return new Ae({colormap:(0,W.o8)(this.colormap),colormapName:this.colormapName,colorRamp:null===(e=this.colorRamp)||void 0===e?void 0:e.clone(),colorRampName:this.colorRampName})}};(0,c._)([(0,p.MZ)({type:[[Number]],json:{write:!0}})],dt.prototype,"colormap",void 0),(0,c._)([(0,p.MZ)({type:String,json:{write:!0}})],dt.prototype,"colormapName",void 0),(0,c._)([(0,Ut.w)("colormapName")],dt.prototype,"castColormapName",null),(0,c._)([(0,p.MZ)({types:cn.g,json:{write:!0}})],dt.prototype,"colorRamp",void 0),(0,c._)([(0,ce.w)("colorRamp")],dt.prototype,"readColorRamp",null),(0,c._)([(0,p.MZ)({type:ct.kH.apiValues,json:{type:ct.kH.jsonValues,write:ct.kH.write}})],dt.prototype,"colorRampName",void 0),(0,c._)([(0,ce.w)("colorRampName")],dt.prototype,"readColorRampName",null),dt=Ae=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ColormapFunctionArguments")],dt);const zs=dt,Vs=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[112,75,3],[113,76,3],[114,77,3],[115,77,3],[116,78,3],[117,79,3],[118,79,3],[119,80,3],[121,81,4],[122,82,4],[123,82,4],[124,83,4],[125,84,4],[126,84,4],[127,85,4],[128,86,4],[129,86,4],[130,87,4],[131,88,4],[132,89,4],[133,89,4],[134,90,4],[135,91,4],[136,91,4],[137,92,4],[138,93,4],[139,94,4],[140,94,4],[142,95,5],[143,96,5],[144,96,5],[145,97,5],[146,98,5],[147,99,5],[148,99,5],[149,100,5],[150,101,5],[151,101,5],[152,102,5],[153,103,5],[154,104,5],[155,104,5],[156,105,5],[157,106,5],[158,106,5],[159,107,5],[160,108,5],[161,108,5],[162,109,5],[164,110,6],[165,111,6],[166,111,6],[167,112,6],[168,113,6],[169,113,6],[170,114,6],[171,115,6],[172,116,6],[173,116,6],[174,117,6],[245,0,0],[245,5,0],[245,10,0],[246,15,0],[246,20,0],[246,25,0],[246,30,0],[247,35,0],[247,40,0],[247,45,0],[247,50,0],[247,55,0],[248,60,0],[248,65,0],[248,70,0],[248,75,0],[249,81,0],[249,86,0],[249,91,0],[249,96,0],[250,101,0],[250,106,0],[250,111,0],[250,116,0],[250,121,0],[251,126,0],[251,131,0],[251,136,0],[251,141,0],[252,146,0],[252,151,0],[252,156,0],[252,156,0],[251,159,0],[250,162,0],[249,165,0],[248,168,0],[247,171,0],[246,174,0],[245,177,0],[245,179,0],[244,182,0],[243,185,0],[242,188,0],[241,191,0],[240,194,0],[239,197,0],[238,200,0],[237,203,0],[236,206,0],[235,209,0],[234,212,0],[233,215,0],[232,218,0],[231,221,0],[230,224,0],[230,226,0],[229,229,0],[228,232,0],[227,235,0],[226,238,0],[225,241,0],[224,244,0],[223,247,0],[165,247,0],[163,244,0],[161,240,0],[158,237,0],[156,233,1],[154,230,1],[152,227,1],[149,223,1],[147,220,1],[145,216,1],[143,213,1],[140,210,2],[138,206,2],[136,203,2],[134,200,2],[132,196,2],[129,193,2],[127,189,2],[125,186,3],[123,183,3],[120,179,3],[118,176,3],[116,172,3],[114,169,3],[111,166,3],[109,162,4],[107,159,4],[105,155,4],[103,152,4],[100,149,4],[98,145,4],[96,142,4],[94,138,5],[91,135,5],[89,132,5],[87,128,5],[85,125,5],[82,121,5],[80,118,5],[78,115,6],[76,111,6],[73,108,6],[71,105,6],[69,101,6],[67,98,6],[65,94,6],[62,91,7],[60,88,7],[58,84,7],[56,81,7],[53,77,7],[51,74,7],[49,71,7],[47,67,8],[44,64,8],[42,60,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8]],Ws=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[245,20,0],[245,24,0],[245,29,0],[245,31,0],[247,33,0],[247,33,0],[247,37,0],[247,41,0],[247,41,0],[247,41,0],[247,45,0],[247,45,0],[247,47,0],[247,49,0],[247,49,0],[247,54,0],[247,54,0],[247,56,0],[247,58,0],[247,58,0],[250,62,0],[250,62,0],[250,62,0],[250,67,0],[250,67,0],[250,67,0],[250,69,0],[250,71,0],[250,71,0],[250,75,0],[250,75,0],[250,78,0],[250,79,0],[250,79,0],[250,79,0],[250,81,0],[250,83,0],[250,83,0],[250,87,0],[250,87,0],[250,90,0],[250,92,0],[252,93,0],[252,93,0],[252,97,0],[252,97,0],[252,97,0],[252,97,0],[252,101,0],[252,101,0],[252,101,0],[252,101,0],[252,105,0],[252,105,0],[252,107,0],[252,109,0],[252,109,0],[252,113,13],[255,118,20],[255,119,23],[255,121,25],[255,126,33],[255,132,38],[255,133,40],[255,135,43],[255,141,48],[255,144,54],[255,150,59],[255,152,61],[255,153,64],[255,159,69],[255,163,77],[255,165,79],[255,168,82],[255,174,87],[255,176,92],[255,181,97],[255,183,99],[255,186,102],[255,191,107],[255,197,115],[255,201,120],[255,203,123],[255,205,125],[255,209,130],[255,214,138],[255,216,141],[255,218,143],[255,224,150],[255,228,156],[255,234,163],[255,236,165],[255,238,168],[255,243,173],[255,248,181],[255,252,186],[253,252,186],[250,252,187],[244,250,180],[238,247,176],[234,246,173],[231,245,169],[223,240,163],[217,237,157],[211,235,150],[205,233,146],[200,230,142],[195,227,136],[189,224,132],[184,222,126],[180,220,123],[174,217,119],[169,214,114],[163,212,108],[160,210,105],[154,207,101],[148,204,96],[143,201,93],[138,199,88],[134,197,84],[130,194,81],[126,191,77],[117,189,70],[115,186,68],[112,184,64],[106,181,60],[100,179,55],[94,176,49],[92,174,47],[90,173,45],[81,168,37],[75,166,33],[71,163,28],[66,160,24],[62,158,21],[56,156,14],[51,153,0],[51,153,0],[51,153,0],[50,150,0],[50,150,0],[50,150,0],[50,150,0],[49,148,0],[49,148,0],[49,148,0],[48,145,0],[48,145,0],[48,145,0],[48,145,0],[48,143,0],[48,143,0],[48,143,0],[48,143,0],[47,140,0],[47,140,0],[47,140,0],[47,140,0],[46,138,0],[46,138,0],[46,138,0],[46,138,0],[45,135,0],[45,135,0],[45,135,0],[45,135,0],[44,133,0],[44,133,0],[44,133,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[42,128,0],[42,128,0],[42,128,0],[42,125,0],[42,125,0],[42,125,0],[42,125,0],[41,122,0],[41,122,0],[41,122,0],[41,122,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[39,117,0],[39,117,0],[39,117,0],[39,117,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0]];function xe(e,t){var n;const s=[],o=[];for(let a=0;a<e.length-1;a++)s.push({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:e[a].slice(1),toColor:e[a+1].slice(1)}),o.push(e[a+1][0]-e[a][0]);return(0,ct.iv)({type:"multipart",colorRamps:s},{numColors:e[e.length-1][0],weights:t=null!==(n=t)&&void 0!==n?n:o})}let vt=class extends T{constructor(){super(...arguments),this.functionName="Colormap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){var e,t;const n=this.sourceRasterInfos[0];if(n.bandCount>1)return{success:!1,supportsGPU:!1,error:"colormap-function: source data must be single band"};let{colormap:s,colormapName:o,colorRamp:i,colorRampName:a}=this.functionArguments;if(null===(e=s)||void 0===e||!e.length)if(i)s=(0,ct.R8)(i,{interpolateAlpha:!0});else if(a){const u=(0,ct.M5)(a);u&&(s=(0,ct.R8)(u))}else o&&(s=function Qs(e){let t;switch(e){case"elevation":t=function Hs(){return xe([[0,0,191,191],[51,0,0,255],[102,255,0,255],[153,255,0,127],[204,191,63,127],[256,20,20,20]])}();break;case"gray":t=function Xs(){return(0,ct.iv)({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:[0,0,0],toColor:[255,255,255]})}();break;case"hillshade":t=function Ys(){return xe([[0,38,41,54],[69,79,82,90],[131,156,156,156],[256,253,253,241]],[.268,.238,.495])}();break;case"ndvi":t=Vs;break;case"ndvi2":t=function Ks(){const e=xe([[0,255,255,255],[70,0,255,0],[80,205,173,193],[100,150,150,150],[110,120,51,100],[130,120,100,200],[140,28,3,144],[160,6,0,55],[180,10,25,30],[201,6,7,27]]);for(let t=e.length;t<256;t++)e.push([6,27,7]);return e}();break;case"ndvi3":t=Ws;break;case"random":t=function Js(){const e=[];for(let t=0;t<256;t++){const n=[];for(let s=0;s<3;s++)n.push(Math.round(255*Math.random()));e.push(n)}return e}()}return t?(t=t.map((n,s)=>[s,...n]),t):null}(o));if(null===(t=s)||void 0===t||!t.length)return{success:!1,supportsGPU:!1,error:"colormap-function: missing colormap argument"};const r=this._getOutputPixelType(n.pixelType);this.outputPixelType=r.startsWith("f")?"s32":r;const l=n.clone();return l.pixelType=this.outputPixelType,l.colormap=s,l.bandCount=1,this.rasterInfo=l,{success:!0,supportsGPU:!0}}_processPixels(e){var t;let n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];return!n||(0,N.zw)(n.pixelType)||(n=n.clone(),n.clamp(this.outputPixelType)),n}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],vt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:zs,json:{write:!0,name:"rasterFunctionArguments"}})],vt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],vt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)()],vt.prototype,"isNoopProcess",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],vt.prototype,"indexedColormap",void 0),vt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ColormapFunction")],vt);const qs=vt;var we,pe=v(50305);let oe=we=class extends G{constructor(){super(...arguments),this.rasters=[]}writeRasters(e,t){t.rasters=e.map(n=>"number"==typeof n||"string"==typeof n?n:n.toJSON())}clone(){return new we({rasters:(0,W.o8)(this.rasters)})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],oe.prototype,"rasters",void 0),(0,c._)([(0,pe.K)("rasters")],oe.prototype,"writeRasters",null),oe=we=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.CompositeBandFunctionArguments")],oe);const tr=oe;let Kt=class extends T{constructor(){super(...arguments),this.functionName="CompositeBand",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){const{sourceRasterInfos:e}=this,t=e[0];this.outputPixelType=this._getOutputPixelType(t.pixelType);const n=t.clone();if(n.attributeTable=null,n.colormap=null,n.pixelType=this.outputPixelType,n.bandCount=e.map(({bandCount:o})=>o).reduce((o,i)=>o+i),e.every(({statistics:o})=>null!=o&&o.length)){const o=[];e.forEach(({statistics:i})=>null!=i&&o.push(...i)),n.statistics=o}if(e.every(({histograms:o})=>null!=o&&o.length)){const o=[];e.forEach(({histograms:i})=>null!=i&&o.push(...i)),n.histograms=o}n.bandCount>1&&(n.colormap=null,n.attributeTable=null);const s=e.every(o=>{var i;return null===(i=o.keyProperties.BandProperties)||void 0===i?void 0:i.length})?e.flatMap(o=>o.keyProperties.BandProperties):void 0;return n.keyProperties={...n.keyProperties,BandProperties:s},this.rasterInfo=n,{success:!0,supportsGPU:n.bandCount<=3}}_processPixels(e){const{pixelBlocks:t}=e;return t?null==(null==t?void 0:t[0])?null:(0,H.Wy)(t):null}_getWebGLParameters(){return{bandCount:this.rasterInfo.bandCount}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Kt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:tr,json:{write:!0,name:"rasterFunctionArguments"}})],Kt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Kt.prototype,"rasterArgumentNames",void 0),Kt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.CompositeBandFunction")],Kt);const er=Kt;var be;let ie=be=class extends G{constructor(){super(...arguments),this.contrastOffset=0,this.brightnessOffset=0}clone(){return new be({contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset,raster:this.raster})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],ie.prototype,"contrastOffset",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],ie.prototype,"brightnessOffset",void 0),ie=be=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ContrastBrightnessFunctionArguments")],ie);const nr=ie;var Mt=v(48104);let Pt=class extends T{constructor(){super(...arguments),this.functionName="ContrastBrightness",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){const{sourceRasterInfos:e}=this,t=e[0];if("u8"!==t.pixelType)return{success:!1,supportsGPU:!1,error:"Only unsigned 8 bit raster is supported by ContrastBrightness function."};this.outputPixelType=this._getOutputPixelType("u8");const n=t.clone();this._removeStatsHistColormapVAT(n),this.rasterInfo=n;const{contrastOffset:s,brightnessOffset:o}=this.functionArguments;return this.lookup=(0,Mt.zj)(s,o),{success:!0,supportsGPU:!0}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];return null==n?null:(0,H.eH)(n,{lut:n.pixels.map(()=>this.lookup),offset:0,outputPixelType:"u8"})}_getWebGLParameters(){const{contrastOffset:e,brightnessOffset:t}=this.functionArguments;return{contrastOffset:e,brightnessOffset:t}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Pt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:nr,json:{write:!0,name:"rasterFunctionArguments"}})],Pt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Pt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],Pt.prototype,"lookup",void 0),Pt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ContrastBrightnessFunction")],Pt);const sr=Pt;function Fe(e,t,n,s,o){const i=Math.floor(s/2);for(let r=0;r<i;r++)for(let l=0;l<t;l++)e[r*t+l]=e[(o-1-r)*t+l],e[(n-1-r)*t+l]=e[(n-o+r)*t+l];const a=Math.floor(o/2);for(let r=0;r<n;r++){const l=r*t;for(let u=0;u<a;u++)e[l+u]=e[l+o-1-u],e[l+t-u-1]=e[l+t+u-o]}}const $=new Map;function pn(e,t,n,s,o,i,a){const r=new Float32Array(t*n),l=i.length,u=a?0:s,d=a?s:0,m=a?1:t;for(let f=u;f<n-u;f++){const x=f*t;for(let y=d;y<t-d;y++){if(o&&!o[x+y])continue;let A=0;for(let _=0;_<l;_++)A+=e[x+y+(_-s)*m]*i[_];r[x+y]=A}}return r}function or(e,t,n,s,o,i,a){const r=new Float32Array(t*n),l=Math.floor(s/2),u=Math.floor(o/2);for(let d=l;d<n-l;d++){const m=d*t;for(let f=u;f<t-u;f++){if(i&&!i[m+f])continue;let x=0;for(let y=0;y<s;y++)for(let A=0;A<o;A++)x+=e[m+f+(y-l)*t+A-u]*a[y*o+A];r[m+f]=x}}return r}var Me;$.set(B.none,[0,0,0,0,1,0,0,0,0]),$.set(B.lineDetectionHorizontal,[-1,-1,-1,2,2,2,-1,-1,-1]),$.set(B.lineDetectionVertical,[-1,2,-1,-1,2,-1,-1,2,-1]),$.set(B.lineDetectionLeftDiagonal,[2,-1,-1,-1,2,-1,-1,-1,2]),$.set(B.lineDetectionRightDiagonal,[-1,-1,2,-1,2,-1,2,-1,-1]),$.set(B.gradientNorth,[-1,-2,-1,0,0,0,1,2,1]),$.set(B.gradientWest,[-1,0,1,-2,0,2,-1,0,1]),$.set(B.gradientEast,[1,0,-1,2,0,-2,1,0,-1]),$.set(B.gradientSouth,[1,2,1,0,0,0,-1,-2,-1]),$.set(B.gradientNorthEast,[0,-1,-2,1,0,-1,2,1,0]),$.set(B.gradientNorthWest,[-2,-1,0,-1,0,1,0,1,2]),$.set(B.smoothArithmeticMean,[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111]),$.set(B.smoothing3x3,[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625]),$.set(B.smoothing5x5,[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1]),$.set(B.sharpening3x3,[-1,-1,-1,-1,9,-1,-1,-1,-1]),$.set(B.sharpening5x5,[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1]),$.set(B.laplacian3x3,[0,-1,0,-1,4,-1,0,-1,0]),$.set(B.laplacian5x5,[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0]),$.set(B.sobelHorizontal,[-1,-2,-1,0,0,0,1,2,1]),$.set(B.sobelVertical,[-1,0,1,-2,0,2,-1,0,1]),$.set(B.sharpen,[0,-.25,0,-.25,2,-.25,0,-.25,0]),$.set(B.sharpen2,[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25]),$.set(B.pointSpread,[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627]);let Tt=Me=class extends G{constructor(){super(...arguments),this.rows=3,this.cols=3,this.kernel=[0,0,0,0,1,0,0,0,0]}set convolutionType(e){this._set("convolutionType",e);const t=$.get(e);if(!t||e===B.userDefined||e===B.none)return;const n=Math.sqrt(t.length);this._set("kernel",t),this._set("cols",n),this._set("rows",n)}clone(){return new Me({cols:this.cols,rows:this.rows,kernel:[...this.kernel],convolutionType:this.convolutionType,raster:(0,W.o8)(this.raster)})}};(0,c._)([(0,p.MZ)({json:{type:Number,write:!0}})],Tt.prototype,"rows",void 0),(0,c._)([(0,p.MZ)({json:{type:Number,write:!0}})],Tt.prototype,"cols",void 0),(0,c._)([(0,p.MZ)({json:{name:"type",type:Number,write:!0}})],Tt.prototype,"convolutionType",null),(0,c._)([(0,p.MZ)({json:{type:[Number],write:!0}})],Tt.prototype,"kernel",void 0),Tt=Me=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ConvolutionFunctionArguments")],Tt);const ur=Tt;let It=class extends T{constructor(){super(...arguments),this.functionName="Convolution",this.rasterArgumentNames=["raster"]}get _normalizedKernel(){const{kernel:e,convolutionType:t}=this.functionArguments,n=e.reduce((s,o)=>s+o);return-1===t||0===n||1===n?e:e.map(s=>s/n)}_bindSourceRasters(){const{convolutionType:e,rows:t,cols:n,kernel:s}=this.functionArguments;if(!Object.values(B).includes(e))return{success:!1,supportsGPU:!1,error:`convolution-function: the specified kernel type is not supported ${e}`};if(e!==B.none&&t*n!==s.length)return{success:!1,supportsGPU:!1,error:"convolution-function: the specified rows and cols do not match the length of the kernel"};const o=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(o.pixelType);const i=o.clone();return i.pixelType=this.outputPixelType,(-1===e||"u8"!==this.outputPixelType&&![B.none,B.sharpen,B.sharpen2,B.sharpening3x3,B.sharpening5x5].includes(e))&&(i.statistics=null,i.histograms=null),i.colormap=null,i.attributeTable=null,this.rasterInfo=i,{success:!0,supportsGPU:s.length<=25}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n||this.functionArguments.convolutionType===B.none)return n;const{rows:s,cols:o}=this.functionArguments,{_normalizedKernel:i}=this;return function lr(e,t){const n=function rr(e){const t=Math.sqrt(e.length),n=e.slice(0,t),s=[1];for(let o=1;o<t;o++){let i=null;for(let a=0;a<t;a++){const r=e[a+o*t],l=e[a];if(null==i)if(0===l){if(r)return{separable:!1,row:null,col:null}}else i=r/l;else if(r/l!==i)return{separable:!1,row:null,col:null}}if(null==i)return{separable:!1,row:null,col:null};s.push(i)}return{separable:!0,row:n,col:s}}(t.kernel),s=!1!==t.mirrorEdges,o=n.separable?function ar(e,t,n,s=!0){const{pixels:o,width:i,height:a,pixelType:r,mask:l}=e,u=o.length,d=[],m=t.length,f=n.length,x=Math.floor(m/2),y=Math.floor(f/2);for(let A=0;A<u;A++){let _=pn(o[A],i,a,x,l,t,!0);_=pn(_,i,a,y,l,n,!1),s&&Fe(_,i,a,m,f),d.push(_)}return new h.A({width:i,height:a,pixelType:r,pixels:d,mask:l})}(e,n.row,n.col,s):function ir(e,t,n=!0){const{pixels:s,width:o,height:i,pixelType:a,mask:r}=e,l=s.length,u=[],{kernel:d,rows:m,cols:f}=t;for(let x=0;x<l;x++){const y=or(s[x],o,i,m,f,r,d);n&&Fe(y,o,i,m,f),u.push(y)}return new h.A({width:o,height:i,pixelType:a,pixels:u,mask:r})}(e,t,s),{outputPixelType:i}=t;return i&&o.clamp(i),o}(n,{kernel:i,rows:s,cols:o,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const e=new Float32Array(25);return e.set(this._normalizedKernel),{kernelRows:this.functionArguments.rows,kernelCols:this.functionArguments.cols,kernel:e,clampRange:(0,N.hP)(this.outputPixelType)}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],It.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:ur,json:{write:!0,name:"rasterFunctionArguments"}})],It.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],It.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)()],It.prototype,"_normalizedKernel",null),It=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ConvolutionFunction")],It);const cr=It;var Pe;const mn=new Wt.J({0:"standard",1:"platform",2:"profile"},{useNumericKeys:!0});let Xt=Pe=class extends G{constructor(){super(...arguments),this.curvatureType="standard",this.zFactor=1}readCurvatureType(e,t){var n,s;return mn.fromJSON(null!==(n=null!==(s=t.type)&&void 0!==s?s:t.curvatureType)&&void 0!==n?n:0)}clone(){return new Pe({curvatureType:this.curvatureType,zFactor:this.zFactor,raster:this.raster})}};(0,c._)([(0,p.MZ)({json:{write:{target:"type"}}}),(0,Vt.e)(mn)],Xt.prototype,"curvatureType",void 0),(0,c._)([(0,ce.w)("curvatureType",["type","curvatureType"])],Xt.prototype,"readCurvatureType",null),(0,c._)([(0,p.MZ)({type:Number,json:{write:!0}})],Xt.prototype,"zFactor",void 0),Xt=Pe=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.CurvatureFunctionArguments")],Xt);const pr=Xt;let Bt=class extends T{constructor(){super(...arguments),this.functionName="Curvature",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){var e,t;this.outputPixelType=this._getOutputPixelType("f32");const n=this.sourceRasterInfos[0].clone();return n.pixelType=this.outputPixelType,n.bandCount=1,this._removeStatsHistColormapVAT(n),this.rasterInfo=n,this.isGCS=null!==(e=null===(t=n.spatialReference)||void 0===t?void 0:t.isGeographic)&&void 0!==e&&e,{success:!0,supportsGPU:!0}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return null;const{zFactor:s,curvatureType:o}=this.functionArguments,{extent:i,primaryPixelSizes:a}=e,r=null==a?void 0:a[0];return(0,zt.E0)(n,{zFactor:this.isGCS&&s>=1?s*zt.rk:s,curvatureType:o,resolution:null!=r?r:i?{x:i.width/n.width,y:i.height/n.height}:{x:1,y:1}})}_getWebGLParameters(){const{zFactor:e,curvatureType:t}=this.functionArguments;return{curvatureType:t,zFactor:this.isGCS&&e>=1?e*zt.rk:e}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Bt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:pr,json:{write:!0,name:"rasterFunctionArguments"}})],Bt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Bt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],Bt.prototype,"isGCS",void 0),Bt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.CurvatureFunction")],Bt);const dr=Bt;var Te;let gt=Te=class extends G{constructor(){super(...arguments),this.bandIds=[],this.bandNames=[],this.bandWavelengths=[],this.missingBandAction=H.Wb.bestMatch}clone(){var e,t,n;return new Te({bandIds:null===(e=this.bandIds)||void 0===e?void 0:e.slice(),bandNames:null===(t=this.bandNames)||void 0===t?void 0:t.slice(),bandWavelengths:null===(n=this.bandWavelengths)||void 0===n?void 0:n.slice(),missingBandAction:this.missingBandAction,method:this.method,wavelengthMatchTolerance:this.wavelengthMatchTolerance})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],gt.prototype,"bandIds",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],gt.prototype,"bandNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],gt.prototype,"bandWavelengths",void 0),(0,c._)([(0,Vt.e)({0:"name",1:"wavelength",2:"id"})],gt.prototype,"method",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],gt.prototype,"missingBandAction",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],gt.prototype,"wavelengthMatchTolerance",void 0),gt=Te=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ExtractBandFunctionArguments")],gt);const mr=gt;let Jt=class extends T{constructor(){super(...arguments),this.functionName="ExtractBand",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){var e,t;const{functionArguments:n,sourceRasterInfos:s}=this,o=s[0],{method:i,bandNames:a,bandWavelengths:r,bandIds:l,missingBandAction:u}=n,d=(null==a?void 0:a.length)&&("name"===i||"id"!==i&&!(null!=l&&l.length)),m=(null==r?void 0:r.length)&&("wavelength"===i||"id"!==i&&!(null!=l&&l.length)),f=u===H.Wb.fail,x=d?this._matchBandNames(o,a):m?this._matchBandWavelengths(o,r,f):this._matchBandIds(o,l,f);if(null==x)return{success:!1,supportsGPU:!1,error:`extract-band-function: Invalid ${d?"band names":m?"band wavelengths":"band ids"} for the imagery data source`};this.functionArguments.bandIds=x,this.functionArguments.method="id",this.outputPixelType=this._getOutputPixelType("f32");const y=o.clone();y.pixelType=this.outputPixelType,y.bandCount=x.length;const{statistics:A,histograms:_}=y;null!=A&&A.length&&(y.statistics=x.map(w=>A[w]||A[A.length-1])),null!=_&&_.length&&(y.histograms=x.map(w=>_[w]||_[_.length-1]));let b=null===(e=y.keyProperties)||void 0===e?void 0:e.BandProperties;return null!==(t=b)&&void 0!==t&&t.length&&(b=x.map(w=>w>=b.length?b[b.length-1]:b[w]),y.keyProperties={...y.keyProperties,BandProperties:b}),this.rasterInfo=y,{success:!0,supportsGPU:y.bandCount<=3}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return null;const s=n.pixels.length,o=this.functionArguments.bandIds.map(i=>i>=s?s-1:i);return n.extractBands(o)}_getWebGLParameters(){let e;if(this.isInputBandIdsSwizzled)e=this.swizzledBandSelection.length?this.swizzledBandSelection:[0,1,2];else{var t,n;e=[...this.functionArguments.bandIds],0===e.length?e=[0,1,2]:e.length<3&&(e[1]=null!==(t=e[1])&&void 0!==t?t:e[0],e[2]=null!==(n=e[2])&&void 0!==n?n:e[1]);for(let s=0;s<3;s++)e[s]=Math.min(e[s],2)}return{bandIndexMat3:Q(e)}}_getInputBandIds(e){const t=e.length;return this.functionArguments.bandIds.map(n=>n>=t?t-1:n).map(n=>e[n])}_matchBandNames(e,t){const n=e.bandInfos.map(({name:o})=>o.toLowerCase()),s=[];for(let o=0;o<t.length;o++){const i=t[o].toLowerCase();let a=n.indexOf(i);if(-1===a&&"nearinfrared"===i&&(a=n.findIndex(r=>r.startsWith("nearinfrared_1")),-1===a&&(a=n.findIndex(r=>r.startsWith("nearinfrared")))),-1===a)return null;s.push(a)}return s}_matchBandIds(e,t,n){const{bandCount:s}=e;return null==t||!t.length||n&&t.some(o=>o<0||o>=s)?null:t}_matchBandWavelengths(e,t,n){const{bandInfos:s}=e,o=[];for(let r=0;r<s.length;r++){const{minWavelength:l,maxWavelength:u}=s[r];if(!l||!u)return null;o.push({minWavelength:l,maxWavelength:u})}const{wavelengthMatchTolerance:i}=this.functionArguments,a=[];for(let r=0;r<t.length;r++){const l=t[r];let u=!1,d=-1,m=Number.MAX_VALUE;for(let f=0;f<o.length;f++){const x=o[f],y=l>=x.minWavelength&&l<=x.maxWavelength,A=Math.abs(l-(x.minWavelength+x.maxWavelength)/2);y?A<m&&(u=!0,d=f,m=A):!u&&A<m&&(d=f,m=A)}if(!u&&i&&m<i&&(u=!0),!u&&n)return null;a.push(d)}return a}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Jt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:mr,json:{write:!0,name:"rasterFunctionArguments"}})],Jt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Jt.prototype,"rasterArgumentNames",void 0),Jt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.ExtractBandFunction")],Jt);const hr=Jt;var Ie;let de=Ie=class extends G{clone(){return new Ie({conversionParameters:[...this.conversionParameters],raster:this.raster})}};(0,c._)([(0,p.MZ)({type:[Number],json:{write:!0}})],de.prototype,"conversionParameters",void 0),de=Ie=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.GrayscaleFunctionArguments")],de);const gr=de;let Rt=class extends T{constructor(){super(...arguments),this.functionName="Grayscale",this.functionArguments=null,this.rasterArgumentNames=["raster"]}get _normalizedWeights(){const{conversionParameters:e}=this.functionArguments,t=e.reduce((n,s)=>n+s);return e.map(n=>n/t)}_bindSourceRasters(){const{conversionParameters:e}=this.functionArguments;if(null==e||!e.length)return{success:!1,supportsGPU:!1,error:"missing valid conversion parameters."};const t=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType;const n=3===e.length||3===t.bandCount&&e.length>3;return t.bandCount=1,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,{success:!0,supportsGPU:n}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];return null==n?null:function fr(e,t,n){const{pixels:s,width:o,height:i,mask:a,bandMasks:r}=e,l=o*i,u=null!=r&&r.length?h.A.combineBandMasks(r):a,d=Math.min(t.length,s.length),m=n.startsWith("f"),f=!m&&n!==e.pixelType,[x,y]=(0,N.hP)(n),A=h.A.createEmptyBand(n,l);for(let b=0;b<i;b++){let w=b*o;for(let k=0;k<o;k++,w++)if(!u||u[w]){let Z=0;for(let Y=0;Y<d;Y++)Z+=t[Y]*s[Y][w];m||(Z=Math.round(Z),f&&(Z=Z>y?y:Z<x?x:Z)),A[w]=Z}}const _=new h.A({width:o,height:i,pixels:[A],pixelType:n,mask:u});return _.updateStatistics(),_}(n,this._normalizedWeights,this.outputPixelType)}_getWebGLParameters(){return{weights:this._normalizedWeights}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Rt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:gr,json:{write:!0,name:"rasterFunctionArguments"}})],Rt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Rt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)()],Rt.prototype,"_normalizedWeights",null),Rt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.GrayscaleFunction")],Rt);const yr=Rt;var Be;let Ct=Be=class extends G{constructor(){super(...arguments),this.rasters=[],this.processAsMultiband=!0}writeRasters(e,t){t.rasters=e.map(n=>"number"==typeof n||"string"==typeof n?n:n.toJSON())}clone(){return new Be({operation:this.operation,processAsMultiband:this.processAsMultiband,rasters:(0,W.o8)(this.rasters)})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],Ct.prototype,"operation",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],Ct.prototype,"rasters",void 0),(0,c._)([(0,pe.K)("rasters")],Ct.prototype,"writeRasters",null),(0,c._)([(0,p.MZ)({json:{write:!0}})],Ct.prototype,"processAsMultiband",void 0),Ct=Be=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.LocalFunctionArguments")],Ct);const vr=Ct;let Yt=class extends T{constructor(){super(...arguments),this.functionName="Local",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){const{sourceRasterInfos:e}=this,t=e[0],{bandCount:n}=t,{processAsMultiband:s}=this.functionArguments;if(e.some(l=>l.bandCount!==n))return{success:!1,supportsGPU:!1,error:"local-function: input rasters do not have same band count"};const{operation:o,rasters:i}=this.functionArguments,a=Ve[o];if(!(999===a||i.length===a||i.length<=1&&1===a))return{success:!1,supportsGPU:!1,error:`local-function: the length of functionArguments.rasters does not match operation's requirement: ${a}`};const r=t.clone();return r.bandCount=999!==a||s?n:1,this._removeStatsHistColormapVAT(r),this._updateStatistics(r),this._updatePixelType(r),this.rasterInfo=r,{success:!0,supportsGPU:1===r.bandCount&&a<=3&&(o<11||o>16)}}_processPixels(e){var t;const{pixelBlocks:n}=e;return null==n||n.some(s=>null==s)?null:on(n,this.functionArguments.operation,{processAsMultiband:this.functionArguments.processAsMultiband,outputPixelType:null!==(t=this.outputPixelType)&&void 0!==t?t:void 0})}_getWebGLParameters(){var e,t,n;const{operation:s}=this.functionArguments,o=Ve[s],i=null!==(e=null===(t=Object.keys(Le).find(d=>Le[d]===s))||void 0===t?void 0:t.toLowerCase())&&void 0!==e?e:"undefined",a=null!==(n=this.outputPixelType)&&void 0!==n?n:"f32";let[r,l]=(0,N.hP)(a);const u=(0,N.zw)(a);return u&&(r-=1e-4,l+=1e-4),{imageCount:o,operationName:i,domainRange:[r,l],isOutputRounded:u}}_updateStatistics(e){var t,n;const s=this.sourceRasterInfos[0],{operation:o}=this.functionArguments,i=null===(t=ze(o))||void 0===t?void 0:t.domain;if(i){e.statistics=[];for(let a=0;a<e.bandCount;a++)e.statistics[a]={min:i[0],max:i[1],avg:(i[0]+i[1])/2,stddev:(i[0]+i[1])/10}}else 45===o&&null!==(n=s.statistics)&&void 0!==n&&n.length&&(e.statistics=s.statistics.map(a=>({min:-a.max,max:-a.min,avg:null!=a.avg?-a.avg:void 0,stddev:null!=a.stddev?-a.stddev:void 0})))}_updatePixelType(e){var t;const{statistics:n,pixelType:s}=this.sourceRasterInfos[0],{operation:o}=this.functionArguments,{domain:i,isInteger:a}=null!==(t=ze(o))&&void 0!==t?t:{domain:null,isInteger:!1};let r="f32";if(i&&a)r=(0,N.X1)(i[0],i[1]);else if(30===o){const l=null==n?void 0:n[0];r=l?(0,N.X1)(l.min,l.max):(0,N.zw)(s)?s:"s32"}else if(45===o&&(0,N.zw)(s)){const l=null==n?void 0:n.map(({max:f})=>-f),u=null==n?void 0:n.map(({min:f})=>-f),d=null!=l&&l.length?Math.min(...l):null,m=null!=u&&u.length?Math.min(...u):null;r=null!=d&&null!=m?(0,N.X1)(d,m):s.startsWith("s")?s.replace("s","u"):"u1"===s||"u2"===s||"u4"===s?"s8":"u8"===s?"s16":"s32"}e.pixelType=this.outputPixelType=this._getOutputPixelType(r)}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Yt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:vr,json:{write:!0,name:"rasterFunctionArguments"}})],Yt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Yt.prototype,"rasterArgumentNames",void 0),Yt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.LocalFunction")],Yt);const _r=Yt;var Re,Qt=v(69287);let Nt=Re=class extends G{constructor(){super(...arguments),this.includedRanges=null,this.noDataValues=null,this.noDataInterpretation=H.IB.matchAny}get normalizedNoDataValues(){const{noDataValues:e}=this;if(null==e||!e.length)return null;let t=!1;const n=e.map(s=>{if("number"==typeof s)return t=!0,[s];if("string"==typeof s){const o=s.trim().split(" ").filter(i=>""!==i.trim()).map(i=>Number(i));return t=t||o.length>0,0===o.length?null:o}return null});return t?n:null}clone(){var e,t,n,s;return new Re({includedRanges:null!==(e=null===(t=this.includedRanges)||void 0===t?void 0:t.slice())&&void 0!==e?e:[],noDataValues:null!==(n=null===(s=this.noDataValues)||void 0===s?void 0:s.slice())&&void 0!==n?n:[],noDataInterpretation:this.noDataInterpretation})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],Nt.prototype,"includedRanges",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],Nt.prototype,"noDataValues",void 0),(0,c._)([(0,p.MZ)()],Nt.prototype,"normalizedNoDataValues",null),(0,c._)([(0,p.MZ)({json:{write:!0}})],Nt.prototype,"noDataInterpretation",void 0),Nt=Re=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.MaskFunctionArguments")],Nt);const Ar=Nt;let Dt=class extends T{constructor(){super(...arguments),this.functionName="Mask",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;this.outputPixelType=this._getOutputPixelType(t),e.pixelType=this.outputPixelType,this.rasterInfo=e;const{includedRanges:n,normalizedNoDataValues:s}=this.functionArguments;if(!(null!=n&&n.length||null!=s&&s.length))return{success:!1,supportsGPU:!1,error:"missing includedRanges or noDataValues argument"};let o=[];for(let a=0;a<e.bandCount;a++){const r=(0,H.Wt)(t,null==n?void 0:n.slice(2*a,2*a+2),null==s?void 0:s[a]);if(null==r){o=null;break}o.push(r)}this.lookups=o;const i=null!=s&&s.every(a=>{var r;return(null==a?void 0:a.length)===(null===(r=s[0])||void 0===r?void 0:r.length)});return{success:!0,supportsGPU:(!n||n.length<=2*H.et)&&(!s||i&&s[0].length<=H.et)}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return null;const{outputPixelType:s,lookups:o}=this,{includedRanges:i,noDataInterpretation:a,normalizedNoDataValues:r}=this.functionArguments;return(0,H.dK)(n,{includedRanges:i,noDataValues:r,outputPixelType:s,matchAll:a===H.IB.matchAll,lookups:o})}_getWebGLParameters(){var e;const{includedRanges:t,normalizedNoDataValues:n}=this.functionArguments,s=new Float32Array(H.et);s.fill(Qt.pq),null!=n&&null!==(e=n[0])&&void 0!==e&&e.length&&s.set(n[0]);const o=new Float32Array(H.et);for(let r=0;r<o.length;r+=2){var i,a;o[r]=null!==(i=null==t?void 0:t[r])&&void 0!==i?i:-Qt.pq,o[r+1]=null!==(a=null==t?void 0:t[r+1])&&void 0!==a?a:Qt.pq}return t&&t.length&&o.set(t),{bandCount:this.sourceRasterInfos[0].bandCount,noDataValues:s,includedRanges:o}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Dt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Ar,json:{write:!0,name:"rasterFunctionArguments"}})],Dt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Dt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],Dt.prototype,"lookups",void 0),Dt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.MaskFunction")],Dt);const xr=Dt;var Ce;let qt=Ce=class extends G{constructor(){super(...arguments),this.visibleBandID=0,this.infraredBandID=1,this.scientificOutput=!1}clone(){const{visibleBandID:e,infraredBandID:t,scientificOutput:n}=this;return new Ce({visibleBandID:e,infraredBandID:t,scientificOutput:n})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],qt.prototype,"visibleBandID",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],qt.prototype,"infraredBandID",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],qt.prototype,"scientificOutput",void 0),qt=Ce=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.NDVIFunctionArguments")],qt);const wr=qt;let te=class extends T{constructor(){super(...arguments),this.functionName="NDVI",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{scientificOutput:e,visibleBandID:t,infraredBandID:n}=this.functionArguments;this.outputPixelType=this._getOutputPixelType(e?"f32":"u8");const s=this.sourceRasterInfos[0],o=Math.max(t,n);if(s.bandCount<2||o>=s.bandCount)return{success:!1,supportsGPU:!1,error:"ndvi-function: source raster has insufficient amount of raster bands"};const i=s.clone();i.pixelType=this.outputPixelType,i.colormap=null,i.histograms=null,i.bandCount=1,i.keyProperties={...i.keyProperties,BandProperties:void 0};const[a,r,l,u]=e?[-1,1,0,.1]:[0,200,100,10];return i.statistics=[{min:a,max:r,avg:l,stddev:u}],this.rasterInfo=i,{success:!0,supportsGPU:!0}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return null;const{visibleBandID:s,infraredBandID:o,scientificOutput:i}=this.functionArguments;return function xs(e,t,n,s){const{mask:o,pixels:i,width:a,height:r}=e,l=i[n],u=i[t],d=u.length,m=s?new Uint8Array(d):new Float32Array(d),f=s?100:1,x=s?100.5:0;for(let A=0;A<d;A++)if(null==o||o[A]){const _=l[A],b=u[A],w=_+b;w&&(m[A]=(_-b)/w*f+x)}const y=new h.A({width:a,height:r,mask:o,pixelType:s?"u8":"f32",pixels:[m]});return y.updateStatistics(),y}(n,s,o,!i)}_getWebGLParameters(){const{visibleBandID:e,infraredBandID:t,scientificOutput:n}=this.functionArguments;return{bandIndexMat3:Q(this.isInputBandIdsSwizzled?[0,1,2]:[t,e,0]),scaled:!n}}_getInputBandIds(e){const{visibleBandID:t,infraredBandID:n}=this.functionArguments;return[n,t,0].map(s=>e[s])}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],te.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:wr,json:{write:!0,name:"rasterFunctionArguments"}})],te.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],te.prototype,"rasterArgumentNames",void 0),te=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.NDVIFunction")],te);const br=te;var Ne;let _t=Ne=class extends G{constructor(){super(...arguments),this.inputRanges=null,this.outputValues=null,this.noDataRanges=null,this.allowUnmatched=!1,this.isLastInputRangeInclusive=!1}clone(){return new Ne({inputRanges:[...this.inputRanges],outputValues:[...this.outputValues],noDataRanges:[...this.noDataRanges],allowUnmatched:this.allowUnmatched,isLastInputRangeInclusive:this.isLastInputRangeInclusive})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],_t.prototype,"inputRanges",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],_t.prototype,"outputValues",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],_t.prototype,"noDataRanges",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],_t.prototype,"allowUnmatched",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],_t.prototype,"isLastInputRangeInclusive",void 0),_t=Ne=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.RemapFunctionArguments")],_t);const Fr=_t;let St=class extends T{constructor(){super(...arguments),this.functionName="Remap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){const e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;this.outputPixelType=this._getOutputPixelType(t),e.pixelType=this.outputPixelType,e.colormap=null,e.histograms=null,e.bandCount=1,e.attributeTable=null;const{statistics:n}=e,{allowUnmatched:s,outputValues:o,inputRanges:i,noDataRanges:a,isLastInputRangeInclusive:r}=this.functionArguments;if(null!=n&&n.length&&null!=o&&o.length)if(s){const l=Math.min.apply(null,[...o,n[0].min]),u=Math.max.apply(null,[...o,n[0].max]);e.statistics=[{...n[0],min:l,max:u}]}else{let l=o[0],u=l;for(let d=0;d<o.length;d++)l=l>o[d]?o[d]:l,u=u>o[d]?u:o[d];e.statistics=[{...n[0],min:l,max:u}]}return this.rasterInfo=e,this.lookup=s?null:(0,H.XU)({srcPixelType:t,inputRanges:i,outputValues:o,noDataRanges:a,allowUnmatched:s,isLastInputRangeInclusive:r,outputPixelType:this.outputPixelType}),{success:!0,supportsGPU:(!o||o.length<=H.et)&&(!a||a.length<=H.et)}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return null;const{lookup:s,outputPixelType:o}=this;if(s){const d=(0,H.eH)(n,{lut:[s.lut],offset:s.offset,outputPixelType:o});return null!=d&&s.mask&&(d.mask=(0,H.UK)(n.pixels[0],n.mask,s.mask,s.offset,"u8")),d}const{inputRanges:i,outputValues:a,noDataRanges:r,allowUnmatched:l,isLastInputRangeInclusive:u}=this.functionArguments;return(0,H.Ew)(n,{inputRanges:i,outputValues:a,noDataRanges:r,outputPixelType:o,allowUnmatched:l,isLastInputRangeInclusive:u})}_getWebGLParameters(){var e,t;const{allowUnmatched:n,noDataRanges:s,isLastInputRangeInclusive:o}=this.functionArguments,i=new Float32Array(3*H.et),a=1e-5,r=null!==(e=this.functionArguments.inputRanges)&&void 0!==e?e:[],l=null!==(t=this.functionArguments.outputValues)&&void 0!==t?t:[],u=l.length;for(let y=0;y<H.et;y++){var d,m,f;i[3*y]=null!==(d=r[2*y])&&void 0!==d?d:Qt.pq-1,i[3*y+1]=null!==(m=r[2*y+1])&&void 0!==m?m:Qt.pq,i[3*y+2]=null!==(f=l[y])&&void 0!==f?f:0,y<u&&(y>0&&(i[3*y]-=a),(y<u-1||!o)&&(i[3*y+1]-=a))}const x=new Float32Array(2*H.et);return x.fill(Qt.pq),null!=s&&s.length&&x.set(s),{allowUnmatched:n,rangeMaps:i,noDataRanges:x,clampRange:(0,N.hP)(this.outputPixelType)}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],St.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Fr,json:{write:!0,name:"rasterFunctionArguments"}})],St.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],St.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],St.prototype,"lookup",void 0),St=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.RemapFunction")],St);const Mr=St;var De;const Pr=new Wt.J({1:"degree",2:"percent-rise",3:"adjusted"},{useNumericKeys:!0});let At=De=class extends G{constructor(){super(...arguments),this.slopeType="degree",this.zFactor=1,this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.removeEdgeEffect=!1}clone(){return new De({slopeType:this.slopeType,zFactor:this.zFactor,pixelSizePower:this.pixelSizePower,pixelSizeFactor:this.pixelSizeFactor,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};(0,c._)([(0,Vt.e)(Pr)],At.prototype,"slopeType",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{write:!0}})],At.prototype,"zFactor",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{name:"psPower",write:!0}})],At.prototype,"pixelSizePower",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{name:"psZFactor",write:!0}})],At.prototype,"pixelSizeFactor",void 0),(0,c._)([(0,p.MZ)({type:Boolean,json:{write:!0}})],At.prototype,"removeEdgeEffect",void 0),At=De=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.SlopeFunctionArguments")],At);const Tr=At;let kt=class extends T{constructor(){super(...arguments),this.functionName="Slope",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){var e,t;this.outputPixelType=this._getOutputPixelType("f32");const n=this.sourceRasterInfos[0].clone();return n.pixelType=this.outputPixelType,n.statistics="percent-rise"!==this.functionArguments.slopeType?[{min:0,max:90,avg:1,stddev:1}]:null,n.histograms=null,n.colormap=null,n.attributeTable=null,n.bandCount=1,this.rasterInfo=n,this.isGCS=null!==(e=null===(t=n.spatialReference)||void 0===t?void 0:t.isGeographic)&&void 0!==e&&e,{success:!0,supportsGPU:!0}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return null;const{zFactor:s,slopeType:o,pixelSizePower:i,pixelSizeFactor:a}=this.functionArguments,{isGCS:r}=this,{extent:l,primaryPixelSizes:u}=e,d=null==u?void 0:u[0];return(0,zt.yy)(n,{zFactor:s,slopeType:o,pixelSizePower:i,pixelSizeFactor:a,isGCS:r,resolution:null!=d?d:l?{x:l.width/n.width,y:l.height/n.height}:{x:1,y:1}})}_getWebGLParameters(){const{zFactor:e,slopeType:t,pixelSizeFactor:n,pixelSizePower:s}=this.functionArguments;return{zFactor:this.isGCS&&e>=1?e*zt.rk:e,slopeType:t,pixelSizeFactor:null!=n?n:0,pixelSizePower:null!=s?s:0}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],kt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Tr,json:{write:!0,name:"rasterFunctionArguments"}})],kt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],kt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],kt.prototype,"isGCS",void 0),kt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.SlopeFunction")],kt);const Ir=kt,hn=new Wt.J({1:"min",2:"max",3:"mean",4:"stddev",5:"median",6:"majority",7:"minority"},{useNumericKeys:!0});function Br(e,t){const{fillNoDataOnly:n}=t,{band:s,width:o,height:i,mask:a,outBand:r}=e;if(n&&!a)return void r.set(s);const{statisticsType:l,kernelRows:u,kernelCols:d}=t,m="stddev"===l,f=o*i,x=new Float64Array(f),y=new Float64Array(f),A=new Uint32Array(f);for(let j=0;j<i;j++){const D=j*o;let E=0,z=0,O=0;for(let U=0;U<d;U++)a&&!a[D+U]||(E+=s[D+U],m&&(z+=s[D+U]**2),O++);x[D]=E,y[D]=z,A[D]=O;for(let U=1;U<=o-d;U++){const st=D+U-1,mt=st+d;a?(a[st]&&(O--,E-=s[st],m&&(z-=s[st]**2)),a[mt]&&(O++,E+=s[mt],m&&(z+=s[mt]**2))):(E-=s[st],E+=s[mt],m&&(z-=s[st]**2,z+=s[mt]**2)),x[D+U]=E,A[D+U]=O,m&&(y[D+U]=z)}}const _=new Float64Array(f),b=new Float64Array(f),w=new Uint32Array(f),k=u*o;for(let j=0;j<=o-d;j++){let D=0,E=0,z=0;for(let O=0;O<u;O++){const U=O*o+j;D+=x[U],z+=A[U],m&&(E+=y[U])}_[j]=D,b[j]=E,w[j]=z;for(let O=1;O<=i-u;O++){const U=(O-1)*o+j,st=U+k;D-=x[U],D+=x[st],z-=A[U],z+=A[st],m&&(E-=y[U],E+=y[st]),_[O*o+j]=D,b[O*o+j]=E,w[O*o+j]=z}}const Z=Math.floor(u/2),Y=Math.floor(d/2);for(let j=Z;j<i-Z;j++){const D=j*o;for(let E=Y;E<o-Y;E++){const z=(j-Z)*o+E-Y,O=w[z];if(0===O||n&&(!a||a[D+E]))continue;const U=_[z]/O,st=m?Math.sqrt((b[z]-_[z]*U)/O):U;r[D+E]=st,a&&(a[D+E]=255)}}}function Rr(e,t){const{fillNoDataOnly:n}=t,{band:s,width:o,height:i,mask:a,outBand:r}=e;if(n&&!a)return void r.set(s);const{kernelRows:l,kernelCols:u,statisticsType:d}=t,m=Math.floor(l/2),f=Math.floor(u/2),x="min"===d,y=r.slice(),A=new Uint32Array(o*i);for(let _=m;_<i-m;_++){const b=_*o;for(let w=f;w<o-f;w++){let k=x?Number.MAX_VALUE:-Number.MAX_VALUE,Z=0;for(let Y=0;Y<l;Y++)for(let j=0;j<u;j++){const D=b+w+(Y-m)*o+j-f;a&&!a[D]||(k=x?Math.min(k,s[D]):Math.max(k,s[D]),Z++)}a?(y[b+w]=0===Z?0:k,A[b+w]=Z):r[b+w]=0===Z?0:k}}if(a)for(let _=m;_<i-m;_++){const b=_*o;for(let w=f;w<o-f;w++)if(A[b+w]){if(n&&a[b+w])continue;r[b+w]=y[b+w],a[b+w]=255}}}function Cr(e,t){const{fillNoDataOnly:n}=t,{band:s,width:o,height:i,mask:a,outBand:r}=e;if(n&&!a)return void r.set(s);const{kernelRows:l,kernelCols:u}=t,d=Math.floor(l/2),m=Math.floor(u/2),f=r.slice(),x=new Uint32Array(o*i);for(let y=d;y<i-d;y++){const A=y*o;for(let _=m;_<o-m;_++){if(n&&a&&a[A+_])continue;const b=[];for(let w=0;w<l;w++)for(let k=0;k<u;k++){const Z=A+_+(w-d)*o+k-m;a&&!a[Z]||b.push(s[Z])}b.length&&(b.sort((w,k)=>w-k),a?(f[A+_]=b[Math.floor((b.length-1)/2)],x[A+_]=b.length):r[A+_]=b[Math.floor((b.length-1)/2)])}}if(a)for(let y=d;y<i-d;y++){const A=y*o;for(let _=m;_<o-m;_++)if(x[A+_]){if(n&&a[A+_])continue;r[A+_]=f[A+_],a[A+_]=255}}}function Nr(e,t){const{fillNoDataOnly:n}=t,{band:s,width:o,height:i,mask:a,outBand:r}=e;if(n&&!a)return void r.set(s);const{kernelRows:l,kernelCols:u}=t,d=Math.floor(l/2),m=Math.floor(u/2),f="majority"===t.statisticsType,x=l*u,y=r.slice(),A=new Uint32Array(o*i);for(let _=d;_<i-d;_++){const b=_*o;for(let w=m;w<o-m;w++){if(n&&a&&a[b+w])continue;const k=new Map;for(let D=0;D<l;D++)for(let E=0;E<u;E++){const z=b+w+(D-d)*o+E-m;if(a&&!a[z])continue;const O=s[z];k.set(O,k.has(O)?k.get(O)+1:1)}if(0===k.size)continue;let Z=0,Y=0,j=f?0:x+1;for(const D of k.keys())Y=k.get(D),f===Y>j&&(j=Y,Z=D);a?(y[b+w]=Z,A[b+w]=k.size):r[b+w]=Z}}if(a)for(let _=d;_<i-d;_++){const b=_*o;for(let w=m;w<o-m;w++)if(A[b+w]){if(n&&a[b+w])continue;r[b+w]=y[b+w],a[b+w]=255}}}var Se;let jt=Se=class extends G{constructor(){super(...arguments),this.rows=3,this.cols=3,this.fillNoDataOnly=!1,this.statisticsType="min"}clone(){return new Se({rows:this.rows,cols:this.cols,fillNoDataOnly:this.fillNoDataOnly,statisticsType:this.statisticsType,raster:(0,W.o8)(this.raster)})}};(0,c._)([(0,p.MZ)({json:{write:!0,read:{source:["kernelRows","rows"],reader:(e,t)=>{var n;return Number(null!==(n=null!=e?e:null==t?void 0:t.kernelRows)&&void 0!==n?n:3)}}}})],jt.prototype,"rows",void 0),(0,c._)([(0,p.MZ)({json:{write:!0,read:{source:["kernelCols","cols"],reader:(e,t)=>{var n;return Number(null!==(n=null!=e?e:null==t?void 0:t.kernelCols)&&void 0!==n?n:3)}}}})],jt.prototype,"cols",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],jt.prototype,"fillNoDataOnly",void 0),(0,c._)([(0,p.MZ)({json:{read:{source:["statisticsType","type"],reader:(e,t)=>{var n,s;return null!==(n=hn.fromJSON(null!==(s=null==t?void 0:t.statisticsType)&&void 0!==s?s:null==t?void 0:t.type))&&void 0!==n?n:"min"}},write:{target:"type"}}}),(0,Vt.e)(hn)],jt.prototype,"statisticsType",void 0),jt=Se=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.StatisticsFunctionArguments")],jt);const Sr=jt;let ee=class extends T{constructor(){super(...arguments),this.functionName="Statistics",this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{type:e}=this.functionArguments.toJSON();if(e<1||e>7)return{success:!1,supportsGPU:!1,error:`statistics-function: the given statistics type is not supported ${e}`};const t=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(t.pixelType);const n=t.clone();n.pixelType=this.outputPixelType;const{statisticsType:s}=this.functionArguments;return"stddev"===s&&this._removeStatsHistColormapVAT(n),this.rasterInfo=n,{success:!0,supportsGPU:n.bandCount<=3&&e<5}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return n;const{statisticsType:s,rows:o,cols:i,fillNoDataOnly:a}=this.functionArguments;return function Dr(e,t){var n,s;const{mask:o}=e,{fillNoDataOnly:i}=t;if(i&&!o)return e;const{pixels:a,width:r,height:l,bandMasks:u,pixelType:d}=e,m=a.length,f=r*l,x=[],{kernelRows:y,kernelCols:A,statisticsType:_,mirrorEdges:b}=t;if(i&&!o)return e;const w=null!==(n=t.outputPixelType)&&void 0!==n?n:d,k=[];for(let E=0;E<m;E++){var Z,Y;const z=a[E],O=h.A.createEmptyBand(w,f);i&&O.set(z);const U=null!==(Z=null==u?void 0:u[E])&&void 0!==Z?Z:o,st=null!==(Y=null==U?void 0:U.slice())&&void 0!==Y?Y:null,mt={band:z,width:r,height:l,mask:st,outBand:O};switch(_){case"min":case"max":Rr(mt,t);break;case"mean":case"stddev":Br(mt,t);break;case"median":Cr(mt,t);break;case"majority":case"minority":Nr(mt,t)}b&&!i&&Fe(O,r,l,y,A),x.push(O),st&&k.push(st)}let j=null!==(s=k[0])&&void 0!==s?s:o;k.length!==m&&(k.length=0),m>1&&null!=u&&u.length&&(j=h.A.combineBandMasks(u));const D=new h.A({pixelType:w,width:r,height:l,pixels:x,bandMasks:u&&k.length?k:null,mask:j});return D.updateStatistics(),D}(n,{kernelRows:o,kernelCols:i,fillNoDataOnly:a,outputPixelType:this.outputPixelType,statisticsType:s,mirrorEdges:!0})}_getWebGLParameters(){const{rows:e,cols:t,statisticsType:n,fillNoDataOnly:s}=this.functionArguments;return{fillNoDataOnly:s,kernelRows:e,kernelCols:t,statisticsType:n,clampRange:(0,N.hP)(this.outputPixelType)}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],ee.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Sr,json:{write:!0,name:"rasterFunctionArguments"}})],ee.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],ee.prototype,"rasterArgumentNames",void 0),ee=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.StatisticsFunction")],ee);const kr=ee;var ke;let Et=ke=class extends G{constructor(){super(...arguments),this.statistics=null,this.histograms=null}readStatistics(e,t){if(null==e||!e.length)return null;const n=[];return e.forEach(s=>{var o,i;const a={min:s.min,max:s.max,avg:null!==(o=s.avg)&&void 0!==o?o:s.mean,stddev:null!==(i=s.stddev)&&void 0!==i?i:s.standardDeviation};n.push(a)}),n}writeStatistics(e,t,n){if(null==e||!e.length)return;const s=[];e.forEach(o=>{const i={...o,mean:o.avg,standardDeviation:o.stddev};delete i.avg,delete i.stddev,s.push(i)}),t[n]=s}clone(){return new ke({statistics:(0,W.o8)(this.statistics),histograms:(0,W.o8)(this.histograms)})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],Et.prototype,"statistics",void 0),(0,c._)([(0,ce.w)("statistics")],Et.prototype,"readStatistics",null),(0,c._)([(0,pe.K)("statistics")],Et.prototype,"writeStatistics",null),(0,c._)([(0,p.MZ)({json:{write:!0}})],Et.prototype,"histograms",void 0),Et=ke=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.StatisticsHistogramFunctionArguments")],Et);const jr=Et;let xt=class extends T{constructor(){super(...arguments),this.functionName="StatisticsHistogram",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const e=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType("u8");const t=e.clone(),{statistics:n,histograms:s}=this.functionArguments;return s&&(t.histograms=s),n&&(t.statistics=n),this.rasterInfo=t,{success:!0,supportsGPU:!0}}_processPixels(e){var t;return null===(t=e.pixelBlocks)||void 0===t?void 0:t[0]}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],xt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:jr,json:{write:!0,name:"rasterFunctionArguments"}})],xt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],xt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],xt.prototype,"indexedColormap",void 0),(0,c._)([(0,p.MZ)()],xt.prototype,"isNoopProcess",void 0),xt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.StatisticsHistogramFunction")],xt);const Er=xt;var je;const Or=new Wt.J({0:"none",3:"standard-deviation",4:"histogram-equalization",5:"min-max",6:"percent-clip",9:"sigmoid"},{useNumericKeys:!0});let et=je=class extends G{constructor(){super(...arguments),this.computeGamma=!1,this.dynamicRangeAdjustment=!1,this.gamma=[],this.histograms=null,this.statistics=null,this.stretchType="none",this.useGamma=!1}writeStatistics(e,t,n){var s;null!==(s=e)&&void 0!==s&&s.length&&(Array.isArray(e[0])||(e=e.map(o=>[o.min,o.max,o.avg,o.stddev])),t[n]=e)}clone(){return new je({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:(0,W.o8)(this.statistics),gamma:(0,W.o8)(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,histograms:(0,W.o8)(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment,raster:this.raster})}};(0,c._)([(0,p.MZ)({type:Boolean,json:{write:!0}})],et.prototype,"computeGamma",void 0),(0,c._)([(0,p.MZ)({type:Boolean,json:{name:"dra",write:!0}})],et.prototype,"dynamicRangeAdjustment",void 0),(0,c._)([(0,p.MZ)({type:[Number],json:{write:!0}})],et.prototype,"gamma",void 0),(0,c._)([(0,p.MZ)()],et.prototype,"histograms",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{write:!0}})],et.prototype,"maxPercent",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{write:!0}})],et.prototype,"minPercent",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{write:!0}})],et.prototype,"numberOfStandardDeviations",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{name:"max",write:!0}})],et.prototype,"outputMax",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{name:"min",write:!0}})],et.prototype,"outputMin",void 0),(0,c._)([(0,p.MZ)({type:Number,json:{write:!0}})],et.prototype,"sigmoidStrengthLevel",void 0),(0,c._)([(0,p.MZ)({json:{type:[[Number]],write:!0}})],et.prototype,"statistics",void 0),(0,c._)([(0,pe.K)("statistics")],et.prototype,"writeStatistics",null),(0,c._)([(0,Vt.e)(Or)],et.prototype,"stretchType",void 0),(0,c._)([(0,p.MZ)({type:Boolean,json:{write:!0}})],et.prototype,"useGamma",void 0),et=je=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.StretchFunctionArguments")],et);const Zr=et;let wt=class extends T{constructor(){super(...arguments),this.functionName="Stretch",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null,this.cutOffs=null}_bindSourceRasters(){this.lookup=null,this.cutOffs=null;const e=this.sourceRasterInfos[0],{pixelType:t}=e,{functionArguments:n}=this,{dynamicRangeAdjustment:s,gamma:o,useGamma:i}=n;if(!s&&["u8","u16","s8","s16"].includes(t)){const r=(0,Mt.DP)(n.toJSON(),{rasterInfo:e}),l=(0,N.zw)(this.outputPixelType)?"round":"float";this.lookup=(0,Mt.RP)({pixelType:t,...r,gamma:i?o:null,rounding:l}),this.cutOffs=r}else s||(this.cutOffs=(0,Mt.DP)(n.toJSON(),{rasterInfo:e}));this.outputPixelType=this._getOutputPixelType(t);const a=e.clone();return a.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(a),"u8"===this.outputPixelType&&(a.keyProperties.DataType="processed"),this.rasterInfo=a,{success:!0,supportsGPU:!s}}_processPixels(e){var t;const n=null===(t=e.pixelBlocks)||void 0===t?void 0:t[0];if(null==n)return n;const{lookup:s}=this;if(s)return(0,H.eH)(n,{...s,outputPixelType:this.rasterInfo.pixelType});const{functionArguments:o}=this,i=this.cutOffs||(0,Mt.DP)(o.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:n});return(0,Mt._N)(n,{...i,gamma:o.useGamma?o.gamma:null,outputPixelType:this.outputPixelType})}_getWebGLParameters(){var e;const{outputMin:t=0,outputMax:n=255,gamma:s,useGamma:o}=this.functionArguments,i=this.rasterInfo.bandCount>=2?3:1,a=o&&null!=s&&s.length?(0,Mt.Nh)(i,s):[1,1,1],{minCutOff:r,maxCutOff:l}=null!==(e=this.cutOffs)&&void 0!==e?e:{minCutOff:[0,0,0],maxCutOff:[255,255,255]};1===r.length&&(r[1]=r[2]=r[0],l[1]=l[2]=l[0]);const u=new Float32Array(i);let d;for(d=0;d<i;d++)u[d]=(n-t)/(l[d]-r[d]);const m=(0,N.zw)(this.outputPixelType);return{bandCount:i,outMin:t,outMax:n,minCutOff:r,maxCutOff:l,factor:u,useGamma:o,gamma:o&&s?s:[1,1,1],gammaCorrection:o&&a?a:[1,1,1],stretchType:this.functionArguments.stretchType,isOutputRounded:m,type:"stretch"}}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],wt.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Zr,json:{write:!0,name:"rasterFunctionArguments"}})],wt.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],wt.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],wt.prototype,"lookup",void 0),(0,c._)([(0,p.MZ)({json:{write:!0}})],wt.prototype,"cutOffs",void 0),wt=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.StretchFunction")],wt);const Ur=wt;var Ee;let me=Ee=class extends G{constructor(){super(...arguments),this.attributeTableAsRecordSet=null}clone(){return new Ee({attributeTableAsRecordSet:(0,W.o8)(this.attributeTableAsRecordSet)})}};(0,c._)([(0,p.MZ)({json:{write:!0}})],me.prototype,"attributeTableAsRecordSet",void 0),me=Ee=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.TableFunctionArguments")],me);const Gr=me;let Ot=class extends T{constructor(){super(...arguments),this.functionName="Table",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const e=this.sourceRasterInfos[0];if(e.bandCount>1||e.pixelType.startsWith("f"))return{success:!1,supportsGPU:!1,error:"table-function: Source data must be single band and integer pixel type."};const{attributeTableAsRecordSet:t}=this.functionArguments;if(!t)return{success:!1,supportsGPU:!1,error:"table-function: Missing attributeTableAsRecordSet argument."};this.outputPixelType=this._getOutputPixelType(e.pixelType);const n=e.clone();return n.pixelType=this.outputPixelType,n.bandCount=1,"thematic"!==n.dataType&&(n.keyProperties=n.keyProperties?{...n.keyProperties,DataType:"thematic"}:{DataType:"thematic"}),this.rasterInfo=n,{success:!0,supportsGPU:!0}}_processPixels(e){var t;return null===(t=e.pixelBlocks)||void 0===t?void 0:t[0]}};(0,c._)([(0,p.MZ)({json:{write:!0,name:"rasterFunction"}})],Ot.prototype,"functionName",void 0),(0,c._)([(0,p.MZ)({type:Gr,json:{write:!0,name:"rasterFunctionArguments"}})],Ot.prototype,"functionArguments",void 0),(0,c._)([(0,p.MZ)()],Ot.prototype,"rasterArgumentNames",void 0),(0,c._)([(0,p.MZ)()],Ot.prototype,"isNoopProcess",void 0),Ot=(0,c._)([(0,F.$)("esri.layers.support.rasterFunctions.TableFunction")],Ot);const Lr=Ot,K=new Map;function fn(e,t){const{rasterFunctionArguments:n}=e;n&&(n.rasters||[n.raster]).forEach(s=>{s&&"number"!=typeof s&&("string"==typeof s?s.startsWith("http")&&(t.includes(s)||t.push(s)):"rasterFunctionArguments"in s&&fn(s,t))})}function $r(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:{},"function"in(e=(0,W.o8)(e))&&"arguments"in e&&e.arguments){const s=An(e,new Map,t);if(Ue(s),!s.renderingRule)throw new rt.A("raster-function-helper","Unsupported raster function json.");e=s.renderingRule}if("rasterFunction"in e)return yn(e=Oe(e),t);throw new rt.A("raster-function-helper","unsupported raster function json.")}function gn(e){return!!(e&&"object"==typeof e&&e.rasterFunction&&e.rasterFunctionArguments)}function Oe(e){var t;const{rasterFunction:n,rasterFunctionArguments:s}=e,o={};for(const i in s){let a=s[i];const r=i.toLowerCase();if("rasters"===r&&Array.isArray(a))o.rasters=a.map(l=>gn(l)?Oe(l):l);else switch(gn(a)&&(a=Oe(a)),r){case"dra":o.dra=a;break;case"pspower":o.psPower=a;break;case"pszfactor":o.psZFactor=a;break;case"bandids":o.bandIds=a;break;default:o[i[0].toLowerCase()+i.slice(1)]=a}}return"Local"!==n||null!==(t=o.rasters)&&void 0!==t&&t.length||(o.rasters=["$$"]),{...e,rasterFunctionArguments:o}}function yn(e,t){var n;const{rasterFunction:s,rasterFunctionArguments:o}=e,i=null===(n=e.outputPixelType)||void 0===n?void 0:n.toLowerCase();if(null==s||!K.has(s))throw new rt.A("raster-function-helper",`unsupported raster function: ${s}`);const a=K.get(s),r=("function"==typeof a.ctor?a.ctor:a.ctor.default).fromJSON({...e,outputPixelType:i}),{rasterArgumentNames:l}=r,u=[],d=function zr(e,t){return"rasters"===t[0]&&Array.isArray(e.rasters)?e.rasters:t.map(n=>e[n])}(o,l),m="rasters"===l[0],f=[];for(let A=0;A<d.length;A++){var x;const _=d[A];let b;null==_||"string"==typeof _&&_.startsWith("$")?u.push(null==t?void 0:t.raster):"string"==typeof _?t[_]&&u.push(t[_]):"number"!=typeof _&&"rasterFunction"in _&&(b=yn(_,t),m||(r.functionArguments[l[A]]=b),u.push(b)),m&&f.push(null!==(x=b)&&void 0!==x?x:_)}if(m&&(r.functionArguments.rasters=f),t){var y;r.sourceRasters=u;const A=null===(y=t.raster)||void 0===y?void 0:y.url;A&&(r.mainPrimaryRasterId=A)}return r}function vn(e,t){if(e&&t)for(const n in e){const s=e[n];s&&"object"==typeof s&&"type"in s&&("RasterFunctionTemplate"===s.type?vn(s.arguments,t):"RasterFunctionVariable"===s.type&&null!=t[s.name]&&(s.value=t[s.name]))}}function Ze(e,t){var n;if(!e||"object"!=typeof e)return e;const{value:s}=e;if(!s||"object"!=typeof s)return e.isDataset?"$$":s;if(Array.isArray(s))return 0===s.length?[]:s.map(i=>"object"==typeof i&&"RasterFunctionVariable"===i.type?Ze(i,t):i);if("value"in s&&["number","string","boolean"].includes(typeof s.value))return s.value;if(e.isDataset&&"Scalar"!==s.type)return"$$";if(!("type"in s))return s;let o=s;switch(s.type){case"Scalar":o=s.value;break;case"AlgorithmicColorRamp":o=_n(s);break;case"MultiPartColorRamp":o={type:"multipart",colorRamps:s.ArrayOfColorRamp.map(_n)};break;case"ArgumentArray":if(null!==(n=s.elements)&&void 0!==n&&n.length&&"RasterStatistics"!==s.elements[0].type){const i=[];for(let a=0;a<s.elements.length;a++){const r=s.elements[a],{type:l}=r;if(l)if("RasterFunctionTemplate"===l){const{renderingRule:u}=An(r,t);i.push(u),null!=r._object_id&&t.set(r._object_id,u)}else{if("RasterFunctionVariable"!==l)throw new rt.A("raster-function-helper","unsupported raster function json.");{const u=Ze(r,t);i.push(u),null!=r._object_id&&t.set(r._object_id,u)}}else i.push(r)}o=i}else o=s.elements}return null!=s._object_id&&t.set(s._object_id,o),o}function _n(e){var t;const n=null!==(t=e.algorithm)&&void 0!==t?t:"esriHSVAlgorithm";let{FromColor:s,ToColor:o}=e;if(!Array.isArray(s)){const{r:i,g:a,b:r}=(0,V.$)({h:s.Hue,s:s.Saturation,v:s.Value});s=[i,a,r,s.AlphaValue]}if(!Array.isArray(o)){const{r:i,g:a,b:r}=(0,V.$)({h:o.Hue,s:o.Saturation,v:o.Value});o=[i,a,r,o.AlphaValue]}return{type:"algorithmic",algorithm:n,fromColor:s,toColor:o}}function An(e,t,n){n&&vn(e,n);const s={renderingRule:{},templates:t};return xn(e,s),s}function xn(e,t){if(!e||!t.renderingRule)return;const{renderingRule:n,templates:s}=t,{function:o,arguments:i,_object_id:a}=e;if(!o||!i)return;null!=a&&s.set(a,n),n.rasterFunction=o.type.replace("Function",""),n.outputPixelType=o.pixelType;const r={};n.rasterFunctionArguments=r;for(const l in i){if("type"===l||"object_id"===l||"_object_ref_id"===l)continue;const u=i[l];u&&"object"==typeof u&&"type"in u&&("RasterFunctionTemplate"===u.type||"RasterFunctionVariable"===u.type)?("RasterFunctionVariable"===u.type?r[l]=Ze(u,s):(n.rasterFunctionArguments[l]={},xn(u,{renderingRule:n.rasterFunctionArguments[l],templates:s})),null!=u._object_id&&s.set(u._object_id,r[l])):r[l]=u}switch(r.DEM&&!r.Raster&&(r.Raster=r.DEM,delete r.DEM),n.rasterFunction){case"Stretch":!function Vr(e){var t;null!==(t=e.Statistics)&&void 0!==t&&t.length&&"object"==typeof e.Statistics&&(e.Statistics=e.Statistics.map(n=>[n.min,n.max,n.mean,n.standardDeviation])),null!=e.NumberOfStandardDeviation&&(e.NumberOfStandardDeviations=e.NumberOfStandardDeviation,delete e.NumberOfStandardDeviation)}(r);break;case"Colormap":!function Wr(e){var t;"randomcolorramp"===(null===(t=e.ColorRamp)||void 0===t||null===(t=t.type)||void 0===t?void 0:t.toLowerCase())&&(delete e.ColorRamp,e.ColormapName="Random"),0===e.ColorSchemeType&&delete e.ColorRamp}(r);break;case"Convolution":!function Hr(e){null!=e.ConvolutionType&&(e.Type=e.ConvolutionType,delete e.ConvolutionType)}(r);break;case"Mask":!function Kr(e){var t;null!==(t=e.NoDataValues)&&void 0!==t&&t.length&&"string"==typeof e.NoDataValues[0]&&(e.NoDataValues=e.NoDataValues.filter(n=>""!==n).map(n=>Number(n)))}(r)}}function Ue(e){const{renderingRule:t,templates:n}=e;if("object"!=typeof t||null==t||!t.rasterFunctionArguments||!n.size)return;const{rasterFunctionArguments:s}=t;for(const o in s){const i=s[o],a="_object_ref_id"===o?i:i&&"object"==typeof i&&"_object_ref_id"in i?i._object_ref_id:null;if(null==a)i&&"object"==typeof i&&(i.rasterFunctionArguments&&Ue({renderingRule:i,templates:n}),Array.isArray(i)&&i.forEach((r,l)=>{if("object"==typeof r)if(null!=r._object_ref_id){if(!n.has(r._object_ref_id))throw new rt.A("raster-function-helper",`unsupported raster function json. _object_ref_id: ${i} does not exist`);const u=n.get(a);u&&"object"==typeof u?Object.assign(r,u):i[l]=u}else Ue({renderingRule:r,templates:n})}));else{if(!n.has(a))throw new rt.A("raster-function-helper",`unsupported raster function json. _object_ref_id: ${a} does not exist`);const r=n.get(a);"_object_ref_id"!==o?s[o]=r:r&&"object"==typeof r&&Object.assign(s,r)}}}K.set("Arithmetic",{desc:"Arithmetic Function",ctor:cs,rasterArgumentNames:["rasters"]}),K.set("Aspect",{desc:"Aspect Function",ctor:ds,rasterArgumentNames:["raster"]}),K.set("BandArithmetic",{desc:"Band Arithmetic Function",ctor:Zs,rasterArgumentNames:["raster"]}),K.set("Colormap",{desc:"Colormap Function",ctor:qs,rasterArgumentNames:["raster"]}),K.set("CompositeBand",{desc:"CompositeBand Function",ctor:er,rasterArgumentNames:["rasters"]}),K.set("Convolution",{desc:"Convolution Function",ctor:cr,rasterArgumentNames:["raster"]}),K.set("ContrastBrightness",{desc:"Contrast Brightness Function",ctor:sr,rasterArgumentNames:["raster"]}),K.set("ExtractBand",{desc:"ExtractBand Function",ctor:hr,rasterArgumentNames:["raster"]}),K.set("Curvature",{desc:"Curvature Function",ctor:dr,rasterArgumentNames:["raster"]}),K.set("Grayscale",{desc:"Grayscale Function",ctor:yr,rasterArgumentNames:["raster"]}),K.set("Clip",{desc:"Clip Function",ctor:$s,rasterArgumentNames:["raster"]}),K.set("Local",{desc:"Local Function",ctor:_r,rasterArgumentNames:["rasters"]}),K.set("Mask",{desc:"Mask Function",ctor:xr,rasterArgumentNames:["raster"]}),K.set("NDVI",{desc:"NDVI Function",ctor:br,rasterArgumentNames:["raster"]}),K.set("Remap",{desc:"Remap Function",ctor:Mr,rasterArgumentNames:["raster"]}),K.set("Slope",{desc:"Slope Function",ctor:Ir,rasterArgumentNames:["raster"]}),K.set("Statistics",{desc:"Focal Statistics Function",ctor:kr,rasterArgumentNames:["raster"]}),K.set("StatisticsHistogram",{desc:"Statistics Histogram Function",ctor:Er,rasterArgumentNames:["raster"]}),K.set("Stretch",{desc:"Stretch Function",ctor:Ur,rasterArgumentNames:["raster"]}),K.set("Table",{desc:"Attribute Table Function",ctor:Lr,rasterArgumentNames:["raster"]})},55490:(ae,ht,v)=>{v.d(ht,{A:()=>F});var V=v(8189),rt=v(71065),W=v(85211),yt=(v(3248),v(35150),v(40707),v(76576));let ot=class extends rt.oY{get affectsPixelSize(){return!1}forwardTransform(N){return N}inverseTransform(N){return N}};(0,V._)([(0,W.MZ)()],ot.prototype,"affectsPixelSize",null),(0,V._)([(0,W.MZ)({json:{write:!0}})],ot.prototype,"spatialReference",void 0),ot=(0,V._)([(0,yt.$)("esri.layers.support.rasterTransforms.BaseRasterTransform")],ot);const F=ot},39181:(ae,ht,v)=>{v.d(ht,{A:()=>lt});var F,V=v(8189),rt=v(85211),ne=(v(3248),v(35150),v(40707),v(15463)),yt=v(76576),ot=v(55490);let N=F=class extends ot.A{constructor(){super(...arguments),this.type="gcs-shift",this.tolerance=1e-8}forwardTransform(S){return"point"===(S=S.clone()).type?(S.x>180+this.tolerance&&(S.x-=360),S):(S.xmin>=180-this.tolerance?(S.xmax-=360,S.xmin-=360):S.xmax>180+this.tolerance&&(S.xmin=-180,S.xmax=180),S)}inverseTransform(S){return"point"===(S=S.clone()).type?(S.x<-this.tolerance&&(S.x+=360),S):(S.xmin<-this.tolerance&&(S.xmin+=360,S.xmax+=360),S)}clone(){return new F({tolerance:this.tolerance})}};(0,V._)([(0,ne.e)({GCSShiftXform:"gcs-shift"})],N.prototype,"type",void 0),(0,V._)([(0,rt.MZ)()],N.prototype,"tolerance",void 0),N=F=(0,V._)([(0,yt.$)("esri.layers.support.rasterTransforms.GCSShiftTransform")],N);const lt=N},47168:(ae,ht,v)=>{v.d(ht,{A:()=>Gt});var pt,V=v(8189),W=(v(21152),v(85211)),yt=(v(3248),v(35150),v(40707),v(15463)),ot=v(17221),F=v(76576),N=v(50305),lt=v(55490),S=v(13303),G=v(28067);function at(g,M,T){const{x:P,y:I}=M;if(T<2)return{x:g[0]+P*g[2]+I*g[4],y:g[1]+P*g[3]+I*g[5]};if(2===T){const it=P*P,le=I*I,tt=P*I;return{x:g[0]+P*g[2]+I*g[4]+it*g[6]+tt*g[8]+le*g[10],y:g[1]+P*g[3]+I*g[5]+it*g[7]+tt*g[9]+le*g[11]}}const R=P*P,nt=I*I,ft=P*I,X=R*P,Lt=R*I,B=P*nt,q=I*nt;return{x:g[0]+P*g[2]+I*g[4]+R*g[6]+ft*g[8]+nt*g[10]+X*g[12]+Lt*g[14]+B*g[16]+q*g[18],y:g[1]+P*g[3]+I*g[5]+R*g[7]+ft*g[9]+nt*g[11]+X*g[13]+Lt*g[15]+B*g[17]+q*g[19]}}function Zt(g,M,T){const{xmin:P,ymin:I,xmax:R,ymax:nt,spatialReference:ft}=M;let X=[];if(T<2)X.push({x:P,y:nt}),X.push({x:R,y:nt}),X.push({x:P,y:I}),X.push({x:R,y:I});else{let q=10;for(let it=0;it<q;it++)X.push({x:P,y:I+(nt-I)*it/(q-1)}),X.push({x:R,y:I+(nt-I)*it/(q-1)});q=8;for(let it=1;it<=q;it++)X.push({x:P+(R-P)*it/q,y:I}),X.push({x:P+(R-P)*it/q,y:nt})}X=X.map(q=>at(g,q,T));const Lt=X.map(q=>q.x),B=X.map(q=>q.y);return new G.A({xmin:Math.min.apply(null,Lt),xmax:Math.max.apply(null,Lt),ymin:Math.min.apply(null,B),ymax:Math.max.apply(null,B),spatialReference:ft})}let h=pt=class extends lt.A{constructor(){super(...arguments),this.polynomialOrder=1,this.type="polynomial"}readForwardCoefficients(g,M){const{coeffX:T,coeffY:P}=M;if(null==T||!T.length||null==P||!P.length||T.length!==P.length)return null;const I=[];for(let R=0;R<T.length;R++)I.push(T[R]),I.push(P[R]);return I}writeForwardCoefficients(g,M,T){const P=[],I=[];for(let R=0;R<(null==g?void 0:g.length);R++)R%2==0?P.push(g[R]):I.push(g[R]);M.coeffX=P,M.coeffY=I}get inverseCoefficients(){let g=this._get("inverseCoefficients");const M=this._get("forwardCoefficients");return!g&&M&&this.polynomialOrder<2&&(g=function Ut(g){const[M,T,P,I,R,nt]=g,ft=P*nt-R*I,X=R*I-P*nt;return[(R*T-M*nt)/ft,(P*T-M*I)/X,nt/ft,I/X,-R/ft,-P/X]}(M)),g}set inverseCoefficients(g){this._set("inverseCoefficients",g)}readInverseCoefficients(g,M){const{inverseCoeffX:T,inverseCoeffY:P}=M;if(null==T||!T.length||null==P||!P.length||T.length!==P.length)return null;const I=[];for(let R=0;R<T.length;R++)I.push(T[R]),I.push(P[R]);return I}writeInverseCoefficients(g,M,T){const P=[],I=[];for(let R=0;R<(null==g?void 0:g.length);R++)R%2==0?P.push(g[R]):I.push(g[R]);M.inverseCoeffX=P,M.inverseCoeffY=I}get affectsPixelSize(){return this.polynomialOrder>0}forwardTransform(g){if("point"===g.type){const M=at(this.forwardCoefficients,g,this.polynomialOrder);return new S.A({x:M.x,y:M.y,spatialReference:g.spatialReference})}return Zt(this.forwardCoefficients,g,this.polynomialOrder)}inverseTransform(g){if("point"===g.type){const M=at(this.inverseCoefficients,g,this.polynomialOrder);return new S.A({x:M.x,y:M.y,spatialReference:g.spatialReference})}return Zt(this.inverseCoefficients,g,this.polynomialOrder)}clone(){return new pt({polynomialOrder:this.polynomialOrder,forwardCoefficients:this.forwardCoefficients?[...this.forwardCoefficients]:null,inverseCoefficients:this.inverseCoefficients?[...this.inverseCoefficients]:null})}};(0,V._)([(0,W.MZ)({json:{write:!0}})],h.prototype,"polynomialOrder",void 0),(0,V._)([(0,W.MZ)()],h.prototype,"forwardCoefficients",void 0),(0,V._)([(0,ot.w)("forwardCoefficients",["coeffX","coeffY"])],h.prototype,"readForwardCoefficients",null),(0,V._)([(0,N.K)("forwardCoefficients")],h.prototype,"writeForwardCoefficients",null),(0,V._)([(0,W.MZ)({json:{write:!0}})],h.prototype,"inverseCoefficients",null),(0,V._)([(0,ot.w)("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],h.prototype,"readInverseCoefficients",null),(0,V._)([(0,N.K)("inverseCoefficients")],h.prototype,"writeInverseCoefficients",null),(0,V._)([(0,W.MZ)()],h.prototype,"affectsPixelSize",null),(0,V._)([(0,yt.e)({PolynomialXform:"polynomial"})],h.prototype,"type",void 0),h=pt=(0,V._)([(0,F.$)("esri.layers.support.rasterTransforms.PolynomialTransform")],h);const Gt=h},30797:(ae,ht,v)=>{v.d(ht,{J:()=>Zt,l:()=>Ut});var N,V=v(39181),rt=v(8189),yt=(v(35150),v(3248),v(40707),v(5922),v(15463)),ot=v(76576),F=v(55490);let lt=N=class extends F.A{constructor(){super(...arguments),this.type="identity"}clone(){return new N}};(0,rt._)([(0,yt.e)({IdentityXform:"identity"})],lt.prototype,"type",void 0),lt=N=(0,rt._)([(0,ot.$)("esri.layers.support.rasterTransforms.IdentityTransform")],lt);const S=lt;var G=v(47168);const pt={GCSShiftXform:V.A,IdentityXform:S,PolynomialXform:G.A},at=Object.keys(pt);function Zt(h){return!h||at.includes(null==h?void 0:h.type)}function Ut(h){if(!(null==h?void 0:h.type))return null;const g=pt[null==h?void 0:h.type];if(g){const M=new g;return M.read(h),M}return null}}}]);