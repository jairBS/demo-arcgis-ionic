"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9867],{39867:(G,D,_)=>{_.r(D),_.d(D,{default:()=>S});var E=_(10467),r=_(8189),T=_(17715),A=_(35150),O=_(56492),M=_(85211),U=(_(3248),_(40707),_(76576)),C=_(58701),c=_(27641),g=(_(5922),_(3804),_(58272),_(29430),_(23098),_(69287),_(28067),_(9015),_(68643),_(21870),_(13303),_(55861),_(93615),_(41510),_(91766),_(47763),_(69630),_(71045),_(82854),_(65264),_(70614),_(88918),_(3691),_(25867),_(39516),_(57249),_(2544),_(34572),_(56854),_(47942),_(53737),_(3688),_(68051),_(65374),_(47669),_(88532),_(30365),_(91644),_(1684),_(86468),_(40702),_(63888),_(62931),_(42425),_(69473),_(82047),_(11242),_(77440),_(50915),_(79061),_(92517),_(68165),_(26136),_(83693),_(9599),_(74847)),L=(_(88258),_(97550),_(55900),_(52321),_(54e3),_(20904),_(6115),_(89563),_(45272),_(55912),_(64559),_(63367),_(38730),_(28291),_(41396),_(93093),_(14356),_(20047),_(67399),_(80745)),R=(_(89447),_(31178),_(76410),_(90949),_(92405),_(2296),_(12225),_(20914),_(32034),_(47258),_(21152),_(77469),_(18800),_(43431),_(96604)),d=_(29459),B=_(9468),o=_(86131),y=_(54290),j=_(67347),W=_(77031),K=_(41474),p=_(96081),v=_(47624),u=_(23868);const V=[0,0];let a=class extends((0,p.A)((0,R.Y)((0,d.e)(K.A)))){constructor(){super(...arguments),this._fetchQueue=null,this._highlightGraphics=new c.Y,this._highlightView=null,this._popupHighlightHelper=null,this._tileStrategy=null,this.layer=null}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(t){var s;this._fetchQueue.pause(),this._fetchQueue.state=t.state,this._tileStrategy.update(t),this._fetchQueue.resume(),null===(s=this._highlightView)||void 0===s||s.processUpdate(t)}attach(){const t="tileServers"in this.layer?this.layer.tileServers:null,s=this.tilemapCache;if(this._tileInfoView=new y.A(this.layer.tileInfo,this.layer.fullExtent,null==s?void 0:s.effectiveMinLOD,null==s?void 0:s.effectiveMaxLOD),this._fetchQueue=new j.A({tileInfoView:this._tileInfoView,concurrency:t&&10*t.length||10,process:(e,i)=>this.fetchTile(e,i)}),this._tileStrategy=new W.A({cachePolicy:"keep",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),(0,v.ox)(this,this.layer)){const e=this._highlightView=new L.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new B.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new v.Uh({createFetchPopupFeaturesQueryGeometry:(i,l)=>(0,u.V)(i,l,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(i,l)=>{e.graphicUpdateHandler({graphic:i,property:l})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate(),this.addAttachHandles(this._updatingHandles.add(()=>this.resampling,()=>{this.doRefresh()})),super.attach()}detach(){var t,s;super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),null!==(t=this._popupHighlightHelper)&&void 0!==t&&t.destroy(),null!==(s=this._highlightView)&&void 0!==s&&s.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}fetchPopupFeaturesAtLocation(t,s){var e=this;return(0,E.A)(function*(){return e._popupHighlightHelper?e._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,s):[]})()}highlight(t){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(t):(0,T.hA)()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){var s;return(0,C.aI)(null===(s=this.layer.tileInfo)||void 0===s?void 0:s.spatialReference,t)}doRefresh(){var t=this;return(0,E.A)(function*(){if(t.attached){if(t.suspended)return t._tileStrategy.clear(),void t.requestUpdate();t._fetchQueue.reset(),t._tileStrategy.refresh(s=>t._updatingHandles.addPromise(t._enqueueTileFetch(s)))}})()}acquireTile(t){const s=this._bitmapView.createTile(t),e=s.bitmap;return[e.x,e.y]=this._tileInfoView.getTileCoords(V,s.key),e.resolution=this._tileInfoView.getTileResolution(s.key),[e.width,e.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(s)),this._bitmapView.addChild(s),this.requestUpdate(),s}releaseTile(t){this._fetchQueue.abort(t.key.id),this._bitmapView.removeChild(t),t.once("detach",()=>t.destroy()),this.requestUpdate()}fetchTile(t,s={}){var e=this;return(0,E.A)(function*(){const i=e.tilemapCache,{signal:l,resamplingLevel:f=0}=s;if(!i)try{return yield e._fetchImage(t,l)}catch(n){if(!(0,O.zf)(n)&&!e.resampling)return(0,o.G)(e._tileInfoView.tileInfo.size);if(f<3){const I=e._tileInfoView.getTileParentId(t.id);if(I){const m=new g.A(I),H=yield e.fetchTile(m,{...s,resamplingLevel:f+1});return(0,o.t)(e._tileInfoView,H,m,t)}}throw n}const h=new g.A(0,0,0,0);let P;try{if(yield i.fetchAvailabilityUpsample(t.level,t.row,t.col,h,{signal:l}),h.level!==t.level&&!e.resampling)return(0,o.G)(e._tileInfoView.tileInfo.size);P=yield e._fetchImage(h,l)}catch(n){if((0,O.zf)(n))throw n;P=yield e._fetchImage(t,l)}return e.resampling?(0,o.t)(e._tileInfoView,P,h,t):P})()}_enqueueTileFetch(t){var s=this;return(0,E.A)(function*(){if(!s._fetchQueue.has(t.key.id)){try{const e=yield s._fetchQueue.push(t.key);t.bitmap.source=e,t.bitmap.width=s._tileInfoView.tileInfo.size[0],t.bitmap.height=s._tileInfoView.tileInfo.size[1],t.once("attach",()=>s.requestUpdate())}catch(e){(0,O.zf)(e)||A.A.getLogger(s).error(e)}s.requestUpdate()}})()}_fetchImage(t,s){var e=this;return(0,E.A)(function*(){return e.layer.fetchImageBitmapTile(t.level,t.row,t.col,{signal:s})})()}};(0,r._)([(0,M.MZ)()],a.prototype,"resampling",null),(0,r._)([(0,M.MZ)()],a.prototype,"tilemapCache",null),a=(0,r._)([(0,U.$)("esri.views.2d.layers.TileLayerView2D")],a);const S=a}}]);