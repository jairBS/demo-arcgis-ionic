"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[114],{33087:(Le,fe,y)=>{y.d(fe,{q:()=>J});var T=y(60611);class J{constructor(q,D){this._storage=new T.F,this.id="",this.name="",this.size=0,this._storage.maxSize=q,this._storage.register(this),D&&this._storage.registerRemoveFunc("",D)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(q,D,k=1){this._storage.put(this,q,D,k,1)}pop(q){return this._storage.pop(this,q)}get(q){return this._storage.get(this,q)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(q){this._storage.maxSize=q}resetHitRate(){}}},60611:(Le,fe,y)=>{y.d(fe,{F:()=>k,Mn:()=>D});var q,W,T=y(12438);(W=q||(q={}))[W.ALL=0]="ALL",W[W.SOME=1]="SOME";class D{constructor(_,g,v){this.name=_,this._storage=g,this.id=_e+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),v&&(this._storage.registerRemoveFunc(this.id,v),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(_){return this._storage.getSize(this,_)}resetHitRate(){this._hit=this._miss=0}put(_,g,v,S=0){this._storage.put(this,_,g,v,S)}pop(_){const g=this._storage.pop(this,_);return void 0===g?++this._miss:++this._hit,g}get(_){const g=this._storage.get(this,_);return void 0===g?++this._miss:++this._hit,g}peek(_){return this._storage.peek(this,_)}updateSize(_,g,v){this._storage.updateSize(this,_,g,v)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class k{get size(){return this._size}constructor(_=10485760){this._maxSize=_,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new T.A,this._users=new T.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(_){this._users.push(_)}deregister(_){this._users.removeUnordered(_)}registerRemoveFunc(_,g){this._removeFuncs.push([_,g])}deregisterRemoveFunc(_){this._removeFuncs.filterInPlace(g=>g[0]!==_)}get maxSize(){return this._maxSize}set maxSize(_){this._maxSize=Math.max(_,-1),this._checkSize()}getSize(_,g){var v;const S=this._db.get(_.id+g);return null!==(v=null==S?void 0:S.size)&&void 0!==v?v:0}put(_,g,v,S,j){const F=this._db.get(g=_.id+g);if(F&&(this._size-=F.size,_.size-=F.size,this._db.delete(g),F.entry!==v&&this._notifyRemove(g,F.entry,F.size,q.ALL)),S>this._maxSize)return void this._notifyRemove(g,v,S,q.ALL);if(void 0===v)return void console.warn("Refusing to cache undefined entry ");if(!S||S<0)return console.warn(`Refusing to cache entry with size ${S} for key ${g}`),void this._notifyRemove(g,v,0,q.ALL);const U=1+Math.max(j,-4)- -3;this._db.set(g,new Z(v,S,U)),this._size+=S,_.size+=S,this._checkSize()}updateSize(_,g,v,S){const j=this._db.get(g=_.id+g);if(j&&j.entry===v){for(this._size-=j.size,_.size-=j.size;S>this._maxSize;){const F=this._notifyRemove(g,v,S,q.SOME);if(!(null!=F&&F>0))return void this._db.delete(g);S=F}j.size=S,this._size+=S,_.size+=S,this._checkSize()}}pop(_,g){const v=this._db.get(g=_.id+g);if(v)return this._size-=v.size,_.size-=v.size,this._db.delete(g),++this._hit,v.entry;++this._miss}get(_,g){const v=this._db.get(g=_.id+g);if(void 0!==v)return this._db.delete(g),v.lives=v.lifetime,this._db.set(g,v),++this._hit,v.entry;++this._miss}peek(_,g){const v=this._db.get(_.id+g);return v?++this._hit:++this._miss,null==v?void 0:v.entry}get performanceInfo(){const _={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},g={},v=new Array;this._db.forEach((F,U)=>{const Pe=F.lifetime;v[Pe]=(v[Pe]||0)+F.size,this._users.forAll(xe=>{const{id:Ue,name:Ve}=xe;U.startsWith(Ue)&&(g[Ve]=(g[Ve]||0)+F.size)})});const S={};this._users.forAll(F=>{const U=F.name;"hitRate"in F&&"number"==typeof F.hitRate&&!isNaN(F.hitRate)&&F.hitRate>0?(g[U]=g[U]||0,S[U]=Math.round(100*F.hitRate)+"%"):S[U]="0%"});const j=Object.keys(g);j.sort((F,U)=>g[U]-g[F]),j.forEach(F=>_[F]=Math.round(g[F]/2**20)+"MB / "+S[F]);for(let F=v.length-1;F>=0;--F){const U=v[F];U&&(_["Priority "+(F+-3-1)]=Math.round(U/this._size*100)+"%")}return _}resetStats(){this._hit=this._miss=0,this._users.forAll(_=>_.resetHitRate())}clear(_){const g=_.id;this._db.forEach((v,S)=>{S.startsWith(g)&&(this._size-=v.size,this._db.delete(S),this._notifyRemove(S,v.entry,v.size,q.ALL))}),_.size=0}clearAll(){this._db.forEach((_,g)=>this._notifyRemove(g,_.entry,_.size,q.ALL)),this._users.forAll(_=>_.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(_,g,v,S){let j;return this._removeFuncs.some(F=>{if(_.startsWith(F[0])){const U=F[1](g,S,v);return"number"==typeof U&&(j=U),!0}return!1}),j}_checkSize(){this._users.forAll(_=>this._checkSizeLimits(_)),this._checkSizeLimits()}_checkSizeLimits(_){const g=null!=_?_:this;if(g.maxSize<0||g.size<=g.maxSize)return;const v=null==_?void 0:_.id;let S=!0;for(;S;){S=!1;for(const[j,F]of this._db)if(0===F.lifetime&&(!v||j.startsWith(v))){if(this._purgeItem(j,F,_),g.size<=.9*g.maxSize)return;S||(S=this._db.has(j))}}for(const[j,F]of this._db)if((!v||j.startsWith(v))&&(this._purgeItem(j,F,_),g.size<=.9*g.maxSize))return}_purgeItem(_,g,v=this._users.find(S=>_.startsWith(S.id))){if(this._db.delete(_),g.lives<=1){this._size-=g.size,v&&(v.size-=g.size);const S=this._notifyRemove(_,g.entry,g.size,q.SOME);null!=S&&S>0&&(this._size+=S,v&&(v.size+=S),g.lives=g.lifetime,g.size=S,this._db.set(_,g))}else--g.lives,this._db.set(_,g)}}let _e=0;class Z{constructor(_,g,v){this.entry=_,this.size=g,this.lifetime=v,this.lives=v}}},40753:(Le,fe,y)=>{y.d(fe,{d:()=>$t});var T=y(10467),J=y(89952),ae=y(5922),q=y(71065),D=y(77806),k=y(11432),_e=y(60611),Z=y(56492),W=y(82663),_=y(11817),g=y(2296),v=y(51995),S=y(83065),j=y(61320),F=y(77098),U=y(58701),Pe=y(31732),xe=y(33087),Ue=y(40013),Re=y(38965);const ke=new class Ve{constructor(t,i){this._cache=new xe.q(t),this._invalidCache=new xe.q(i)}get(t,i){const r=`${i.uid}:${t}`,o=this._cache.get(r);if(o)return o;if(null!=this._invalidCache.get(r))return null;try{const n=Ue.WhereClause.create(t,i);return this._cache.put(r,n),n}catch(n){return this._invalidCache.put(r,n),null}}getError(t,i){var r;return null!==(r=this._invalidCache.get(`${i.uid}:${t}`))&&void 0!==r?r:null}}(50,500),Fe="unsupported-query",qe=" as ",Ke=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),Ze=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),A=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...Ke,...Ze]);function B(f,t,i={}){const r=ue(t,f);if(!r){const n=ke.getError(t,f);throw new ae.A(Fe,"invalid SQL expression",{expression:t,error:n})}const o=i.expressionName||"expression";if(i.validateStandardized&&!r.isStandardized)throw new ae.A(Fe,`${o} is not standard`,{expression:t});if(i.validateAggregate&&!r.isAggregate)throw new ae.A(Fe,`${o} does not contain a valid aggregate function`,{expression:t});return r.fieldNames}function ue(f,t){return f?ke.get(f,t):null}function ye(f){return/\((.*?)\)/.test(f)?f:f.split(qe)[0]}function x(f,t,i,r={}){var o;const n=new Map;if(function R(f,t,i,r,o){const n=o.includes("*")?[...i,...o.filter(h=>"*"!==h)]:o;for(const h of n)if(t.get(h))N(f,t,i,r,h);else try{const d=B(t,ye(h),{validateStandardized:!0});for(const m of d)N(f,t,i,r,m)}catch(d){f.set(h,{type:"expression-error",expression:h,error:d})}}(n,f,t,null!==(o=r.allowedFieldTypes)&&void 0!==o?o:A,i),n.size){var h;const d=null!==(h=r.expressionName)&&void 0!==h?h:"expression";throw new ae.A(Fe,`${d} contains invalid or missing fields`,{errors:Array.from(n.values()),query:r.query})}}function N(f,t,i,r,o){const n=t.get(o);n?i.has(n.name)?"all"!==r&&!1===(null==r?void 0:r.has(n.type))&&f.set(o,{type:"invalid-type",fieldName:n.name,fieldType:Re.m.fromJSON(n.type),allowedFieldTypes:Array.from(r,h=>Re.m.fromJSON(h))}):f.set(o,{type:"missing-field",fieldName:n.name}):f.set(o,{type:"invalid-field",fieldName:o})}var O=y(95985),z=y(88840),ce=y(78200),ge=y(39239),oe=y(22442),Te=y(721),X=y(86300),be=y(19093),Y=y(59377),re=y(48218);class pe{constructor(t,i,r){var o;this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=null!==(o=t.returnDistinctValues)&&void 0!==o&&o,this.fieldsIndex=r,this.featureAdapter=i;const n=t.outFields;if(n&&!n.includes("*")){this.outFields=n;let h=0;for(const d of n){const m=ye(d),p=this.fieldsIndex.get(m),E=p?null:ue(m,r),I=p?p.name:d.split(qe)[1]||"FIELD_EXP_"+h++;this._fieldDataCache.set(d,{alias:I,clause:E})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach(i=>this.getAttributes(i)),this._returnDistinctMap.size):t.length}getAttributes(t){const i=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(i)}getFieldValue(t,i,r){var o,n;const h=r?r.name:i;let d=null;return this._fieldDataCache.has(h)?d=null===(o=this._fieldDataCache.get(h))||void 0===o?void 0:o.clause:r||(d=ue(i,this.fieldsIndex),this._fieldDataCache.set(h,{alias:h,clause:d})),r?this.featureAdapter.getAttribute(t,h):null===(n=d)||void 0===n?void 0:n.calculateValue(t,this.featureAdapter)}getDataValues(t,i,r=!0){const o=i.normalizationType,n=i.normalizationTotal,h=this.fieldsIndex.get(i.field),d=(0,X.zD)(h)||(0,X.Ah)(h),m=(0,X.OH)(h);return t.map(p=>{let E=i.field&&this.getFieldValue(p,i.field,this.fieldsIndex.get(i.field));if(i.field2?(E=`${(0,Y.gJ)(E)}${i.fieldDelimiter}${(0,Y.gJ)(this.getFieldValue(p,i.field2,this.fieldsIndex.get(i.field2)))}`,i.field3&&(E=`${E}${i.fieldDelimiter}${(0,Y.gJ)(this.getFieldValue(p,i.field3,this.fieldsIndex.get(i.field3)))}`)):"string"==typeof E&&r&&(d?E=E?new Date(E).getTime():null:m&&(E=E?(0,be.rb)(E):null)),o&&Number.isFinite(E)){const I="field"===o&&i.normalizationField?this.getFieldValue(p,i.normalizationField,this.fieldsIndex.get(i.normalizationField)):null;E=(0,Y.zS)(E,o,I,n)}return E})}getExpressionValues(t,i,r,o,n){var h=this;return(0,T.A)(function*(){const{arcadeUtils:d}=yield(0,re.lw)(),m=d.hasGeometryOperations(i);m&&(yield d.enableGeometryOperations());const p=d.createFunction(i),E=d.getViewInfo(r),I={fields:h.fieldsIndex.fields};return t.map(b=>{const G={attributes:h.featureAdapter.getAttributes(b),layer:I,geometry:m?{...(0,O.pL)(o.geometryType,o.hasZ,o.hasM,h.featureAdapter.getGeometry(b)),spatialReference:null==r?void 0:r.spatialReference}:null},M=d.createExecContext(G,E,n);return d.executeFunction(p,M)})})()}validateItem(t,i){var r,o;return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:ue(i,this.fieldsIndex)}),null!==(r=null===(o=this._fieldDataCache.get(i))||void 0===o||null===(o=o.clause)||void 0===o?void 0:o.testFeature(t,this.featureAdapter))&&void 0!==r&&r}validateItems(t,i){var r,o;return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:ue(i,this.fieldsIndex)}),null!==(r=null===(o=this._fieldDataCache.get(i))||void 0===o||null===(o=o.clause)||void 0===o?void 0:o.testSet(t,this.featureAdapter))&&void 0!==r&&r}_processAttributesForOutFields(t){const i=this.outFields;if(null==i||!i.length)return this.featureAdapter.getAttributes(t);const r={};for(const o of i){const{alias:n,clause:h}=this._fieldDataCache.get(o);r[n]=h?h.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,n)}return r}_processAttributesForDistinctValues(t){if(null==t||!this.returnDistinctValues)return t;const i=this.outFields,r=[];if(i)for(const h of i){const{alias:d}=this._fieldDataCache.get(h);r.push(t[d])}else for(const h in t)r.push(t[h]);const o=`${(i||["*"]).join(",")}=${r.join(",")}`;let n=this._returnDistinctMap.get(o)||0;return this._returnDistinctMap.set(o,++n),n>1?null:t}}function Oe(f,t,i){return{objectId:f,target:t,distance:i,type:"vertex"}}function We(f,t,i,r,o,n=!1){return{objectId:f,target:t,distance:i,type:"edge",start:r,end:o,draped:n}}class he{constructor(t,i,r){this.items=t,this.query=i,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const t=new pe(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return t.countDistinctValues(this.items);const{groupByFieldsForStatistics:i,having:r,outStatistics:o}=this.query;if(!(null==i?void 0:i.length))return 1;const h=new Map,d=new Map,m=new Set;for(const p of o){const{statisticType:E}=p,I="exceedslimit"!==E?p.onStatisticField:void 0;if(!d.has(I)){const G=[];for(const M of i){const P=this._getAttributeValues(t,M,h);G.push(P)}d.set(I,this._calculateUniqueValues(G,t.returnDistinctValues))}const b=d.get(I);for(const G in b){const{data:M,items:P}=b[G],C=M.join(",");r&&!t.validateItems(P,r)||m.add(C)}}return m.size}createQueryResponse(){var t=this;return(0,T.A)(function*(){let i;if(i=t.query.outStatistics?t.query.outStatistics.some(r=>"exceedslimit"===r.statisticType)?t._createExceedsLimitQueryResponse(t.query):yield t._createStatisticsQueryResponse(t.query):t._createFeatureQueryResponse(t.query),t.query.returnQueryGeometry){const r=t.query.geometry;i.queryGeometry=(0,U.fn)(t.query.outSR)&&!(0,U.aI)(r.spatialReference,t.query.outSR)?(0,O.ag)({spatialReference:t.query.outSR,...(0,z.Cv)(r,r.spatialReference,t.query.outSR)}):(0,O.ag)({spatialReference:t.query.outSR,...r})}return i})()}createSnappingResponse(t,i){const r=this.featureAdapter,o=Ce(this.hasZ,this.hasM),{point:n,mode:h}=t,d="number"==typeof t.distance?t.distance:t.distance.x,m="number"==typeof t.distance?t.distance:t.distance.y,p={candidates:[]},E="esriGeometryPolygon"===this.geometryType,I=this._getPointCreator(h,this.spatialReference,i),b=new Me(null,0),G=new Me(null,0),M={x:0,y:0,z:0};for(const P of this.items){const C=r.getGeometry(P);if(null==C)continue;const{coords:Q,lengths:ie}=C;if(b.coords=Q,G.coords=Q,t.returnEdge){let se=0;for(let ee=0;ee<ie.length;ee++){const H=ie[ee];for(let L=0;L<H;L++,se+=o){const K=b;if(K.coordsIndex=se,L!==H-1){const $=G;$.coordsIndex=se+o;const le=M;we(M,n,K,$);const Se=(n.x-le.x)/d,ze=(n.y-le.y)/m,et=Se*Se+ze*ze;et<=1&&p.candidates.push(We(r.getObjectId(P),I(le),Math.sqrt(et),I(K),I($)))}}}}if("none"!==t.vertexMode){const se=E?Q.length-o:Q.length;if("all"===t.vertexMode)for(let ee=0;ee<se;ee+=o){const H=b;H.coordsIndex=ee;const L=(n.x-H.x)/d,K=(n.y-H.y)/m,$=L*L+K*K;$<=1&&p.candidates.push(Oe(r.getObjectId(P),I(H),Math.sqrt($)))}else if("ends"===t.vertexMode){const ee=[0];E||ee.push(Q.length-o);for(const H of ee){const L=b;L.coordsIndex=H;const K=(n.x-L.x)/d,$=(n.y-L.y)/m,le=K*K+$*$;le<=1&&p.candidates.push(Oe(r.getObjectId(P),I(L),Math.sqrt(le)))}}}}return p.candidates.sort((P,C)=>P.distance-C.distance),p}_getPointCreator(t,i,r){const o=null==r||(0,U.aI)(i,r)?d=>d:d=>(0,z.Cv)(d,i,r),{hasZ:n}=this;return"3d"===t?n?({x:d,y:m,z:p})=>o({x:d,y:m,z:p}):({x:d,y:m})=>o({x:d,y:m,z:0}):({x:d,y:m})=>o({x:d,y:m})}createSummaryStatisticsResponse(t){var i=this;return(0,T.A)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,minValue:m,maxValue:p,scale:E,timeZone:I}=t,b=i.fieldsIndex.get(r),G=(0,X.vE)(b)||(0,X.zD)(b)||(0,X.Ah)(b),M=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:E,timeZone:I}),P=(0,Y.Vb)({normalizationType:h,normalizationField:n,minValue:m,maxValue:p}),C={value:.5,fieldType:null==b?void 0:b.type},Q=(0,X.yM)(b)?(0,Y.z9)({values:M,supportsNullCount:P,percentileParams:C}):(0,Y.G_)({values:M,minValue:m,maxValue:p,useSampleStdDev:!h,supportsNullCount:P,percentileParams:C});return(0,Y.oZ)(Q,G)})()}createUniqueValuesResponse(t){var i=this;return(0,T.A)(function*(){const{field:r,valueExpression:o,domains:n,returnAllCodedValues:h,scale:d,timeZone:m}=t,p=yield i._getDataValues({field:r,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:o,scale:d,timeZone:m},!1),E=(0,Y.b3)(p);return(0,Y.lv)(E,n,h,t.fieldDelimiter)})()}createClassBreaksResponse(t){var i=this;return(0,T.A)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:p,minValue:E,maxValue:I,numClasses:b,scale:G,timeZone:M}=t,P=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:G,timeZone:M}),C=(0,Y.Rw)(P,{field:r,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:p,minValue:E,maxValue:I,numClasses:b});return(0,Y.jM)(C,m)})()}createHistogramResponse(t){var i=this;return(0,T.A)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:p,minValue:E,maxValue:I,numBins:b,scale:G,timeZone:M}=t,P=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:G,timeZone:M});return(0,Y.$y)(P,{field:r,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:p,minValue:E,maxValue:I,numBins:b})})()}_sortFeatures(t,i,r){if(t.length>1&&null!=i&&i.length)for(const o of i.reverse()){const n=o.split(" "),h=n[0],d=this.fieldsIndex.get(h),m=!!n[1]&&"desc"===n[1].toLowerCase(),p=(0,Y.FM)(null==d?void 0:d.type,m);t.sort((E,I)=>{const b=r(E,h,d),G=r(I,h,d);return p(b,G)})}}_createFeatureQueryResponse(t){const i=this.items,{geometryType:r,hasM:o,hasZ:n,objectIdField:h,spatialReference:d}=this,{outFields:m,outSR:p,quantizationParameters:E,resultRecordCount:I,resultOffset:b,returnZ:G,returnM:M}=t,P=null!=I&&i.length>(b||0)+I,C=m&&(m.includes("*")?[...this.fieldsIndex.fields]:m.map(Q=>this.fieldsIndex.get(Q)));return{exceededTransferLimit:P,features:this._createFeatures(t,i),fields:C,geometryType:r,hasM:o&&M,hasZ:n&&G,objectIdFieldName:h,spatialReference:(0,O.ag)(p||d),transform:E&&(0,Te.VV)(E)||null}}_createFeatures(t,i){const r=new pe(t,this.featureAdapter,this.fieldsIndex),{hasM:o,hasZ:n}=this,{orderByFields:h,quantizationParameters:d,returnGeometry:m,returnCentroid:p,maxAllowableOffset:E,resultOffset:I,resultRecordCount:b,returnZ:G=!1,returnM:M=!1}=t,P=n&&G,C=o&&M;let Q=[],ie=0;const se=[...i];if(this._sortFeatures(se,h,(L,K,$)=>r.getFieldValue(L,K,$)),this.geometryType&&(m||p)){var ee;const L=null!==(ee=(0,Te.VV)(d))&&void 0!==ee?ee:void 0,K="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(m&&!p)for(const $ of se){const le=this.featureAdapter.getGeometry($),Se={attributes:r.getAttributes($),geometry:(0,O.pL)(this.geometryType,this.hasZ,this.hasM,le,E,L,P,C)};K&&le&&!Se.geometry&&(Se.centroid=(0,O.LQ)(this,this.featureAdapter.getCentroid($,this),L)),Q[ie++]=Se}else if(!m&&p)for(const $ of se)Q[ie++]={attributes:r.getAttributes($),centroid:(0,O.LQ)(this,this.featureAdapter.getCentroid($,this),L)};else for(const $ of se)Q[ie++]={attributes:r.getAttributes($),centroid:(0,O.LQ)(this,this.featureAdapter.getCentroid($,this),L),geometry:(0,O.pL)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry($),E,L,P,C)}}else for(const L of se){const K=r.getAttributes(L);K&&(Q[ie++]={attributes:K})}const H=I||0;return null!=b&&(Q=Q.slice(H,Math.min(Q.length,H+b))),Q}_createExceedsLimitQueryResponse(t){let i=!1,r=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const d of null!==(h=t.outStatistics)&&void 0!==h?h:[]){var h;if("exceedslimit"===d.statisticType){r=null!=d.maxPointCount?d.maxPointCount:Number.POSITIVE_INFINITY,o=null!=d.maxRecordCount?d.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=d.maxVertexCount?d.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)i=this.items.length>r;else if(this.items.length>o)i=!0;else{const d=Ce(this.hasZ,this.hasM),m=this.featureAdapter;i=this.items.reduce((p,E)=>{const I=m.getGeometry(E);return p+(null!=I&&I.coords.length||0)},0)/d>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(i)}}]}}_createStatisticsQueryResponse(t){var i=this;return(0,T.A)(function*(){const r={attributes:{}},o=[],n=new Map,h=new Map,d=new Map,m=new Map,p=new pe(t,i.featureAdapter,i.fieldsIndex),E=t.outStatistics,{groupByFieldsForStatistics:I,having:b,orderByFields:G,resultRecordCount:M}=t,P=null==I?void 0:I.length,C=!!P,Q=C?I[0]:null,ie=C&&!i.fieldsIndex.get(Q);for(const H of null!=E?E:[]){var se;const{outStatisticFieldName:L,statisticType:K}=H,$=H,le="exceedslimit"!==K?H.onStatisticField:void 0,Se="percentile_disc"===K||"percentile_cont"===K,ze="EnvelopeAggregate"===K||"CentroidAggregate"===K||"ConvexHullAggregate"===K,et=C&&1===P&&(le===Q||ie)&&"count"===K;if(C){if(!d.has(le)){const tt=[];for(const ht of I){const it=i._getAttributeValues(p,ht,n);tt.push(it)}d.set(le,i._calculateUniqueValues(tt,!ze&&p.returnDistinctValues))}const Ge=d.get(le);if(!Ge)continue;const ct=Object.keys(Ge);for(const tt of ct){const{count:ht,data:it,items:St,itemPositions:Zt}=Ge[tt],Rt=it.join(",");if(!b||p.validateItems(St,b)){const $e=m.get(Rt)||{attributes:{}};if(ze){$e.aggregateGeometries||($e.aggregateGeometries={});const{aggregateGeometries:Qe,outStatisticFieldName:Ye}=yield i._getAggregateGeometry($,St);$e.aggregateGeometries[Ye]=Qe}else{let Qe=null;if(et)Qe=ht;else{const Ye=i._getAttributeValues(p,le,n),Ft=Zt.map(Ht=>Ye[Ht]);Qe=Se&&"statisticParameters"in $?i._getPercentileValue($,Ft):i._getStatisticValue($,Ft,null,p.returnDistinctValues)}$e.attributes[L]=Qe}let Wt=0;I.forEach((Qe,Ye)=>$e.attributes[i.fieldsIndex.get(Qe)?Qe:"EXPR_"+ ++Wt]=it[Ye]),m.set(Rt,$e)}}}else if(ze){r.aggregateGeometries||(r.aggregateGeometries={});const{aggregateGeometries:Ge,outStatisticFieldName:ct}=yield i._getAggregateGeometry($,i.items);r.aggregateGeometries[ct]=Ge}else{const Ge=i._getAttributeValues(p,le,n);r.attributes[L]=Se&&"statisticParameters"in $?i._getPercentileValue($,Ge):i._getStatisticValue($,Ge,h,p.returnDistinctValues)}const kt="min"!==K&&"max"!==K||!(0,X.yM)(i.fieldsIndex.get(le))&&!i._isAnyDateField(le)?null:null===(se=i.fieldsIndex.get(le))||void 0===se?void 0:se.type;o.push({name:L,alias:L,type:kt||"esriFieldTypeDouble"})}const ee=C?Array.from(m.values()):[r];return i._sortFeatures(ee,G,(H,L)=>H.attributes[L]),M&&(ee.length=Math.min(M,ee.length)),{fields:o,features:ee}})()}_isAnyDateField(t){const i=this.fieldsIndex.get(t);return(0,X.vE)(i)||(0,X.zD)(i)||(0,X.Ah)(i)||(0,X.OH)(i)}_getAggregateGeometry(t,i){var r=this;return(0,T.A)(function*(){const{convexHull:o,union:n}=yield Promise.all([y.e(3930),y.e(2076)]).then(y.bind(y,27815)),{statisticType:h,outStatisticFieldName:d}=t,{featureAdapter:m,spatialReference:p,geometryType:E,hasZ:I,hasM:b}=r,G=i.map(C=>(0,O.pL)(E,I,b,m.getGeometry(C))),M=o(p,G,!0)[0],P={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===h){const C=M?(0,oe.v)(M):(0,oe.HA)(n(p,G));P.aggregateGeometries={...C,spatialReference:p},P.outStatisticFieldName=d||"extent"}else if("CentroidAggregate"===h){const C=M?(0,ge.l8)(M):(0,ge.Z4)((0,oe.HA)(n(p,G)));P.aggregateGeometries={x:C[0],y:C[1],spatialReference:p},P.outStatisticFieldName=d||"centroid"}else"ConvexHullAggregate"===h&&(P.aggregateGeometries=M,P.outStatisticFieldName=d||"convexHull");return P})()}_getStatisticValue(t,i,r,o){const{onStatisticField:n,statisticType:h}=t;let d=null;return d=null!=r&&r.has(n)?r.get(n):(0,X.yM)(this.fieldsIndex.get(n))||this._isAnyDateField(n)?(0,Y.z9)({values:i,returnDistinct:o}):(0,Y.G_)({values:o?[...new Set(i)]:i,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(n,d),d["var"===h?"variance":h]}_getPercentileValue(t,i){const{onStatisticField:r,statisticParameters:o,statisticType:n}=t,{value:h,orderBy:d}=o,m=this.fieldsIndex.get(r);return(0,Y.qg)(i,{value:h,orderBy:d,fieldType:null==m?void 0:m.type,isDiscrete:"percentile_disc"===n})}_getAttributeValues(t,i,r){if(r.has(i))return r.get(i);const o=this.fieldsIndex.get(i),n=this.items.map(h=>t.getFieldValue(h,i,o));return r.set(i,n),n}_calculateUniqueValues(t,i){const r={},o=this.items,n=o.length;for(let h=0;h<n;h++){const d=o[h],m=[];for(const E of t)m.push(E[h]);const p=m.join(",");null==r[p]?r[p]={count:1,data:m,items:[d],itemPositions:[h]}:(i||r[p].count++,r[p].items.push(d),r[p].itemPositions.push(h))}return r}_getDataValues(t,i=!0){var r=this;return(0,T.A)(function*(){const o=new pe(r.query,r.featureAdapter,r.fieldsIndex),{valueExpression:n,scale:h,timeZone:d}=t;return n?o.getExpressionValues(r.items,n,{viewingMode:"map",scale:h,spatialReference:r.query.outSR||r.spatialReference},{geometryType:r.geometryType,hasZ:r.hasZ,hasM:r.hasM},d):o.getDataValues(r.items,(0,D.o8)(t),i)})()}}function we(f,t,i,r){const o=r.x-i.x,n=r.y-i.y,m=Math.min(1,Math.max(0,((t.x-i.x)*o+(t.y-i.y)*n)/(o*o+n*n)));f.x=i.x+o*m,f.y=i.y+n*m}function Ce(f,t){return f?t?4:3:t?3:2}class Me{constructor(t,i){this.coords=t,this.coordsIndex=i}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var ve=y(871),Ee=y(18633);const me="unsupported-query";function Ne(f,t){return ne.apply(this,arguments)}function ne(){return(ne=(0,T.A)(function*(f,{fieldsIndex:t,geometryType:i,spatialReference:r,availableFields:o}){var n;if((null!==(n=f.distance)&&void 0!==n?n:0)<0||null!=f.geometryPrecision||f.multipatchOption&&"xyFootprint"!==f.multipatchOption||f.pixelSize||f.relationParam||f.text)throw new ae.A(me,"Unsupported query options",{query:f});return Be(t,o,f),function bt(f,t,i){const{outStatistics:r,groupByFieldsForStatistics:o,having:n}=i,h=null==o?void 0:o.length,d=null==r?void 0:r.length;if(n){if(!h||!d)throw new ae.A(me,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:i});!function te(f,t,i,r,o){if(!i)return!0;const n="having clause",h=B(f,i,{validateAggregate:!0,expressionName:n});x(f,t,h,{expressionName:n,query:o});const d=ue(i,f);if(!(null==d?void 0:d.getExpressions().every(p=>{var E;const{aggregateType:I,field:b}=p,G=null===(E=f.get(b))||void 0===E?void 0:E.name;return r.some(M=>{var P;const{onStatisticField:C,statisticType:Q}=M;return(null===(P=f.get(C))||void 0===P?void 0:P.name)===G&&Q.toLowerCase().trim()===I})})))throw new ae.A(Fe,"expressions in having clause should also exist in outStatistics",{having:i})}(f,t,n,r,i)}if(d){if(!function Mt(f){return null!=f&&f.every(t=>"exceedslimit"!==t.statisticType)}(r))return;x(f,t,r.map(p=>p.onStatisticField).filter(Boolean),{expressionName:"onStatisticFields",query:i}),h&&x(f,t,o,{expressionName:"groupByFieldsForStatistics",query:i});for(const p of r){const{onStatisticField:E,statisticType:I}=p;if("percentile_disc"!==I&&"percentile_cont"!==I||!("statisticParameters"in p))f.get(E)&&"count"!==I&&"min"!==I&&"max"!==I&&x(f,t,[E],{expressionName:`outStatistics with '${I}' statistic type`,allowedFieldTypes:st,query:i});else{const{statisticParameters:b}=p;if(!b)throw new ae.A(me,"statisticParameters should be set for percentile type",{definition:p,query:i})}}}}(t,o,f),Promise.all([(0,Ee.c0)(f,i,r),(0,z.Nk)(r,f.outSR)]).then(()=>f)})).apply(this,arguments)}function Be(f,t,i){const{outFields:r,orderByFields:o,returnDistinctValues:n,outStatistics:h}=i,d=h?h.map(m=>m.outStatisticFieldName&&m.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(o&&o.length>0){const m=" asc",p=" desc";x(f,t,o.map(I=>{const b=I.toLowerCase();return b.includes(m)?b.split(m)[0]:b.includes(p)?b.split(p)[0]:I}).filter(I=>!d.includes(I)),{expressionName:"orderByFields",query:i})}if(r&&r.length>0)x(f,t,r,{expressionName:"outFields",query:i,allowedFieldTypes:"all"});else if(n)throw new ae.A(me,"outFields should be specified for returnDistinctValues",{query:i});!function V(f,t,i,r){if(!i)return!0;const o="where clause";x(f,t,B(f,i,{validateStandardized:!0,expressionName:o}),{expressionName:o,query:r})}(f,t,i.where,i)}const st=new Set([...Ke,...Ze]);function rt(){return(rt=(0,T.A)(function*(f,t,{fieldsIndex:i,geometryType:r,spatialReference:o,availableFields:n}){var h;if((null!==(h=f.distance)&&void 0!==h?h:0)<0||null!=f.geometryPrecision||f.multipatchOption||f.pixelSize||f.relationParam||f.text||f.outStatistics||f.groupByFieldsForStatistics||f.having||f.orderByFields)throw new ae.A(me,"Unsupported query options",{query:f});return Be(i,n,f),Promise.all([Ct(i,n,t,f),(0,Ee.c0)(f,r,o),(0,z.Nk)(o,f.outSR)]).then(()=>f)})).apply(this,arguments)}function Ct(f,t,i,r){return nt.apply(this,arguments)}function nt(){return(nt=(0,T.A)(function*(f,t,i,r){let o=[];if(i.valueExpression){const{arcadeUtils:n}=yield(0,re.lw)();o=n.extractFieldNames(i.valueExpression)}if(i.field&&o.push(i.field),i.field2&&o.push(i.field2),i.field3&&o.push(i.field3),i.normalizationField&&o.push(i.normalizationField),!o.length&&!i.valueExpression)throw new ae.A(me,"field or valueExpression is required",{params:i});x(f,t,o,{expressionName:"statistics",query:r})})).apply(this,arguments)}var ft=y(76980),Dt=y(73258),Pt=y(86807),Nt=(y(3248),y(35150)),at=y(13316),ot=y(12438),lt=y(48900),ut=y(54029),Ie=y(82595);const mt=Symbol("Yield");class zt{constructor(){this._tasks=new Array,this._runningTasks=(0,ut.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(t){if(0===this.length)return mt;for(;!t.done&&this._process(t);)t.madeProgress()}push(t,i,r){return++this._runningTasks.value,new Promise((o,n)=>this._tasks.push(new gt(o,n,t,i,r))).finally(()=>--this._runningTasks.value)}unshift(t,i,r){return++this._runningTasks.value,new Promise((o,n)=>this._tasks.unshift(new gt(o,n,t,i,r))).finally(()=>--this._runningTasks.value)}_process(t){if(0===this._tasks.length)return!1;const i=this._tasks.shift();try{const o=(0,Z.G4)(i.signal);if(o&&!i.abortCallback)i.reject((0,Z.NK)());else{var r;const n=o?null===(r=i.abortCallback)||void 0===r?void 0:r.call(i,(0,Z.NK)()):i.callback(t);(0,Z.$X)(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(o){i.reject(o)}return!0}cancelAll(){const t=(0,Z.NK)();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(t);i.resolve(r)}else i.reject(t);this._tasks.length=0}}class gt{constructor(t,i,r,o=void 0,n=void 0){this.resolve=t,this.reject=i,this.callback=r,this.signal=o,this.abortCallback=n}}var dt=y(8189),Lt=y(98877),pt=y(85211),Ut=(y(40707),y(76576));let He=class extends Lt.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,dt._)([(0,pt.MZ)()],He.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,dt._)([(0,pt.MZ)()],He.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),He=(0,dt._)([(0,Ut.$)("esri.views.support.DebugFlags")],He);const wt=new He;var w,f,Ae=y(40830);(f=w||(w={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",f.RESOURCE_CONTROLLER="schedule",f.SLIDE="slide",f.STREAM_DATA_LOADER="stream loader",f.ELEVATION_QUERY="elevation query",f.TERRAIN_SURFACE="terrain",f.SURFACE_GEOMETRY_UPDATES="surface geometry updates",f.LOD_RENDERER="LoD renderer",f.GRAPHICS_CORE="Graphics3D",f.I3S_CONTROLLER="I3S",f.POINT_CLOUD_LAYER="point cloud",f.FEATURE_TILE_FETCHER="feature fetcher",f.OVERLAY="overlay",f.STAGE="stage",f.GRAPHICS_DECONFLICTOR="graphics deconflictor",f.FILTER_VISIBILITY="Graphics3D filter visibility",f.SCALE_VISIBILITY="Graphics3D scale visibility",f.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",f.POINT_OF_INTEREST_FREQUENT="POI frequent",f.POINT_OF_INTEREST_INFREQUENT="POI infrequent",f.LABELER="labeler",f.FEATURE_QUERY_ENGINE="feature query",f.FEATURE_TILE_TREE="feature tile tree",f.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",f.ELEVATION_ALIGNMENT="elevation alignment",f.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",f.TEXT_TEXTURE_ATLAS="text texture atlas",f.TEXTURE_UNLOAD="texture unload",f.LINE_OF_SIGHT_TOOL="line of sight tool",f.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",f.ELEVATION_PROFILE="elevation profile",f.SNAPPING="snapping",f.SHADOW_ACCUMULATOR="shadow accumulator",f.CLOUDS_GENERATOR="clouds generator",f[f.NONE=0]="NONE",f[f.TEST_PRIO=1]="TEST_PRIO";const _t=new Map([[w.RESOURCE_CONTROLLER_IMMEDIATE,0],[w.RESOURCE_CONTROLLER,4],[w.SLIDE,0],[w.STREAM_DATA_LOADER,0],[w.ELEVATION_QUERY,0],[w.TERRAIN_SURFACE,1],[w.SURFACE_GEOMETRY_UPDATES,1],[w.LOD_RENDERER,2],[w.GRAPHICS_CORE,2],[w.I3S_CONTROLLER,2],[w.POINT_CLOUD_LAYER,2],[w.FEATURE_TILE_FETCHER,2],[w.OVERLAY,4],[w.STAGE,4],[w.GRAPHICS_DECONFLICTOR,4],[w.FILTER_VISIBILITY,4],[w.SCALE_VISIBILITY,4],[w.FRUSTUM_VISIBILITY,4],[w.CLOUDS_GENERATOR,4],[w.POINT_OF_INTEREST_FREQUENT,6],[w.POINT_OF_INTEREST_INFREQUENT,30],[w.LABELER,8],[w.FEATURE_QUERY_ENGINE,8],[w.FEATURE_TILE_TREE,16],[w.FEATURE_TILE_TREE_ACTIVE,0],[w.ELEVATION_ALIGNMENT,12],[w.ELEVATION_ALIGNMENT_SCENE,14],[w.TEXT_TEXTURE_ATLAS,12],[w.TEXTURE_UNLOAD,12],[w.LINE_OF_SIGHT_TOOL,16],[w.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[w.SNAPPING,0],[w.SHADOW_ACCUMULATOR,30]]);function yt(f){return _t.has(f)?_t.get(f):"number"==typeof f?f:1}const vt=(0,Ie.l5)(6.5),Et=(0,Ie.l5)(1),Gt=(0,Ie.l5)(30),xt=(0,Ie.l5)(1e3/30),Tt=(0,Ie.l5)(100);var Je,je;(function(f){f.Scheduler=class t{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=(0,ut.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new at.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Ae.M.INTERACTING,this._tasks=new ot.A,this._runQueue=new ot.A,this._load=0,this._idleStateCallbacks=new ot.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,lt.wB)(()=>wt.SCHEDULER_LOG_SLOW_TASKS,h=>this._debug=h,lt.Vh);for(const h of Object.keys(w))this.performanceInfo.tasks.set(w[h],new at.A(w[h]));const n=this;this._test={FRAME_SAFETY_BUDGET:vt,INTERACTING_BUDGET:xt,IDLE_BUDGET:Tt,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:h=>n._budget=h,updateTask:h=>this._updateTask(h),getState:h=>this._getState(h),getRuntime:h=>this._getRuntime(h),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),(0,k.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,h){const d=new i(this,n,h);return this._tasks.push(d),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new at.A(n)),d}registerIdleStateCallbacks(n,h){const d={idleBegin:n,idleEnd:h};this._idleStateCallbacks.push(d),this.state===Ae.M.IDLE&&this._idleUpdatesStartFired&&d.idleBegin();const m=this;return{remove:()=>this._removeIdleStateCallbacks(d),set idleBegin(p){m._idleUpdatesStartFired&&(d.idleEnd(),m._state===Ae.M.IDLE&&p()),d.idleBegin=p},set idleEnd(p){d.idleEnd=p}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Ae.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(h=>h.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let h=vt,d=n.frameDuration,m=Et;switch(this.state){case Ae.M.IDLE:h=(0,Ie.l5)(0),d=(0,Ie.l5)(Math.max(Tt,n.frameDuration)),m=Gt;break;case Ae.M.INTERACTING:d=(0,Ie.l5)(Math.max(xt,n.frameDuration))}return d=(0,Ie.l5)(d-n.elapsedFrameTime-h),this.state!==Ae.M.IDLE&&d<Et&&!this._forceTask?(this._forceTask=!0,!1):(d=(0,Ie.l5)(Math.max(d,m)),this._budget.reset(d,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ae.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Ae.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset((0,Ie.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(h=>{h.name===n&&h.setPriority(n)})}_getState(n){if(this._runQueue.some(d=>d.name===n))return je.SCHEDULED;let h=je.IDLE;return this._tasks.forAll(d=>{d.name===n&&d.needsUpdate&&(d.schedulePriority<=1?h=je.READY:h!==je.READY&&(h=je.WAITING))}),h}_getRuntime(n){let h=0;return this._tasks.forAll(d=>{d.name===n&&(h+=d.runtime)}),h}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(d=>{d.needsUpdate&&n.set(d.name,(n.get(d.name)||0)+1)}),0===n.size)return null;let h="";return n.forEach((d,m)=>{h+=d>1?` ${d}x ${m}`:` ${m}`}),h}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((h,d)=>d.needsUpdate?++h:h,0);this._load=.9*this._load+n*(1-.9)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{0===n.basePriority&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});0===this._runQueue.length;){let n=!1,h=0;if(this._tasks.forAll(d=>{d.needsUpdate&&0!==d.schedulePriority&&0!==d.basePriority&&d.blockFrame!==this._frameNumber&&(n=!0,h=Math.max(h,d.basePriority),1===d.schedulePriority?(d.schedulePriority=0,this._runQueue.push(d)):--d.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const h=this._budget.now(),d=this._runQueue.pop();this._budget.resetProgress();try{d.task.runTask(this._budget)===mt&&(d.blockFrame=this._frameNumber)}catch(p){Nt.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${d.name}"`,p),d.blockFrame=this._frameNumber}!this._budget.hasProgressed&&d.blockFrame!==this._frameNumber&&d.needsUpdate&&(d.blockFrame=this._frameNumber),d.schedulePriority=d.basePriority;const m=this._budget.now()-h;if(d.runtime+=m,this._frameTaskTimes.set(d.priority,this._frameTaskTimes.get(d.priority)+m),this._debug&&m>2*this._budget.budget&&console.log("Task",d.name,"used",m,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(w))this._frameTaskTimes.set(w[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((h,d)=>this.performanceInfo.tasks.get(d).record(h)),this.performanceInfo.total.record(n)}get test(){return this._test}};class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,h,d){this._scheduler=n,this.name=h,this.blockFrame=0,this.runtime=0,this._queue=new zt,this._handles=new Pt.A,this._basePriority=yt(h),this.schedulePriority=this._basePriority,this._task=(0,ut.v)(null!=d?d:this._queue),this._handles.add((0,lt.z7)(()=>this.task.running,m=>n.taskRunningChanged(m)))}remove(){this.processQueue(Xe),this._scheduler.removeTask(this),this.schedule=At.schedule,this.reschedule=At.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const h=yt(n);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=h),this._basePriority=h}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,h,d){return this._queue.push(n,h,d)}reschedule(n,h,d){return this._queue.unshift(n,h,d)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Ae.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(!0===n()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,h){this._begin=this.now(),this._budget=n,this._state=h,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}f.Budget=r})(Je||(Je={})),function(f){f.SCHEDULED="s",f.READY="r",f.WAITING="w",f.IDLE="i"}(je||(je={}));const Xe=(()=>{const f=new Je.Budget;return f.enabled=!1,f})(),At=new class Qt{remove(){}processQueue(){}schedule(t,i,r){try{if((0,Z.G4)(i)){const o=(0,Z.NK)();return r?Promise.resolve(r(o)):Promise.reject(o)}return(0,Z.z7)(t(Xe))}catch(o){return Promise.reject(o)}}reschedule(t,i,r){return this.schedule(t,i,r)}},jt=new _e.F(2e6);let Bt=0;class $t{constructor(t){this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:ce.F},this.geometryType=t.geometryType,this.hasM=!!t.hasM,this.hasZ=!!t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new _e.Mn(Bt+++"$$",jt)),this.fieldsIndex=(0,q.Wj)(t.fieldsIndex)?t.fieldsIndex:Dt.A.fromJSON(t.fieldsIndex),this.availableFields=!t.availableFields||1===t.availableFields.length&&"*"===t.availableFields[0]?new Set(this.fieldsIndex.fields.map(i=>i.name)):new Set(t.availableFields.map(i=>{var r;return null===(r=this.fieldsIndex.get(i))||void 0===r?void 0:r.name}).filter(i=>null!=i)),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}destroy(){this._frameTask=(0,k.xt)(this._frameTask),this.clearCache(),(0,k.pR)(this._geometryQueryCache),this._changeHandle=(0,k.xt)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){var t;null!==(t=this._geometryQueryCache)&&void 0!==t&&t.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}executeQuery(t,i){var r=this;return(0,T.A)(function*(){const o=(0,Z.Mq)(i);try{return(yield r._executeQuery(t,{},o)).createQueryResponse()}catch(n){if(n!==ve.v8)throw n;return new he([],t,r).createQueryResponse()}})()}executeQueryForCount(t={},i){var r=this;return(0,T.A)(function*(){const o=(0,Z.Mq)(i);try{return(yield r._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},o)).createQueryResponseForCount()}catch(n){if(n!==ve.v8)throw n;return 0}})()}executeQueryForExtent(t,i){var r=this;return(0,T.A)(function*(){const o=(0,Z.Mq)(i),n=t.outSR;try{const h=yield r._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},o),d=h.size;return d?{count:d,extent:yield r._getBounds(h.items,h.spatialReference,n||r.spatialReference)}:{count:0,extent:null}}catch(h){if(h===ve.v8)return{count:0,extent:null};throw h}})()}executeQueryForIds(t,i){var r=this;return(0,T.A)(function*(){return r.executeQueryForIdSet(t,i).then(o=>Array.from(o))})()}executeQueryForIdSet(t,i){var r=this;return(0,T.A)(function*(){const o=(0,Z.Mq)(i);try{const n=yield r._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},o),h=n.items,d=new Set;return yield r._reschedule(()=>{for(const m of h)d.add(n.featureAdapter.getObjectId(m))},o),d}catch(n){if(n===ve.v8)return new Set;throw n}})()}executeQueryForSnapping(t,i){var r=this;return(0,T.A)(function*(){const o=(0,Z.Mq)(i),{point:n,distance:h,returnEdge:d,vertexMode:m}=t;if(!d&&"none"===m)return{candidates:[]};let p=(0,D.o8)(t.query);p=yield r._schedule(()=>(0,ve.T2)(p,r.definitionExpression,r.spatialReference),o),p=yield r._reschedule(()=>Ne(p,{availableFields:r.availableFields,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,spatialReference:r.spatialReference}),o);const E=!(0,U.aI)(n.spatialReference,r.spatialReference);E&&(yield(0,z.Nk)(n.spatialReference,r.spatialReference));const I="number"==typeof h?h:h.x,b="number"==typeof h?h:h.y,G={xmin:n.x-I,xmax:n.x+I,ymin:n.y-b,ymax:n.y+b,spatialReference:n.spatialReference},M=E?(0,z.Cv)(G,r.spatialReference):G;if(!M)return{candidates:[]};const P=(yield(0,F.el)((0,j.rS)(n),null,{signal:o}))[0],C=(yield(0,F.el)((0,j.rS)(M),null,{signal:o}))[0];if(null==P||null==C)return{candidates:[]};const Q=new he(yield r._reschedule(()=>r._searchFeatures(r._getQueryBBoxes(C.toJSON())),o),p,r);yield r._reschedule(()=>r._executeObjectIdsQuery(Q),o),yield r._reschedule(()=>r._executeTimeQuery(Q),o),yield r._reschedule(()=>r._executeAttributesQuery(Q),o),yield r._reschedule(()=>r._executeGeometryQueryForSnapping(Q,o),o);const ie=P.toJSON(),se=E?(0,z.Cv)(ie,r.spatialReference):ie,ee=E?Math.max(M.xmax-M.xmin,M.ymax-M.ymin)/2:h;return Q.createSnappingResponse({...t,point:se,distance:ee},n.spatialReference)})()}executeQueryForLatestObservations(t,i){var r=this;return(0,T.A)(function*(){var o;const n=(0,Z.Mq)(i);if(null===(o=r.timeInfo)||void 0===o||!o.trackIdField)throw new ae.A("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:r.timeInfo});try{const h=yield r._executeQuery(t,{},n);return yield r._reschedule(()=>r._filterLatest(h),n),h.createQueryResponse()}catch(h){if(h!==ve.v8)throw h;return new he([],t,r).createQueryResponse()}})()}executeQueryForSummaryStatistics(t={},i,r){var o=this;return(0,T.A)(function*(){const n=(0,Z.Mq)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createSummaryStatisticsResponse(i)})()}executeQueryForUniqueValues(t={},i,r){var o=this;return(0,T.A)(function*(){const n=(0,Z.Mq)(r),{field:h,field2:d,field3:m,valueExpression:p}=i;return(yield o._executeQueryForStatistics(t,{field:h,field2:d,field3:m,valueExpression:p},n)).createUniqueValuesResponse(i)})()}executeQueryForClassBreaks(t={},i,r){var o=this;return(0,T.A)(function*(){const n=(0,Z.Mq)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createClassBreaksResponse(i)})()}executeQueryForHistogram(t={},i,r){var o=this;return(0,T.A)(function*(){const n=(0,Z.Mq)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createHistogramResponse(i)})()}fetchRecomputedExtents(t){var i=this;return(0,T.A)(function*(){const r=(0,Z.Mq)(t);i._timeExtentPromise||(i._timeExtentPromise=(0,ft.W)(i.timeInfo,i.featureStore));const[o,n]=yield Promise.all([i._getFullExtent(),i._timeExtentPromise]);return(0,Z.Te)(r),{fullExtent:o,timeExtent:n}})()}_getBounds(t,i,r){var o=this;return(0,T.A)(function*(){const n=(0,g.hZ)((0,g.vt)(),g.qv);yield o.featureStore.forEachBounds(t,m=>(0,g.RF)(n,m));const h={xmin:n[0],ymin:n[1],xmax:n[3],ymax:n[4],spatialReference:(0,O.ag)(o.spatialReference)};o.hasZ&&isFinite(n[2])&&isFinite(n[5])&&(h.zmin=n[2],h.zmax=n[5]);const d=(0,z.Cv)(h,i,r);if(d.spatialReference=(0,O.ag)(r),d.xmax-d.xmin==0){const m=(0,W.GA)(d.spatialReference);d.xmin-=m,d.xmax+=m}if(d.ymax-d.ymin==0){const m=(0,W.GA)(d.spatialReference);d.ymin-=m,d.ymax+=m}if(o.hasZ&&null!=d.zmin&&null!=d.zmax&&d.zmax-d.zmin==0){const m=(0,W.GA)(d.spatialReference);d.zmin-=m,d.zmax+=m}return d})()}_getFullExtent(){return this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(t=>this._getBounds(t,this.spatialReference,this.spatialReference))),this._fullExtentPromise}_schedule(t,i){var r=this;return(0,T.A)(function*(){return null!=r._frameTask?r._frameTask.schedule(t,i):t(Xe)})()}_reschedule(t,i){var r=this;return(0,T.A)(function*(){return null!=r._frameTask?r._frameTask.reschedule(t,i):t(Xe)})()}_getAllFeaturesQueryEngineResult(t){var i=this;return(0,T.A)(function*(){return new he(yield i._getAllFeatures(),t,i)})()}_getAllFeatures(){var t=this;return(0,T.A)(function*(){if(null==t._allFeaturesPromise){const o=[];t._allFeaturesPromise=(0,T.A)(function*(){yield t.featureStore.forEach(n=>o.push(n))})().then(()=>o)}const i=t._allFeaturesPromise,r=yield i;return i===t._allFeaturesPromise?r.slice():t._getAllFeatures()})()}_executeQuery(t,i,r){var o=this;return(0,T.A)(function*(){t=(0,D.o8)(t),t=yield o._schedule(()=>(0,ve.GC)(t,o.definitionExpression,o.spatialReference),r),t=yield o._reschedule(()=>Ne(t,{availableFields:o.availableFields,fieldsIndex:o.fieldsIndex,geometryType:o.geometryType,spatialReference:o.spatialReference}),r),t={...t,...i};const n=yield o._reschedule(()=>o._executeSceneFilterQuery(t,r),r),h=yield o._reschedule(()=>o._executeGeometryQuery(t,n,r),r);return yield o._reschedule(()=>o._executeAggregateIdsQuery(h),r),yield o._reschedule(()=>o._executeObjectIdsQuery(h),r),yield o._reschedule(()=>o._executeTimeQuery(h),r),yield o._reschedule(()=>o._executeAttributesQuery(h),r),h})()}_executeSceneFilterQuery(t,i){var r=this;return(0,T.A)(function*(){if(null==t.sceneFilter)return null;const{outSR:o,returnGeometry:n,returnCentroid:h}=t,d=r.featureStore.featureSpatialReference,m=t.sceneFilter.geometry,p=null==d||(0,U.aI)(d,m.spatialReference)?m:(0,z.Cv)(m,d);if(!p)return null;const E=n||h,I=(0,U.fn)(o)&&!(0,U.aI)(r.spatialReference,o)&&E?function(){var C=(0,T.A)(function*(Q){return r._project(Q,o)});return function(Q){return C.apply(this,arguments)}}():C=>C,b=r.featureAdapter,G=yield r._reschedule(()=>r._searchFeatures(r._getQueryBBoxes(p)),i);if("disjoint"===t.sceneFilter.spatialRelationship){if(!G.length)return null;const C=new Set;for(const se of G)C.add(b.getObjectId(se));const Q=yield r._reschedule(()=>r._getAllFeatures(),i);return I(yield r._reschedule((0,T.A)(function*(){const se=yield(0,Ee.xt)("esriSpatialRelDisjoint",p,r.geometryType,r.hasZ,r.hasM),H=yield r._runSpatialFilter(Q,L=>!C.has(b.getObjectId(L))||se(b.getGeometry(L)),i);return new he(H,t,r)}),i))}if(!G.length)return new he([],t,r);if(r._canExecuteSinglePass(p,t))return I(new he(G,t,r));const M=yield(0,Ee.xt)("esriSpatialRelContains",p,r.geometryType,r.hasZ,r.hasM),P=yield r._runSpatialFilter(G,C=>M(b.getGeometry(C)),i);return I(new he(P,t,r))})()}_executeGeometryQuery(t,i,r){var o=this;return(0,T.A)(function*(){if(null!=i&&0===i.items.length)return i;t=null!=i?i.query:t;const{geometry:n,outSR:h,spatialRel:d,returnGeometry:m,returnCentroid:p}=t,E=o.featureStore.featureSpatialReference,I=!n||null==E||(0,U.aI)(E,n.spatialReference)?n:(0,z.Cv)(n,E),b=m||p,G=(0,U.fn)(h)&&!(0,U.aI)(o.spatialReference,h),M=o._geometryQueryCache&&null==i?JSON.stringify(G&&b?{originalFilterGeometry:n,spatialRelationship:d,outSpatialReference:h}:{originalFilterGeometry:n,spatialRelationship:d}):null,P=M?o._geometryQueryCache.get(M):null;if(null!=P)return new he(P,t,o);const C=function(){var H=(0,T.A)(function*(L){return G&&b&&(yield o._project(L,h)),M&&o._geometryQueryCache.put(M,L.items,L.items.length+1),L});return function(K){return H.apply(this,arguments)}}();if(!I)return C(null!=i?i:yield o._getAllFeaturesQueryEngineResult(t));const Q=o.featureAdapter;let ie=yield o._reschedule(()=>o._searchFeatures(o._getQueryBBoxes(n)),r);if("esriSpatialRelDisjoint"===d){if(!ie.length)return C(null!=i?i:yield o._getAllFeaturesQueryEngineResult(t));const H=new Set;for(const $ of ie)H.add(Q.getObjectId($));const L=null!=i?i.items:yield o._reschedule(()=>o._getAllFeatures(),r);return C(yield o._reschedule((0,T.A)(function*(){const $=yield(0,Ee.xt)(d,I,o.geometryType,o.hasZ,o.hasM),Se=yield o._runSpatialFilter(L,ze=>!H.has(Q.getObjectId(ze))||$(Q.getGeometry(ze)),r);return new he(Se,t,o)}),r))}if(null!=i){const H=new J.vW;ie=ie.filter(L=>(0,J.qh)(i.items,L,i.items.length,H)>=0)}if(!ie.length){const H=new he([],t,o);return M&&o._geometryQueryCache.put(M,H.items,1),H}if(o._canExecuteSinglePass(I,t))return C(new he(ie,t,o));const se=yield(0,Ee.xt)(d,I,o.geometryType,o.hasZ,o.hasM),ee=yield o._runSpatialFilter(ie,H=>se(Q.getGeometry(H)),r);return C(new he(ee,t,o))})()}_executeGeometryQueryForSnapping(t,i){var r=this;return(0,T.A)(function*(){var o;const{query:n}=t,{spatialRel:h}=n;if(null==t||null===(o=t.items)||void 0===o||!o.length||!n.geometry||!h)return;const d=yield(0,Ee.xt)(h,n.geometry,r.geometryType,r.hasZ,r.hasM),m=yield r._runSpatialFilter(t.items,p=>d(p.geometry),i);t.items=m})()}_executeAggregateIdsQuery(t){var i;if(0===t.items.length||null===(i=t.query.aggregateIds)||void 0===i||!i.length||null==this.aggregateAdapter)return;const r=new Set;for(const n of t.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(n).forEach(h=>r.add(h));const o=this.featureAdapter.getObjectId;t.items=t.items.filter(n=>r.has(o(n)))}_executeObjectIdsQuery(t){var i;if(0===t.items.length||null===(i=t.query.objectIds)||void 0===i||!i.length)return;const r=new Set(t.query.objectIds),o=this.featureAdapter.getObjectId;t.items=t.items.filter(n=>r.has(o(n)))}_executeTimeQuery(t){if(0===t.items.length)return;const i=(0,ft.I)(this.timeInfo,t.query.timeExtent,this.featureAdapter);null!=i&&(t.items=t.items.filter(i))}_executeAttributesQuery(t){if(0===t.items.length)return;const i=ue(t.query.where,this.fieldsIndex);if(i){if(!i.isStandardized)throw new TypeError("Where clause is not standardized");t.items=t.items.filter(r=>i.testFeature(r,this.featureAdapter))}}_runSpatialFilter(t,i,r){var o=this;return(0,T.A)(function*(){if(!i)return t;if(null==o._frameTask)return t.filter(m=>i(m));let n=0;const h=new Array,d=function(){var m=(0,T.A)(function*(p){for(;n<t.length;){const E=t[n++];i(E)&&(h.push(E),p.madeProgress()),p.done&&(yield o._reschedule(I=>d(I),r))}});return function(E){return m.apply(this,arguments)}}();return o._reschedule(m=>d(m),r).then(()=>h)})()}_filterLatest(t){const{trackIdField:i,startTimeField:r,endTimeField:o}=this.timeInfo,n=o||r,h=new Map,d=this.featureAdapter.getAttribute;for(const m of t.items){const p=d(m,i),E=d(m,n),I=h.get(p);(!I||E>d(I,n))&&h.set(p,m)}t.items=Array.from(h.values())}_canExecuteSinglePass(t,i){const{spatialRel:r}=i;return(0,Ee.tC)(t)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}_project(t,i){var r=this;return(0,T.A)(function*(){if(!i||(0,U.aI)(r.spatialReference,i))return t;const o=r.featureAdapter;let n;try{const d=yield r._getFullExtent();n=(0,_.getTransformation)(r.spatialReference,i,d)}catch{}const h=yield(0,z.lK)(t.items.map(d=>(0,O.pL)(r.geometryType,r.hasZ,r.hasM,o.getGeometry(d))),r.spatialReference,i,n);return t.items=h.map((d,m)=>o.cloneWithGeometry(t.items[m],(0,Pe.Ux)(d,r.hasZ,r.hasM))),t})()}_getQueryBBoxes(t){if((0,Ee.tC)(t)){if((0,j.ZC)(t))return[(0,v.fA)(Math.min(t.xmin,t.xmax),Math.min(t.ymin,t.ymax),Math.max(t.xmin,t.xmax),Math.max(t.ymin,t.ymax))];if((0,j.Bi)(t))return t.rings.map(i=>(0,v.fA)(Math.min(i[0][0],i[2][0]),Math.min(i[0][1],i[2][1]),Math.max(i[0][0],i[2][0]),Math.max(i[0][1],i[2][1])))}return[(0,S.Rg)((0,v.vt)(),t)]}_searchFeatures(t){var i=this;return(0,T.A)(function*(){const r=new Set;yield Promise.all(t.map(n=>i.featureStore.forEachInBounds(n,h=>r.add(h))));const o=Array.from(r.values());return r.clear(),o})()}_executeQueryForStatistics(t,i,r){var o=this;return(0,T.A)(function*(){t=(0,D.o8)(t);try{t=yield o._schedule(()=>(0,ve.GC)(t,o.definitionExpression,o.spatialReference),r),t=yield o._reschedule(()=>function Ot(f,t,i){return rt.apply(this,arguments)}(t,i,{availableFields:o.availableFields,fieldsIndex:o.fieldsIndex,geometryType:o.geometryType,spatialReference:o.spatialReference}),r);const n=yield o._reschedule(()=>o._executeSceneFilterQuery(t,r),r),h=yield o._reschedule(()=>o._executeGeometryQuery(t,n,r),r);return yield o._reschedule(()=>o._executeAggregateIdsQuery(h),r),yield o._reschedule(()=>o._executeObjectIdsQuery(h),r),yield o._reschedule(()=>o._executeTimeQuery(h),r),yield o._reschedule(()=>o._executeAttributesQuery(h),r),h}catch(n){if(n!==ve.v8)throw n;return new he([],t,o)}})()}}},78200:(Le,fe,y)=>{y.d(fe,{F:()=>T});const T={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},50690:(Le,fe,y)=>{y.d(fe,{T:()=>q});var T=y(27999),J=y(42086),ae=y(13682);const q={getObjectId:D=>D.objectId,getAttributes:D=>D.attributes,getAttribute:(D,k)=>D.attributes[k],cloneWithGeometry:(D,k)=>new J.Om(k,D.attributes,null,D.objectId),getGeometry:D=>D.geometry,getCentroid:(D,k)=>(null==D.centroid&&(D.centroid=(0,T.Q)(new ae.A,D.geometry,k.hasZ,k.hasM)),D.centroid)}},19093:(Le,fe,y)=>{y.d(fe,{$r:()=>Ue,Jc:()=>ke,gV:()=>Ve,rb:()=>Re});var T=y(10467),J=y(37027),D=(y(21152),y(5922),y(67685)),k=y(97442),_e=y(32034),Z=y(721),W=y(58701),_=y(86300),g=y(78592),v=y(43039),S=y(59377),j=y(48218),F=y(13303);let U=null;const Pe=(0,J.A)(/^(([0-1][0-9])|([2][0-3])):([0-5][0-9])(:([0-5][0-9]))?([.](\d+))?$/,{hh:1,mm:4,ss:6,ms:8});function Ue(x,R,N,O){const z=(0,W.d9)(N)?(0,W.Vp)(N):null,ce=z?Math.round((z.valid[1]-z.valid[0])/R.scale[0]):null;return x.map(ge=>{const oe=new F.A(ge.geometry);return(0,Z.Gy)(R,oe,oe,oe.hasZ,oe.hasM),ge.geometry=z?function xe(x,R,N){return x.x<0?x.x+=R:x.x>N&&(x.x-=R),x}(oe,null!=ce?ce:0,O[0]):oe,ge})}function Ve(x,R=18,N,O,z){const ce=new Float64Array(O*z);R=Math.round((0,D.Lz)(R));let ge=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY;const Te=(0,g.YW)(N);for(const{geometry:X,attributes:be}of x){const{x:Y,y:re}=X,pe=Math.max(0,Y-R),Oe=Math.max(0,re-R),We=Math.min(z,re+R),he=Math.min(O,Y+R),we=+Te(be);for(let Ce=Oe;Ce<We;Ce++)for(let Me=pe;Me<he;Me++){const ve=Ce*O+Me,Ee=(0,g.hv)(Me-Y,Ce-re,R)*we,me=ce[ve]+=Ee;ge=Math.min(ge,me),oe=Math.max(oe,me)}}return{min:ge,max:oe}}function Re(x){const R=Pe.exec(x);if(!R)return null;const{hh:N,mm:O,ss:z,ms:ce}=R.groups;return Number(N)*k.vf.hours+Number(O)*k.vf.minutes+Number(z)*k.vf.seconds+Number(ce||0)}function ke(x,R){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,T.A)(function*(x,R,N=!0){if(!R)return[];const{field:O,field2:z,field3:ce,fieldDelimiter:ge,fieldInfos:oe,timeZone:Te}=x,X=O&&(null==oe?void 0:oe.find(me=>me.name.toLowerCase()===O.toLowerCase())),be=!!X&&(0,_.OH)(X),Y=!!X&&(0,v.fs)(X),re=x.valueExpression,pe=x.normalizationType,Oe=x.normalizationField,We=x.normalizationTotal,he=[],we=x.viewInfoParams;let Ce=null,Me=null;if(re){if(!U){const{arcadeUtils:me}=yield(0,j.lw)();U=me}U.hasGeometryOperations(re)&&(yield U.enableGeometryOperations()),Ce=U.createFunction(re),Me=we?U.getViewInfo({viewingMode:we.viewingMode,scale:we.scale,spatialReference:new _e.A(we.spatialReference)}):null}const ve=x.fieldInfos,Ee=R[0]&&"declaredClass"in R[0]&&"esri.Graphic"===R[0].declaredClass||!ve?null:{fields:ve};return R.forEach(me=>{const Ne=me.attributes;let ne;if(re){const Be=Ee?{...me,layer:Ee}:me,st=U.createExecContext(Be,Me,Te);ne=U.executeFunction(Ce,st)}else Ne&&(ne=Ne[O],z?(ne=`${(0,S.gJ)(ne)}${ge}${(0,S.gJ)(Ne[z])}`,ce&&(ne=`${ne}${ge}${(0,S.gJ)(Ne[ce])}`)):"string"==typeof ne&&N&&(Y?ne=ne?new Date(ne).getTime():null:be&&(ne=ne?Re(ne):null)));if(pe&&"number"==typeof ne&&isFinite(ne)){const Be=Ne&&parseFloat(Ne[Oe]);ne=(0,S.zS)(ne,pe,Be,We)}he.push(ne)}),he})).apply(this,arguments)}},43039:(Le,fe,y)=>{y.d(fe,{fs:()=>j,i0:()=>Ze});var T=y(48266),J=y(86300),D=(y(48218),y(71470),y(22639));function j(A){return(0,J.vE)(A)||(0,J.zD)(A)||(0,J.Ah)(A)}function Ze(A,B){const{format:V,timeZoneOptions:te,fieldType:ue}=null!=B?B:{};let ye,de;if(te&&({timeZone:ye,timeZoneName:de}=(0,D.hv)(te.layerTimeZone,te.datesInUnknownTimezone,te.viewTimeZone,(0,T.J2)(V||"short-date-short-time"),ue)),"string"==typeof A&&isNaN(Date.parse("time-only"===ue?`1970-01-01T${A}Z`:A)))return A;switch(ue){case"date-only":{const x=(0,T.J2)(V||"short-date");return"string"==typeof A?(0,T.iS)(A,{...x}):(0,T.Yq)(A,{...x,timeZone:D.n$})}case"time-only":{const x=(0,T.J2)(V||"short-time");return"string"==typeof A?(0,T.F8)(A,x):(0,T.Yq)(A,{...x,timeZone:D.n$})}case"timestamp-offset":{if(!ye&&"string"==typeof A&&new Date(A).toISOString()!==A)return A;const x=V||te?(0,T.J2)(V||"short-date-short-time"):void 0,R=x?{...x,timeZone:ye,timeZoneName:de}:void 0;return"string"==typeof A?(0,T.Ey)(A,R):(0,T.Yq)(A,R)}default:{const x=V||te?(0,T.J2)(V||"short-date-short-time"):void 0;return(0,T.Yq)("string"==typeof A?new Date(A):A,x?{...x,timeZone:ye,timeZoneName:de}:void 0)}}}},40830:(Le,fe,y)=>{var T,J;y.d(fe,{M:()=>T}),(J=T||(T={}))[J.ANIMATING=0]="ANIMATING",J[J.INTERACTING=1]="INTERACTING",J[J.IDLE=2]="IDLE"},37027:(Le,fe,y)=>{y.d(fe,{A:()=>q});var T=y(82284);function J(D,k){return(J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Z,W){return Z.__proto__=W,Z})(D,k)}function q(){q=function(_,g){return new _e(_,void 0,g)};var D=RegExp.prototype,k=new WeakMap;function _e(W,_,g){var v=new RegExp(W,_);return k.set(v,g||k.get(W)),J(v,_e.prototype)}function Z(W,_){var g=k.get(_);return Object.keys(g).reduce(function(v,S){var j=g[S];if("number"==typeof j)v[S]=W[j];else{for(var F=0;void 0===W[j[F]]&&F+1<j.length;)F++;v[S]=W[j[F]]}return v},Object.create(null))}return function ae(D,k){if("function"!=typeof k&&null!==k)throw new TypeError("Super expression must either be null or a function");D.prototype=Object.create(k&&k.prototype,{constructor:{value:D,writable:!0,configurable:!0}}),Object.defineProperty(D,"prototype",{writable:!1}),k&&J(D,k)}(_e,RegExp),_e.prototype.exec=function(W){var _=D.exec.call(this,W);if(_){_.groups=Z(_,this);var g=_.indices;g&&(g.groups=Z(g,this))}return _},_e.prototype[Symbol.replace]=function(W,_){if("string"==typeof _){var g=k.get(this);return D[Symbol.replace].call(this,W,_.replace(/\$<([^>]+)>/g,function(S,j){var F=g[j];return"$"+(Array.isArray(F)?F.join("$"):F)}))}if("function"==typeof _){var v=this;return D[Symbol.replace].call(this,W,function(){var S=arguments;return"object"!=(0,T.A)(S[S.length-1])&&(S=[].slice.call(S)).push(Z(S,v)),_.apply(this,S)})}return D[Symbol.replace].call(this,W,_)},q.apply(this,arguments)}}}]);