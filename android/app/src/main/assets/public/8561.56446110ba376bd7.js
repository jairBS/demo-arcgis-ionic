"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8561],{45219:(k,U,d)=>{d.d(U,{OP:()=>S,V4:()=>v,rZ:()=>h}),d(3248);var L=d(35150);function v(M,O,F){var R;if(null==M)return null;const o=O.readArcadeFeature();O.contextTimeZone=null===(R=F.$view)||void 0===R?void 0:R.timeZone;try{return M.evaluate({...F,$feature:o},M.services)}catch(I){return L.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",I),null}}function h(M){return null==M||M===1/0||M===-1/0||"number"==typeof M&&isNaN(M)}function S(M,O,F,R){var o;if(null==M)return null!=R?R:null;const I=O.readArcadeFeature();O.contextTimeZone=null===(o=F.$view)||void 0===o?void 0:o.timeZone;const C=M.evaluate({...F,$feature:I},M.services);return h(C)?null!=R?R:null:C}},78698:(k,U,d)=>{d.d(U,{A:()=>v,J:()=>L});var P=d(1119);function L(M,O){let F;if("string"==typeof M)F=(0,P.Wm)(M+`-seed(${O})`);else{let R=12;F=M^O;do{F=107*(F>>8^F)+R|0}while(0!=--R)}return(1+F/(1<<31))/2}function v(M){return Math.floor(L(M,h)*S)}const h=53290320,S=10},6690:(k,U,d)=>{d.d(U,{U:()=>F});var P=d(88258),L=d(10084);class h{get length(){return this._pos}constructor(o,I){this._pos=0;const C=I?this._roundToNearest(I,o.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(C),this._buffer=new o(this._array),this._ctor=o,this._i16View=new Int16Array(this._array)}_roundToNearest(o,I){const C=Math.round(o);return 1===I?C:C+(I-C%I)}_ensureSize(o){if(this._pos+o>=this._buffer.length){const I=this._roundToNearest(1.25*(this._array.byteLength+o*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),C=new ArrayBuffer(I),z=new this._ctor(C);z.set(this._buffer,0),this._array=C,this._buffer=z,this._i16View=new Int16Array(this._array)}}ensureSize(o){this._ensureSize(o)}writeF32(o){this._ensureSize(1);const I=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=o,this._pos++,I}push(o){this._ensureSize(1);const I=this._pos;return this._buffer[this._pos++]=o,I}writeFixed(o){this._buffer[this._pos++]=o}setValue(o,I){this._buffer[o]=I}i1616Add(o,I,C){this._i16View[2*o]+=I,this._i16View[2*o+1]+=C}getValue(o){return this._buffer[o]}getValueF32(o){return new Float32Array(this._array,4*o,1)[0]}incr(o){if(this._buffer.length<o)throw new Error("Increment index overflows the target buffer");this._buffer[o]++}decr(o){this._buffer[o]--}writeRegion(o){this._ensureSize(o.length);const I=this._pos;return this._buffer.set(o,this._pos),this._pos+=o.length,I}writeManyFrom(o,I,C){this._ensureSize(C-I);for(let z=I;z!==C;z++)this.writeFixed(o._buffer[z])}buffer(){const o=this._array.slice(0,4*this._pos);return this.destroy(),o}toArray(){return[...this._buffer]}seek(o){this._pos=o}destroy(){this._array=null,this._buffer=null}}class O{constructor(o,I,C,z=0){const K=6*z*Uint32Array.BYTES_PER_ELEMENT,Q=4*z*C,x=C/4,D=I.attributes.find(j=>"pos"===j.name||"position"===j.name);if(!D)throw new Error("InternalError: Unable to find position attribute");this.layout={...I,position:D},this._indices=new h(Uint32Array,K),this._vertices=new h(Uint32Array,Q),this._metrics=new h(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=x,this._instanceId=o}serialize(o){const I=this._indices.buffer(),C=this._vertices.buffer(),z=this._metrics.length?this._metrics.buffer():null;return o.push(I,C),{instanceId:this._instanceId,layout:this.layout,indices:I,vertices:C,metrics:z}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(o){this._vertices.ensureSize(o)}indexEnsureSize(o){this._indices.ensureSize(o)}writeIndex(o){this._indices.push(o)}writeVertex(o){this._vertices.push(o)}writeVertexRegion(o){this._vertices.writeRegion(o)}writeVertexF32(o){this._vertices.writeF32(o)}writeMetric(o){this._metrics.incr(this._metricCountOffset),o.serialize(this._metrics)}}class F{constructor(o,I=0){this._id=o,this._sizeHint=I,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new h(Uint32Array,this._sizeHint*P.A.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const o=new Array,I=[],C=this._entities.buffer();for(const z of this._instanceIdToVertexData.values())I.push(z.serialize(o));return{message:{data:I,entities:C},transferList:o}}vertexCount(){var o,I;return null!==(o=null===(I=this._current.writer)||void 0===I?void 0:I.vertexCount)&&void 0!==o?o:0}indexCount(){var o,I;return null!==(o=null===(I=this._current.writer)||void 0===I?void 0:I.indexCount)&&void 0!==o?o:0}vertexEnsureSize(o){this._current.writer.vertexEnsureSize(o)}indexEnsureSize(o){this._current.writer.indexEnsureSize(o)}vertexWrite(o){this._current.writer.writeVertex(o)}vertexWriteRegion(o){this._current.writer.writeVertexRegion(o)}vertexWriteF32(o){this._current.writer.writeVertexF32(o)}recordBounds(o,I,C,z){}indexWrite(o){this._current.writer.writeIndex(o)}metricStart(o){this._current.metric=o}metricEnd(){this._current.metric.bounds.length&&this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(o){this._current.metric.bounds.push(o)}entityStart(o,I=o){this._entityIdIndex=this._entities.push(o),this._entitySortKeyIndex=this._entities.writeF32(I),this._entityRecordCountOffset=this._entities.push(0)}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(o,I,C=0){this._current.writer=this._getVertexWriter(o,I),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=o,this._current.layoutHash=I.hash,this._current.textureKey=C}recordEnd(o=0){const I=this._current.vertexStart,C=this._current.writer.vertexCount-I;if(!C)return!1;const z=this._current.indexStart,K=this._current.writer.indexCount-z;return this._recordIndexStart=z,this._recordIndexCount=K,this._recordVertexStart=I,this._recordVertexCount=C,this._entities.incr(this._entityRecordCountOffset),L.A.write(this._entities,this._current.instanceId,this._current.textureKey,z,K,I,C,o),!0}copyLast(o,I){var C;const z=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),L.A.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,z,this._recordVertexCount,0);const K=this._current.writer.indexWriter,Q=this._current.writer.vertexWriter,x=this._recordIndexStart+this._recordIndexCount,D=this._recordVertexCount;for(let p=this._recordIndexStart;p!==x;p++){const m=K.getValue(p);K.push(m+D)}const j=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,Y=(this._recordVertexStart+this._recordVertexCount)*j;for(let p=this._recordVertexStart*j;p!==Y;p++){const m=Q.getValue(p);Q.push(m)}const $=this._current.writer.layout.position,Z=null!==(C=$.packPrecisionFactor)&&void 0!==C?C:1,V=$.offset/Uint32Array.BYTES_PER_ELEMENT,a=o*Z,y=I*Z;for(let p=z*j;p<=Q.length;p+=j)Q.i1616Add(p+V,a,y);this.recordEnd()}copyLastFrom(o,I,C){var z;const K=o._entities.getValue(o._entityIdIndex);if(K!==this._entities.getValue(this._entityIdIndex)){const m=o._entities.getValueF32(o._entitySortKeyIndex);this.entityStart(K,m)}this.recordStart(o._current.instanceId,o._current.writer.layout,o._current.textureKey);const Q=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,x=this._current.vertexStart,D=o._current.vertexStart-x,j=this._current.writer.indexWriter,G=this._current.writer.vertexWriter,Y=o._current.writer.indexWriter,$=o._current.writer.vertexWriter;for(let m=o._current.indexStart;m!==Y.length;m++){const T=Y.getValue(m);j.push(T-D)}for(let m=o._current.vertexStart*Q;m!==$.length;m++){const T=$.getValue(m);G.push(T)}const Z=this._current.writer.layout.position,V=null!==(z=Z.packPrecisionFactor)&&void 0!==z?z:1,a=Z.offset/Uint32Array.BYTES_PER_ELEMENT,y=I*V,p=C*V;for(let m=x*Q;m<=G.length;m+=Q)G.i1616Add(m+a,y,p);this.recordEnd()}_getVertexWriter(o,I){const{stride:C}=I,z=this._instanceIdToVertexData;return z.has(o)||z.set(o,new O(o,I,C,this._sizeHint)),z.get(o)}}},86220:(k,U,d)=>{d.d(U,{J:()=>S});var P=d(10467),L=d(1119),v=d(24370);class h{}class S extends h{constructor(O){super(),this._fetcher=O,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destory(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(O){const F=(0,v.IF)(O.resource),R=(0,L.Wm)(JSON.stringify(F));return this._pendingIds.has(R)||(this._pendingIds.add(R),this._pendingRequests.push({...O,resourceId:R})),R}fetchEnqueuedResources(){var O=this;return(0,P.A)(function*(){const F=O._pendingRequests;O._pendingIds.clear(),O._pendingRequests=[];const R=yield O._fetcher.fetch(F,O._abortOptions);for(let o=0;o<R.length;o++)O._resourceIdToResource.set(F[o].resourceId,R[o])})()}fetchResourceImmediate(O){var F=this;return(0,P.A)(function*(){const R=yield F._fetcher.fetch([O],F._abortOptions);if(1!==R.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return R[0]})()}fetchDictionaryResourceImmediate(O){var F=this;return(0,P.A)(function*(){const R=yield F._fetcher.fetchDictionary([O],F._abortOptions);if(1!==R.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return R[0]})()}getResource(O){return this._resourceIdToResource.get(O)}}},77190:(k,U,d)=>{d.d(U,{hZ:()=>G,PZ:()=>V});var P=d(10467),L=d(69522),v=d(89952),h=d(5922),S=d(77806),M=d(35150),O=d(78698),F=d(1416),R=d(9908);function I(y,p){return C.apply(this,arguments)}function C(){return(C=(0,P.A)(function*(y,p,m=!1){const{defaultValue:T,valueExpressionInfo:g,value:B}=p;if(g){const{expression:w}=g,s=yield y.createComputedField({expression:w},m);return s?{...p,computed:s,defaultValue:T}:null}return{...p,computed:new R.G(B),defaultValue:T}})).apply(this,arguments)}function z(y,p){return K.apply(this,arguments)}function K(){return(K=(0,P.A)(function*(y,p){const{defaultValue:m,valueExpressionInfo:T}=p,{expression:g}=T,B=yield y.createComputedField({expression:g});return B?{...p,computed:B,defaultValue:m}:null})).apply(this,arguments)}const Q=y=>"boolean"!=typeof y&&"number"!=typeof y&&"valueExpressionInfo"in y;class D{static create(p,m,T){return(0,P.A)(function*(){const g={},B=new Map,w=new Map,s=new Map,l=new Map,b=new Map;for(const n in T.params){const _=T.params[n];if(null!=_&&"object"==typeof _)if(Array.isArray(_)){if("object"==typeof _[0])throw new Error(`InternalError: Cannot handle ${n}. Nested array params are not supported`);g[n]=_}else if("valueExpressionInfo"in _){if(_.value){g[n]=_.value;continue}const A=yield z(p,_);if(!A){g[n]=_.defaultValue;continue}B.set(n,A),g[n]=null}else switch(_.type){case"cim-effect-infos":if(_.effectInfos.some(A=>A.overrides.length)){w.set(n,{effects:yield Promise.all(_.effectInfos.map(function(){var A=(0,P.A)(function*(W){const N=W.overrides.map(H=>I(p,H));return{effect:W.effect,compiledOverrides:(yield Promise.all(N)).filter(v.Ru)}});return function(W){return A.apply(this,arguments)}}()))});break}g[n]=_.effectInfos.map(A=>A.effect);break;case"cim-marker-placement-info":_.overrides.length&&s.set(n,{placementInfo:_,compiledOverrides:(yield Promise.all(_.overrides.map(A=>I(p,A)))).filter(v.Ru)}),g[n]=_.placement;break;case"text-rasterization-param":{var E;if(_.overrides.length){const W=_.overrides.map(N=>I(p,N,_.useLegacyLabelEvaluationRules));l.set(n,{compiledOverrides:(yield Promise.all(W)).filter(v.Ru),rasterizationParam:_,objectIdToResourceId:new Map});continue}const A={type:"cim-rasterization-info",resource:_.resource};g[n]=null!==(E=yield m.fetchResourceImmediate(A))&&void 0!==E?E:null;break}case"sprite-rasterization-param":{var i;if(_.overrides.length){const W=_.overrides.map(N=>I(p,N));l.set(n,{compiledOverrides:(yield Promise.all(W)).filter(v.Ru),rasterizationParam:_,objectIdToResourceId:new Map});continue}if("animated"===_.resource.type){l.set(n,{compiledOverrides:[],rasterizationParam:_,objectIdToResourceId:new Map});continue}const A={type:"cim-rasterization-info",resource:_.resource};g[n]=null!==(i=yield m.fetchResourceImmediate(A))&&void 0!==i?i:null;break}case"cim-marker-transform-param":{const{params:A}=_;if(A.some(p=>{for(const m in p)if(Q(p[m]))return!0;return!1})){const W={compiledMarkerInfos:[]};yield Promise.all(A.map(function(){var N=(0,P.A)(function*(H){const J={props:{}};for(const X in H)if(Q(H[X])){const q=yield z(p,H[X]);J.compiledExpressionMap||(J.compiledExpressionMap=new Map),q&&J.compiledExpressionMap.set(X,q)}else J.props[X]=H[X];W.compiledMarkerInfos.push(J)});return function(H){return N.apply(this,arguments)}}())),b.set(n,W)}else g[n]={type:"cim-marker-transform-info",infos:A};break}default:g[n]=_}else g[n]=_}return new D(T,g,B,w,s,l,b)})()}constructor(p,m,T,g,B,w,s){this.inputMeshParams=p,this._resolvedMeshParams=m,this._dynamicProperties=T,this._dynamicEffectProperties=g,this._dynamicPlacementProperties=B,this._dynamicAsyncProperties=w,this._dynamicTransformProperties=s,this.evaluator=l=>l}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(p,m,T){for(const g of this._dynamicAsyncProperties.values()){const B=(0,S.o8)(g.rasterizationParam.resource);"animated"===g.rasterizationParam.resource.type&&g.rasterizationParam.resource.randomizeStartTime&&(B.primitiveName="__RESERVED__PRIMITIVE__NAME__",B.startGroup=(0,O.A)(m.getObjectId()||0));for(const{primitiveName:s,propertyName:l,computed:b,defaultValue:E,valueExpressionInfo:i}of g.compiledOverrides)try{(0,F.Ph)(B,"animated"===g.rasterizationParam.resource.type?B.primitiveName:s,l,b,m,T,E)}catch(n){M.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new h.A("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${null==i?void 0:i.expression}' (primitive: '${s}', property: '${l}')`,n))}const w=p.enqueueRequest({type:"cim-rasterization-info",resource:B});g.objectIdToResourceId.set(m.getObjectId(),w)}}evaluateMeshParams(p,m,T){for(const[g,B]of this._dynamicProperties.entries())this._resolvedMeshParams[g]=B.computed.readWithDefault(m,T,B.defaultValue);for(const[g,B]of this._dynamicPlacementProperties.entries())for(const{computed:w,defaultValue:s,propertyName:l}of B.compiledOverrides){const b=w.readWithDefault(m,T,s);B.placementInfo.placement[l]=b,this._resolvedMeshParams[g]=B.placementInfo.placement}for(const[g,B]of this._dynamicEffectProperties.entries())for(const w of B.effects){for(const{computed:s,defaultValue:l,propertyName:b}of w.compiledOverrides){const E=s.readWithDefault(m,T,l);w.effect[b]=E}this._resolvedMeshParams[g]=B.effects.map(s=>s.effect)}for(const[g,B]of this._dynamicTransformProperties.entries()){const w={type:"cim-marker-transform-info",infos:[]};for(const s of B.compiledMarkerInfos){const l={...s.props};if(s.compiledExpressionMap)for(const[b,E]of s.compiledExpressionMap){const i=E.computed.readWithDefault(m,T,E.defaultValue);l[b]="number"==typeof i||"boolean"==typeof i?i:E.defaultValue}w.infos.push(l)}this._resolvedMeshParams[g]=w}for(const[g,B]of this._dynamicAsyncProperties.entries()){const w=B.objectIdToResourceId.get(m.getObjectId());if(null==w)continue;const s=p.getResource(w);this._resolvedMeshParams[g]=s}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}}var j=d(73624);function G(y,p,m,T,g,B,w){return Y.apply(this,arguments)}function Y(){return(Y=(0,P.A)(function*(y,p,m,T,g,B,w){const s=j.Y[m],l=yield D.create(y,p,g),b=new s.constructor(T,l,B,w);return yield b.loadDependencies(),b})).apply(this,arguments)}function V(y,p,m,T){return a.apply(this,arguments)}function a(){return(a=(0,P.A)(function*(y,p,m,T){return Promise.all(m.map(g=>G(y,p,g.meshWriterName,(0,L.P)(g.id),g.options,T,g.optionalAttributes)))})).apply(this,arguments)}},54661:(k,U,d)=>{d.d(U,{Z:()=>P});class P{getObjectId(v){return v.getObjectId()}getAttributes(v){return v.readAttributes()}getAttribute(v,h){return v.readAttribute(h)}getAttributeAsTimestamp(v,h){return v.readAttributeAsTimestamp(h)}cloneWithGeometry(v,h){return v}getGeometry(v){return v.readGeometryWorldSpace()}getCentroid(v,h){return v.readCentroidForDisplay()}}P.Shared=new P},32197:(k,U,d)=>{d.d(U,{L:()=>P});class P{destroy(){}}},10903:(k,U,d)=>{d.d(U,{K:()=>Z});var P=d(10467),L=d(5922),v=d(3248),h=d(35150),S=d(48237),M=d(25735),O=d(47669),F=d(53212),R=d(24370),o=d(90731);class z{constructor(a){this.data=a,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}class K{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(a){let y=this._objectIdToDisplayId.get(a);return y?y.increment():(y=new z((0,F.Ss)(this._getFreeId(),!1)),y.increment(),this._objectIdToDisplayId.set(a,y)),y.data}releaseIdForObjectId(a){const y=this._objectIdToDisplayId.get(a);y&&(y.decrement(),y.empty()&&(this._objectIdToDisplayId.delete(a),this._freeIds.push(y.data)))}releaseAll(){for(const a of this._objectIdToDisplayId.values())this._freeIds.push(a.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var Q=d(83897),x=d(50915);const j=()=>h.A.getLogger("esri.views.layers.2d.features.support.AttributeStore"),G=(!1,j(),()=>null),Y_sharedArrayBuffer=(0,v.A)("esri-shared-array-buffer");(0,v.A)("esri-atomics");class ${constructor(a,y,p){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:m,layout:T,textureOnly:g}=y;this.textureOnly=g||!1,this.pixelType=m,this.layout=T,this._resetRange(),this.size=a,this.isLocal=p,g||(this.data=this._initData(m,a))}get buffer(){var a;return null===(a=this.data)||void 0===a?void 0:a.buffer}unsetComponentAllTexels(a,y){const p=this.data;for(let m=0;m<this.size*this.size;m++)p[m*this.texelSize+a]&=~y;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(a,y){const p=this.data;for(let m=0;m<this.size*this.size;m++)p[m*this.texelSize+a]|=255&y;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(a,y,p){const m=this.data;for(const T of p)m[T*this.texelSize+a]|=y,this.dirtyStart=Math.min(this.dirtyStart,T),this.dirtyEnd=Math.max(this.dirtyEnd,T)}setComponentTexel(a,y,p){this.data[p*this.texelSize+a]|=y,this.dirtyStart=Math.min(this.dirtyStart,p),this.dirtyEnd=Math.max(this.dirtyEnd,p)}unsetComponentTexel(a,y,p){this.data[p*this.texelSize+a]&=~y,this.dirtyStart=Math.min(this.dirtyStart,p),this.dirtyEnd=Math.max(this.dirtyEnd,p)}getData(a,y){const p=(0,F.Q4)(a);return this.data[p*this.texelSize+y]}setData(a,y,p){const m=(0,F.Q4)(a);this.layout&1<<y?null!=this.data&&(this.data[m*this.texelSize+y]=p,this.dirtyStart=Math.min(this.dirtyStart,m),this.dirtyEnd=Math.max(this.dirtyEnd,m)):j().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(a){if(this.size=a,!this.textureOnly){const y=this._initData(this.pixelType,a);y.set(this.data),this.data=y}}toMessage(){const a=this.dirtyStart,y=this.dirtyEnd,p=this.texelSize;if(a>y)return null;this._resetRange();const T=this.pixelType,g=this.layout;return{start:a,end:y,data:!this.isLocal&&this.data.slice(a*p,(y+1)*p)||null,pixelType:T,layout:g}}_initData(a,y){const p=ArrayBuffer,m=(0,R.Qz)(a),T=new m(new p(y*y*4*m.BYTES_PER_ELEMENT));for(let g=0;g<T.length;g+=4)T[g+1]=255;return T}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class Z{constructor(a){this._client=a,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=O.TB,this._idsToHighlight=new Map,this._referencesScale=!1,this._referencesGeometry=!1,this._initialized=!1,this.version=0,this._idGenerator=new K,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const a=x.ld.FLOAT;G(`Creating AttributeStore ${Y_sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:x.ld.UNSIGNED_BYTE,layout:1},{pixelType:x.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:x.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:a,layout:15},{pixelType:a,layout:15},{pixelType:a,layout:15},{pixelType:a,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get _signal(){return this._abortController.signal}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(a){return this._idGenerator.createIdForObjectId(a)}releaseDisplayIdForObjectId(a){return this._idGenerator.releaseIdForObjectId(a)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}update(a,y,p,m,T=0){var g=this;return(0,P.A)(function*(){const B=(0,S.Ui)(g._schema,a);if(g.version=T,B&&((0,v.A)("esri-2d-update-debug")&&console.debug(`Version[${T}] AttributeStore.update`,{changed:B}),g._schema=a,g._attributeComputeInfo=null,g._initialize(),null!=a))if(p&&(g._filters=yield Promise.all(a.filters.map(w=>w?Q.A.create({geometryType:p.geometryType,hasM:!1,hasZ:!1,timeInfo:p.timeInfo,fieldsIndex:p.fieldsIndex,spatialReference:null!=m?m:p.spatialReference,filterJSON:w}):null))),"subtype"!==a.type)g._attributeComputeInfo={isSubtype:!1,map:new Map},yield Promise.all(a.bindings.map(function(){var w=(0,P.A)(function*(s){var l,b;const E=yield g._bind(y,s);g._referencesGeometry=g._referencesGeometry||null!==(l=null==E?void 0:E.referencesGeometry())&&void 0!==l&&l,g._referencesScale=g._referencesScale||null!==(b=null==E?void 0:E.referencesScale())&&void 0!==b&&b});return function(s){return w.apply(this,arguments)}}()));else{g._attributeComputeInfo={isSubtype:!0,subtypeField:a.subtypeField,map:new Map},g._referencesScale=!1,g._referencesGeometry=!1;for(const w in a.bindings){const s=a.bindings[w];yield Promise.all(s.map(function(){var l=(0,P.A)(function*(b){var E,i;const n=yield g._bind(y,b,parseInt(w,10));g._referencesGeometry=g._referencesGeometry||null!==(E=null==n?void 0:n.referencesGeometry())&&void 0!==E&&E,g._referencesScale=g._referencesScale||null!==(i=null==n?void 0:n.referencesScale())&&void 0!==i&&i});return function(b){return l.apply(this,arguments)}}()))}}})()}setHighlight(a,y){const p=this._getBlock(0);p.unsetComponentAllTexels(0,(1<<M.M$.length)-1);for(const{displayId:m,highlightFlags:T}of a){if(null==m)continue;const g=(0,F.Q4)(m);p.setComponent(0,T,[g])}this._idsToHighlight.clear();for(const{objectId:m,highlightFlags:T}of a)this._idsToHighlight.set(m,T);for(const{objectId:m,highlightFlags:T}of y)this._idsToHighlight.set(m,T)}setData(a,y,p,m){const T=(0,F.Q4)(a);this._ensureSizeForTexel(T),this._getBlock(y).setData(a,p,m)}getData(a,y,p){return this._getBlock(y).getData(a,p)}getHighlightFlags(a){return this._idsToHighlight.get(a)||0}unsetAttributeData(a){const y=(0,F.Q4)(a);this._getBlock(0).setData(y,0,0)}setAttributeData(a,y,p){var m;const T=(0,F.Q4)(a);this._ensureSizeForTexel(T),this._getBlock(0).setData(T,0,this.getFilterFlags(y));const g=this._attributeComputeInfo;let s=null;g&&(s=g.isSubtype?g.map.get(y.readAttribute(g.subtypeField)):g.map,null!==(m=s)&&void 0!==m&&m.size&&s.forEach((l,b)=>{var E;const i=1*b%4,n=Math.floor(1*b/4),_=this._getBlock(n+O.dV.VV);let A=null===(E=l.field)||void 0===E?void 0:E.read(y,p);l.valueRepresentation&&(A=function D(V,a){if(!V||!a)return V;switch(a){case"radius":case"distance":return 2*V;case"diameter":case"width":return V;case"area":return Math.sqrt(V)}return V}(A,l.valueRepresentation)),(null===A||isNaN(A)||A===1/0||A===-1/0)&&(A=o.qM),_.setData(T,i,A)}))}get epoch(){return this._epoch}sendUpdates(){var a=this;return(0,P.A)(function*(){const y=a._blocks.map(m=>null!=m?m.toMessage():null),p=a._getInitArgs();(0,v.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),yield a._client.update({initArgs:p,blockData:y,version:a.version,sendUpdateEpoch:a._epoch},a._signal),a._epoch+=1,(0,v.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")})()}_ensureSizeForTexel(a){for(;a>=this._size*this._size;)if(this._expand())return}_bind(a,y,p){var m=this;return(0,P.A)(function*(){const T=yield a.createComputedField(y),{valueRepresentation:g}=y,B=m._attributeComputeInfo;if(B.isSubtype){var w;const s=null!==(w=B.map.get(p))&&void 0!==w?w:new Map;s.set(y.binding,{field:T,valueRepresentation:g}),B.map.set(p,s)}else B.map.set(y.binding,{field:T,valueRepresentation:g});return T})()}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(O.dV.Animation),this._getBlock(O.dV.GPGPU),{blockSize:this._size,blockDescriptors:this._blocks.map(a=>null!=a?{textureOnly:a.textureOnly,buffer:a.buffer,pixelType:a.pixelType}:null)})}_getBlock(a){const y=this._blocks[a];if(null!=y)return y;G(`Initializing AttributeBlock at index ${a}`);const p=new $(this._size,this._blockDescriptors[a],this._client.isLocal);return this._blocks[a]=p,this._initialized=!1,p}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const a=this._size<<=1;G("Expanding block size to",a,this._blocks);for(const y of this._blocks)null==y||y.expand(a);return this._initialized=!1,this._size=a,0}return j().error(new L.A("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}isVisible(a){return!!(this._getBlock(0).getData(a,0)&1<<M.M$.length)}getFilterFlags(a){let y=0;for(let m=0;m<this._filters.length;m++){const g=this._filters[m];y|=(1<<m&&null!=g&&!g.check(a)?0:1)<<m}let p=0;if(this._idsToHighlight.size){const m=a.getObjectId();p=this.getHighlightFlags(m)}return y<<M.M$.length|p}}},85452:(k,U,d)=>{d.d(U,{l:()=>B});var P=d(10467),L=d(5922),v=d(35150),h=d(2296),S=d(53212),M=d(32197);class O extends M.L{constructor(s){super(),this._field=s}resize(s){throw new Error("Method not implemented.")}read(s,l){return s.readAttribute(this._field)}readWithDefault(s,l){return s.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}var F=d(1119),R=d(48218),o=d(45219);class I extends M.L{static create(s,l){return(0,P.A)(function*(){const b=yield(0,R.Ad)(s,l.spatialReference,l.fields),E=(0,F.Wm)(s);return new I(b,E)})()}constructor(s,l){super(),this._compiled=s,this._cacheKey=l}resize(s){}read(s,l){return this.referencesScale()||"system"!==l.$view.timeZone?(0,o.V4)(this._compiled,s,l):this._readCached(s,l)}readWithDefault(s,l,b){return this.referencesScale()||"system"!==l.$view.timeZone?(0,o.OP)(this._compiled,s,l,b):this._readWithDefaultCached(s,l,b)}referencesScale(){var s,l;return null!==(s=null===(l=this._compiled)||void 0===l?void 0:l.referencesScale())&&void 0!==s&&s}referencesGeometry(){var s,l;return null!==(s=null===(l=this._compiled)||void 0===l?void 0:l.referencesGeometry())&&void 0!==s&&s}_readCached(s,l){if(s.setCache(this._cacheKey),s.hasCachedValue())return s.getCachedValue();const b=(0,o.V4)(this._compiled,s,l);return s.setCachedValue(b),b}_readWithDefaultCached(s,l,b){if(s.setCache(this._cacheKey),s.hasCachedValue())return s.getCachedValue();const E=(0,o.OP)(this._compiled,s,l,b);return s.setCachedValue(E),E}}var C=d(48266),z=d(68479),K=d(54444),Q=d(86300),x=d(4858);class V extends M.L{static create(s,l){return(0,P.A)(function*(){const b=(0,x.lc)(s);return new V(E=>b.replaceAll(/{[^}]*}/g,i=>{const n=i.slice(1,-1),_=E.metadata.fieldsIndex.get(n);if(null==_)return i;const A=E.readAttribute(n);return null==A?"":function Z(w,s){if(null==w)return"";const l=s.domain;if(l)if("codedValue"===l.type||"coded-value"===l.type){const E=w;for(const i of l.codedValues)if(i.code===E)return i.name}else if("range"===l.type){const{max:E,min:i}=(0,K.A5)(s),n=+w;if(null!=i&&null!=E&&i<=n&&n<=E)return l.name}let b=w;return(0,Q.vE)(s)?b=(0,C.Yq)(b,(0,C.J2)("short-date")):(0,Q.WA)(s)&&(b=(0,z.ZV)(+b)),b||""}(A,_)}))})()}constructor(s){super(),this._evaluator=s}resize(s){}read(s,l){return this._evaluator(s)}readWithDefault(s,l,b){const E=this._evaluator(s);return(0,o.rZ)(E)?b:E}referencesScale(){return!1}referencesGeometry(){return!1}}class a extends M.L{constructor(s,l){super(),this._field=s,this._normalizationInfo=l}resize(s){throw new Error("Method not implemented.")}read(s,l){return this._readNormalized(s)}readWithDefault(s,l){return this._readNormalized(s)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(s){const l=s.readAttribute(this._field);if(null==l)return null;const{normalizationField:b,normalizationTotal:E,normalizationType:i}=this._normalizationInfo,n=s.readAttribute(b);switch(null!=i?i:"esriNormalizeByField"){case"esriNormalizeByField":return n?n?l/n:void 0:null;case"esriNormalizeByLog":return Math.log(l)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return E?l/E*100:null}}}var y=d(42178),p=d(96845);const m=()=>v.A.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),T=4294967295;function g(w,s,l){if(!(w.length>s))for(;w.length<=s;)w.push(l)}class B{constructor(s){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=s}createBitset(){const s=this._bitsets.length;return this._bitsets.push(y.y.create(this._allocatedSize,S.KQ)),s+1}createComputedField(s,l=!1){var b=this;return(0,P.A)(function*(){if(s.expression)try{if(!b.compilationOptions)throw new Error("InternalError: Compilation options not defined");return l?V.create(s.expression,b.compilationOptions):yield I.create(s.expression,b.compilationOptions)}catch(i){const n=new L.A("featurelayer","Failed to compile arcade expression",{error:i,expression:s.expression});return m().error(n),null}if(s.normalizationType||s.normalizationField)return new a(s.field,s);if(s.field)return new O(s.field);const E=new L.A("featurelayer","Unable to create computed field. No expression or field found",{info:s});return m().error(E),null})()}createWhereClause(s){var l=this;return(0,P.A)(function*(){return s?(0,p.$)(s,l.compilationOptions.fields):null})()}getBitset(s){return this._bitsets[s-1]}getComputedNumeric(s,l){return this.getComputedNumericAtIndex(s&S.KQ,0)}setComputedNumeric(s,l,b){return this.setComputedNumericAtIndex(s&S.KQ,b,0)}getComputedString(s,l){return this.getComputedStringAtIndex(s&S.KQ,0)}setComputedString(s,l,b){return this.setComputedStringAtIndex(s&S.KQ,0,b)}getComputedNumericAtIndex(s,l){const b=s&S.KQ;return this._ensureNumeric(l,b),this._numerics[l][b]}setComputedNumericAtIndex(s,l,b){const E=s&S.KQ;this._ensureNumeric(l,E),this._numerics[l][E]=b}getPackedChunkId(s){const l=s&S.KQ;return this._ensureInstanceId(l),this._instanceIds[l]}setPackedChunkId(s,l){const b=s&S.KQ;this._ensureInstanceId(b),this._instanceIds[b]=l}getComputedStringAtIndex(s,l){const b=s&S.KQ;return this._ensureString(l,b),this._strings[l][b]}setComputedStringAtIndex(s,l,b){const E=s&S.KQ;this._ensureString(l,E),this._strings[l][E]=b}getXMin(s){return this._bounds[4*(s&S.KQ)]}getYMin(s){return this._bounds[4*(s&S.KQ)+1]}getXMax(s){return this._bounds[4*(s&S.KQ)+2]}getYMax(s){return this._bounds[4*(s&S.KQ)+3]}setBounds(s,l,b=!1){const E=s&S.KQ;if(!b&&!this._dirtyBitset.has(s))return this._bounds[4*E]!==T;this._dirtyBitset.unset(s);const i=l.readGeometryWorldSpace();if(g(this._bounds,4*E+4,0),!i||!i.coords.length)return this._bounds[4*E]=T,this._bounds[4*E+1]=T,this._bounds[4*E+2]=T,this._bounds[4*E+3]=T,!1;let n=1/0,_=1/0,A=-1/0,W=-1/0;return i.forEachVertex((N,H)=>{n=Math.min(n,N),_=Math.min(_,H),A=Math.max(A,N),W=Math.max(W,H)}),this._bounds[4*E]=n,this._bounds[4*E+1]=_,this._bounds[4*E+2]=A,this._bounds[4*E+3]=W,!0}getBounds(s,l){const b=this.getXMin(l),E=this.getYMin(l),i=this.getXMax(l),n=this.getYMax(l);return(0,h.BI)(s,b,E,i,n),b!==T}_ensureNumeric(s,l){this._numerics[s]||(this._numerics[s]=[]),g(this._numerics[s],l,0)}_ensureInstanceId(s){g(this._instanceIds,s,0)}_ensureString(s,l){this._strings[s]||(this._strings[s]=[]),g(this._strings[s],l,null)}}},9908:(k,U,d)=>{d.d(U,{G:()=>L});var P=d(32197);class L extends P.L{constructor(h){super(),this._value=h}resize(h){}read(h,S){return this._value}readWithDefault(h,S,M){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}},83897:(k,U,d)=>{d.d(U,{A:()=>K});var P=d(10467),L=d(5922),v=d(35150),h=d(51995),S=d(83065),M=d(871),O=d(18633),F=d(76980),R=d(87086),o=d(54661),I=d(96845);class K{constructor(x){this._geometryBounds=(0,h.vt)(),this._idToVisibility=new Map,this._serviceInfo=x}static create(x){return(0,P.A)(function*(){const D=new K(x);return yield D.update(x.filterJSON,x.spatialReference),D})()}get hash(){return this._hash}check(x){return this._applyFilter(x)}clear(){const x=this._resetAllHiddenIds();return this.update(),{show:x,hide:[]}}invalidate(){this._idToVisibility.forEach((x,D)=>{this._idToVisibility.set(D,0)})}setKnownIds(x){for(const D of x)this._idToVisibility.set(D,1)}setTrue(x){const D=[],j=[],G=new Set(x);return this._idToVisibility.forEach((Y,$)=>{const Z=!!(1&this._idToVisibility.get($)),V=G.has($);!Z&&V?D.push($):Z&&!V&&j.push($),this._idToVisibility.set($,V?3:0)}),{show:D,hide:j}}createQuery(){const{geometry:x,spatialRel:D,where:j,timeExtent:G,objectIds:Y}=this;return R.A.fromJSON({geometry:x,spatialRel:D,where:j,timeExtent:G,objectIds:Y})}update(x,D){var j=this;return(0,P.A)(function*(){j._hash=JSON.stringify(x);const G=yield(0,M.T2)(x,null,D);yield Promise.all([j._setGeometryFilter(G),j._setIdFilter(G),j._setAttributeFilter(G),j._setTimeFilter(G)])})()}_setAttributeFilter(x){var D=this;return(0,P.A)(function*(){if(null==x||!x.where)return D._clause=null,void(D.where=null);D._clause=yield(0,I.$)(x.where,D._serviceInfo.fieldsIndex),D.where=x.where})()}_setIdFilter(x){this._idsToShow=(null==x?void 0:x.objectIds)&&new Set(x.objectIds),this._idsToHide=(null==x?void 0:x.hiddenIds)&&new Set(x.hiddenIds),this.objectIds=null==x?void 0:x.objectIds}_setGeometryFilter(x){var D=this;return(0,P.A)(function*(){if(null==x||!x.geometry)return D._spatialQueryOperator=null,D.geometry=null,void(D.spatialRel=null);const j=x.geometry,G=x.spatialRel||"esriSpatialRelIntersects",Y=yield(0,O.xt)(G,j,D._serviceInfo.geometryType,D._serviceInfo.hasZ,D._serviceInfo.hasM);(0,S.Rg)(D._geometryBounds,j),D._spatialQueryOperator=Y,D.geometry=j,D.spatialRel=G})()}_setTimeFilter(x){if(this.timeExtent=this._timeOperator=null,null!=x&&x.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=x.timeExtent,this._timeOperator=(0,F.I)(this._serviceInfo.timeInfo,x.timeExtent,o.Z.Shared);else{const D=new L.A("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",x.timeExtent);v.A.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(D)}}_applyFilter(x){return this._filterByGeometry(x)&&this._filterById(x)&&this._filterByTime(x)&&this._filterByExpression(x)}_filterByExpression(x){return!this.where||this._clause(x)}_filterById(x){var D,j;return(!(null!==(D=this._idsToHide)&&void 0!==D&&D.size)||!this._idsToHide.has(x.getObjectId()))&&(!(null!==(j=this._idsToShow)&&void 0!==j&&j.size)||this._idsToShow.has(x.getObjectId()))}_filterByGeometry(x){if(!this.geometry)return!0;const D=x.readGeometryWorldSpace();return!!D&&this._spatialQueryOperator(D)}_filterByTime(x){return null==this._timeOperator||this._timeOperator(x)}_resetAllHiddenIds(){const x=[];return this._idToVisibility.forEach((D,j)=>{1&D||(this._idToVisibility.set(j,1),x.push(j))}),x}}},34650:(k,U,d)=>{d.d(U,{h:()=>h,i:()=>v});var P=d(32034),L=d(73258);class v{constructor(M){var O,F,R;this._options=M,this._fieldsIndex="fieldsIndex"in M?L.A.fromJSON(M.fieldsIndex):new L.A(M.fields),M.spatialReference&&(this._spatialReference=P.A.fromJSON(M.spatialReference)),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:null!==(O=this._options.typeIdField)&&void 0!==O?O:void 0,types:null!==(F=this._options.types)&&void 0!==F?F:void 0,subtypeField:this._options.subtypeField,subtypes:null!==(R=this._options.subtypes)&&void 0!==R?R:void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return this._options.geometryType}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class h extends v{static create(M){return new h({fields:[],objectIdField:"uid",geometryType:null,spatialReference:M,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}},54977:(k,U,d)=>{d.d(U,{P:()=>L});var P=d(42178);class L{constructor(h){this._valid=P.y.create(h),this._data=new Array(h)}has(h){return this._valid.has(h)}set(h,S){this._valid.set(h),this._data[h]=S}get(h){return this._data[h]}}},27420:(k,U,d)=>{d.d(U,{Y:()=>b}),d(21152);var j,G,Y,L=d(61299),v=d(3248),h=d(11432),S=d(87257),M=d(29752),O=d(72137),F=d(2296),R=d(13259),o=d(27999),I=d(31732),C=d(42086),z=d(13682),K=d(22639),Q=d(54977),x=d(42178),D=d(61320);const $=null!==(j=(0,v.A)("featurelayer-simplify-thresholds"))&&void 0!==j?j:[.5,.5,.5,.5],Z=$[0],V=$[1],a=$[2],y=$[3],p=null!==(G=(0,v.A)("featurelayer-simplify-payload-size-factors"))&&void 0!==G?G:[1,2,4],m=p[0],T=p[1],g=p[2],B=null!==(Y=(0,v.A)("featurelayer-simplify-mobile-factor"))&&void 0!==Y?Y:2,w=(0,v.A)("esri-mobile"),s=4294967295;class b{constructor(i){this.metadata=i,this.type="FeatureSetReader",this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(i,n){let _=1;const A=w?B:1;n>4e6?_=g*A:n>1e6?_=T*A:n>5e5?_=m*A:n>1e5&&(_=A);let W=0;return i>4e3?W=y*_:i>2e3?W=a*_:i>100?W=V:i>15&&(W=Z),W}parseTimestampOffset(i){return i}getBounds(i){if(function l(E,i,n){if(!(E.length>i))for(;E.length<=i;)E.push(n)}(this._boundsBuffer,4*this.getIndex()+4,0),this.getBoundsXMin()===s)return!1;if(0===this.getBoundsXMin()){const N=this.readGeometryWorldSpace();if(!N)return this.setBoundsXMin(s),!1;let H=1/0,J=1/0,X=-1/0,q=-1/0;return N.forEachVertex((ee,te)=>{H=Math.min(H,ee),J=Math.min(J,te),X=Math.max(X,ee),q=Math.max(q,te)}),this.setBoundsXMin(H),this.setBoundsYMin(J),this.setBoundsXMax(X),this.setBoundsYMax(q),(0,F.BI)(i,H,J,X,q),!0}const n=this.getBoundsXMin(),_=this.getBoundsYMin(),A=this.getBoundsXMax(),W=this.getBoundsYMax();return(0,F.BI)(i,n,_,A,W),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(i){this._boundsBuffer[4*this.getIndex()]=i}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(i){this._boundsBuffer[4*this.getIndex()+1]=i}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(i){this._boundsBuffer[4*this.getIndex()+2]=i}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(i){this._boundsBuffer[4*this.getIndex()+3]=i}readAttributeAsTimestamp(i){const n=this.readAttribute(i);return"string"==typeof n?new Date(n).getTime():"number"==typeof n||null==n?n:null}readAttribute(i,n=!1){const _=this._readAttribute(i,n);if(void 0!==_)return _;for(const A of this._joined){A.setIndex(this.getIndex());const W=A._readAttribute(i,n);if(void 0!==W)return W}}readAttributes(){const i=this._readAttributes();for(const n of this._joined){n.setIndex(this.getIndex());const _=n._readAttributes();for(const A of Object.keys(_))i[A]=_[A]}return i}joinAttributes(i){this._joined.push(i)}removeIds(i){if(null==this._objectIdToIndex){const _=new Map,A=this.getCursor();for(;A.next();){const W=A.getObjectId();(0,h.Lw)(W),_.set(W,A.getIndex())}this._objectIdToIndex=_}const n=this._objectIdToIndex;for(const _ of i.values())n.has(_)&&this._removeAtIndex(n.get(_))}readOptimizedFeatureWorldSpace(){const i=this.readGeometryWorldSpace(),n=this.readAttributes(),_=this.readCentroidWorldSpace(),A=new C.Om(i,n,_);return A.objectId=this.getObjectId(),A.displayId=this.getDisplayId(),A}readLegacyFeatureForDisplay(){var i;const n=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:null!==(i=n&&{x:n.coords[0],y:n.coords[1]})&&void 0!==i?i:null}}readLegacyFeatureWorldSpace(){var i;const n=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:null!==(i=n&&{x:n.coords[0],y:n.coords[1]})&&void 0!==i?i:null}}readLegacyGeometryForDisplay(){const i=this.readGeometryForDisplay();return(0,I.zv)(i,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const i=this._readX(),n=this.getInTransform();return null==n?i:i*n.scale[0]+n.translate[0]}readYWorldSpace(){const i=this._readY(),n=this.getInTransform();return null==n?i:n.translate[1]-i*n.scale[1]}readGeometryForDisplay(){const i=this._readGeometryDeltaDecoded(!0);if(!i){const n=this._createGeometryFromServerCentroid();return n?n.deltaDecode():null}return i}readGeometryWorldSpace(){let i=this._readGeometry();if(i||(i=this._createGeometryFromServerCentroid()),!i)return null;const n=i.clone(),_=this.getInTransform();return null!=_&&(0,I.Ch)(n,n,this.hasZ,this.hasM,_),n}readCentroidForDisplay(){const i=this.readGeometryForDisplay();return i?this._computeDisplayCentroid(i):this._readServerCentroid()}readCentroidWorldSpace(){const i=this.readGeometryForDisplay(),n=i?this._computeDisplayCentroid(i):this._readServerCentroid();if(!n)return null;const _=n.clone(),A=this.getInTransform();return null!=A&&(0,I.Ch)(_,_,this.hasZ,this.hasM,A),_}setCache(i){let n=this._caches.get(i);null==n&&(n=new Q.P(this.getSize()),this._caches.set(i,n)),this._activeCache=n}setCachedValue(i){this._activeCache.set(this.getIndex(),i)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(i){const n=this._readGeometry(i);return"esriGeometryPoint"!==this.geometryType&&n&&this.getInTransform()?n.deltaDecode():n}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(i){this._contextTimeZone=i}readArcadeFeature(){return this}hasField(i){return this.fields.has(i)||this._joined.some(n=>n.hasField(i))}geometry(){const i=this.readGeometryWorldSpace(),n=(0,I.zv)(i,this.geometryType,this.hasZ,this.hasM),_=(0,D.rS)(n);if(_){if(!this.metadata.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");_.spatialReference=this.metadata.spatialReference}return _}autocastArcadeDate(i,n){var _;return n&&n instanceof Date?this.isUnknownDateTimeField(i)?L.lY.unknownDateJSToArcadeDate(n):L.lY.dateJSAndZoneToArcadeDate(n,null!==(_=this.contextTimeZone)&&void 0!==_?_:K.qU):n}isUnknownDateTimeField(i){return this.metadata.fieldsIndex.getTimeZone(i)===K.L5}field(i){let n=this.fields.get(i);if(n)switch(n.type){case"date-only":case"esriFieldTypeDateOnly":return S.n.fromReader(this.readAttribute(i,!1));case"time-only":case"esriFieldTypeTimeOnly":return M.k.fromReader(this.readAttribute(i,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return L.lY.fromReaderAsTimeStampOffset(this.readAttribute(i,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(i,this.readAttribute(i,!0));default:return this.readAttribute(i,!1)}for(const _ of this._joined)if(_.setIndex(this.getIndex()),n=_.fields.get(i),n)switch(n.type){case"date-only":case"esriFieldTypeDateOnly":return S.n.fromReader(_._readAttribute(i,!1));case"time-only":case"esriFieldTypeTimeOnly":return M.k.fromReader(_._readAttribute(i,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return L.lY.fromReaderAsTimeStampOffset(_._readAttribute(i,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(i,_._readAttribute(i,!0));default:return this.readAttribute(i,!1)}throw new Error(`Field ${i} does not exist`)}setField(i,n){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map(i=>i.name)}castToText(i=!1){var n;if(!i)return JSON.stringify(this.readLegacyFeatureForDisplay());const _=this.readLegacyFeatureForDisplay();if(!_)return JSON.stringify(null);const A={geometry:_.geometry,attributes:{...null!==(n=_.attributes)&&void 0!==n?n:{}}};for(const W in A.attributes){const N=A.attributes[W];N instanceof Date&&(A.attributes[W]=N.getTime())}return JSON.stringify(A)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(i=null){var n,_;return{attributes:this._readAttributes(),geometry:!0===(null==i?void 0:i.keepGeometryType)?this.geometry():null!==(n=null===(_=this.geometry())||void 0===_?void 0:_.toJSON())&&void 0!==n?n:null}}castAsJsonAsync(i=null,n=null){return Promise.resolve(this.castAsJson(n))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(i){if(null==this.getInTransform())return(0,o.Q)(new z.A,i,this.hasM,this.hasZ);const n=O.z.fromOptimized(i,this.geometryType);n.yFactor*=-1;const _=(0,R.d)(n);return _?(_[1]*=-1,new z.A([],_)):null}copyInto(i){i._joined=this._joined,i._deleted=this._deleted,i._objectIdToIndex=this._objectIdToIndex,i._boundsBuffer=this._boundsBuffer,i._activeCache=this._activeCache,i._caches=this._caches,i._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const i=this.readGeometryWorldSpace();return(0,I.zv)(i,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const i=this._readServerCentroid();if(!i)return null;const[n,_]=i.coords;return this._createQuantizedExtrudedGeometry(n,_)}_createQuantizedExtrudedGeometry(i,n){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(i,n):this._createQuantizedExtrudedQuad(i,n)}_createQuantizedExtrudedQuad(i,n){return new z.A([5],[i-1,n,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(i,n){return new z.A([2],[i-1,n+1,1,-1])}_removeAtIndex(i){null==this._deleted&&(this._deleted=x.y.create(this.getSize())),this._deleted.set(i)}}},42178:(k,U,d)=>{d.d(U,{y:()=>P});class P{static fromBuffer(v,h){return new P(v,h)}static create(v,h=4294967295){const S=new Uint32Array(Math.ceil(v/32));return new P(S,h)}constructor(v,h){this._mask=0,this._buf=v,this._mask=h}_getIndex(v){return Math.floor(v/32)}has(v){const h=this._mask&v;return!!(this._buf[this._getIndex(h)]&1<<h%32)}hasRange(v,h){let S=v,M=h;for(;S%32&&S!==M;){if(this.has(S))return!0;S++}for(;M%32&&S!==M;){if(this.has(S))return!0;M--}if(S===M)return!1;for(let O=S/32;O!==M/32;O++)if(this._buf[O])return!0;return!1}set(v){const h=this._mask&v,S=this._getIndex(h);this._buf[S]|=1<<h%32}setRange(v,h){let S=v,M=h;for(;S%32&&S!==M;)this.set(S++);for(;M%32&&S!==M;)this.set(M--);if(S!==M)for(let O=S/32;O!==M/32;O++)this._buf[O]=4294967295}unset(v){const h=this._mask&v,S=this._getIndex(h);this._buf[S]&=4294967295^1<<h%32}resize(v){const h=this._buf,S=new Uint32Array(Math.ceil(v/32));S.set(h),this._buf=S}or(v){for(let h=0;h<this._buf.length;h++)this._buf[h]|=v._buf[h];return this}and(v){for(let h=0;h<this._buf.length;h++)this._buf[h]&=v._buf[h];return this}xor(v){for(let h=0;h<this._buf.length;h++)this._buf[h]^=v._buf[h];return this}ior(v){for(let h=0;h<this._buf.length;h++)this._buf[h]|=~v._buf[h];return this}iand(v){for(let h=0;h<this._buf.length;h++)this._buf[h]&=~v._buf[h];return this}ixor(v){for(let h=0;h<this._buf.length;h++)this._buf[h]^=~v._buf[h];return this}any(){for(let v=0;v<this._buf.length;v++)if(this._buf[v])return!0;return!1}copy(v){for(let h=0;h<this._buf.length;h++)this._buf[h]=v._buf[h];return this}clone(){return new P(this._buf.slice(),this._mask)}clear(){for(let v=0;v<this._buf.length;v++)this._buf[v]=0;return this}forEachSet(v){for(let h=0;h<this._buf.length;h++){let S=this._buf[h],M=32*h;if(S)for(;S;)1&S&&v(M),S>>>=1,M++}}countSet(){let v=0;return this.forEachSet(h=>{v++}),v}}},96845:(k,U,d)=>{d.d(U,{$:()=>O});var P=d(10467),L=d(5922),v=d(35150),h=d(63484);const S=()=>v.A.getLogger("esri.views.2d.layers.features.support.whereUtils"),M={getAttribute:(R,o)=>R.readAttribute(o)};function O(R,o){return F.apply(this,arguments)}function F(){return(F=(0,P.A)(function*(R,o){try{const I=yield(0,h.G)(R,o);if(!I.isStandardized){const C=new L.A("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",I);S().error(C)}return C=>{const z=C.readArcadeFeature();try{return I.testFeature(z,M)}catch{return S().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",R),!0}}}catch{return S().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",R),C=>!0}})).apply(this,arguments)}}}]);