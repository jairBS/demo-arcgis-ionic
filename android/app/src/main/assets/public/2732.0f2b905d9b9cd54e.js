"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2732],{53781:(he,N,c)=>{c.d(N,{a:()=>y,b:()=>Y,c:()=>p,e:()=>I,f:()=>m,g:()=>T,i:()=>ne,j:()=>U,l:()=>Z,n:()=>B,s:()=>w,t:()=>g});var h=c(85952);function p(r,a){return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r}function w(r,a,u,E,S){return r[0]=a,r[1]=u,r[2]=E,r[3]=S,r}function m(r,a,u){return r[0]=a[0]+u[0],r[1]=a[1]+u[1],r[2]=a[2]+u[2],r[3]=a[3]+u[3],r}function O(r,a,u){return r[0]=a[0]-u[0],r[1]=a[1]-u[1],r[2]=a[2]-u[2],r[3]=a[3]-u[3],r}function F(r,a,u){return r[0]=a[0]*u[0],r[1]=a[1]*u[1],r[2]=a[2]*u[2],r[3]=a[3]*u[3],r}function fe(r,a,u){return r[0]=a[0]/u[0],r[1]=a[1]/u[1],r[2]=a[2]/u[2],r[3]=a[3]/u[3],r}function Y(r,a,u){return r[0]=a[0]*u,r[1]=a[1]*u,r[2]=a[2]*u,r[3]=a[3]*u,r}function L(r,a){const u=a[0]-r[0],E=a[1]-r[1],S=a[2]-r[2],M=a[3]-r[3];return Math.sqrt(u*u+E*E+S*S+M*M)}function Q(r,a){const u=a[0]-r[0],E=a[1]-r[1],S=a[2]-r[2],M=a[3]-r[3];return u*u+E*E+S*S+M*M}function ne(r){const a=r[0],u=r[1],E=r[2],S=r[3];return Math.sqrt(a*a+u*u+E*E+S*S)}function U(r){const a=r[0],u=r[1],E=r[2],S=r[3];return a*a+u*u+E*E+S*S}function B(r,a){const u=a[0],E=a[1],S=a[2],M=a[3];let A=u*u+E*E+S*S+M*M;return A>0&&(A=1/Math.sqrt(A),r[0]=u*A,r[1]=E*A,r[2]=S*A,r[3]=M*A),r}function T(r,a){return r[0]*a[0]+r[1]*a[1]+r[2]*a[2]+r[3]*a[3]}function Z(r,a,u,E){const S=a[0],M=a[1],A=a[2],H=a[3];return r[0]=S+E*(u[0]-S),r[1]=M+E*(u[1]-M),r[2]=A+E*(u[2]-A),r[3]=H+E*(u[3]-H),r}function g(r,a,u){const E=a[0],S=a[1],M=a[2],A=a[3];return r[0]=u[0]*E+u[4]*S+u[8]*M+u[12]*A,r[1]=u[1]*E+u[5]*S+u[9]*M+u[13]*A,r[2]=u[2]*E+u[6]*S+u[10]*M+u[14]*A,r[3]=u[3]*E+u[7]*S+u[11]*M+u[15]*A,r}function y(r,a){return r[0]===a[0]&&r[1]===a[1]&&r[2]===a[2]&&r[3]===a[3]}function I(r,a){const u=r[0],E=r[1],S=r[2],M=r[3],A=a[0],H=a[1],K=a[2],$=a[3],X=(0,h.FD)();return Math.abs(u-A)<=X*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(E-H)<=X*Math.max(1,Math.abs(E),Math.abs(H))&&Math.abs(S-K)<=X*Math.max(1,Math.abs(S),Math.abs(K))&&Math.abs(M-$)<=X*Math.max(1,Math.abs(M),Math.abs($))}Object.freeze(Object.defineProperty({__proto__:null,add:m,ceil:function le(r,a){return r[0]=Math.ceil(a[0]),r[1]=Math.ceil(a[1]),r[2]=Math.ceil(a[2]),r[3]=Math.ceil(a[3]),r},copy:p,copyVec3:function R(r,a){return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},dist:L,distance:L,div:fe,divide:fe,dot:T,equals:I,exactEquals:y,floor:function se(r,a){return r[0]=Math.floor(a[0]),r[1]=Math.floor(a[1]),r[2]=Math.floor(a[2]),r[3]=Math.floor(a[3]),r},inverse:function z(r,a){return r[0]=1/a[0],r[1]=1/a[1],r[2]=1/a[2],r[3]=1/a[3],r},len:ne,length:ne,lerp:Z,max:function re(r,a,u){return r[0]=Math.max(a[0],u[0]),r[1]=Math.max(a[1],u[1]),r[2]=Math.max(a[2],u[2]),r[3]=Math.max(a[3],u[3]),r},min:function k(r,a,u){return r[0]=Math.min(a[0],u[0]),r[1]=Math.min(a[1],u[1]),r[2]=Math.min(a[2],u[2]),r[3]=Math.min(a[3],u[3]),r},mul:F,multiply:F,negate:function W(r,a){return r[0]=-a[0],r[1]=-a[1],r[2]=-a[2],r[3]=-a[3],r},normalize:B,random:function v(r,a){const u=h.Ov;let E,S,M,A,H,K;a=a||1;do{E=2*u()-1,S=2*u()-1,H=E*E+S*S}while(H>=1);do{M=2*u()-1,A=2*u()-1,K=M*M+A*A}while(K>=1);const $=Math.sqrt((1-H)/K);return r[0]=a*E,r[1]=a*S,r[2]=a*M*$,r[3]=a*A*$,r},round:function ie(r,a){return r[0]=Math.round(a[0]),r[1]=Math.round(a[1]),r[2]=Math.round(a[2]),r[3]=Math.round(a[3]),r},scale:Y,scaleAndAdd:function ee(r,a,u,E){return r[0]=a[0]+u[0]*E,r[1]=a[1]+u[1]*E,r[2]=a[2]+u[2]*E,r[3]=a[3]+u[3]*E,r},set:w,sqrDist:Q,sqrLen:U,squaredDistance:Q,squaredLength:U,str:function D(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},sub:O,subtract:O,transformMat4:g,transformQuat:function b(r,a,u){const E=a[0],S=a[1],M=a[2],A=u[0],H=u[1],K=u[2],$=u[3],X=$*E+H*M-K*S,Ee=$*S+K*E-A*M,te=$*M+A*S-H*E,Fe=-A*E-H*S-K*M;return r[0]=X*$+Fe*-A+Ee*-K-te*-H,r[1]=Ee*$+Fe*-H+te*-A-X*-K,r[2]=te*$+Fe*-K+X*-H-Ee*-A,r[3]=a[3],r}},Symbol.toStringTag,{value:"Module"}))},63583:(he,N,c)=>{var h,p;c.d(N,{u:()=>h}),(p=h||(h={}))[p.KILOBYTES=1024]="KILOBYTES",p[p.MEGABYTES=1048576]="MEGABYTES",p[p.GIGABYTES=1073741824]="GIGABYTES"},89141:(he,N,c)=>{function h(){return[0,0,0,0]}function R(U,W,z,B){return[U,W,z,B]}function F(){return R(1,1,1,1)}function fe(){return R(1,0,0,0)}function le(){return R(0,1,0,0)}function se(){return R(0,0,1,0)}function k(){return R(0,0,0,1)}c.d(N,{fA:()=>R,vt:()=>h});const ie=F(),Y=fe(),ee=le(),L=se(),Q=k();Object.freeze(Object.defineProperty({__proto__:null,ONES:ie,UNIT_W:Q,UNIT_X:Y,UNIT_Y:ee,UNIT_Z:L,ZEROS:[0,0,0,0],clone:function p(U){return[U[0],U[1],U[2],U[3]]},create:h,createView:function m(U,W){return new Float64Array(U,W,4)},fromArray:function w(U,W=[0,0,0,0]){const z=Math.min(4,U.length);for(let B=0;B<z;++B)W[B]=U[B];return W},fromValues:R,ones:F,unitW:k,unitX:fe,unitY:le,unitZ:se,zeros:function O(){return[0,0,0,0]}},Symbol.toStringTag,{value:"Module"}))},48716:(he,N,c)=>{c.d(N,{j:()=>R});var h=c(82663),p=c(47258);const R={unknown:1,inches:(0,h.oU)(1,"meters","inches"),feet:(0,h.oU)(1,"meters","feet"),"us-feet":(0,h.oU)(1,"meters","us-feet"),yards:(0,h.oU)(1,"meters","yards"),miles:(0,h.oU)(1,"meters","miles"),"nautical-miles":(0,h.oU)(1,"meters","nautical-miles"),millimeters:(0,h.oU)(1,"meters","millimeters"),centimeters:(0,h.oU)(1,"meters","centimeters"),decimeters:(0,h.oU)(1,"meters","decimeters"),meters:(0,h.oU)(1,"meters","meters"),kilometers:(0,h.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,h.vl)(1,"meters",p.$O.radius)}},1832:(he,N,c)=>{function h(p){const R={};for(const w in p){if("declaredClass"===w)continue;const m=p[w];if(null!=m&&"function"!=typeof m)if(Array.isArray(m)){R[w]=[];for(let O=0;O<m.length;O++)R[w][O]=h(m[O])}else"object"==typeof m?m.toJSON&&(R[w]=JSON.stringify(m)):R[w]=m}return R}c.d(N,{z:()=>h})},1277:(he,N,c)=>{c.d(N,{IJ:()=>ee,Jf:()=>W,Pk:()=>ne,eW:()=>ie,gW:()=>U,kS:()=>Q});var h=c(10467),p=c(89563),R=c(45272),w=c(61320),m=c(77098),O=c(58701),F=c(1832),fe=c(78304),le=c(98789);const se="Layer does not support extent calculation.";function re(v,g){var b;const D=v.geometry,y=v.toJSON();delete y.compactGeometryEnabled,delete y.defaultSpatialReferenceEnabled;const I=y;let ue,G,de;if(null!=D&&(G=D.spatialReference,de=(0,O.YX)(G),I.geometryType=(0,w.$B)(D),I.geometry=function k(v,g){if(g&&"extent"===v.type)return`${v.xmin},${v.ymin},${v.xmax},${v.ymax}`;if(g&&"point"===v.type)return`${v.x},${v.y}`;const b=v.toJSON();return delete b.spatialReference,JSON.stringify(b)}(D,v.compactGeometryEnabled),I.inSR=de),y.groupByFieldsForStatistics&&(I.groupByFieldsForStatistics=y.groupByFieldsForStatistics.join(",")),y.objectIds&&(I.objectIds=y.objectIds.join(",")),y.orderByFields&&(I.orderByFields=y.orderByFields.join(",")),!y.outFields||!y.returnDistinctValues&&(null!=g&&g.returnCountOnly||null!=g&&g.returnExtentOnly||null!=g&&g.returnIdsOnly)?delete I.outFields:I.outFields=y.outFields.includes("*")?"*":y.outFields.join(","),y.outSR?(I.outSR=(0,O.YX)(y.outSR),ue=v.outSpatialReference):D&&(y.returnGeometry||y.returnCentroid)&&(I.outSR=I.inSR,ue=G),y.returnGeometry&&delete y.returnGeometry,y.outStatistics&&(I.outStatistics=JSON.stringify(y.outStatistics)),y.fullText&&(I.fullText=JSON.stringify(y.fullText)),y.pixelSize&&(I.pixelSize=JSON.stringify(y.pixelSize)),y.quantizationParameters&&(v.defaultSpatialReferenceEnabled&&null!=G&&null!=(null===(b=v.quantizationParameters)||void 0===b?void 0:b.extent)&&G.equals(v.quantizationParameters.extent.spatialReference)&&delete y.quantizationParameters.extent.spatialReference,I.quantizationParameters=JSON.stringify(y.quantizationParameters)),y.parameterValues&&(I.parameterValues=JSON.stringify(y.parameterValues)),y.rangeValues&&(I.rangeValues=JSON.stringify(y.rangeValues)),y.dynamicDataSource&&(I.layer=JSON.stringify({source:y.dynamicDataSource}),delete y.dynamicDataSource),y.timeExtent){const ye=y.timeExtent,{start:ce,end:pe}=ye;null==ce&&null==pe||(I.time=ce===pe?ce:`${null!=ce?ce:"null"},${null!=pe?pe:"null"}`),delete y.timeExtent}return v.defaultSpatialReferenceEnabled&&null!=G&&null!=ue&&G.equals(ue)&&(I.defaultSR=I.inSR,delete I.inSR,delete I.outSR),I}function ie(v,g,b,D){return Y.apply(this,arguments)}function Y(){return(Y=(0,h.A)(function*(v,g,b,D){const y=null!=g.timeExtent&&g.timeExtent.isEmpty?{data:{features:[]}}:yield B(v,g,"json",D);return(0,le.q)(g,b,y.data),y})).apply(this,arguments)}function ee(v,g,b,D){return L.apply(this,arguments)}function L(){return(L=(0,h.A)(function*(v,g,b,D){if(null!=g.timeExtent&&g.timeExtent.isEmpty)return{data:b.createFeatureResult()};const y=yield Q(v,g,D),I=y;return I.data=(0,fe.m)(y.data,b),I})).apply(this,arguments)}function Q(v,g,b){return B(v,g,"pbf",b)}function ne(v,g,b){return null!=g.timeExtent&&g.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):B(v,g,"json",b,{returnIdsOnly:!0})}function U(v,g,b){return null!=g.timeExtent&&g.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):B(v,g,"json",b,{returnIdsOnly:!0,returnCountOnly:!0})}function W(v,g,b){return z.apply(this,arguments)}function z(){return(z=(0,h.A)(function*(v,g,b){if(null!=g.timeExtent&&g.timeExtent.isEmpty)return{data:{count:0,extent:null}};const D=yield B(v,g,"json",b,{returnExtentOnly:!0,returnCountOnly:!0}),y=D.data;if(y.hasOwnProperty("extent"))return D;if(y.features)throw new Error(se);if(y.hasOwnProperty("count"))throw new Error(se);return D})).apply(this,arguments)}function B(v,g,b){return T.apply(this,arguments)}function T(){return(T=(0,h.A)(function*(v,g,b,D={},y={}){const I="string"==typeof v?(0,R.An)(v):v,ue=g.geometry?[g.geometry]:[],G=yield(0,m.el)(ue,null,{signal:D.signal}),de=null==G?void 0:G[0];null!=de&&((g=g.clone()).geometry=de);const ye=(0,F.z)({...I.query,f:b,...y,...re(g,y)});return(0,p.A)((0,R.fj)(I.path,function Z(v,g){return null!=v.formatOf3DObjects&&!(g.returnCountOnly||g.returnExtentOnly||g.returnIdsOnly)}(g,y)?"query3d":"query"),{...D,responseType:"pbf"===b?"array-buffer":"json",query:{...ye,...D.query}})})).apply(this,arguments)}},98789:(he,N,c)=>{c.d(N,{q:()=>p});var h=c(23743);function p(R,w,m){if(null==m||!m.features||!m.hasZ)return;const O=(0,h.N)(m.geometryType,w,R.outSpatialReference);if(null!=O)for(const F of m.features)O(F.geometry)}},88485:(he,N,c)=>{c.d(N,{A:()=>B});var Y,h=c(8189),p=c(49976),R=c(71065),w=c(11432),m=c(85211),le=(c(3248),c(35150),c(40707),c(17221)),se=c(76576),k=c(50305),re=c(10467),ie=c(86300);let ee=Y=class extends R.oY{constructor(T){super(T)}collectRequiredFields(T,Z){var v=this;return(0,re.A)(function*(){return(0,ie.Dx)(T,Z,v.expression)})()}clone(){return new Y({expression:this.expression,title:this.title})}equals(T){return this.expression===T.expression&&this.title===T.title}};(0,h._)([(0,m.MZ)({type:String,json:{write:!0}})],ee.prototype,"expression",void 0),(0,h._)([(0,m.MZ)({type:String,json:{write:!0}})],ee.prototype,"title",void 0),ee=Y=(0,h._)([(0,se.$)("esri.layers.support.FeatureExpressionInfo")],ee);const L=ee;var ne,Q=c(82575);const U=(0,p.O)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),W=new p.J({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let z=ne=class extends R.oY{constructor(T){super(T),this.offset=null}readFeatureExpressionInfo(T,Z){return null!=T?T:Z.featureExpression&&0===Z.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(T,Z,v,g){Z[v]=T.write({},g),"0"===T.expression&&(Z.featureExpression={value:0})}get mode(){const{offset:T,featureExpressionInfo:Z}=this;return this._isOverridden("mode")?this._get("mode"):null!=T||Z?"relative-to-ground":"on-the-ground"}set mode(T){this._override("mode",T)}set unit(T){this._set("unit",T)}write(T,Z){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(T,Z):null}clone(){return new ne({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(T){return this.mode===T.mode&&this.offset===T.offset&&this.unit===T.unit&&(0,w.CM)(this.featureExpressionInfo,T.featureExpressionInfo)}};(0,h._)([(0,m.MZ)({type:L,json:{write:!0}})],z.prototype,"featureExpressionInfo",void 0),(0,h._)([(0,le.w)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],z.prototype,"readFeatureExpressionInfo",null),(0,h._)([(0,k.K)("featureExpressionInfo",{featureExpressionInfo:{type:L},"featureExpression.value":{type:[0]}})],z.prototype,"writeFeatureExpressionInfo",null),(0,h._)([(0,m.MZ)({type:U.apiValues,nonNullable:!0,json:{type:U.jsonValues,read:U.read,write:{writer:U.write,isRequired:!0}}})],z.prototype,"mode",null),(0,h._)([(0,m.MZ)({type:Number,json:{write:!0}})],z.prototype,"offset",void 0),(0,h._)([(0,m.MZ)({type:Q.KQ,json:{type:String,read:W.read,write:W.write}})],z.prototype,"unit",null),z=ne=(0,h._)([(0,se.$)("esri.layers.support.ElevationInfo")],z);const B=z},82575:(he,N,c)=>{c.d(N,{Ao:()=>R,KQ:()=>m});var h=c(48716);function R(O){return 1/(h.j[O]||1)}const m=function w(){const O=Object.keys(h.j);return O.sort(),O}()},26580:(he,N,c)=>{c.r(N),c.d(N,{default:()=>Qe});var h=c(10467),p=c(8189),w=(c(21152),c(42425)),m=c(56492),O=c(48900),F=c(85211),le=(c(3248),c(35150)),k=(c(40707),c(76576)),re=c(56985),ie=c(32034),Y=c(64373),ee=c(40753),L=c(11333),Q=c(87086),ne=c(88485),U=c(33087),W=c(60797),z=c(82663),B=c(82575);function T(e=!1,i){if(e){const{elevationInfo:n,alignPointsInFeatures:s}=i;return new g(n,s)}return new Z}class Z{alignCandidates(i,n,s){return(0,h.A)(function*(){return i})()}notifyElevationSourceChange(){}}class g{constructor(i,n){this._elevationInfo=i,this._alignPointsInFeatures=n,this._alignmentsCache=new U.q(1024),this._cacheVersion=0}alignCandidates(i,n,s){var o=this;return(0,h.A)(function*(){const l=o._elevationInfo;return null==l||"absolute-height"!==l.mode||l.featureExpressionInfo?o._alignComputedElevationCandidates(i,n,s):(o._alignAbsoluteElevationCandidates(i,n,l),i)})()}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(i,n,s){const{offset:o,unit:l}=s;if(null==o)return;const d=(0,z.G9)(n),f=o*((0,B.Ao)(null!=l?l:"meters")/d);for(const _ of i)switch(_.type){case"edge":_.start.z+=f,_.end.z+=f;continue;case"vertex":_.target.z+=f;continue}}_alignComputedElevationCandidates(i,n,s){var o=this;return(0,h.A)(function*(){const l=new Map;for(const J of i)(0,W.tE)(l,J.objectId,y).push(J);const[d,f,_]=o._prepareQuery(l,n),x=yield o._alignPointsInFeatures(d,s);if((0,m.Te)(s),_!==o._cacheVersion)return o._alignComputedElevationCandidates(i,n,s);o._applyCacheAndResponse(d,x,f);const{drapedObjectIds:P,failedObjectIds:q}=x,V=[];for(const J of i){const{objectId:ge}=J;P.has(ge)&&"edge"===J.type&&(J.draped=!0),q.has(ge)||V.push(J)}return V})()}_prepareQuery(i,n){const s=[],o=[];for(const[l,d]of i){const f=[];for(const _ of d)this._addToQueriesOrCachedResult(l,_.target,f,o),"edge"===_.type&&(this._addToQueriesOrCachedResult(l,_.start,f,o),this._addToQueriesOrCachedResult(l,_.end,f,o));0!==f.length&&s.push({objectId:l,points:f})}return[{spatialReference:n.toJSON(),pointsInFeatures:s},o,this._cacheVersion]}_addToQueriesOrCachedResult(i,n,s,o){const l=D(i,n),d=this._alignmentsCache.get(l);null==d?s.push(n):o.push(new b(n,d))}_applyCacheAndResponse(i,{elevations:n,drapedObjectIds:s,failedObjectIds:o},l){for(const _ of l)_.apply();let d=0;const f=this._alignmentsCache;for(const{objectId:_,points:x}of i.pointsInFeatures){if(o.has(_)){d+=x.length;continue}const P=!s.has(_);for(const q of x){const V=D(_,q),J=n[d++];q.z=J,P&&f.put(V,J,1)}}}}class b{constructor(i,n){this.point=i,this.z=n}apply(){this.point.z=this.z}}function D(e,{x:i,y:n,z:s,spatialReference:o}){return`${e}-${i}-${n}-${null!=s?s:0}}-wkid:${null==o?void 0:o.wkid}`}function y(){return[]}class I{filter(i,n){return n}notifyElevationSourceChange(){}}class ue{filter(i,n){const{point:s,distance:o}=i,{z:l}=s;if(null==l||0===n.length)return n;const d=function Ce(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(o),f=this._updateCandidatesTo3D(n,s,d).filter(G);return f.sort(Me),f}_updateCandidatesTo3D(i,n,s){for(const o of i)switch(o.type){case"edge":ye(o,n,s);continue;case"vertex":pe(o,n,s);continue}return i}}function G(e){return e.distance<=1}function de(e=!1){return e?new ue:new I}function ye(e,i,{x:n,y:s,z:o}){const{start:l,end:d,target:f}=e;e.draped||function ce(e,i,n,s){const o=s.x-n.x,l=s.y-n.y,d=s.z-n.z,x=Math.min(1,Math.max(0,((i.x-n.x)*o+(i.y-n.y)*l+d*(i.z-n.z))/(o*o+l*l+d*d))),q=n.y+l*x,V=n.z+d*x;e.x=n.x+o*x,e.y=q,e.z=V}(f,i,l,d);const _=(i.x-f.x)/n,x=(i.y-f.y)/s,P=(i.z-f.z)/o;e.distance=Math.sqrt(_*_+x*x+P*P)}function pe(e,i,{x:n,y:s,z:o}){const{target:l}=e,d=(i.x-l.x)/n,f=(i.y-l.y)/s,_=(i.z-l.z)/o,x=Math.sqrt(d*d+f*f+_*_);e.distance=x}function Me(e,i){return e.distance-i.distance}var r=c(77806),a=c(1119);function u(e=!1,i){return e?new M(i):new E}class E{fetch(){return(0,h.A)(function*(){return[]})()}notifySymbologyChange(){}}class M{constructor(i){this._getSymbologyCandidates=i,this._candidatesCache=new U.q(1024),this._cacheVersion=0}fetch(i,n){var s=this;return(0,h.A)(function*(){if(0===i.length)return[];const o=[],l=[],d=s._candidatesCache;for(const V of i){const J=A(V),ge=d.get(J);if(ge)for(const Se of ge)l.push((0,r.o8)(Se));else o.push(V),d.put(J,[],1)}if(0===o.length)return l;const f=s._cacheVersion,{candidates:_,sourceCandidateIndices:x}=yield s._getSymbologyCandidates(o,n);if((0,m.Te)(n),f!==s._cacheVersion)return s.fetch(i,n);const P=[],{length:q}=_;for(let V=0;V<q;++V){const J=_[V],ge=A(o[x[V]]),Se=d.get(ge);Se.push(J),d.put(ge,Se,Se.length),P.push((0,r.o8)(J))}return l.concat(P)})()}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function A(e){switch(e.type){case"vertex":{var i;const{objectId:o,target:l}=e,d=`${o}-vertex-${l.x}-${l.y}-${null!==(i=l.z)&&void 0!==i?i:0}`;return(0,a.Wm)(d).toString()}case"edge":{var n,s;const{objectId:o,start:l,end:d}=e,f=`${o}-edge-${l.x}-${l.y}-${null!==(n=l.z)&&void 0!==n?n:0}-to-${d.x}-${d.y}-${null!==(s=d.z)&&void 0!==s?s:0}`;return(0,a.Wm)(f).toString()}default:return""}}var H=c(98877),K=c(89952);let $=class extends H.A{constructor(){super(...arguments),this.updating=!1,this._pending=[]}push(e,i){this._pending.push({promise:e,callback:i}),1===this._pending.length&&this._process()}_process(){if(!this._pending.length)return void(this.updating=!1);this.updating=!0;const e=this._pending[0];e.promise.then(i=>e.callback(i)).catch(()=>{}).then(()=>{this._pending.shift(),this._process()})}};(0,p._)([(0,F.MZ)()],$.prototype,"updating",void 0),$=(0,p._)([(0,k.$)("esri.core.AsyncSequence")],$);var C,e,X=c(89447),Ee=c(17715),te=c(17435),Fe=c(28067),oe=c(51995),xe=c(31732),Pe=c(68438),Ue=c(42122),Te=c(1277);class De{constructor(i,n){this.data=i,this.resolution=n,this.state={type:C.CREATED},this.alive=!0}process(i){switch(this.state.type){case C.CREATED:return this.state=this._gotoFetchCount(this.state,i),this.state.task.promise.then(i.resume,i.resume);case C.FETCH_COUNT:break;case C.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,i),this.state.task.promise.then(i.resume,i.resume);case C.FETCH_FEATURES:break;case C.FETCHED_FEATURES:this.state=this._goToDone(this.state,i)}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case C.CREATED:case C.FETCH_COUNT:return 0;case C.FETCHED_COUNT:return this.state.featureCount;case C.FETCH_FEATURES:return this.state.previous.featureCount;case C.FETCHED_FEATURES:return this.state.features.length;case C.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case C.CREATED:return"created";case C.FETCH_COUNT:return"fetch-count";case C.FETCHED_COUNT:return"fetched-count";case C.FETCH_FEATURES:return"fetch-features";case C.FETCHED_FEATURES:return"fetched-features";case C.DONE:return"done"}}_gotoFetchCount(i,n){var s=this;return{type:C.FETCH_COUNT,previous:i,task:(0,X.UT)(function(){var o=(0,h.A)(function*(l){const d=yield(0,X.DZ)(n.fetchCount(s,l));s.state.type===C.FETCH_COUNT&&(s.state=s._gotoFetchedCount(s.state,d.ok?d.value:1/0))});return function(l){return o.apply(this,arguments)}}())}}_gotoFetchedCount(i,n){return{type:C.FETCHED_COUNT,featureCount:n,previous:i}}_gotoFetchFeatures(i,n){var s=this;return{type:C.FETCH_FEATURES,previous:i,task:(0,X.UT)(function(){var o=(0,h.A)(function*(l){const d=yield(0,X.DZ)(n.fetchFeatures(s,i.featureCount,l));s.state.type===C.FETCH_FEATURES&&(s.state=s._gotoFetchedFeatures(s.state,d.ok?d.value:[]))});return function(l){return o.apply(this,arguments)}}())}}_gotoFetchedFeatures(i,n){return{type:C.FETCHED_FEATURES,previous:i,features:n}}_goToDone(i,n){return n.finish(this,i.features),{type:C.DONE,previous:i}}reset(){const i=this.state;switch(this.state={type:C.CREATED},i.type){case C.CREATED:case C.FETCHED_COUNT:case C.FETCHED_FEATURES:case C.DONE:break;case C.FETCH_COUNT:case C.FETCH_FEATURES:i.task.abort()}}intersects(i){return null==i||!this.data.extent||((0,oe.VY)(i,be),(0,oe.HY)(this.data.extent,be))}}(e=C||(C={}))[e.CREATED=0]="CREATED",e[e.FETCH_COUNT=1]="FETCH_COUNT",e[e.FETCHED_COUNT=2]="FETCHED_COUNT",e[e.FETCH_FEATURES=3]="FETCH_FEATURES",e[e.FETCHED_FEATURES=4]="FETCHED_FEATURES",e[e.DONE=5]="DONE";const be=(0,oe.vt)();let j=class extends H.A{get _minimumVerticesPerFeature(){var e;switch(null===(e=this.store)||void 0===e?void 0:e.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}get _mandatoryOutFields(){const e=new Set;return this.objectIdField&&e.add(this.objectIdField),this.globalIdField&&e.add(this.globalIdField),e}set outFields(e){const i=this._get("outFields"),n=(0,te.KC)(e,this._mandatoryOutFields);(0,te.aI)(n,i)||(this._set("outFields",n),(0,te.Yy)(n,i)||this.refresh())}get outFields(){var e;return null!==(e=this._get("outFields"))&&void 0!==e?e:this._mandatoryOutFields}set filter(e){const i=this._get("filter"),n=this._filterProperties(e);JSON.stringify(i)!==JSON.stringify(n)&&this._set("filter",n)}set customParameters(e){const i=this._get("customParameters");JSON.stringify(i)!==JSON.stringify(e)&&this._set("customParameters",e)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const i=this._get("tileInfo");i!==e&&(null!=e&&null!=i&&JSON.stringify(e)===JSON.stringify(i)||(this._set("tileInfo",e),this.store.tileInfo=e))}set tileSize(e){this._get("tileSize")!==e&&this._set("tileSize",e)}get updating(){return this.updatingExcludingEdits||this._pendingEdits.updating}get updatingExcludingEdits(){return this._updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(e){super(e),this.suspended=!0,this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._updatingHandles=new re.U,this._pendingEdits=new $,this._pendingEditsAbortController=new AbortController}initialize(){this._initializeFetchExtent(),this._updatingHandles.add(()=>this._configuration,()=>this.refresh()),this._updatingHandles.add(()=>this.tilesOfInterest,(e,i)=>{(0,K.aI)(e,i,({id:n},{id:s})=>n===s)||this._process()},O.OH),this.addHandles((0,O.z7)(()=>!this.suspended,()=>this._process()))}destroy(){this._pendingTiles.forEach(e=>this._deletePendingTile(e)),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._pendingEditsAbortController.abort(),this._pendingEditsAbortController=null,this._updatingHandles.destroy()}refresh(){this.store.refresh(),this._pendingTiles.forEach(e=>this._deletePendingTile(e)),this._process()}applyEdits(e){var i=this;this._pendingEdits.push(e,function(){var n=(0,h.A)(function*(s){if(0===s.addedFeatures.length&&0===s.updatedFeatures.length&&0===s.deletedFeatures.length)return;for(const[,l]of i._pendingTiles)l.reset();const o={...s,deletedFeatures:s.deletedFeatures.map(({objectId:l,globalId:d})=>l&&-1!==l?l:i._lookupObjectIdByGlobalId(d))};yield i._updatingHandles.addPromise(i.store.processEdits(o,(l,d)=>i._queryFeaturesById(l,d),i._pendingEditsAbortController.signal)),i._processPendingTiles()});return function(s){return n.apply(this,arguments)}}())}_initializeFetchExtent(){var e=this;if(!this.capabilities.query.supportsExtent||!(0,Pe.Wo)(this.url))return;const i=(0,X.UT)(function(){var n=(0,h.A)(function*(s){try{var o,l;const d=yield(0,Te.Jf)(e.url,new Q.A({where:"1=1",outSpatialReference:e.spatialReference,cacheHint:null!==(o=e.capabilities.query.supportsCacheHint)&&void 0!==o?o:void 0}),{query:e._configuration.customParameters,signal:s});e.store.extent=Fe.A.fromJSON(null===(l=d.data)||void 0===l?void 0:l.extent)}catch(d){(0,m.QP)(d),le.A.getLogger(e).warn("Failed to fetch data extent",d)}});return function(s){return n.apply(this,arguments)}}());this._updatingHandles.addPromise(i.promise.then(()=>this._process())),this.addHandles((0,Ee.hA)(()=>i.abort()))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map(e=>e.debugInfo),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,e]of this._pendingTiles)e.alive=!1}_createPendingTiles(){if(this.suspended)return;const e=this._collectMissingTilesInfo();if(this._setAvailability(null==e?1:e.coveredArea/e.fullArea),null!=e)for(const{data:i,resolution:n}of e.missingTiles){const s=this._pendingTiles.get(i.id);s?(s.resolution=n,s.alive=!0):this._createPendingTile(i,n)}}_collectMissingTilesInfo(){let e=null;for(let i=this.tilesOfInterest.length-1;i>=0;i--){const s=this.store.process(this.tilesOfInterest[i],(o,l)=>this._verifyTileComplexity(o,l),this.outFields);null==e?e=s:e.prepend(s)}return e}_deletePendingTiles(){for(const[,e]of this._pendingTiles)e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(i,n)=>this._fetchCount(i,n),fetchFeatures:(i,n,s)=>this._fetchFeatures(i,n,s),finish:(i,n)=>this._finishPendingTile(i,n),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const[,i]of this._pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(i.data),i.resolution)&&this._updatingHandles.addPromise(i.process(e))}_verifyTileComplexity(e,i){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,i)}_verifyVertexComplexity(e){return e*this._minimumVerticesPerFeature<we}_verifyFeatureDensity(e,i){if(null==this.tileInfo)return!1;const n=this.tileSize*i;return e*(ze/(n*n))<Ne}_ensureFetchAllCounts(e){let i=!0;for(const[,n]of this._pendingTiles)n.state.type<C.FETCHED_COUNT&&this._updatingHandles.addPromise(n.process(e)),n.state.type<=C.FETCH_COUNT&&(i=!1);return i}_finishPendingTile(e,i){this.store.add(e.data,i),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(null==e?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set("availability",e)}_createPendingTile(e,i){const n=new De(e,i);return this._pendingTiles.set(e.id,n),n}_deletePendingTile(e){e.reset(),this._pendingTiles.delete(e.data.id)}_fetchCount(e,i){var n=this;return(0,h.A)(function*(){return n.store.fetchCount(e.data,n.url,n._createCountQuery(e),{query:n.customParameters,timeout:Ie,signal:i})})()}_fetchFeatures(e,i,n){var s=this;return(0,h.A)(function*(){let o=0;const l=[];let d=0,f=i;for(;;){const _=s._createFeaturesQuery(e),x=s._setPagingParameters(_,o,f),{features:P,exceededTransferLimit:q}=yield s._queryFeatures(_,n);x&&(o+=_.num),d+=P.length;for(const V of P)l.push(V);if(f=i-d,!x||!q||f<=0)return l}})()}_filterProperties(e){return null==e?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||"1=1",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const i=this.globalIdField,n=this.objectIdField;if(null==i)throw new Error("Expected globalIdField to be defined");let s=null;if(this.store.featureStore.forEach(o=>{var l;e===o.attributes[i]&&(s=null!==(l=o.objectId)&&void 0!==l?l:o.attributes[n])}),null==s)throw new Error(`Expected to find a feature with globalId ${e}`);return s}_queryFeaturesById(e,i){const n=this._createFeaturesQuery();return n.objectIds=e,this._queryFeatures(n,i)}_queryFeatures(e,i){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,i):this._queryFeaturesJSON(e,i)}_queryFeaturesPBF(e,i){var n=this;return(0,h.A)(function*(){const{sourceSpatialReference:s}=n,{data:o}=yield(0,Te.IJ)(n.url,e,new Ue.S({sourceSpatialReference:s}),{query:n._configuration.customParameters,timeout:Ie,signal:i});return(0,xe.eY)(o)})()}_queryFeaturesJSON(e,i){var n=this;return(0,h.A)(function*(){const{sourceSpatialReference:s}=n,{data:o}=yield(0,Te.eW)(n.url,e,s,{query:n._configuration.customParameters,timeout:Ie,signal:i});return(0,xe.q3)(o,n.objectIdField)})()}_createCountQuery(e){const i=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(i.cacheHint=!0),i}_createFeaturesQuery(e=null){var i;const n=this._createBaseQuery(e),s=null!=(null==e?void 0:e.data)?this.store.getAttributesForTile(null==e||null===(i=e.data)||void 0===i?void 0:i.id):null,o=(0,te.KC)((0,te.iv)(this.outFields,null!=s?s:new Set),this._mandatoryOutFields);return n.outFields=Array.from(o),n.returnGeometry=!0,null!=e&&(this.capabilities.query.supportsResultType?n.resultType="tile":this.capabilities.query.supportsCacheHint&&(n.cacheHint=!0)),n}_createBaseQuery(e){const i=new Q.A({returnZ:this.hasZ,returnM:!1,geometry:null!=this.tileInfo&&null!=e?(0,oe.w1)(e.data.extent,this.tileInfo.spatialReference):void 0}),n=this._configuration.filter;return null!=n&&(i.where=n.where,i.gdbVersion=n.gdbVersion,i.timeExtent=n.timeExtent),i.outSpatialReference=this.spatialReference,i}_setPagingParameters(e,i,n){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:o,tileMaxRecordCount:l,maxRecordCount:d,supportsResultType:f}=this.capabilities.query,_=s?Q.A.MAX_MAX_RECORD_COUNT_FACTOR:1,x=_*((f||o)&&l?l:d||je);return e.start=i,s?(e.maxRecordCountFactor=Math.min(_,Math.ceil(n/x)),e.num=Math.min(n,e.maxRecordCountFactor*x)):e.num=Math.min(n,x),!0}};(0,p._)([(0,F.MZ)({constructOnly:!0})],j.prototype,"url",void 0),(0,p._)([(0,F.MZ)({constructOnly:!0})],j.prototype,"objectIdField",void 0),(0,p._)([(0,F.MZ)({constructOnly:!0})],j.prototype,"globalIdField",void 0),(0,p._)([(0,F.MZ)({constructOnly:!0})],j.prototype,"capabilities",void 0),(0,p._)([(0,F.MZ)({constructOnly:!0})],j.prototype,"sourceSpatialReference",void 0),(0,p._)([(0,F.MZ)({constructOnly:!0})],j.prototype,"spatialReference",void 0),(0,p._)([(0,F.MZ)({constructOnly:!0})],j.prototype,"store",void 0),(0,p._)([(0,F.MZ)({readOnly:!0})],j.prototype,"_minimumVerticesPerFeature",null),(0,p._)([(0,F.MZ)()],j.prototype,"_mandatoryOutFields",null),(0,p._)([(0,F.MZ)()],j.prototype,"outFields",null),(0,p._)([(0,F.MZ)()],j.prototype,"suspended",void 0),(0,p._)([(0,F.MZ)()],j.prototype,"filter",null),(0,p._)([(0,F.MZ)()],j.prototype,"customParameters",null),(0,p._)([(0,F.MZ)({readOnly:!0})],j.prototype,"_configuration",null),(0,p._)([(0,F.MZ)()],j.prototype,"tileInfo",null),(0,p._)([(0,F.MZ)()],j.prototype,"tileSize",null),(0,p._)([(0,F.MZ)()],j.prototype,"tilesOfInterest",void 0),(0,p._)([(0,F.MZ)({readOnly:!0})],j.prototype,"updating",null),(0,p._)([(0,F.MZ)({readOnly:!0})],j.prototype,"updatingExcludingEdits",null),(0,p._)([(0,F.MZ)({readOnly:!0})],j.prototype,"availability",void 0),(0,p._)([(0,F.MZ)()],j.prototype,"hasZ",null),j=(0,p._)([(0,k.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],j);const je=2e3,Ie=6e5,we=1e6,ze=25,Ne=1;var Ae=c(4277),He=c(63583),Be=c(59894),Ze=c(25858);class $e{constructor(){this._store=new Map,this._byteSize=0}set(i,n){this.delete(i),this._store.set(i,n),this._byteSize+=n.byteSize}delete(i){const n=this._store.get(i);return!!this._store.delete(i)&&(null!=n&&(this._byteSize-=n.byteSize),!0)}get(i){return this._used(i),this._store.get(i)}has(i){return this._used(i),this._store.has(i)}clear(){this._store.clear()}applyByteSizeLimit(i,n){for(const[s,o]of this._store){if(this._byteSize<=i)break;this.delete(s),n(o)}}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}_used(i){const n=this._store.get(i);n&&(this._store.delete(i),this._store.set(i,n))}}let _e=class extends H.A{constructor(e){super(e),this.tileInfo=null,this.extent=null,this.maximumByteSize=10*He.u.MEGABYTES,this._tileBounds=new Be.F,this._tiles=new $e,this._refCounts=new Map,this._tileFeatureCounts=new Map,this._tmpBoundingRect=(0,oe.vt)()}add(e,i){var n,s;for(const d of i)this._referenceFeature(d.objectId);const o=this.featureStore.upsertMany(i),l=o.map(d=>new Set(Object.keys(d.attributes))).reduce((d,f)=>(0,te.E$)(d,f),new Set(Object.keys(null!==(n=null===(s=o[0])||void 0===s?void 0:s.attributes)&&void 0!==n?n:[])));this._addTileStorage(e,new Set(o.map(d=>d.objectId)),function Le(e){return e.reduce((i,n)=>i+function Ve(e){return 32+function Je(e){if(null==e)return 0;const i=(0,Ae.zd)(e.lengths,4);return 32+(0,Ae.zd)(e.coords,8)+i}(e.geometry)+(0,Ae.eY)(e.attributes)}(n),0)}(o),l),this._tiles.applyByteSizeLimit(this.maximumByteSize,d=>this._removeTileStorage(d))}getAttributesForTile(e){var i;return e?null===(i=this._tiles.get(e))||void 0===i?void 0:i.attributeKeys:null}destroy(){this.clear(),this._tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this._tileBounds.clear(),this._tiles.clear(),this._refCounts.clear()}refresh(){this.clear(),this._tileFeatureCounts.clear()}processEdits(e,i,n){return this._processEditsDelete(e.deletedFeatures.concat(e.updatedFeatures)),this._processEditsRefetch(e.addedFeatures.concat(e.updatedFeatures),i,n)}_addTileStorage(e,i,n,s){const o=e.id;this._tiles.set(o,new We(e,i,n,s)),this._tileBounds.set(o,e.extent),this._tileFeatureCounts.set(o,i.size)}_remove({id:e}){const i=this._tiles.get(e);i&&this._removeTileStorage(i)}_removeTileStorage(e){const i=[];for(const s of e.objectIds)this._unreferenceFeature(s)===me.REMOVED&&i.push(s);this.featureStore.removeManyById(i);const n=e.data.id;this._tiles.delete(n),this._tileBounds.delete(n)}_processEditsDelete(e){this.featureStore.removeManyById(e);for(const[,i]of this._tiles){for(const n of e)i.objectIds.delete(n);this._tileFeatureCounts.set(i.data.id,i.objectIds.size)}for(const i of e)this._refCounts.delete(i)}_processEditsRefetch(e,i,n){var s=this;return(0,h.A)(function*(){const o=(yield i(e,n)).features,{hasZ:l,hasM:d}=s.featureStore;for(const f of o){const _=(0,xe.jQ)(s._tmpBoundingRect,f.geometry,l,d);null!=_&&s._tileBounds.forEachInBounds(_,x=>{const P=s._tiles.get(x);s.featureStore.add(f);const q=f.objectId;P.objectIds.has(q)||(P.objectIds.add(q),s._referenceFeature(q),s._tileFeatureCounts.set(P.data.id,P.objectIds.size))})}})()}process(e,i=(()=>!0),n){if(null==this.tileInfo||!e.extent||null!=this.extent&&!(0,oe.HY)((0,oe.VY)(this.extent,this._tmpBoundingRect),e.extent))return new Oe(e);const s=this.getAttributesForTile(e.id);if((0,te.Yy)(n,s))return new Oe(e);const o=this._createTileTree(e,this.tileInfo);return this._simplify(o,i,null,0,1),this._collectMissingTiles(e,o,this.tileInfo,n)}get debugInfo(){return Array.from(this._tiles.values()).map(({data:e})=>({data:e,featureCount:this._tileFeatureCounts.get(e.id)||0}))}getFeatureCount(e){var i;return null!==(i=this._tileFeatureCounts.get(e.id))&&void 0!==i?i:0}fetchCount(e,i,n,s){var o=this;return(0,h.A)(function*(){const l=o._tileFeatureCounts.get(e.id);if(null!=l)return l;const d=yield(0,Te.gW)(i,n,s);return o._tileFeatureCounts.set(e.id,d.data.count),d.data.count})()}_createTileTree(e,i){const n=new Re(e.level,e.row,e.col);return i.updateTileInfo(n,L.A.ExtrapolateOptions.POWER_OF_TWO),this._tileBounds.forEachInBounds(e.extent,s=>{var o;const l=null===(o=this._tiles.get(s))||void 0===o?void 0:o.data;l&&this._tilesAreRelated(e,l)&&this._populateChildren(n,l,i,this._tileFeatureCounts.get(l.id)||0)}),n}_tilesAreRelated(e,i){if(!e||!i)return!1;if(e.level===i.level)return e.row===i.row&&e.col===i.col;const n=e.level<i.level,s=n?e:i,o=n?i:e,l=1<<o.level-s.level;return Math.floor(o.row/l)===s.row&&Math.floor(o.col/l)===s.col}_populateChildren(e,i,n,s){const o=i.level-e.level-1;if(o<0)return void(e.isLeaf=!0);const l=i.row>>o,d=i.col>>o,_=d-(e.col<<1)+(l-(e.row<<1)<<1),x=e.children[_];if(null!=x)this._populateChildren(x,i,n,s);else{const P=new Re(e.level+1,l,d);n.updateTileInfo(P,L.A.ExtrapolateOptions.POWER_OF_TWO),e.children[_]=P,this._populateChildren(P,i,n,s)}}_simplify(e,i,n,s,o){const l=o*o;if(e.isLeaf)return i(this.getFeatureCount(e),o)?0:(this._remove(e),null!=n&&(n.children[s]=null),l);const d=o/2,f=d*d;let _=0;for(let x=0;x<e.children.length;x++){const P=e.children[x];_+=null!=P?this._simplify(P,i,e,x,d):f}return 0===_?this._mergeChildren(e):1-_/l<Ke&&(this._purge(e),null!=n&&(n.children[s]=null),_=l),_}_mergeChildren(e){var i;const n=new Set;let s,o=0;this._forEachLeaf(e,l=>{const d=this._tiles.get(l.id);if(d){s=s?(0,te.E$)(s,d.attributeKeys):new Set(d.attributeKeys),o+=d.byteSize;for(const f of d.objectIds)n.has(f)||(n.add(f),this._referenceFeature(f));this._remove(l)}}),this._addTileStorage(e,n,o,null!==(i=s)&&void 0!==i?i:new Set),e.isLeaf=!0,e.children[0]=e.children[1]=e.children[2]=e.children[3]=null,this._tileFeatureCounts.set(e.id,n.size)}_forEachLeaf(e,i){for(const n of e.children)null!=n&&(n.isLeaf?i(n):this._forEachLeaf(n,i))}_purge(e){if(null!=e)if(e.isLeaf)this._remove(e);else for(let i=0;i<e.children.length;i++)this._purge(e.children[i]),e.children[i]=null}_collectMissingTiles(e,i,n,s){const o=new Ge(n,e,this.extent);return this._collectMissingTilesRecurse(i,o,1,s),o.info}_collectMissingTilesRecurse(e,i,n,s){const o=this.getAttributesForTile(e.id),l=o&&!(0,te.Yy)(s,o);if(l&&i.addMissing(e.level,e.row,e.col,n),e.isLeaf)return;if(!e.hasChildren)return void(l||i.addMissing(e.level,e.row,e.col,n));const d=n/2;for(let f=0;f<e.children.length;f++){const _=e.children[f];null==_?i.addMissing(e.level+1,(e.row<<1)+((2&f)>>1),(e.col<<1)+(1&f),d):this._collectMissingTilesRecurse(_,i,d,s)}}_referenceFeature(e){const i=(this._refCounts.get(e)||0)+1;return this._refCounts.set(e,i),1===i?me.ADDED:me.UNCHANGED}_unreferenceFeature(e){const i=(this._refCounts.get(e)||0)-1;return 0===i?(this._refCounts.delete(e),me.REMOVED):(i>0&&this._refCounts.set(e,i),me.UNCHANGED)}get test(){return{tiles:Array.from(this._tiles.values()).map(e=>`${e.data.id}:[${Array.from(e.objectIds)}]`),featureReferences:Array.from(this._refCounts.keys()).map(e=>`${e}:${this._refCounts.get(e)}`)}}};(0,p._)([(0,F.MZ)({constructOnly:!0})],_e.prototype,"featureStore",void 0),(0,p._)([(0,F.MZ)()],_e.prototype,"tileInfo",void 0),(0,p._)([(0,F.MZ)()],_e.prototype,"extent",void 0),(0,p._)([(0,F.MZ)()],_e.prototype,"maximumByteSize",void 0),_e=(0,p._)([(0,k.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],_e);class We{constructor(i,n,s,o){this.data=i,this.objectIds=n,this.byteSize=s,this.attributeKeys=o}}class Re{constructor(i,n,s){this.level=i,this.row=n,this.col=s,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&(null!=this.children[0]||null!=this.children[1]||null!=this.children[2]||null!=this.children[3])}}class Oe{constructor(i,n=[]){this.missingTiles=n,this.fullArea=0,this.coveredArea=0,this.fullArea=(0,oe.Wc)(i.extent),this.coveredArea=this.fullArea}prepend(i){this.missingTiles=i.missingTiles.concat(this.missingTiles),this.coveredArea+=i.coveredArea,this.fullArea+=i.fullArea}}class Ge{constructor(i,n,s){this._tileInfo=i,this._extent=null,this.info=new Oe(n),null!=s&&(this._extent=(0,oe.VY)(s))}addMissing(i,n,s,o){const l=new Ze.U(null,i,n,s);this._tileInfo.updateTileInfo(l,L.A.ExtrapolateOptions.POWER_OF_TWO),null==l.extent||null!=this._extent&&!(0,oe.HY)(this._extent,l.extent)||(this.info.missingTiles.push({data:l,resolution:o}),this.info.coveredArea-=(0,oe.Wc)(l.extent))}}const Ke=.18751;var me;!function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.UNCHANGED=2]="UNCHANGED"}(me||(me={}));var Ye=c(61320);let ve=class extends w.A.EventedAccessor{constructor(){var e;super(...arguments),e=this,this._isInitializing=!0,this.remoteClient=null,this._whenSetup=(0,m.Tw)(),this._elevationAligner=T(),this._elevationFilter=de(),this._symbologyCandidatesFetcher=u(),this._updatingHandles=new re.U,this._editsUpdatingHandles=new re.U,this._pendingApplyEdits=new Map,this._alignPointsInFeatures=function(){var i=(0,h.A)(function*(n,s){const o={query:n},l=yield e.remoteClient.invoke("alignElevation",o,{signal:s});return(0,m.Te)(s),l});return function(n,s){return i.apply(this,arguments)}}(),this._getSymbologyCandidates=function(){var i=(0,h.A)(function*(n,s){const o={candidates:n,spatialReference:e._spatialReference.toJSON()},l=yield e.remoteClient.invoke("getSymbologyCandidates",o,{signal:s});return(0,m.Te)(s),l});return function(n,s){return i.apply(this,arguments)}}()}get updating(){return this.updatingExcludingEdits||this._editsUpdatingHandles.updating||this._featureFetcher.updating}get updatingExcludingEdits(){return this._featureFetcher.updatingExcludingEdits||this._isInitializing||this._updatingHandles.updating}destroy(){var e,i,n;null!==(e=this._featureFetcher)&&void 0!==e&&e.destroy(),null!==(i=this._queryEngine)&&void 0!==i&&i.destroy(),null===(n=this._featureStore)||void 0===n||n.clear()}setup(e){var i=this;return(0,h.A)(function*(){if(i.destroyed)return{result:{}};const{geometryType:n,objectIdField:s,timeInfo:o,fieldsIndex:l}=e.serviceInfo,{hasZ:d}=e,f=ie.A.fromJSON(e.spatialReference);i._spatialReference=f,i._featureStore=new Y.A({...e.serviceInfo,hasZ:d,hasM:!1}),i._queryEngine=new ee.d({spatialReference:e.spatialReference,featureStore:i._featureStore,geometryType:n,fieldsIndex:l,hasZ:d,hasM:!1,objectIdField:s,timeInfo:o}),i._featureFetcher=new j({store:new _e({featureStore:i._featureStore}),url:e.serviceInfo.url,objectIdField:e.serviceInfo.objectIdField,globalIdField:e.serviceInfo.globalIdField,capabilities:e.serviceInfo.capabilities,spatialReference:f,sourceSpatialReference:ie.A.fromJSON(e.serviceInfo.spatialReference),customParameters:e.configuration.customParameters});const _="3d"===e.configuration.viewType;return i._elevationAligner=T(_,{elevationInfo:null!=e.elevationInfo?ne.A.fromJSON(e.elevationInfo):null,alignPointsInFeatures:i._alignPointsInFeatures}),i._elevationFilter=de(_),i.addHandles([(0,O.wB)(()=>i._featureFetcher.availability,x=>i.emit("notify-availability",{availability:x}),O.OH),(0,O.wB)(()=>i.updating,()=>i._notifyUpdating())]),i._whenSetup.resolve(),i._isInitializing=!1,i.configure(e.configuration)})()}configure(e){var i=this;return(0,h.A)(function*(){return yield i._updatingHandles.addPromise(i._whenSetup.promise),i._updateFeatureFetcherConfiguration(e),ae})()}setSuspended(e,i){var n=this;return(0,h.A)(function*(){return yield n._updatingHandles.addPromise(n._whenSetup.promise),(0,m.Te)(i),n._featureFetcher.suspended=e,ae})()}updateOutFields(e,i){var n=this;return(0,h.A)(function*(){return yield n._updatingHandles.addPromise(n._whenSetup.promise),(0,m.Te)(i),n._featureFetcher.outFields=new Set(null!=e?e:[]),ae})()}fetchCandidates(e,i){var n=this;return(0,h.A)(function*(){var s;yield n._whenSetup.promise,(0,m.Te)(i);const o=function Xe(e){if(!e.filter)return{...e,query:{where:"1=1"}};const{distance:i,units:n,spatialRel:s,where:o,timeExtent:l,objectIds:d}=e.filter,f={geometry:e.filter.geometry?(0,Ye.rS)(e.filter.geometry):void 0,distance:i,units:n,spatialRel:s,timeExtent:l,objectIds:d,where:null!=o?o:"1=1"};return{...e,query:f}}(e),l=null==i?void 0:i.signal,d=yield n._queryEngine.executeQueryForSnapping(o,l);(0,m.Te)(l);const f=yield n._elevationAligner.alignCandidates(d.candidates,null!==(s=ie.A.fromJSON(e.point.spatialReference))&&void 0!==s?s:ie.A.WGS84,l);(0,m.Te)(l);const _=yield n._symbologyCandidatesFetcher.fetch(f,l);(0,m.Te)(l);const x=0===_.length?f:f.concat(_);return{result:{candidates:n._elevationFilter.filter(o,x)}}})()}updateTiles(e,i){var n=this;return(0,h.A)(function*(){return yield n._updatingHandles.addPromise(n._whenSetup.promise),(0,m.Te)(i),n._featureFetcher.tileSize=e.tileSize,n._featureFetcher.tilesOfInterest=e.tiles,n._featureFetcher.tileInfo=null!=e.tileInfo?L.A.fromJSON(e.tileInfo):null,ae})()}refresh(e,i){var n=this;return(0,h.A)(function*(){return yield n._updatingHandles.addPromise(n._whenSetup.promise),(0,m.Te)(i),n._featureFetcher.refresh(),ae})()}whenNotUpdating(e,i){var n=this;return(0,h.A)(function*(){return yield n._updatingHandles.addPromise(n._whenSetup.promise),(0,m.Te)(i),yield(0,O.C_)(()=>!n.updatingExcludingEdits,i),(0,m.Te)(i),ae})()}getDebugInfo(e,i){var n=this;return(0,h.A)(function*(){return(0,m.Te)(i),{result:n._featureFetcher.debugInfo}})()}beginApplyEdits(e,i){var n=this;return(0,h.A)(function*(){n._updatingHandles.addPromise(n._whenSetup.promise),(0,m.Te)(i);const s=(0,m.Tw)();return n._pendingApplyEdits.set(e.id,s),n._featureFetcher.applyEdits(s.promise),n._editsUpdatingHandles.addPromise(s.promise),ae})()}endApplyEdits(e,i){var n=this;return(0,h.A)(function*(){const s=n._pendingApplyEdits.get(e.id);return s&&s.resolve(e.edits),(0,m.Te)(i),ae})()}notifyElevationSourceChange(e,i){var n=this;return(0,h.A)(function*(){return n._elevationAligner.notifyElevationSourceChange(),ae})()}notifySymbologyChange(e,i){var n=this;return(0,h.A)(function*(){return n._symbologyCandidatesFetcher.notifySymbologyChange(),ae})()}setSymbologySnappingSupported(e){var i=this;return(0,h.A)(function*(){return i._symbologyCandidatesFetcher=u(e,i._getSymbologyCandidates),ae})()}_updateFeatureFetcherConfiguration(e){this._featureFetcher.filter=null!=e.filter?Q.A.fromJSON(e.filter):null,this._featureFetcher.customParameters=e.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};(0,p._)([(0,F.MZ)({readOnly:!0})],ve.prototype,"updating",null),(0,p._)([(0,F.MZ)({readOnly:!0})],ve.prototype,"updatingExcludingEdits",null),(0,p._)([(0,F.MZ)()],ve.prototype,"_isInitializing",void 0),ve=(0,p._)([(0,k.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],ve);const Qe=ve,ae={result:{}}}}]);