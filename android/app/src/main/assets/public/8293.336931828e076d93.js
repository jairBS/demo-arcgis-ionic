"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8293],{50501:(Xe,Ce,T)=>{T.d(Ce,{K:()=>w});const w=(N=>["operational-layers","basemap","ground"])()},26994:(Xe,Ce,T)=>{T.r(Ce),T.d(Ce,{default:()=>$n});var w=T(10467),N=T(8189),ce=(T(21152),T(31178)),me=T(5922),de=T(35150),ne=T(56492),U=T(85211),H=(T(3248),T(40707),T(76576)),le=T(19412),X=T(95478),Y=T(31732),W=T(13682),oe=T(98877),Ee=T(60797),be=T(63484),We=T(55861),K=T(11817),J=T(58701),ee=T(42086),b=T(61320);class te{constructor(){this._featureLookup=new Map}static getInstance(){return te.instance||(te.instance=new te),te.instance}static resetInstance(){te.instance&&(te.instance=null)}deleteFromStore(h){h.forEach(E=>{this._featureLookup.delete(E)})}readFromStoreByList(h){const E=[];return h.forEach(g=>{const v=this.readFromStoreById(g);v&&E.push(v)}),E}readFromStoreById(h){var E;return null!==(E=this._featureLookup.get(h))&&void 0!==E?E:null}writeToStore(h,E,g){const v=[];return h.forEach(L=>{if(null==L||!L.id)return;L.properties||(L.properties=[]);let M,x=null;if(g&&L.properties[g]&&(x=(0,Y.Ux)(L.properties[g])),"originId"in L&&"destinationId"in L&&(L.properties.ESRI__ORIGIN_ID=L.originId,L.properties.ESRI__DESTINATION_ID=L.destinationId),L.properties[E]=L.id,L.id&&this._featureLookup.has(L.id)&&this._featureLookup.get(L.id).attributes){const A=this._featureLookup.get(L.id),D=JSON.parse(JSON.stringify(Object.assign(A.attributes,L.properties)));g&&L.properties[g]&&(D[g]=(0,b.rS)(L.properties[g])),M=new ee.Om(x?JSON.parse(JSON.stringify(x)):null!=A&&A.geometry?JSON.parse(JSON.stringify(A.geometry)):null,D,null,L.properties[E])}else M=new ee.Om(x?JSON.parse(JSON.stringify(x)):null,L.properties,null,L.properties[E]);this._featureLookup.set(L.id,M),v.push(M)}),v}}T(89563);var Pe,u,it,st,Ne,lt,ht,Lt,k=T(22246),I=T(74490);function xn(u){if(!u.spatialReference.isWGS84)throw new me.A("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let h;return h=u.xmax>180&&u.xmin<180?[[[u.xmin,u.ymin],[u.xmin,u.ymax],[180,u.ymax],[180,u.ymin],[u.xmin,u.ymin]],[[-180,u.ymin],[-180,u.ymax],[u.xmax-360,u.ymax],[u.xmax-360,u.ymin],[-180,u.ymin]]]:u.xmax>180&&u.xmin>180?[[[u.xmin-360,u.ymin],[u.xmin-360,u.ymax],[u.xmax-360,u.ymax],[u.xmax-360,u.ymin],[u.xmin-360,u.ymin]]]:u.xmax>-180&&u.xmin<-180?[[[u.xmin+360,u.ymin],[u.xmin+360,u.ymax],[180,u.ymax],[180,u.ymin],[u.xmin+360,u.ymin]],[[-180,u.ymin],[-180,u.ymax],[u.xmax,u.ymax],[u.xmax,u.ymin],[-180,u.ymin]]]:u.xmax<-180&&u.xmin<-180?[[[u.xmin+360,u.ymin],[u.xmin+360,u.ymax],[u.xmax+360,u.ymax],[u.xmax+360,u.ymin],[u.xmin+360,u.ymin]]]:[[[u.xmin,u.ymin],[u.xmin,u.ymax],[u.xmax,u.ymax],[u.xmax,u.ymin],[u.xmin,u.ymin]]],h}function St(){return St=(0,w.A)(function*(u,h){var E;const g=[],v=new Map,L=[];if(null!==(E=h.dataModel)&&void 0!==E&&E.relationshipTypes)for(const x of h.dataModel.relationshipTypes)x.name&&v.set(x.name,[]);for(const x of u){var M;v.has(x.typeName)&&(null===(M=v.get(x.typeName))||void 0===M||M.push(x.id))}for(const[x,A]of v){if(A.length<1)continue;const D=new I.A({openCypherQuery:`MATCH (n)-[r:${x}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:A}});L.push((0,k.executeQueryStreaming)(h,D).then(function(){var j=(0,w.A)(function*(R){const P=R.resultRowsStream.getReader();for(;;){const{done:z,value:ge}=yield P.read();if(z)break;for(const _ of ge)g.push({id:_[0],typeName:_[1]}),g.push({id:_[2],typeName:_[3]})}});return function(R){return j.apply(this,arguments)}}()))}return yield Promise.all(L),g}),St.apply(this,arguments)}T(32034),(u=Pe||(Pe={})).ELEMENTUID="ELEMENTUID",u.TYPENAME="TYPENAME",function(u){u[u.ELEMENTUID=0]="ELEMENTUID",u[u.TYPENAME=1]="TYPENAME"}(it||(it={})),function(u){u[u.ELEMENTUID=0]="ELEMENTUID",u[u.TYPENAME=1]="TYPENAME",u[u.FROMUID=2]="FROMUID",u[u.TOUID=3]="TOUID"}(st||(st={})),T(31772),T(66072),function(u){u[u.featureResult=0]="featureResult",u[u.countResult=1]="countResult",u[u.idsResult=2]="idsResult"}(Ne||(Ne={})),function(u){u[u.upperLeft=0]="upperLeft",u[u.lowerLeft=1]="lowerLeft"}(lt||(lt={})),function(u){u[u.sqlTypeBigInt=0]="sqlTypeBigInt",u[u.sqlTypeBinary=1]="sqlTypeBinary",u[u.sqlTypeBit=2]="sqlTypeBit",u[u.sqlTypeChar=3]="sqlTypeChar",u[u.sqlTypeDate=4]="sqlTypeDate",u[u.sqlTypeDecimal=5]="sqlTypeDecimal",u[u.sqlTypeDouble=6]="sqlTypeDouble",u[u.sqlTypeFloat=7]="sqlTypeFloat",u[u.sqlTypeGeometry=8]="sqlTypeGeometry",u[u.sqlTypeGUID=9]="sqlTypeGUID",u[u.sqlTypeInteger=10]="sqlTypeInteger",u[u.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",u[u.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",u[u.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",u[u.sqlTypeNChar=14]="sqlTypeNChar",u[u.sqlTypeNVarChar=15]="sqlTypeNVarChar",u[u.sqlTypeOther=16]="sqlTypeOther",u[u.sqlTypeReal=17]="sqlTypeReal",u[u.sqlTypeSmallInt=18]="sqlTypeSmallInt",u[u.sqlTypeSqlXml=19]="sqlTypeSqlXml",u[u.sqlTypeTime=20]="sqlTypeTime",u[u.sqlTypeTimestamp=21]="sqlTypeTimestamp",u[u.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",u[u.sqlTypeTinyInt=23]="sqlTypeTinyInt",u[u.sqlTypeVarbinary=24]="sqlTypeVarbinary",u[u.sqlTypeVarchar=25]="sqlTypeVarchar"}(ht||(ht={})),function(u){u[u.OID_ARRAY=0]="OID_ARRAY",u[u.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",u[u.STRING_ARRAY=2]="STRING_ARRAY",u[u.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(Lt||(Lt={}));var mt=T(87086),Tt=T(28067);const Ue="ESRI__ID",xt="ESRI__ORIGIN_ID",wt="ESRI__DESTINATION_ID",ze="ESRI__LAYOUT_GEOMETRY",Bt="ESRI__AGGREGATION_COUNT";let ut=class extends oe.A{constructor(u){var h,E,g;super(u),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const v=new Map;null!==(h=u.knowledgeGraph.dataModel.entityTypes)&&void 0!==h&&h.forEach(L=>{var M,x;L.name&&(v.set(L.name,"entity"),this._processingCacheUpdatesLookup.set(L.name,[]),u.inclusionModeDefinition&&!(null!==(M=u.inclusionModeDefinition)&&void 0!==M&&M.generateAllSublayers)||this.entityTypeNames.add(L.name),null===(x=L.properties)||void 0===x||x.forEach(A=>{var D;A.geometryType&&"esriGeometryNull"!==A.geometryType&&this.geographicLookup.set(L.name,{name:null!==(D=A.name)&&void 0!==D?D:"",geometryType:A.geometryType})}))}),null!==(E=u.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==E&&E.forEach(L=>{var M,x;L.name&&(v.set(L.name,"relationship"),this._processingCacheUpdatesLookup.set(L.name,[]),u.inclusionModeDefinition&&!(null!==(M=u.inclusionModeDefinition)&&void 0!==M&&M.generateAllSublayers)||this.relationshipTypeNames.add(L.name),null===(x=L.properties)||void 0===x||x.forEach(A=>{var D;A.geometryType&&"esriGeometryNull"!==A.geometryType&&this.geographicLookup.set(L.name,{name:null!==(D=A.name)&&void 0!==D?D:"",geometryType:A.geometryType})}))}),null===(g=u.inclusionModeDefinition)||void 0===g||g.namedTypeDefinitions.forEach((L,M)=>{var x;if("entity"===v.get(M))this.entityTypeNames.add(M);else{var A;if("relationship"!==v.get(M))return de.A.getLogger(this).warn(`A named type, ${M}, was in the inclusion list that wasn't in the data model and will be removed`),void(null===(A=u.inclusionModeDefinition)||void 0===A||A.namedTypeDefinitions.delete(M));this.relationshipTypeNames.add(M)}const D=new Map;null!==(x=L.members)&&void 0!==x&&x.forEach(j=>{(0,Ee.tE)(this.memberIdTypeLookup,j.id,()=>new Set).add(M);const R=this.getById(j.id);R&&D.set(j.id,R)}),this.sublayerCaches.set(M,D)})}addToLayer(u){u.forEach(({typeName:h,id:E})=>{if(!this.inclusionModeDefinition)throw new me.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(h)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(h)){const g=this.inclusionModeDefinition.namedTypeDefinitions.get(h);g.members||(g.members=new Map),g.members.set(E,{id:E}),(0,Ee.tE)(this.memberIdTypeLookup,E,()=>new Set).add(h)}}else{const g=new Map;g.set(E,{id:E}),this.inclusionModeDefinition.namedTypeDefinitions.set(h,{useAllData:!1,members:g}),(0,Ee.tE)(this.memberIdTypeLookup,E,()=>new Set).add(h)}})}getById(u){return te.getInstance().readFromStoreById(u)}getData(u,h,E){var g=this;return(0,w.A)(function*(){var v;if(h.objectType.name&&null!==(v=g.inclusionModeDefinition)&&void 0!==v&&v.namedTypeDefinitions&&g.inclusionModeDefinition.namedTypeDefinitions.size>0&&!g.inclusionModeDefinition.namedTypeDefinitions.has(h.objectType.name))return[];let L;if(L=u||new mt.A({where:"1=1",outFields:["*"]}),"link-chart"===h.parentCompositeLayer.type){var M,x,A;const D=h.parentCompositeLayer,j=g._processingCacheUpdatesLookup.get(null!==(M=h.objectType.name)&&void 0!==M?M:""),R=L.outFields,P=L.geometry;let z="",ge="";P&&P.extent&&(z=(0,le.Qj)(P.extent.ymin,P.extent.xmin,12),ge=(0,le.Qj)(P.extent.ymax,P.extent.xmax,12)),R&&1===R.length&&R[0]===Ue&&"1=1"===L.where||(yield Promise.all(null!=j?j:[]));const _=g.sublayerCaches.has(null!==(x=h.objectType.name)&&void 0!==x?x:"")?Array.from(null===(A=g.sublayerCaches.get(h.objectType.name))||void 0===A?void 0:A.values()):[],B=[];return _.forEach(re=>{if(re.geometry=g.relationshipTypeNames.has(h.objectType.name)?D.relationshipLinkChartDiagramLookup.get(re.attributes[h.objectIdField]):D.entityLinkChartDiagramLookup.get(re.attributes[h.objectIdField]),re.attributes[ze]=re.geometry,z&&ge){const xe=D.linkChartGeohashLookup.get(re.attributes[h.objectIdField]);xe?xe>=z&&xe<=ge&&B.push(re):B.push(re)}else B.push(re)}),B}return g.retrieveDataFromService(L,h,E)})()}getConnectedRecordIds(u,h){var E=this;return(0,w.A)(function*(){const g=[];let v="";const L=[],M=new Map;if(u.forEach(x=>{if(E.memberIdTypeLookup.has(x))for(const D of E.memberIdTypeLookup.get(x)){var A;if(!E.entityTypeNames.has(D))return;M.has(D)?null===(A=M.get(D))||void 0===A||A.push(x):M.set(D,[x])}}),h&&0!==(null==h?void 0:h.length)){for(const x of h)v=v+x+"|";v=v.slice(0,-1)}return M.forEach((x,A)=>{let D;D=h&&0!==(null==h?void 0:h.length)?`MATCH (n:${A})-[r:${v}]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`:`MATCH (n:${A})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`;const j=new Promise(R=>{(0,w.A)(function*(){const P=(yield(0,k.executeQueryStreaming)(E.knowledgeGraph,new I.A({openCypherQuery:D,bindParameters:{ids:x}}))).resultRowsStream.getReader();try{for(;;){const{done:z,value:ge}=yield P.read();if(z)break;for(let _=0;_<ge.length;_++){const B=ge[_];g.push({id:B[0],typeName:B[1]}),g.push({id:B[2],typeName:B[3]})}}}catch(z){if("AbortError"!==z.name)throw z;de.A.getLogger(E).info("Request aborted as expected")}})().then(()=>{R()})});L.push(j)}),E.refreshCacheContent(),yield Promise.all(L),g})()}refreshCacheContent(u,h,E,g=!0){var v=this;return(0,w.A)(function*(){var L,M,x,A,D;const j=te.getInstance(),R=[],P=new Map,z=new Map;null!==(L=v.knowledgeGraph.dataModel.entityTypes)&&void 0!==L&&L.forEach(_=>{_.name&&z.set(_.name,_)}),null!==(M=v.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==M&&M.forEach(_=>{_.name&&z.set(_.name,_)}),u||v.inclusionModeDefinition?u?u.forEach(_=>{if(v.memberIdTypeLookup.has(_))for(const re of v.memberIdTypeLookup.get(_)){var B;P.has(re)?null===(B=P.get(re))||void 0===B||B.push(_):P.set(re,[_])}}):null===(x=v.inclusionModeDefinition)||void 0===x||null===(x=x.namedTypeDefinitions)||void 0===x||x.forEach((_,B)=>{_.useAllData?P.set(B,null):_.members&&_.members.forEach(re=>{var xe;P.has(B)&&null!==P.get(B)?null===(xe=P.get(B))||void 0===xe||xe.push(re.id):P.set(B,[re.id])})}):(null!==(A=v.knowledgeGraph.dataModel.entityTypes)&&void 0!==A&&A.forEach(_=>{_.name&&P.set(_.name,null)}),null===(D=v.knowledgeGraph.dataModel.entityTypes)||void 0===D||D.forEach(_=>{_.name&&P.set(_.name,null)}));for(const[_,B]of P){var ge;const re=new Promise(xe=>{(function(){var ve=(0,w.A)(function*(){var Re;const Je=new Set,De=[];let Ge,Q="",pe=!1;if(h||null!==(Re=z.get(_))&&void 0!==Re&&null!==(Re=Re.properties)&&void 0!==Re&&Re.forEach(q=>{q.name&&Je.add(q.name)}),E&&v.geographicLookup.has(_)){var Oe;const q=null===(Oe=v.geographicLookup.get(_))||void 0===Oe?void 0:Oe.name;q&&Je.add(q)}if(v.entityTypeNames.has(_))Q=`MATCH (n:${_}) ${B?"WHERE id(n) IN $ids ":""}return ID(n)`,Je.forEach(q=>{Q+=`, n.${q}`,De.push(q)});else{if(!v.relationshipTypeNames.has(_))throw new me.A("knowledge-graph:layer-data-manager",`The graph type of ${_} could not be determined. Was this type set in the KG data model and inclusion definition?`);pe=!0,Q=`MATCH ()-[n:${_}]->() ${B?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,Je.forEach(q=>{Q+=`, n.${q}`,De.push(q)})}Ge=new I.A(B?{openCypherQuery:Q,bindParameters:{ids:B}}:{openCypherQuery:Q});const je=(yield(0,k.executeQueryStreaming)(v.knowledgeGraph,Ge)).resultRowsStream.getReader();for(;;){var Ae,we,Se,Te;const{done:q,value:G}=yield je.read();if(q)break;const $=[];for(let Ke=0;Ke<G.length;Ke++){const ke=G[Ke];let _e=0,et=0;const Qe={properties:{}};for(Qe.id=ke[_e],_e++,et++,pe&&(Qe.originId=ke[_e],_e++,et++,Qe.destinationId=ke[_e],_e++,et++,(0,Ee.tE)(v.nodeConnectionsLookup,Qe.originId,()=>new Set).add(Qe.id),(0,Ee.tE)(v.nodeConnectionsLookup,Qe.destinationId,()=>new Set).add(Qe.id),(0,Ee.tE)(v.relationshipConnectionsLookup,Qe.id,()=>[Qe.originId,Qe.destinationId]));_e<ke.length;_e++)Qe.properties[De[_e-et]]=ke[_e];$.push(Qe)}const he=j.writeToStore($,Ue,null===(Ae=v.geographicLookup.get(_))||void 0===Ae?void 0:Ae.name);v.sublayerCaches.has(_)||v.sublayerCaches.set(_,new Map),g&&!(null!==(we=v.inclusionModeDefinition)&&void 0!==we&&we.namedTypeDefinitions.has(_))&&null!==(Se=v.inclusionModeDefinition)&&void 0!==Se&&Se.namedTypeDefinitions.set(_,{useAllData:!1,members:new Map}),g&&(null===(Te=v.inclusionModeDefinition)||void 0===Te||!Te.namedTypeDefinitions.get(_).members)&&(v.inclusionModeDefinition.namedTypeDefinitions.get(_).members=new Map);const nt=v.sublayerCaches.get(_);he.forEach(Ke=>{var ke,_e;null!=nt&&nt.set(Ke.attributes[Ue],Ke),g&&(null===(ke=v.inclusionModeDefinition)||void 0===ke||!ke.namedTypeDefinitions.get(_).members.has(Ke.attributes[Ue]))&&(null!==(_e=v.inclusionModeDefinition)&&void 0!==_e&&_e.namedTypeDefinitions.get(_).members.set(Ke.attributes[Ue],{id:Ke.attributes[Ue]}),(0,Ee.tE)(v.memberIdTypeLookup,Ke.attributes[Ue],()=>new Set).add(_))})}});return function(){return ve.apply(this,arguments)}})()().then(()=>{xe(null)})});R.push(re),null===(ge=v._processingCacheUpdatesLookup.get(_))||void 0===ge||ge.push(re)}yield Promise.all(R)})()}removeFromLayer(u){const h=new Set,E=new Set(u.map(M=>M.id));for(const M of u){var g,v,L;h.add(M.typeName),1===(null===(g=this.memberIdTypeLookup.get(M.id))||void 0===g?void 0:g.size)?this.memberIdTypeLookup.delete(M.id):null===(v=this.memberIdTypeLookup.get(M.id))||void 0===v||v.delete(M.typeName),null===(L=this.inclusionModeDefinition)||void 0===L||L.namedTypeDefinitions.forEach((x,A)=>{var D;A===M.typeName&&null!==(D=x.members)&&void 0!==D&&D.has(M.id)&&x.members.delete(M.id)})}h.forEach(M=>{var x;null===(x=this.sublayerCaches.get(M))||void 0===x||x.forEach((A,D)=>{var j;E.has(D)&&(null===(j=this.sublayerCaches.get(M))||void 0===j||j.delete(D))})})}retrieveDataFromService(u,h,E){var g=this;return(0,w.A)(function*(){var v,L,M;const x=te.getInstance(),A=new Set,D=[];let j,R="",P=[];const z="relationship"===h.graphType,ge=null===(v=g.inclusionModeDefinition)||void 0===v||null===(v=v.namedTypeDefinitions)||void 0===v||null===(v=v.get(h.objectType.name))||void 0===v?void 0:v.useAllData,_=h.parentCompositeLayer.sublayerIdsCache.get(h.objectType.name);let B=!ge&&_?Array.from(_).sort():null;if(null!==(L=g.inclusionModeDefinition)&&void 0!==L&&null!==(L=L.namedTypeDefinitions)&&void 0!==L&&null!==(L=L.get(h.objectType.name))&&void 0!==L&&L.useAllData)null!==(M=g.inclusionModeDefinition)&&void 0!==M&&null!==(M=M.namedTypeDefinitions)&&void 0!==M&&null!==(M=M.get(h.objectType.name))&&void 0!==M&&M.useAllData&&null!=u.objectIds&&(B=u.objectIds);else if(null!=u.objectIds&&B&&B.length>0){const Q=u.objectIds;u.objectIds=B.filter(pe=>Q.includes(pe))}else if(null!=u.objectIds)B=u.objectIds;else{var re,xe,Ye;if(null!==(re=g.inclusionModeDefinition)&&void 0!==re&&re.namedTypeDefinitions.has(h.objectType.name)&&(null===(xe=g.inclusionModeDefinition.namedTypeDefinitions.get(h.objectType.name))||void 0===xe||!xe.members||(null===(Ye=g.inclusionModeDefinition.namedTypeDefinitions.get(h.objectType.name))||void 0===Ye||null===(Ye=Ye.members)||void 0===Ye?void 0:Ye.size)<1))return u.objectIds=[],[];u.objectIds=B}if(null!=u.outFields){const Q=u.outFields;Q.includes("*")?h.fields.forEach(pe=>{A.add(pe.name)}):Q.forEach(pe=>{pe!==Ue&&pe!==h.geometryFieldName&&A.add(pe)})}if(null!=u.geometry){var ve,Re,Je;const Q=u.geometry;let pe;const Oe=h.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,je=null==Oe?void 0:Oe.spatialReference,Ae=null==Oe||null===(ve=Oe.serviceCapabilities)||void 0===ve?void 0:ve.geometryCapabilities;let we=null==Ae?void 0:Ae.geometryMaxBoundingRectangleSizeX,Se=null==Ae?void 0:Ae.geometryMaxBoundingRectangleSizeY;if(null==Q||null===(Re=Q.extent)||void 0===Re||!Re.spatialReference||null!==(Je=Q.spatialReference)&&void 0!==Je&&Je.isWGS84?pe=Q.extent:(yield(0,K.initializeProjection)(Q.extent.spatialReference,J.KK),pe=(0,K.project)(Q.extent,J.KK)),we&&Se&&je){if(4326!==je.wkid){const Te=new Tt.A({spatialReference:je,xmax:we,ymax:Se}),q=(0,K.project)(Te,J.KK);we=q.xmax,Se=q.ymax}if(pe.xmax-pe.xmin>we)throw new me.A("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${we}\xb0 latitude, limit exceeded`);if(pe.ymax-pe.ymin>Se)throw new me.A("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${Se}\xb0 longitude, limit exceeded`)}if(null!=u.where&&"1=1"!==u.where){const Te=yield(0,be.G)(u.where.toUpperCase(),h.fieldsIndex);h.fields.forEach(q=>{Te.fieldNames.includes(q.name)&&A.add(q.name)})}R=z?`Match ()-[n:${h.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${h.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${h.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${h.geometryFieldName}) return ID(n)`,h.geometryFieldName&&A.add(h.geometryFieldName),A.forEach(Te=>{R+=`, n.${Te}`,D.push(Te)}),j=new I.A({openCypherQuery:R,bindParameters:{param_filter_geom:new We.A({rings:xn(pe)})}})}else{let Q="";if(null!=u.where&&"1=1"!==u.where){const je=yield(0,be.G)(u.where,h.fieldsIndex);h.fields.forEach(q=>{je.fieldNames.includes(q.name)&&A.add(q.name)});const Ae=new Set(["column-reference","string","number","binary-expression"]),we=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let Se=!1;const Te=q=>{if("column-reference"===q.type)return`n.${q.column}`;if("string"===q.type)return`'${q.value}'`;if("number"===q.type)return`${q.value}`;if("binary-expression"===q.type&&Ae.has(q.left.type)&&Ae.has(q.right.type)&&we.has(q.operator))return`${Te(q.left)} ${q.operator} ${Te(q.right)}`;if("binary-expression"===q.type&&"LIKE"===q.operator){let G="";if("function"===q.left.type&&"column-reference"===q.left.args.value[0].type)G+=`lower(n.${q.left.args.value[0].column})`;else{if("column-reference"!==q.left.type)return Se=!0,"";G+=`lower(n.${q.left.column})`}if(G+=" CONTAINS (","string"!==q.right.type)return Se=!0,"";{let $=q.right.value;"%"===$.charAt(0)&&($=$.slice(1)),"%"===$.charAt($.length-1)&&($=$.slice(0,-1)),G+=`'${$.toLowerCase()}')`}return G}return Se=!0,""};Q=Te(je.parseTree),Se&&(Q="")}let pe="";pe=z?`Match ()-[n:${h.objectType.name}]->()`:`Match (n:${h.objectType.name})`;let Oe=!1;B&&(Oe=!0,pe+=" WHERE ID(n) IN $ids"),Q&&(pe+=Oe?" AND":" WHERE",pe+=` ${Q}`),pe+=" return ID(n)",z&&(pe+=", id(startNode(n)), id(endNode(n))"),u.returnGeometry&&h.geometryFieldName&&A.add(h.geometryFieldName),A.forEach(je=>{pe+=`, n.${je}`,D.push(je)}),j=new I.A(B?{openCypherQuery:pe,bindParameters:{ids:B}}:{openCypherQuery:pe})}const De=(yield(0,k.executeQueryStreaming)(h.parentCompositeLayer.dataManager.knowledgeGraph,j,E)).resultRowsStream.getReader();for(;;){var Ge;const{done:Q,value:pe}=yield De.read();if(Q)break;const Oe=[];for(let je=0;je<pe.length;je++){const Ae=pe[je];let we=0,Se=0;const Te={properties:{}};for(Te.id=Ae[we],we++,Se++,z&&(Te.originId=Ae[we],we++,Se++,Te.destinationId=Ae[we],we++,Se++);we<Ae.length;we++)Te.properties[D[we-Se]]=Ae[we];Oe.push(Te)}P=P.concat(x.writeToStore(Oe,Ue,null===(Ge=h.parentCompositeLayer.dataManager.geographicLookup.get(h.objectType.name))||void 0===Ge?void 0:Ge.name))}return P})()}};(0,N._)([(0,U.MZ)()],ut.prototype,"knowledgeGraph",void 0),(0,N._)([(0,U.MZ)()],ut.prototype,"inclusionModeDefinition",void 0),(0,N._)([(0,U.MZ)()],ut.prototype,"entityTypeNames",void 0),(0,N._)([(0,U.MZ)()],ut.prototype,"relationshipTypeNames",void 0),(0,N._)([(0,U.MZ)()],ut.prototype,"geographicLookup",void 0),(0,N._)([(0,U.MZ)()],ut.prototype,"sublayerCaches",void 0),(0,N._)([(0,U.MZ)()],ut.prototype,"nodeConnectionsLookup",void 0),(0,N._)([(0,U.MZ)()],ut.prototype,"relationshipConnectionsLookup",void 0),(0,N._)([(0,U.MZ)()],ut.prototype,"memberIdTypeLookup",void 0),ut=(0,N._)([(0,H.$)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],ut);var In=T(92165),Zt=(T(79122),T(70176),T(92089),T(9826),T(15317),T(38582),T(73747),T(13318),T(85718)),An=T(36156),Sn=(T(19284),T(64373)),Rn=T(40753),Ct=T(89962);const cn=(0,T(3404).p)(),Nn=u=>{let h=class extends u{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,N._)([(0,U.MZ)(cn.fields)],h.prototype,"fields",void 0),(0,N._)([(0,U.MZ)(cn.fieldsIndex)],h.prototype,"fieldsIndex",void 0),h=(0,N._)([(0,H.$)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],h),h};var yn=T(93410),On=T(61495),jn=T(1151),hn=T(33036),kn=T(81687),Kt=T(29141),Fn=T(86300),Un=T(93327),Gn=T(41843),Bn=T(85311),Wt=T(93615),ft=T(6434);let Ze=class extends((0,On.J)(Nn((0,yn.d)((0,hn.j)((0,jn.J)(X.A)))))){constructor(u){var h,E,g,v;if(super(u),this.capabilities=(0,Ct.f)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=Ue,this.objectType=null,this.parentCompositeLayer=null,this.popupEnabled=!0,this.popupTemplate=null,this.source={openPorts:()=>this.load().then(()=>{const D=new MessageChannel;return new Bn.A(D.port1,{channel:D,client:{queryFeatures:(j,R={})=>{const P=mt.A.fromJSON(j);return this.queryFeaturesJSON(P,R)}}}),[D.port2]})},this.type="knowledge-graph-sublayer","link-chart"===u.parentCompositeLayer.type)this.geometryType="relationship"===u.graphType?"polyline":"point",this.geometryFieldName=ze;else if(null!==(h=u.parentCompositeLayer.dataManager.geographicLookup.get(u.objectType.name))&&void 0!==h&&h.geometryType&&"esriGeometryNull"!==(null===(E=u.parentCompositeLayer.dataManager.geographicLookup.get(u.objectType.name))||void 0===E?void 0:E.geometryType)){var L,M,x,A;const D=u.parentCompositeLayer.dataManager.geographicLookup.get(u.objectType.name);this.geometryFieldName=null!==(L=null==D?void 0:D.name)&&void 0!==L?L:null,this.geometryType=null!=D&&D.geometryType?ft.g.fromJSON(D.geometryType):null;const j=null==D?void 0:D.name,R=j?null===(M=u.objectType.properties)||void 0===M?void 0:M[j]:null;R?(this.hasM=null!==(x=R.hasM)&&void 0!==x&&x,this.hasZ=null!==(A=R.hasZ)&&void 0!==A&&A):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;null!==(g=u.objectType.properties)&&void 0!==g&&g.forEach(D=>{let R=D.fieldType;"esriFieldTypeOID"===R&&(R="esriFieldTypeInteger"),this.fields.push(Kt.A.fromJSON({name:D.name,type:R,alias:D.alias,defaultValue:null,editable:D.editable,nullable:D.nullable}))}),this.fields.push(Kt.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this.fields.push(Kt.A.fromJSON({name:Bt,type:"esriFieldTypeInteger",alias:Bt,editable:!1})),this._set("fields",[...this.fields]),null!==(v=u.parentCompositeLayer.dataManager.knowledgeGraph.dataModel)&&void 0!==v&&v.spatialReference&&(this.spatialReference=u.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),this.renderer=(0,Zt.r)("link-chart"===u.parentCompositeLayer.type?"relationship"===u.graphType?(0,Ct.F0)(ft.g.toJSON("polyline")).renderer:(0,Ct.F0)(ft.g.toJSON("point")).renderer:(0,Ct.F0)(ft.g.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(u){(0,Fn.yp)(u,this.fieldsIndex),this._set("renderer",u)}createPopupTemplate(u){return(0,Gn.tn)(this,u)}createQuery(){return new mt.A({where:"1=1",outFields:["*"]})}getField(u){for(let h=0;h<this.fields.length;h++)if(this.fields[h].name===u)return this.fields[h];return null}getFieldDomain(u,h){return null}queryFeatures(u,h){var E=this;return(0,w.A)(function*(){const{resolvedQuery:g,queryEngine:v}=yield E._setupQueryObjects(u),L=Un.A.fromJSON(yield v.executeQuery(g.toJSON(),null==h?void 0:h.signal));return L.features.forEach(M=>{M.sourceLayer=E}),L})()}queryFeaturesJSON(u,h){var E=this;return(0,w.A)(function*(){const{resolvedQuery:g,queryEngine:v}=yield E._setupQueryObjects(u);return yield v.executeQuery(g.toJSON(),null==h?void 0:h.signal)})()}queryFeatureCount(u,h){var E=this;return(0,w.A)(function*(){const{resolvedQuery:g,queryEngine:v}=yield E._setupQueryObjects(u);return v.executeQueryForCount(g.toJSON(),null==h?void 0:h.signal)})()}queryExtent(u={},h){var E=this;return(0,w.A)(function*(){var g,v,L,M;const x={...u,returnGeometry:!0},{resolvedQuery:A,queryEngine:D}=yield E._setupQueryObjects(x),j=yield D.executeQueryForExtent(A.toJSON(),null==h?void 0:h.signal);let R;return R=null!=(null===(g=j.extent)||void 0===g?void 0:g.xmin)&&null!=(null===(v=j.extent)||void 0===v?void 0:v.xmax)&&null!=(null===(L=j.extent)||void 0===L?void 0:L.ymin)&&null!=(null===(M=j.extent)||void 0===M?void 0:M.ymax)?new Tt.A(j.extent):new Tt.A,{count:j.count,extent:R}})()}queryObjectIds(u,h){var E=this;return(0,w.A)(function*(){const g=mt.A.from(u);let v;if("link-chart"===E.parentCompositeLayer.type&&E._cachedQueryEngine)v=E._cachedQueryEngine;else{const L=yield E.parentCompositeLayer.dataManager.getData(g,E,h);v=E.loadQueryEngine(L)}return v.executeQueryForIds(g.toJSON(),null==h?void 0:h.signal)})()}loadQueryEngine(u){const h=new Sn.A({geometryType:ft.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),E=new Rn.d({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:ft.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:h});return E.featureStore.addMany(u),E}refreshCachedQueryEngine(){var u=this;return(0,w.A)(function*(){const h=yield u.parentCompositeLayer.dataManager.getData(new mt.A({where:"1=1",outFields:[Ue]}),u);u._cachedQueryEngine=u.loadQueryEngine(h)})()}_setupQueryObjects(u,h){var E=this;return(0,w.A)(function*(){var g;const v=mt.A.from(u),L=v.geometry;let M;if(L&&!(null!==(g=L.spatialReference)&&void 0!==g&&g.isWGS84)&&(yield(0,K.initializeProjection)(L.spatialReference,J.KK),v.geometry=(0,K.project)(L instanceof We.A||L instanceof Wt.A?L:L.extent,J.KK)),"link-chart"===E.parentCompositeLayer.type&&E._cachedQueryEngine)M=E._cachedQueryEngine;else{const x=yield E.parentCompositeLayer.dataManager.getData(v,E,h);M=E.loadQueryEngine(x)}return{resolvedQuery:v,queryEngine:M}})()}};(0,N._)([(0,U.MZ)()],Ze.prototype,"capabilities",void 0),(0,N._)([(0,U.MZ)({readOnly:!0})],Ze.prototype,"defaultPopupTemplate",null),(0,N._)([(0,U.MZ)()],Ze.prototype,"definitionExpression",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"displayField",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"elevationInfo",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"geometryType",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"geometryFieldName",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"graphType",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"hasM",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"hasZ",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"labelsVisible",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"labelingInfo",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"objectIdField",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"objectType",void 0),(0,N._)([(0,U.MZ)()],Ze.prototype,"parentCompositeLayer",void 0),(0,N._)([(0,U.MZ)(kn.M6)],Ze.prototype,"popupEnabled",void 0),(0,N._)([(0,U.MZ)({type:In.A,json:{name:"popupInfo",write:!0}})],Ze.prototype,"popupTemplate",void 0),(0,N._)([(0,U.MZ)({types:An.H,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],Ze.prototype,"renderer",null),(0,N._)([(0,U.MZ)()],Ze.prototype,"source",void 0),(0,N._)([(0,U.MZ)({json:{read:!1}})],Ze.prototype,"type",void 0),Ze=(0,N._)([(0,H.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],Ze);const zt=Ze;var Zn=T(90261);let Jt,Me=null;var dt,bt,Qt,$t,Ht,Yt,Vt,Xt,vn,En;function gt(u,h,E,g,v,L){const M=E.length,x=v.length,A=Float64Array.BYTES_PER_ELEMENT,D=Uint32Array.BYTES_PER_ELEMENT,j=Uint8Array.BYTES_PER_ELEMENT,z=Me._malloc(15+M*(j+2*A)+x*(2*D));try{const ge=z+16-z%16,_=ge+M*A,B=_+M*A,re=B+x*D,xe=re+x*D,Ye=()=>[Me.HEAPF64.subarray(ge>>3,(ge>>3)+M),Me.HEAPF64.subarray(_>>3,(_>>3)+M),Me.HEAPU32.subarray(B>>2,(B>>2)+x),Me.HEAPU32.subarray(re>>2,(re>>2)+x),Me.HEAPU8.subarray(xe,xe+M)],[ve,Re,Je,De,Ge]=Ye();ve.set(E),Re.set(g),Je.set(v),De.set(L),Ge.set(h);let Q=u(M,xe,ge,_,x,B,re),pe=null;if(Q){const Te=Me.getLayoutLinksTypes(),q=Me.getLayoutLinksVerticesEndIndices(),G=Me.getLayoutLinksVertices(),$=Me.countLayoutLinksVertices();!x||Te&&q?$&&!G?Q=!1:pe={types:new Uint8Array(Me.HEAPU8.subarray(Te,Te+x)),vertexEndIndex:new Uint32Array(Me.HEAPU32.subarray(q>>2,(q>>2)+x)),vertices:new Float64Array(Me.HEAPF64.subarray(G>>3,(G>>3)+2*$))}:Q=!1}const[Oe,je,Ae,we,Se]=Ye();return E.set(Oe),g.set(je),v.set(Ae),L.set(we),h.set(Se),{success:Q,links:pe}}finally{Me._free(z),Me.cleanupLayout()}}(function(u){u[u.None=0]="None",u[u.IsMovable=1]="IsMovable",u[u.IsGeographic=2]="IsGeographic",u[u.IsRoot=4]="IsRoot"})(dt||(dt={})),function(u){u[u.Regular=0]="Regular",u[u.Orthogonal=1]="Orthogonal",u[u.Curved=2]="Curved",u[u.Recursive=3]="Recursive"}(bt||(bt={})),function(u){u.getMinIdealEdgeLength=function h(){return Me.getMinIdealEdgeLength()},u.apply=function E(g,v,L,M,x,A=2,D=1,j=-1){return gt((R,P,z,ge,_,B,re)=>Me.applyForceDirectedLayout(R,P,z,ge,_,B,re,A,D,j),g,v,L,M,x)}}(Qt||(Qt={})),function(u){u.apply=function h(E,g,v,L,M,x=2,A=1,D=-1){return gt((j,R,P,z,ge,_,B)=>Me.applyCommunityLayout(j,R,P,z,ge,_,B,x,A,D),E,g,v,L,M)}}($t||($t={})),function(u){u.apply=function h(E,g,v,L,M){return gt(Me.applySimpleLayout,E,g,v,L,M)}}(Ht||(Ht={})),function(u){u.apply=function h(E,g,v,L,M){return gt(Me.applyHierarchicalLayout,E,g,v,L,M)}}(Yt||(Yt={})),function(u){u.apply=function h(E,g,v,L,M){return gt(Me.applyRadialTreeLayout,E,g,v,L,M)}}(Vt||(Vt={})),function(u){u.apply=function h(E,g,v,L,M){return gt(Me.applySmartTreeLayout,E,g,v,L,M)}}(Xt||(Xt={})),function(u){u[u.Undirected=0]="Undirected",u[u.Directed=1]="Directed",u[u.Reversed=2]="Reversed"}(vn||(vn={})),function(u){u[u.ByCC_Raw=0]="ByCC_Raw",u[u.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",u[u.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(En||(En={}));var zn=T(89679),Jn=T(77062),Tn=T(13303);let qe=class extends((0,yn.d)((0,hn.j)(X.A))){constructor(u){if(super(u),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE"},this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new ce.A,this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,this.linkChartExtent=new Tt.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new ce.A,this.type="link-chart",this._originalInclusionList=u.inclusionModeDefinition,u.dataPreloadedInLocalCache&&!u.inclusionModeDefinition)throw new me.A("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(u){return{url:u.url,title:u.title,dataPreloadedInLocalCache:u.dataPreloadedInLocalCache,defaultLinkChartConfig:u.defaultLinkChartConfig}}_initializeLayerProperties(u){var h,E,g,v,L,M,x,A,D,j;if(!this.title&&this.url){const _=this.url.split("/");this.title=_[_.length-2]}const R=new Set;let P=[],z=[];if(u.inclusionModeDefinition&&(!u.inclusionModeDefinition.namedTypeDefinitions||u.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new me.A("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");null!==(h=u.knowledgeGraph.dataModel.entityTypes)&&void 0!==h&&h.forEach(_=>{_.name&&this._graphTypeLookup.set(_.name,_)}),null!==(E=u.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==E&&E.forEach(_=>{_.name&&this._graphTypeLookup.set(_.name,_)}),null!==(g=u.inclusionModeDefinition)&&void 0!==g&&g.generateAllSublayers?(P=null!==(v=u.knowledgeGraph.dataModel.entityTypes)&&void 0!==v?v:[],z=null!==(L=u.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==L?L:[]):null!==(M=u.inclusionModeDefinition)&&void 0!==M&&M.namedTypeDefinitions&&(null===(x=u.inclusionModeDefinition)||void 0===x?void 0:x.namedTypeDefinitions.size)>0?null===(A=u.inclusionModeDefinition)||void 0===A||A.namedTypeDefinitions.forEach((_,B)=>{var re,xe;if(!this._graphTypeLookup.get(B))return de.A.getLogger(this).warn(`A named type, ${B}, was in the inclusion list that wasn't in the data model and will be removed`),void(null===(re=u.inclusionModeDefinition)||void 0===re||re.namedTypeDefinitions.delete(B));this._graphTypeLookup.get(B)instanceof Jn.A||"strictOrigin"in this._graphTypeLookup.get(B)?R.has(B)||(R.add(B),z.push(this._graphTypeLookup.get(B))):this._graphTypeLookup.get(B)instanceof zn.A||"properties"in this._graphTypeLookup.get(B)?R.has(B)||(R.add(B),P.push(this._graphTypeLookup.get(B))):(de.A.getLogger(this).warn(`A named type, ${B}, was in the inclusion list that wasn't properly modeled and will be removed`),null===(xe=u.inclusionModeDefinition)||void 0===xe||xe.namedTypeDefinitions.delete(B))}):(P=null!==(D=u.knowledgeGraph.dataModel.entityTypes)&&void 0!==D?D:[],z=null!==(j=u.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==j?j:[]);const ge=new ut({knowledgeGraph:u.knowledgeGraph,inclusionModeDefinition:u.inclusionModeDefinition});this.knowledgeGraph=u.knowledgeGraph,this.memberEntityTypes=P,this.memberRelationshipTypes=z,this.dataManager=ge}load(u){var h=this;return this.addResolvingPromise(new Promise(E=>{(0,k.fetchKnowledgeGraph)(this.url).then(g=>{var v,L,M,x;if(this._initializeLayerProperties({knowledgeGraph:g,inclusionModeDefinition:this._originalInclusionList}),null!==(v=this.dataManager.inclusionModeDefinition)&&void 0!==v&&null!==(v=v.namedTypeDefinitions)&&void 0!==v&&v.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},null!==(L=this.dataManager.knowledgeGraph.dataModel.entityTypes)&&void 0!==L&&L.forEach(D=>{var j;D.name&&(null===(j=this.dataManager.inclusionModeDefinition)||void 0===j||j.namedTypeDefinitions.set(D.name,{useAllData:!0}))}),null!==(M=this.dataManager.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==M&&M.forEach(D=>{var j;D.name&&(null===(j=this.dataManager.inclusionModeDefinition)||void 0===j||j.namedTypeDefinitions.set(D.name,{useAllData:!0}))})),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),null===(x=this.dataManager.inclusionModeDefinition)||void 0===x||x.namedTypeDefinitions.forEach(D=>{var j;D.useAllData=!1,null!==(j=D.members)&&void 0!==j&&j.forEach(R=>{let P;P=R.linkChartLocation instanceof W.A?R.linkChartLocation:R.linkChartLocation?(0,Y.Ux)(R.linkChartLocation):null,P&&2===P.coords.length&&0===P.lengths.length?(this.linkChartGeohashLookup.set(R.id,(0,le.Qj)(P.coords[1],P.coords[0],12)),this.entityLinkChartDiagramLookup.set(R.id,P)):(this.linkChartGeohashLookup.set(R.id,""),this.relationshipLinkChartDiagramLookup.set(R.id,P))}),this.addResolvingPromise(this._initializeDiagram().then((0,w.A)(function*(){h.layers.forEach(function(){var R=(0,w.A)(function*(P){yield P.refreshCachedQueryEngine()});return function(P){return R.apply(this,arguments)}}()),h.tables.forEach(function(){var R=(0,w.A)(function*(P){yield P.refreshCachedQueryEngine()});return function(P){return R.apply(this,arguments)}}())})))});else{var A;const D="GEOGRAPHIC"===(null===(A=this.defaultLinkChartConfig)||void 0===A?void 0:A.layoutMode);this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,D,!0).then((0,w.A)(function*(){(0,ne.Te)(u);const j=[],R=[];h.loadLayerAssumingLocalCache(),h.dataManager.inclusionModeDefinition&&(h.dataManager.inclusionModeDefinition.generateAllSublayers=!1,h.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach(P=>{P.useAllData=!1})),yield h._initializeDiagram(),h.layers.forEach(P=>{R.push(P.refreshCachedQueryEngine()),j.push(new Promise(z=>{P.on("layerview-create",()=>{z(null)})}))}),h.tables.forEach(P=>{R.push(P.refreshCachedQueryEngine())}),yield Promise.all(R)})))}E(null)})})),Promise.resolve(this)}addRecords(u,h){var E=this;return(0,w.A)(function*(){let g=[];null!=h&&h.cascadeAddRelationshipEndNodes&&E.dataManager.knowledgeGraph.dataModel&&(g=yield function wn(u,h){return St.apply(this,arguments)}(u,E.dataManager.knowledgeGraph));const v=u.concat(g).filter(L=>{var M;return!(null!==(M=E.sublayerIdsCache.get(L.typeName))&&void 0!==M&&M.has(L.id))});yield E._handleNewRecords(v)})()}removeRecords(u,{cascadeRemoveRelationships:h=!0,recalculateLayout:E=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){var g=this;return(0,w.A)(function*(){let v=[];for(const D of u){var L,M;!1===(null===(L=g.dataManager.inclusionModeDefinition)||void 0===L||null===(L=L.namedTypeDefinitions)||void 0===L||null===(L=L.get(D.typeName))||void 0===L?void 0:L.useAllData)&&null!==(M=g.dataManager.inclusionModeDefinition)&&void 0!==M&&null!==(M=M.namedTypeDefinitions)&&void 0!==M&&null!==(M=M.get(D.typeName))&&void 0!==M&&null!==(M=M.members)&&void 0!==M&&M.has(D.id)&&v.push(D)}if(h){const D=new Set,j=[];for(const R of v)if(g.dataManager.nodeConnectionsLookup.has(R.id))for(const P of g.dataManager.nodeConnectionsLookup.get(R.id))D.add(P);for(const R of D)if(g.dataManager.memberIdTypeLookup.has(R))for(const P of g.dataManager.memberIdTypeLookup.get(R))g.dataManager.relationshipTypeNames.has(P)&&j.push({id:R,typeName:P});v=v.concat(j)}g.dataManager.removeFromLayer(v);for(const D of v){var x;null!==(x=g.sublayerIdsCache.get(D.typeName))&&void 0!==x&&x.delete(D.id),g.dataManager.relationshipTypeNames.has(D.typeName)?g.relationshipLinkChartDiagramLookup.delete(D.id):g.entityLinkChartDiagramLookup.delete(D.id)}E&&(yield g.calculateLinkChartLayout(g._currentLinkChartConfig.layoutMode,{}));const A=[];return g.layers.forEach(D=>{A.push(D.refreshCachedQueryEngine())}),yield Promise.all(A),g._refreshNamedTypes(),v})()}expand(u,h){var E=this;return(0,w.A)(function*(){const g=yield E.dataManager.getConnectedRecordIds(u,h),v=g.filter(L=>{var M;return!(null!==(M=E.sublayerIdsCache.get(L.typeName))&&void 0!==M&&M.has(L.id))});return yield E._handleNewRecords(g),{records:v}})()}loadLayerAssumingLocalCache(){var u,h;this.memberRelationshipTypes.forEach(E=>{const g=new zt({objectType:E,parentCompositeLayer:this,graphType:"relationship",title:E.name});g.geometryType?this.layers.push(g):this.tables.push(g),this.dataManager.sublayerCaches.has(E.name)||this.dataManager.sublayerCaches.set(E.name,new Map)}),this.memberEntityTypes.forEach(E=>{const g=new zt({objectType:E,parentCompositeLayer:this,graphType:"entity",title:E.name});g.geometryType?this.layers.push(g):this.tables.push(g),this.dataManager.sublayerCaches.has(E.name)||this.dataManager.sublayerCaches.set(E.name,new Map)}),null!==(u=this.dataManager.inclusionModeDefinition)&&void 0!==u&&u.namedTypeDefinitions&&(null===(h=this.dataManager.inclusionModeDefinition)||void 0===h||h.namedTypeDefinitions.forEach((E,g)=>{var v;const L=((u,h,E)=>(u.has(h)||u.set(h,new Set),u.get(h)))(this.sublayerIdsCache,g);null===(v=E.members)||void 0===v||v.forEach(M=>{if(L.add(M.id),M.linkChartLocation)if(M.linkChartLocation instanceof W.A)this.dataManager.relationshipTypeNames.has(g)?this.relationshipLinkChartDiagramLookup.set(M.id,M.linkChartLocation):this.entityLinkChartDiagramLookup.set(M.id,M.linkChartLocation),this.linkChartGeohashLookup.set(M.id,2===M.linkChartLocation.coords.length&&0===M.linkChartLocation.lengths.length?(0,le.Qj)(M.linkChartLocation.coords[1],M.linkChartLocation.coords[0],12):"");else{const x=(0,Y.Ux)(M.linkChartLocation);this.dataManager.relationshipTypeNames.has(g)?this.relationshipLinkChartDiagramLookup.set(M.id,M.linkChartLocation?x:null):this.entityLinkChartDiagramLookup.set(M.id,M.linkChartLocation?x:null),this.linkChartGeohashLookup.set(M.id,"x"in M.linkChartLocation&&"y"in M.linkChartLocation?(0,le.Qj)(M.linkChartLocation.x,M.linkChartLocation.y,12):"")}})}))}calculateLinkChartLayout(u="RADIAL_TREE",h){var E=this;return(0,w.A)(function*(){const g=[],v=[],L=[];E.dataManager.sublayerCaches.forEach((G,$)=>{E.dataManager.entityTypeNames.has($)?G.forEach(he=>{g.push({typeName:$,feature:he})}):E.dataManager.relationshipTypeNames.has($)&&G.forEach(he=>{v.push({typeName:$,feature:he})})}),E.entityLinkChartDiagramLookup=new Map,E.relationshipLinkChartDiagramLookup=new Map;const M=new Map,x=new Map,A=new Map,D=new Map,j=new Uint8Array(g.length),R=new Float64Array(g.length),P=new Float64Array(g.length),z=new Uint32Array(v.length),ge=new Uint32Array(v.length),_=[],re=new Tt.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let xe,Ye="FORCE_DIRECTED",ve=0,Re=0;switch(Ye="GEOGRAPHIC"===u?"FORCE_DIRECTED":u,Ye){case"FORCE_DIRECTED":xe=Qt.apply;break;case"COMMUNITY":xe=$t.apply;break;case"HIERARCHICAL":xe=Yt.apply;break;case"RADIAL_TREE":xe=Vt.apply;break;case"SMART_TREE":xe=Xt.apply;break;default:xe=Ht.apply}g.forEach(({typeName:G,feature:$})=>{var he,nt,Ke,ke,_e,et;if(null!=h&&null!==(he=h.lockedNodeLocations)&&void 0!==he&&he.has($.attributes[Ue])){j[ve]="GEOGRAPHIC"===u&&E.dataManager.geographicLookup.has(G)?dt.IsGeographic:dt.None;const $e=h.lockedNodeLocations.get($.attributes[Ue]);R[ve]=$e.x,P[ve]=$e.y}else if("GEOGRAPHIC"===u&&E.dataManager.geographicLookup.has(G)){var Qe;j[ve]=dt.IsGeographic;let $e=null;const Ve=$.attributes[E.dataManager.geographicLookup.get(G).name];switch(null===(Qe=E.dataManager.geographicLookup.get(G))||void 0===Qe?void 0:Qe.geometryType){case"esriGeometryPoint":R[ve]=null==Ve?void 0:Ve.x,P[ve]=null==Ve?void 0:Ve.y;break;case"esriGeometryPolygon":$e=null==Ve?void 0:Ve.centroid,null!=(null===(nt=$e)||void 0===nt?void 0:nt.x)&&null!=(null===(Ke=$e)||void 0===Ke?void 0:Ke.y)?(R[ve]=$e.x,P[ve]=$e.y):j[ve]=dt.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":$e=null==Ve||null===(ke=Ve.extent)||void 0===ke?void 0:ke.center,null!=(null===(_e=$e)||void 0===_e?void 0:_e.x)&&null!=(null===(et=$e)||void 0===et?void 0:et.y)?(R[ve]=$e.x,P[ve]=$e.y):j[ve]=dt.IsMovable;break;default:j[ve]=dt.IsMovable}(null==R[ve]||null==P[ve]||Number.isNaN(R[ve])||Number.isNaN(P[ve]))&&(j[ve]=dt.IsMovable,R[ve]=0,P[ve]=0)}else j[ve]=dt.IsMovable,R[ve]=0,P[ve]=0;D.set($.attributes[Ue],ve),_[ve]={feature:$,typeName:G},ve++});let Je=!1;const De=new Map;v.forEach(G=>{const $=G.feature.attributes[xt],he=G.feature.attributes[wt],nt=D.get($),Ke=D.get(he);if(void 0!==nt&&void 0!==Ke){const ke=$+"-"+he,_e=De.get(ke);(null==_e?void 0:_e.has(G.typeName))||(z[Re]=nt,ge[Re]=Ke,void 0===_e?De.set(ke,new Map([[G.typeName,Re]])):_e.set(G.typeName,Re),Re++),L.push(G)}else Je=!0,E.relationshipLinkChartDiagramLookup.set($,null),E.linkChartGeohashLookup.set($,null)}),Je&&de.A.getLogger(E).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),yield function Kn(){return Jt||(Jt=T.e(1538).then(T.bind(T,71538)).then(u=>u.l).then(({default:u})=>u({locateFile:h=>(0,Zn.s)(`esri/libs/linkchartlayout/${h}`)})).then(u=>{!function Wn(u){Me=u}(u)}),Jt)}();const{success:Ge,links:Q}=xe(j,R,P,z.subarray(0,Re),ge.subarray(0,Re));if(!Ge)throw new me.A("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let G=0;G<_.length;G++){if(P[G]>84.9999?P[G]=84.9999:P[G]<-84.9999&&(P[G]=-84.9999),R[G]>179.9999?R[G]=179.9999:R[G]<-179.9999&&(R[G]=-179.9999),_[G].feature.attributes[ze]=new Tn.A(R[G],P[G]),M.has(_[G].typeName)){const he=M.get(_[G].typeName);null==he||he.set(_[G].feature.attributes[Ue],_[G].feature)}else{const he=new Map;he.set(_[G].feature.attributes[Ue],_[G].feature),M.set(_[G].typeName,he)}A.set(_[G].feature.attributes[Ue],_[G].feature);const $=(0,Y.Ux)(_[G].feature.attributes[ze]);E.entityLinkChartDiagramLookup.set(_[G].feature.attributes[Ue],_[G].feature.attributes[ze]?$:null),E.linkChartGeohashLookup.set(_[G].feature.attributes[Ue],(0,le.Qj)(_[G].feature.attributes[ze].y,_[G].feature.attributes[ze].x,12)),_[G].feature.attributes[ze].x<re.xmin&&(re.xmin=_[G].feature.attributes[ze].x),_[G].feature.attributes[ze].x>re.xmax&&(re.xmax=_[G].feature.attributes[ze].x),_[G].feature.attributes[ze].y<re.ymin&&(re.ymin=_[G].feature.attributes[ze].y),_[G].feature.attributes[ze].y>re.ymax&&(re.ymax=_[G].feature.attributes[ze].y)}if(E.linkChartExtent.xmin=re.xmin,E.linkChartExtent.xmax=re.xmax,E.linkChartExtent.ymin=re.ymin,E.linkChartExtent.ymax=re.ymax,!Q)throw new me.A("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");const pe=new Map,Oe=new Map,je=new Map,Ae=new Set;for(let G=0;G<L.length;G++){const $=[],he=L[G],nt=he.feature.attributes[xt],Ke=he.feature.attributes[wt],ke=nt+"-"+Ke,_e=De.get(ke).get(he.typeName),et=0===_e?0:null==Q?void 0:Q.vertexEndIndex[_e-1];if(!Ae.has(_e)){var we,Se;if(Ae.add(_e),Q.types[_e]===bt.Recursive){const Be=[Q.vertices[2*et],Q.vertices[2*et+1]],Mt=[Q.vertices[2*(et+1)],Q.vertices[2*(et+1)+1]],ct=[.5*(Be[0]+Mt[0]),.5*(Be[1]+Mt[1])],Et=[ct[0]-Be[0],ct[1]-Be[1]],tn=[ct[0]+Et[1],ct[1]-Et[0]],nn=[ct[0]-Et[1],ct[1]+Et[0]];$.push(Be),$.push(tn),$.push(Mt),$.push(nn),$.push(Be)}else{if(Q.types[_e]!==bt.Regular){de.A.getLogger(E).warn("A relationship generated an unsupported link geometry type.  It will not be rendered");continue}for(let Be=et;Be<Q.vertexEndIndex[_e];Be++)$.push([Q.vertices[2*Be],Q.vertices[2*Be+1]])}const at=null===(we=_[D.get(nt)])||void 0===we?void 0:we.feature.attributes[ze],vt=null===(Se=_[D.get(Ke)])||void 0===Se?void 0:Se.feature.attributes[ze];$[0][0]===at.x&&$[0][1]===at.y||($[0]=[at.x,at.y]),$[$.length-1][0]===vt.x&&$[$.length-1][1]===vt.y||($[$.length-1]=[vt.x,vt.y]);for(let Be=1;Be<$.length-1;Be++)$[Be][1]>85.5?$[Be][1]=85.5:$[Be][1]<-85.5&&($[Be][1]=-85.5),$[Be][0]>179.9999?$[Be][0]=179.9999:$[Be][0]<-179.9999&&($[Be][0]=-179.9999);pe.has(ke)?pe.get(ke).push($):pe.set(ke,[$])}const Qe=pe.get(ke);Oe.has(ke)||(Oe.set(ke,new Map),je.set(ke,new Map));const $e=Oe.get(ke),Ve=je.get(ke);$e.has(he.typeName)||($e.set(he.typeName,Qe.shift()),Ve.set(he.typeName,0));const Dt=$e.get(he.typeName);Ve.set(he.typeName,Ve.get(he.typeName)+1);const qt=new Wt.A({paths:Dt});if(he.feature.attributes[ze]=qt,x.has(he.typeName)){const at=x.get(he.typeName);null==at||at.set(he.feature.attributes[Ue],he.feature)}else{const at=new Map;at.set(he.feature.attributes[Ue],he.feature),x.set(he.typeName,at)}A.set(he.feature.attributes[Ue],he.feature);const en=(0,Y.Ux)(he.feature.attributes[ze]);E.relationshipLinkChartDiagramLookup.set(he.feature.attributes[Ue],he.feature.attributes[ze]?en:null),E.linkChartGeohashLookup.set(he.feature.attributes[Ue],"")}for(const G of L){var Te,q;G.feature.attributes[Bt]=null!==(Te=null===(q=je.get(G.feature.attributes[xt]+"-"+G.feature.attributes[wt]))||void 0===q?void 0:q.get(G.typeName))&&void 0!==Te?Te:null}return E._currentLinkChartConfig={layoutMode:u},{nodes:M,links:x,idMap:A}})()}applyNewLinkChartLayout(u="RADIAL_TREE",h){var E=this;return(0,w.A)(function*(){const g=[];yield E.calculateLinkChartLayout(u,h),E.layers.forEach(v=>{g.push(v.refreshCachedQueryEngine())}),yield Promise.all(g),E._refreshNamedTypes()})()}getCurrentNodeLocations(){var u;const h=new Map;return null!==(u=this.dataManager.inclusionModeDefinition)&&void 0!==u&&null!==(u=u.namedTypeDefinitions)&&void 0!==u&&u.forEach(E=>{var g;null==E||null===(g=E.members)||void 0===g||g.forEach(v=>{const L=v.linkChartLocation;let M;L&&(M="x"in L?{x:L.x,y:L.y}:{x:L.coords[0],y:L.coords[1]},h.set(v.id,new Tn.A({x:M.x,y:M.y})))})}),h}synchronizeInclusionListWithCache(){var u=this;return(0,w.A)(function*(){return new Promise(h=>{var E;null!==(E=u.dataManager.inclusionModeDefinition)&&void 0!==E&&E.namedTypeDefinitions.forEach((g,v)=>{if(g.useAllData=!1,g.members&&g.members.size>0){if(!u.dataManager.sublayerCaches.get(v))return;const L=new Set(Array.from(u.dataManager.sublayerCaches.get(v).keys()));Array.from(g.members.keys()).filter(M=>!L.has(M)).forEach(M=>{var x;null===(x=g.members)||void 0===x||x.delete(M)})}}),h()})})()}refreshLinkChartCache(u){var h=this;return(0,w.A)(function*(){yield h.dataManager.refreshCacheContent(u);const E=[];h.layers.forEach(g=>{E.push(g.refreshCachedQueryEngine())}),yield Promise.all(E),h._refreshNamedTypes()})()}_handleNewRecords(u){var h=this;return(0,w.A)(function*(){const E=[];h.dataManager.addToLayer(u);for(const g of u)h.sublayerIdsCache.has(g.typeName)||(h.sublayerIdsCache.set(g.typeName,new Set),E.push(g.typeName)),h.sublayerIdsCache.get(g.typeName).add(g.id);for(const g of E)if(h._graphTypeLookup.has(g)){const v=h._graphTypeLookup.get(g),L="endPoints"in v?"relationship":"entity",M=new zt({objectType:v,parentCompositeLayer:h,graphType:L,title:g});"entity"===L?h.dataManager.entityTypeNames.add(g):h.dataManager.relationshipTypeNames.add(g),M.geometryType?h.layers.push(M):h.tables.push(M),h.dataManager.sublayerCaches.set(g,new Map)}yield h.dataManager.refreshCacheContent(u.map(g=>g.id)),yield h.applyNewLinkChartLayout(h._currentLinkChartConfig.layoutMode)})()}_initializeDiagram(){var u=this;return(0,w.A)(function*(){var h;u.defaultLinkChartConfig?u.defaultLinkChartConfig.doNotRecalculateLayout?(null!==(h=u.dataManager.inclusionModeDefinition)&&void 0!==h&&null!==(h=h.namedTypeDefinitions)&&void 0!==h&&h.forEach((E,g)=>{var v;null==E||null===(v=E.members)||void 0===v||v.forEach(L=>{const M=L.linkChartLocation;let x;const A=L.id;if(!M)return;x="x"in M?{x:M.x,y:M.y}:{x:M.coords[0],y:M.coords[1]};const D=(0,Y.Ux)(x);u.dataManager.relationshipTypeNames.has(g)?u.relationshipLinkChartDiagramLookup.set(A,D):u.entityLinkChartDiagramLookup.set(A,D),u.linkChartGeohashLookup.set(A,(0,le.Qj)(x.x,x.y,12)),u.linkChartExtent.xmin>x.x&&(u.linkChartExtent.xmin=x.x),u.linkChartExtent.xmax<x.x&&(u.linkChartExtent.xmax=x.x),u.linkChartExtent.ymin>x.y&&(u.linkChartExtent.ymin=x.y),u.linkChartExtent.ymax<x.y&&(u.linkChartExtent.ymax=x.y)})}),u.memberRelationshipTypes.forEach(E=>{var g;E.name&&(null===(g=u.dataManager.sublayerCaches.get(E.name))||void 0===g||g.forEach(v=>{const L=u.relationshipLinkChartDiagramLookup.get(v.attributes[xt]),M=u.relationshipLinkChartDiagramLookup.get(v.attributes[wt]);if(L&&M){const x=(0,Y.Ux)(new Wt.A({paths:[[L.coords[0],L.coords[1]],[M.coords[0],M.coords[1]]]}));u.relationshipLinkChartDiagramLookup.set(v.attributes[Ue],x)}else u.relationshipLinkChartDiagramLookup.set(v.attributes[Ue],null);u.linkChartGeohashLookup.set(v.attributes[Ue],"")}))})):yield u.calculateLinkChartLayout(u.defaultLinkChartConfig.layoutMode,{lockedNodeLocations:u.getCurrentNodeLocations()}):yield u.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:u.getCurrentNodeLocations()})})()}_refreshNamedTypes(){for(const u of this.layers)u.emit("refresh",{dataChanged:!0});for(const u of this.tables)u.emit("refresh",{dataChanged:!0})}};(0,N._)([(0,U.MZ)()],qe.prototype,"dataPreloadedInLocalCache",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"defaultLinkChartConfig",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"dataManager",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"knowledgeGraph",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"layers",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"entityLinkChartDiagramLookup",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"relationshipLinkChartDiagramLookup",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"linkChartExtent",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"linkChartGeohashLookup",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"memberEntityTypes",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"memberRelationshipTypes",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"sublayerIdsCache",void 0),(0,N._)([(0,U.MZ)()],qe.prototype,"tables",void 0),(0,N._)([(0,U.MZ)({json:{read:!1}})],qe.prototype,"type",void 0),qe=(0,N._)([(0,H.$)("esri.layers.LinkChartLayer")],qe);const $n=qe},72211:(Xe,Ce,T)=>{T.d(Ce,{LF:()=>me,M9:()=>de,zu:()=>fe});var w=T(5922),N=T(89221),Le=T(79845),ce=T(26073);function me(X,Y,W){try{return function U(X){if(!X||0===X.length)return null;if(function ie(X){const Y=X[0];return!!Y&&"scale"in Y}(X)){const Y=[];for(const W of X)Y.push({scale:W.scale,value:fe(W.value)});return Y}return fe(X)}(X)}catch(Ee){var oe;null==W||null===(oe=W.messages)||void 0===oe||oe.push(Ee)}return null}function de(X,Y,W,oe){try{const Ee=function ne(X){const Y=(0,Le.q)(X);return Y?(0,ce.dw)(Y)?Y.map(W=>W.toJSON()):Y.map(({scale:W,effects:oe})=>({scale:W,value:oe.map(Ee=>Ee.toJSON())})):null}(X);(0,N.sM)(W,Ee,Y)}catch(Ee){oe.messages&&oe.messages.push(Ee)}}function fe(X){if(null==X||!X.length)return"";const Y=[];for(const W of X){let oe=[];switch(W.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":oe=[H(W,"amount")];break;case"blur":oe=[H(W,"radius","pt")];break;case"hue-rotate":oe=[H(W,"angle","deg")];break;case"drop-shadow":oe=[H(W,"xoffset","pt"),H(W,"yoffset","pt"),H(W,"blurRadius","pt"),le(W,"color")];break;case"bloom":oe=[H(W,"strength"),H(W,"radius","pt"),H(W,"threshold")]}const Ee=`${W.type}(${oe.filter(Boolean).join(" ")})`;(0,Le.q)(Ee),Y.push(Ee)}return Y.join(" ")}function H(X,Y,W){if(null==X[Y])throw new w.A("effect:missing-parameter",`Missing parameter '${Y}' in ${X.type} effect`,{effect:X});return W?X[Y]+W:""+X[Y]}function le(X,Y){if(null==X[Y])throw new w.A("effect:missing-parameter",`Missing parameter '${Y}' in ${X.type} effect`,{effect:X});const W=X[Y];return`rgba(${W[0]||0}, ${W[1]||0}, ${W[2]||0}, ${W[3]/255||0})`}},89962:(Xe,Ce,T)=>{T.d(Ce,{F0:()=>me,Vx:()=>U,e2:()=>ie,f:()=>fe});var w=T(3248),N=T(77806),Le=T(78200),ce=T(48254);function me(H){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===H||"esriGeometryMultipoint"===H?ce.Cb:"esriGeometryPolyline"===H?ce.yM:ce.WR}}}const de=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let ne=1;function U(H,le){if((0,w.A)("esri-csp-restrictions"))return()=>({[le]:null,...H});try{let X=`this.${le} = null;`;for(const W in H)X+=`this${de.test(W)?`.${W}`:`["${W}"]`} = ${JSON.stringify(H[W])};`;const Y=new Function(`\n      return class AttributesClass$${ne++} {\n        constructor() {\n          ${X};\n        }\n      }\n    `)();return()=>new Y}catch{return()=>({[le]:null,...H})}}function ie(H={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,N.o8)(H)}}]}function fe(H,le){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:H},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:le,supportsDelete:le,supportsEditing:le,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:le,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:Le.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:le,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},93410:(Xe,Ce,T)=>{T.d(Ce,{d:()=>ie});var w=T(8189),N=T(85211),de=(T(3248),T(35150),T(40707),T(76576)),ne=T(72211);const U={read:{reader:ne.LF},write:{allowNull:!0,writer:ne.M9}},ie=fe=>{let H=class extends fe{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,w._)([(0,N.MZ)({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],H.prototype,"blendMode",void 0),(0,w._)([(0,N.MZ)({json:{read:!1,write:!1,origins:{"web-map":U,"portal-item":U}}})],H.prototype,"effect",void 0),H=(0,w._)([(0,de.$)("esri.layers.mixins.BlendLayer")],H),H}},1151:(Xe,Ce,T)=>{T.d(Ce,{J:()=>k});var w=T(10467),N=T(8189),Le=T(35150),ce=T(56492),me=T(85211),de=T(48669),ie=(T(40707),T(3248),T(76576)),fe=T(50501),H=T(31178),W=(T(89447),T(5922),T(76410),T(34703));const oe=new H.A,Ee=new WeakMap;function J(I,C){return Number.isFinite(I)&&Number.isFinite(C)?C<=0?I:J(C,I%C):0}let ee=0,b=0;function S(){const I=Date.now();let C=!1;for(const F of oe){const V=F.deref();var O;V?V.refreshInterval&&I-(null!==(O=Ee.get(V))&&void 0!==O?O:0)+5>=6e4*V.refreshInterval&&(Ee.set(V,I),V.refresh(I)):C=!0}if(C)for(let F=oe.length-1;F>=0;F--)oe.at(F).deref()||oe.removeAt(F)}(0,W.fm)(()=>{const I=Date.now();let C=0;for(const O of oe){const F=O.deref();F&&(C=J(Math.round(6e4*F.refreshInterval),C),F.refreshInterval?Ee.get(F)||Ee.set(F,I):Ee.delete(F))}if(C!==b){if(b=C,clearInterval(ee),0===b)return void(ee=0);ee=setInterval(S,b)}});const k=I=>{let C=class extends I{constructor(...O){super(...O),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,ce.sg)(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||function be(I){(function K(I){return null!=I&&"object"==typeof I&&"refreshInterval"in I&&"refresh"in I})(I)&&oe.push(new WeakRef(I))}(this)},()=>{})}destroy(){!function We(I){const C=oe.find(O=>O.deref()===I);C&&oe.remove(C)}(this)}castRefreshInterval(O){return O>=.1?O:O<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(O=Date.now()){(0,ce.QZ)(this._debounceHasDataChanged()).then(F=>{F&&this._set("refreshTimestamp",O),this.emit("refresh",{dataChanged:F})},F=>{Le.A.getLogger(this).error(F),this.emit("refresh",{dataChanged:!1,error:F})})}hasDataChanged(){return(0,w.A)(function*(){return!0})()}get test(){const O=this;return{set refreshInterval(F){O._set("refreshInterval",F)}}}};return(0,N._)([(0,me.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:fe.K}}}}})],C.prototype,"refreshInterval",void 0),(0,N._)([(0,de.w)("refreshInterval")],C.prototype,"castRefreshInterval",null),(0,N._)([(0,me.MZ)({readOnly:!0})],C.prototype,"refreshTimestamp",void 0),(0,N._)([(0,me.MZ)({readOnly:!0})],C.prototype,"refreshParameters",null),C=(0,N._)([(0,ie.$)("esri.layers.mixins.RefreshableLayer")],C),C}},33036:(Xe,Ce,T)=>{T.d(Ce,{j:()=>ne});var w=T(8189),N=T(85211),de=(T(3248),T(35150),T(40707),T(76576));const ne=ie=>{let fe=class extends ie{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const H={minScale:this.minScale,maxScale:this.maxScale},le=this.parent;le&&"effectiveScaleRange"in le&&function U(ie,fe){ie.minScale=ie.minScale>0?fe.minScale>0?Math.min(ie.minScale,fe.minScale):ie.minScale:fe.minScale,ie.maxScale=ie.maxScale>0?fe.maxScale>0?Math.max(ie.maxScale,fe.maxScale):ie.maxScale:fe.maxScale}(H,le.effectiveScaleRange);const X=this._get("effectiveScaleRange");return X&&X.minScale===H.minScale&&X.maxScale===H.maxScale?X:H}};return(0,w._)([(0,N.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],fe.prototype,"minScale",void 0),(0,w._)([(0,N.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],fe.prototype,"maxScale",void 0),(0,w._)([(0,N.MZ)({readOnly:!0})],fe.prototype,"effectiveScaleRange",null),fe=(0,w._)([(0,de.$)("esri.layers.mixins.ScaleRangeLayer")],fe),fe}},20329:(Xe,Ce,T)=>{T.d(Ce,{A:()=>I});var W,w=T(8189),N=T(47280),Le=T(49976),ce=T(71065),me=T(77806),de=T(67685),ne=T(85211),fe=(T(3248),T(35150),T(17221)),H=T(76576),le=T(50305),Y=(T(40707),T(4858));let oe=W=class extends ce.oY{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(C,O){return O.value?(0,Y.mX)(O.value):C}writeExpression(C,O,F){null!=this.value&&(C=(0,Y.mX)(this.value)),null!=C&&(O[F]=C)}clone(){return new W({expression:this.expression,title:this.title,value:this.value})}};(0,w._)([(0,ne.MZ)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],oe.prototype,"expression",void 0),(0,w._)([(0,fe.w)("expression",["expression","value"])],oe.prototype,"readExpression",null),(0,w._)([(0,le.K)("expression")],oe.prototype,"writeExpression",null),(0,w._)([(0,ne.MZ)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],oe.prototype,"title",void 0),(0,w._)([(0,ne.MZ)({json:{read:!1,write:!1}})],oe.prototype,"value",void 0),oe=W=(0,w._)([(0,H.$)("esri.layers.support.LabelExpressionInfo")],oe);const Ee=oe;var J,be=T(58443),We=T(91644),K=T(35564);const ee=new Le.J({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function b(C,O,F){return{enabled:!(0,be.TU)(null==F?void 0:F.layer)}}function S(C){var O;return!C||"service"!==C.origin&&"map-image"!==(null===(O=C.layer)||void 0===O?void 0:O.type)}function te(C){var O;return!!function Z(C){return"map-image"===(null==C?void 0:C.type)}(C)&&!(null===(O=C.capabilities)||void 0===O||null===(O=O.exportMap)||void 0===O||!O.supportsArcadeExpressionForLabeling)}let k=J=class extends ce.oY{static evaluateWhere(C,O){const F=(V,se,He)=>{switch(se){case"=":return V==He;case"<>":return V!=He;case">":return V>He;case">=":return V>=He;case"<":return V<He;case"<=":return V<=He}return!1};try{if(null==C)return!0;const V=C.split(" ");if(3===V.length)return F(O[V[0]],V[1],V[2]);if(7===V.length){const se=F(O[V[0]],V[1],V[2]),He=V[3],rt=F(O[V[4]],V[5],V[6]);switch(He){case"AND":return se&&rt;case"OR":return se||rt}}return!1}catch{console.log("Error.: can't parse = "+C)}}constructor(C){super(C),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=We.Hk,this.useCodedValues=void 0,this.where=null}readLabelExpression(C,O){const F=O.labelExpressionInfo;if(!F||!F.value&&!F.expression)return C}writeLabelExpression(C,O,F){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)C=(0,Y.D3)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const V=(0,Y.tH)(this.labelExpressionInfo.expression);V&&(C="["+V+"]")}null!=C&&(O[F]=C)}writeLabelExpressionInfo(C,O,F,V){if(null==C&&null!=this.labelExpression&&S(V))C=new Ee({expression:this.getLabelExpressionArcade()});else if(!C)return;const se=C.toJSON(V);se.expression&&(O[F]=se)}writeMaxScale(C,O){(C||this.minScale)&&(O.maxScale=C)}writeMinScale(C,O){(C||this.maxScale)&&(O.minScale=C)}getLabelExpression(){return(0,Y.XJ)(this)}getLabelExpressionArcade(){return(0,Y.BI)(this)}getLabelExpressionSingleField(){return(0,Y.rU)(this)}hash(){return JSON.stringify(this)}clone(){return new J({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,me.o8)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,me.o8)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,w._)([(0,ne.MZ)({type:String,json:{write:!0}})],k.prototype,"name",void 0),(0,w._)([(0,ne.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:b}}}}})],k.prototype,"allowOverrun",void 0),(0,w._)([(0,ne.MZ)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:b}}}}})],k.prototype,"deconflictionStrategy",void 0),(0,w._)([(0,ne.MZ)({type:String,json:{write:{overridePolicy(C,O,F){return this.labelExpressionInfo&&"service"===(null==F?void 0:F.origin)&&te(F.layer)?{enabled:!1}:{allowNull:!0}}}}})],k.prototype,"labelExpression",void 0),(0,w._)([(0,fe.w)("labelExpression")],k.prototype,"readLabelExpression",null),(0,w._)([(0,le.K)("labelExpression")],k.prototype,"writeLabelExpression",null),(0,w._)([(0,ne.MZ)({type:Ee,json:{write:{overridePolicy:(C,O,F)=>function Ie(C){return S(C)||te(null==C?void 0:C.layer)}(F)?{allowNull:!0}:{enabled:!1}}}})],k.prototype,"labelExpressionInfo",void 0),(0,w._)([(0,le.K)("labelExpressionInfo")],k.prototype,"writeLabelExpressionInfo",null),(0,w._)([(0,ne.MZ)({type:ee.apiValues,json:{type:ee.jsonValues,read:ee.read,write:ee.write}})],k.prototype,"labelPlacement",void 0),(0,w._)([(0,ne.MZ)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],k.prototype,"labelPosition",void 0),(0,w._)([(0,ne.MZ)({type:Number})],k.prototype,"maxScale",void 0),(0,w._)([(0,le.K)("maxScale")],k.prototype,"writeMaxScale",null),(0,w._)([(0,ne.MZ)({type:Number})],k.prototype,"minScale",void 0),(0,w._)([(0,le.K)("minScale")],k.prototype,"writeMinScale",null),(0,w._)([(0,ne.MZ)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:b}}}}})],k.prototype,"repeatLabel",void 0),(0,w._)([(0,ne.MZ)({type:Number,cast:de.cr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:b}}}}})],k.prototype,"repeatLabelDistance",void 0),(0,w._)([(0,ne.MZ)({types:N.em,json:{origins:{"web-scene":{types:N.Rv,write:K.oO,default:null}},write:K.oO,default:null}})],k.prototype,"symbol",void 0),(0,w._)([(0,ne.MZ)({type:Boolean,json:{write:!0}})],k.prototype,"useCodedValues",void 0),(0,w._)([(0,ne.MZ)({type:String,json:{write:!0}})],k.prototype,"where",void 0),k=J=(0,w._)([(0,H.$)("esri.layers.support.LabelClass")],k);const I=k},81687:(Xe,Ce,T)=>{T.d(Ce,{ui:()=>V,Yj:()=>k,id:()=>He,kF:()=>Z,fV:()=>Ie,C1:()=>It,hG:()=>_t,hn:()=>rt,ke:()=>O,Ih:()=>F,M6:()=>S,Qo:()=>I,Fm:()=>se,PY:()=>b,OZ:()=>te});var w=T(12849),N=T(50501),Le=T(28067),ce=T(32034),me=T(88135),U=(T(89952),T(77806),T(97442)),J=T(88485),ee=T(46873);const b={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:N.K}}},S={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(ue,ae)=>!ae.disablePopup},write:{enabled:!0,writer(ue,ae,ye){ae[ye]=!ue}}}},Z={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:N.K}}},te={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:me.w}}},Ie={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:N.K}}},k={value:null,type:J.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:N.K}}};function I(ue){return{type:ue,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const C={write:{enabled:!0,layerContainerTypes:N.K},read:!0},O={type:Number,json:{origins:{"web-document":C,"portal-item":{write:!0}}}},F={...O,json:{...O.json,origins:{"web-document":{...C,write:{enabled:!0,layerContainerTypes:N.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(ue,ae,ye)=>{var Fe;return ye&&"service"!==ye.origin||!ae.drawingInfo||void 0===ae.drawingInfo.transparency?null!==(Fe=ae.layerDefinition)&&void 0!==Fe&&Fe.drawingInfo&&void 0!==ae.layerDefinition.drawingInfo.transparency?(0,ee.D)(ae.layerDefinition.drawingInfo.transparency):void 0:(0,ee.D)(ae.drawingInfo.transparency)}}}},V={type:w.A,readOnly:!0,get(){var ue,ae,ye;const Fe=null!=(null===(ue=this.layer)||void 0===ue?void 0:ue.timeInfo)?this.layer:null!=(null===(ae=this.i3slayer)||void 0===ae?void 0:ae.timeInfo)?this.i3slayer:null;if(null==Fe)return null;const{datesInUnknownTimezone:Pe,timeOffset:tt,useViewTime:it}=Fe,st=null===(ye=this.view)||void 0===ye?void 0:ye.timeExtent;let pt=Fe.timeExtent;Pe&&(pt=function K(ue){if(!ue)return ue;const{start:ae,end:ye}=ue;return new w.A({start:null!=ae?(0,U.S1)(ae,ae.getTimezoneOffset(),"minutes"):ae,end:null!=ye?(0,U.S1)(ye,ye.getTimezoneOffset(),"minutes"):ye})}(pt));let ot=it?st&&pt?st.intersection(pt):st||pt:pt;if(!ot||ot.isEmpty||ot.isAllTime)return ot;tt&&(ot=ot.offset(-tt.value,tt.unit)),Pe&&(ot=function We(ue){if(!ue)return ue;const{start:ae,end:ye}=ue;return new w.A({start:null!=ae?(0,U.S1)(ae,-ae.getTimezoneOffset(),"minutes"):ae,end:null!=ye?(0,U.S1)(ye,-ye.getTimezoneOffset(),"minutes"):ye})}(ot));const Ne=this._get("timeExtent");return ot.equals(Ne)?Ne:ot}},se={type:Le.A,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(ue,ae)=>{const ye=Le.A.fromJSON(ue);return null!=ae.spatialReference&&"object"==typeof ae.spatialReference&&(ye.spatialReference=ce.A.fromJSON(ae.spatialReference)),ye}}}},read:!1}},He={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},rt={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:N.K}}},name:"layerDefinition.minScale",write:!0}},_t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:N.K}}},name:"layerDefinition.maxScale",write:!0}},It={json:{write:{ignoreOrigin:!0,layerContainerTypes:N.K},origins:{"web-map":{read:!1,write:!1}}}}},4858:(Xe,Ce,T)=>{T.d(Ce,{BI:()=>Y,D3:()=>le,XJ:()=>X,lc:()=>H,mX:()=>oe,rU:()=>W,tH:()=>ee});var w=T(1119);const N="__begin__",Le="__end__",ce=new RegExp(N,"ig"),me=new RegExp(Le,"ig"),de=new RegExp("^"+N,"i"),ne=new RegExp(Le+"$","i"),U='"',ie=U+" + ",fe=" + "+U;function H(b){return b.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function le(b){return b.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function X(b){const S={expression:"",type:"none"};return b.labelExpressionInfo?b.labelExpressionInfo.value?(S.expression=b.labelExpressionInfo.value,S.type="conventional"):b.labelExpressionInfo.expression&&(S.expression=b.labelExpressionInfo.expression,S.type="arcade"):null!=b.labelExpression&&(S.expression=H(b.labelExpression),S.type="conventional"),S}function Y(b){const S=X(b);if(!S)return null;switch(S.type){case"conventional":return oe(S.expression);case"arcade":return S.expression}return null}function W(b){const S=X(b);if(!S)return null;switch(S.type){case"conventional":return function be(b){const S=null==b?void 0:b.match(Ee);return(null==S?void 0:S[1].trim())||null}(S.expression);case"arcade":return ee(S.expression)}return null}function oe(b){let S;return b?(S=(0,w.HC)(b,Z=>N+'$feature["'+Z+'"]'+Le),S=de.test(S)?S.replace(de,""):U+S,S=ne.test(S)?S.replace(ne,""):S+U,S=S.replaceAll(ce,ie).replaceAll(me,fe)):S='""',S}const Ee=/^\s*\{([^}]+)\}\s*$/i,We=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,K=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,J=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function ee(b){if(!b)return null;let S=We.exec(b)||K.exec(b);return S?S[1]||S[3]:(S=J.exec(b),S?S[2]:null)}},48716:(Xe,Ce,T)=>{T.d(Ce,{j:()=>Le});var w=T(82663),N=T(47258);const Le={unknown:1,inches:(0,w.oU)(1,"meters","inches"),feet:(0,w.oU)(1,"meters","feet"),"us-feet":(0,w.oU)(1,"meters","us-feet"),yards:(0,w.oU)(1,"meters","yards"),miles:(0,w.oU)(1,"meters","miles"),"nautical-miles":(0,w.oU)(1,"meters","nautical-miles"),millimeters:(0,w.oU)(1,"meters","millimeters"),centimeters:(0,w.oU)(1,"meters","centimeters"),decimeters:(0,w.oU)(1,"meters","decimeters"),meters:(0,w.oU)(1,"meters","meters"),kilometers:(0,w.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,w.vl)(1,"meters",N.$O.radius)}},52466:(Xe,Ce,T)=>{T.d(Ce,{A:()=>fe});var U,w=T(8189),N=T(71065),Le=T(77806),ce=T(85211),me=T(55739),de=T(76576),ne=T(50305);let ie=U=class extends N.oY{constructor(H){super(H),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(H,le){le.resultOffset=this.start,le.resultRecordCount=this.num||10}clone(){return new U((0,Le.o8)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};(0,w._)([(0,ce.MZ)({type:[String],json:{write:!0}})],ie.prototype,"attachmentTypes",void 0),(0,w._)([(0,ce.MZ)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],ie.prototype,"attachmentsWhere",void 0),(0,w._)([(0,ce.MZ)({type:Boolean,json:{write:!0}})],ie.prototype,"cacheHint",void 0),(0,w._)([(0,ce.MZ)({type:[String],json:{write:!0}})],ie.prototype,"keywords",void 0),(0,w._)([(0,ce.MZ)({type:[Number],json:{write:!0}})],ie.prototype,"globalIds",void 0),(0,w._)([(0,ce.MZ)({json:{write:!0}})],ie.prototype,"name",void 0),(0,w._)([(0,ce.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],ie.prototype,"num",void 0),(0,w._)([(0,ce.MZ)({type:[Number],json:{write:!0}})],ie.prototype,"objectIds",void 0),(0,w._)([(0,ce.MZ)({type:Boolean,json:{default:!1,write:!0}})],ie.prototype,"returnMetadata",void 0),(0,w._)([(0,ce.MZ)({type:[Number],json:{write:!0}})],ie.prototype,"size",void 0),(0,w._)([(0,ce.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],ie.prototype,"start",void 0),(0,w._)([(0,ne.K)("start"),(0,ne.K)("num")],ie.prototype,"writeStart",null),(0,w._)([(0,ce.MZ)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ie.prototype,"where",void 0),ie=U=(0,w._)([(0,de.$)("esri.rest.support.AttachmentQuery")],ie),ie.from=(0,me.dp)(ie);const fe=ie},93327:(Xe,Ce,T)=>{T.d(Ce,{A:()=>We});var oe,w=T(8189),N=T(21152),Le=T(81098),ce=T(49976),me=T(71065),de=T(77806),ne=T(85211),fe=(T(3248),T(35150),T(17221)),H=T(76576),le=T(50305),X=T(32034),Y=T(61320),W=T(29141);const Ee=new ce.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let be=oe=class extends me.oY{constructor(K){super(K),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(K,J){const ee=X.A.fromJSON(J.spatialReference),b=[];for(let Z=0;Z<K.length;Z++){var S;const te=K[Z],Ie=Le.A.fromJSON(te),k=null===(S=te.geometry)||void 0===S?void 0:S.spatialReference;null==Ie.geometry||k||(Ie.geometry.spatialReference=ee);const I=te.aggregateGeometries,C=Ie.aggregateGeometries;if(I&&null!=C)for(const O in C){const F=C[O],V=I[O];null==F||(null==V?void 0:V.spatialReference)||(F.spatialReference=ee)}b.push(Ie)}return b}writeGeometryType(K,J,ee,b){if(K)return void Ee.write(K,J,ee,b);const{features:S}=this;if(S)for(const Z of S)if(null!=(null==Z?void 0:Z.geometry))return void Ee.write(Z.geometry.type,J,ee,b)}readQueryGeometry(K,J){if(!K)return null;const ee=!!K.spatialReference,b=(0,Y.rS)(K);return b&&!ee&&J.spatialReference&&(b.spatialReference=X.A.fromJSON(J.spatialReference)),b}writeSpatialReference(K,J){if(K)return void(J.spatialReference=K.toJSON());const{features:ee}=this;if(ee)for(const b of ee)if(b&&null!=b.geometry&&b.geometry.spatialReference)return void(J.spatialReference=b.geometry.spatialReference.toJSON())}clone(){return new oe(this.cloneProperties())}cloneProperties(){return(0,de.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(K){const J=this.write();if(J.features&&Array.isArray(K)&&K.length>0)for(let ee=0;ee<J.features.length;ee++){const b=J.features[ee];if(b.geometry){const S=null==K?void 0:K[ee];b.geometry=(null==S?void 0:S.toJSON())||b.geometry}}return J}quantize(K){const{scale:[J,ee],translate:[b,S]}=K,Ie=this.features,k=this._getQuantizationFunction(this.geometryType,I=>Math.round((I-b)/J),I=>Math.round((S-I)/ee));for(let I=0,C=Ie.length;I<C;I++)null!=k&&k(Ie[I].geometry)||(Ie.splice(I,1),I--,C--);return this.transform=K,this}unquantize(){var K,J;const{geometryType:ee,features:b,transform:S}=this;if(!S)return this;const{translate:[Z,te],scale:[Ie,k]}=S;let O=null,F=null;if(this.hasZ&&null!=(null==S||null===(K=S.scale)||void 0===K?void 0:K[2])){const{translate:[,,se],scale:[,,He]}=S;O=rt=>rt*He+se}if(this.hasM&&null!=(null==S||null===(J=S.scale)||void 0===J?void 0:J[3])){const{translate:[,,,se],scale:[,,,He]}=S;F=rt=>null==rt?rt:rt*He+se}const V=this._getHydrationFunction(ee,se=>se*Ie+Z,se=>te-se*k,O,F);for(const{geometry:se}of b)null!=se&&V&&V(se);return this.transform=null,this}_quantizePoints(K,J,ee){let b,S;const Z=[];for(let te=0,Ie=K.length;te<Ie;te++){const k=K[te];if(te>0){const I=J(k[0]),C=ee(k[1]);I===b&&C===S||(Z.push([I-b,C-S]),b=I,S=C)}else b=J(k[0]),S=ee(k[1]),Z.push([b,S])}return Z.length>0?Z:null}_getQuantizationFunction(K,J,ee){return"point"===K?b=>(b.x=J(b.x),b.y=ee(b.y),b):"polyline"===K||"polygon"===K?b=>{const S=(0,Y.Bi)(b)?b.rings:b.paths,Z=[];for(let te=0,Ie=S.length;te<Ie;te++){const I=this._quantizePoints(S[te],J,ee);I&&Z.push(I)}return Z.length>0?((0,Y.Bi)(b)?b.rings=Z:b.paths=Z,b):null}:"multipoint"===K?b=>{const S=this._quantizePoints(b.points,J,ee);return S&&S.length>0?(b.points=S,b):null}:"extent"===K?b=>b:null}_getHydrationFunction(K,J,ee,b,S){return"point"===K?Z=>{Z.x=J(Z.x),Z.y=ee(Z.y),b&&(Z.z=b(Z.z))}:"polyline"===K||"polygon"===K?Z=>{const te=(0,Y.Bi)(Z)?Z.rings:Z.paths;let Ie,k;for(let I=0,C=te.length;I<C;I++){const O=te[I];for(let F=0,V=O.length;F<V;F++){const se=O[F];F>0?(Ie+=se[0],k+=se[1]):(Ie=se[0],k=se[1]),se[0]=J(Ie),se[1]=ee(k)}}if(b&&S)for(let I=0,C=te.length;I<C;I++){const O=te[I];for(let F=0,V=O.length;F<V;F++){const se=O[F];se[2]=b(se[2]),se[3]=S(se[3])}}else if(b)for(let I=0,C=te.length;I<C;I++){const O=te[I];for(let F=0,V=O.length;F<V;F++){const se=O[F];se[2]=b(se[2])}}else if(S)for(let I=0,C=te.length;I<C;I++){const O=te[I];for(let F=0,V=O.length;F<V;F++){const se=O[F];se[2]=S(se[2])}}}:"extent"===K?Z=>{Z.xmin=J(Z.xmin),Z.ymin=ee(Z.ymin),Z.xmax=J(Z.xmax),Z.ymax=ee(Z.ymax),b&&null!=Z.zmax&&null!=Z.zmin&&(Z.zmax=b(Z.zmax),Z.zmin=b(Z.zmin)),S&&null!=Z.mmax&&null!=Z.mmin&&(Z.mmax=S(Z.mmax),Z.mmin=S(Z.mmin))}:"multipoint"===K?Z=>{const te=Z.points;let Ie,k;for(let I=0,C=te.length;I<C;I++){const O=te[I];I>0?(Ie+=O[0],k+=O[1]):(Ie=O[0],k=O[1]),O[0]=J(Ie),O[1]=ee(k)}if(b&&S)for(let I=0,C=te.length;I<C;I++){const O=te[I];O[2]=b(O[2]),O[3]=S(O[3])}else if(b)for(let I=0,C=te.length;I<C;I++){const O=te[I];O[2]=b(O[2])}else if(S)for(let I=0,C=te.length;I<C;I++){const O=te[I];O[2]=S(O[2])}}:null}};(0,w._)([(0,ne.MZ)({type:String,json:{write:!0}})],be.prototype,"displayFieldName",void 0),(0,w._)([(0,ne.MZ)({type:Boolean,json:{write:{overridePolicy:K=>({enabled:K})}}})],be.prototype,"exceededTransferLimit",void 0),(0,w._)([(0,ne.MZ)({type:[Le.A],json:{write:!0}})],be.prototype,"features",void 0),(0,w._)([(0,fe.w)("features")],be.prototype,"readFeatures",null),(0,w._)([(0,ne.MZ)({type:[W.A],json:{write:!0}})],be.prototype,"fields",void 0),(0,w._)([(0,ne.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:Ee.read}}})],be.prototype,"geometryType",void 0),(0,w._)([(0,le.K)("geometryType")],be.prototype,"writeGeometryType",null),(0,w._)([(0,ne.MZ)({type:Boolean,json:{write:{overridePolicy:K=>({enabled:K})}}})],be.prototype,"hasM",void 0),(0,w._)([(0,ne.MZ)({type:Boolean,json:{write:{overridePolicy:K=>({enabled:K})}}})],be.prototype,"hasZ",void 0),(0,w._)([(0,ne.MZ)({types:N.yR,json:{write:!0}})],be.prototype,"queryGeometry",void 0),(0,w._)([(0,fe.w)("queryGeometry")],be.prototype,"readQueryGeometry",null),(0,w._)([(0,ne.MZ)({type:X.A,json:{write:!0}})],be.prototype,"spatialReference",void 0),(0,w._)([(0,le.K)("spatialReference")],be.prototype,"writeSpatialReference",null),(0,w._)([(0,ne.MZ)({json:{write:!0}})],be.prototype,"transform",void 0),be=oe=(0,w._)([(0,H.$)("esri.rest.support.FeatureSet")],be),be.prototype.toJSON.isDefaultToJSON=!0;const We=be},41843:(Xe,Ce,T)=>{T.d(Ce,{tn:()=>X});var w=T(92165),N=T(86300),Le=T(54042),ne=(T(75432),T(65121),T(558),T(8975)),H=(T(90792),T(83902),T(98089),T(61099)),le=T(17580);function X({displayField:k,editFieldsInfo:I,fields:C,objectIdField:O,title:F},V){if(!C)return null;const se=function We(k,I){var C;const O=null==I?void 0:I.visibleFieldNames;return function oe(k,I){const C=k;return I&&(k=k.filter(O=>!I.includes(O.type))),k===C&&(k=k.slice()),k.sort(Ee),k}(null!==(C=k.fields)&&void 0!==C?C:[],(null==I?void 0:I.ignoreFieldTypes)||Ie).map(F=>new H.A({fieldName:F.name,isEditable:(0,N.R$)(F,k),label:F.alias,format:ee(F),visible:W(F,{...k,visibleFieldNames:O})}))}({editFieldsInfo:I,fields:C,objectIdField:O},V);if(!se.length)return null;const He=function Z(k){const I=(0,N.mB)(k),{titleBase:C}=k;return I?`${C}: {${I.trim()}}`:null!=C?C:""}({titleBase:F,fields:C,displayField:k}),rt=function b(){return[new ne.A,new Le.A]}();return new w.A({title:He,content:rt,fieldInfos:se})}const W=(k,I)=>I.visibleFieldNames?I.visibleFieldNames.has(k.name):(0,N.Bz)(k,I);function Ee(k,I){return"oid"===k.type?-1:"oid"===I.type?1:te(k)?-1:te(I)?1:(k.alias||k.name).toLocaleLowerCase().localeCompare((I.alias||I.name).toLocaleLowerCase())}function ee(k){switch(k.type){case"small-integer":case"integer":case"single":return new le.A({digitSeparator:!0,places:0});case"double":return new le.A({digitSeparator:!0,places:2});case"string":return(0,N.JL)(k.name)?new le.A({digitSeparator:!0,places:0}):null;default:return null}}function te(k){return"name"===(k.name&&k.name.toLowerCase())||"name"===(k.alias&&k.alias.toLowerCase())}const Ie=["geometry","blob","raster","guid","xml"]},88485:(Xe,Ce,T)=>{T.d(Ce,{A:()=>ee});var Y,w=T(8189),N=T(49976),Le=T(71065),ce=T(11432),me=T(85211),ie=(T(3248),T(35150),T(40707),T(17221)),fe=T(76576),H=T(50305),le=T(10467),X=T(86300);let W=Y=class extends Le.oY{constructor(b){super(b)}collectRequiredFields(b,S){var Z=this;return(0,le.A)(function*(){return(0,X.Dx)(b,S,Z.expression)})()}clone(){return new Y({expression:this.expression,title:this.title})}equals(b){return this.expression===b.expression&&this.title===b.title}};(0,w._)([(0,me.MZ)({type:String,json:{write:!0}})],W.prototype,"expression",void 0),(0,w._)([(0,me.MZ)({type:String,json:{write:!0}})],W.prototype,"title",void 0),W=Y=(0,w._)([(0,fe.$)("esri.layers.support.FeatureExpressionInfo")],W);const oe=W;var be,Ee=T(82575);const We=(0,N.O)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),K=new N.J({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let J=be=class extends Le.oY{constructor(b){super(b),this.offset=null}readFeatureExpressionInfo(b,S){return null!=b?b:S.featureExpression&&0===S.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(b,S,Z,te){S[Z]=b.write({},te),"0"===b.expression&&(S.featureExpression={value:0})}get mode(){const{offset:b,featureExpressionInfo:S}=this;return this._isOverridden("mode")?this._get("mode"):null!=b||S?"relative-to-ground":"on-the-ground"}set mode(b){this._override("mode",b)}set unit(b){this._set("unit",b)}write(b,S){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(b,S):null}clone(){return new be({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(b){return this.mode===b.mode&&this.offset===b.offset&&this.unit===b.unit&&(0,ce.CM)(this.featureExpressionInfo,b.featureExpressionInfo)}};(0,w._)([(0,me.MZ)({type:oe,json:{write:!0}})],J.prototype,"featureExpressionInfo",void 0),(0,w._)([(0,ie.w)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],J.prototype,"readFeatureExpressionInfo",null),(0,w._)([(0,H.K)("featureExpressionInfo",{featureExpressionInfo:{type:oe},"featureExpression.value":{type:[0]}})],J.prototype,"writeFeatureExpressionInfo",null),(0,w._)([(0,me.MZ)({type:We.apiValues,nonNullable:!0,json:{type:We.jsonValues,read:We.read,write:{writer:We.write,isRequired:!0}}})],J.prototype,"mode",null),(0,w._)([(0,me.MZ)({type:Number,json:{write:!0}})],J.prototype,"offset",void 0),(0,w._)([(0,me.MZ)({type:Ee.KQ,json:{type:String,read:K.read,write:K.write}})],J.prototype,"unit",null),J=be=(0,w._)([(0,fe.$)("esri.layers.support.ElevationInfo")],J);const ee=J},91644:(Xe,Ce,T)=>{T.d(Ce,{A7:()=>U,Cx:()=>ie,Hk:()=>fe,JJ:()=>Y,UK:()=>ne,jM:()=>le,x3:()=>X}),T(3248);var N=T(88521),Le=T(55417),ce=T(46602),me=T(47705),de=T(48254);const ne=ce.A.fromJSON(de.Cb),U=Le.A.fromJSON(de.yM),ie=N.A.fromJSON(de.WR),fe=me.A.fromJSON(de.JZ),le=ce.A.fromJSON(de.nC),X=Le.A.fromJSON(de.HW),Y=N.A.fromJSON(de.b6)},48254:(Xe,Ce,T)=>{T.d(Ce,{Cb:()=>Le,HW:()=>U,JZ:()=>de,WR:()=>me,b6:()=>ie,nC:()=>ne,yM:()=>ce});const w=[252,146,31,255],Le={type:"esriSMS",style:"esriSMSCircle",size:6,color:w,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},ce={type:"esriSLS",style:"esriSLSSolid",width:.75,color:w},me={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},de={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},ne={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},U={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},ie={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},82575:(Xe,Ce,T)=>{T.d(Ce,{Ao:()=>Le,KQ:()=>me});var w=T(48716);function Le(de){return 1/(w.j[de]||1)}const me=function ce(){const de=Object.keys(w.j);return de.sort(),de}()}}]);