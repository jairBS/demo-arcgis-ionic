"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8147,9927],{98147:(x,B,r)=>{r.r(B),r.d(B,{default:()=>l});var v=r(10467),n=r(8189),K=r(89563),P=r(5922),V=r(11432),U=r(39693),O=r(56492),L=r(45272),c=r(85211),C=(r(3248),r(35150),r(40707),r(17221)),W=r(76576),$=r(33119),u=r(95478),p=r(73474),d=r(25936),m=r(17049),A=r(85551),I=r(81687);class T{constructor(t,i,a,h){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in t?(this.values=t.pixelData,this.width=t.width,this.height=t.height,this.noDataValue=t.noDataValue):(this.values=t,this.width=i,this.height=a,this.noDataValue=h)}get hasNoDataValues(){return null==this._hasNoDataValues&&(this._hasNoDataValues=this.values.includes(this.noDataValue)),this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(null!=this._minValue)return;const{noDataValue:t,values:i}=this;let a=1/0,h=-1/0,M=!0;for(const g of i)g===t?this._hasNoDataValues=!0:(a=g<a?g:a,h=g>h?g:h,M=!1);M?(this._minValue=0,this._maxValue=0):(this._minValue=a,this._maxValue=h>-3e38?h:0)}}var R=r(94542);class _ extends R.B{constructor(t=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,a){return t&&0!==t.byteLength?this.invoke({buffer:t,options:i},a):Promise.resolve(null)}release(){--this.ref<=0&&(j.forEach((t,i)=>{t===this&&j.delete(i)}),this.destroy())}}const j=new Map;let s=class extends((0,p.f)((0,d.b)((0,m.q)((0,A.A)((0,U.P)(u.A)))))){constructor(...e){super(...e),this.capabilities={operations:{supportsTileMap:!1}},this.copyright=null,this.heightModelInfo=null,this.path=null,this.minScale=void 0,this.maxScale=void 0,this.opacity=1,this.operationalLayerType="ArcGISTiledElevationServiceLayer",this.sourceJSON=null,this.type="elevation",this.url=null,this.version=null,this._lercDecoder=function f(e=null){let t=j.get(e);return t||(null!=e?(t=new _(i=>e.immediate.schedule(i)),j.set(e,t)):(t=new _,j.set(null,t))),++t.ref,t}()}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){this._lercDecoder=(0,V.Gz)(this._lercDecoder)}readCapabilities(e,t){const i=t.capabilities&&t.capabilities.split(",").map(a=>a.toLowerCase().trim());return i?{operations:{supportsTileMap:i.includes("tilemap")}}:{operations:{supportsTileMap:!1}}}readVersion(e,t){let i=t.currentVersion;return i||(i=9.3),i}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:i=>{if(i.typeKeywords)for(let a=0;a<i.typeKeywords.length;a++)if("elevation 3d layer"===i.typeKeywords[a].toLowerCase())return!0;throw new P.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).catch(O.QP).then(()=>this._fetchImageService(t))),Promise.resolve(this)}fetchTile(e,t,i,a){const h=null!=(a=a||{signal:null}).signal?a.signal:a.signal=(new AbortController).signal,M={responseType:"array-buffer",signal:h},g={noDataValue:a.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(e,t,i,a)).then(()=>(0,K.A)(this.getTileUrl(e,t,i),M)).then(y=>this._lercDecoder.decode(y.data,g,h)).then(y=>new T(y))}getTileUrl(e,t,i){const h=(0,L.x0)({...this.parsedUrl.query,blankTile:!(!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile)&&null});return`${this.parsedUrl.path}/tile/${e}/${t}/${i}${h?"?"+h:""}`}queryElevation(e,t){var i=this;return(0,v.A)(function*(){const{ElevationQuery:a}=yield r.e(6848).then(r.bind(r,96848));return(0,O.Te)(t),(new a).query(i,e,t)})()}createElevationSampler(e,t){var i=this;return(0,v.A)(function*(){const{ElevationQuery:a}=yield r.e(6848).then(r.bind(r,96848));return(0,O.Te)(t),(new a).createSampler(i,e,t)})()}_fetchTileAvailability(e,t,i,a){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,i,a):Promise.resolve("unknown")}_fetchImageService(e){var t=this;return(0,v.A)(function*(){var i;if(t.sourceJSON)return t.sourceJSON;const a={query:{f:"json",...t.parsedUrl.query},responseType:"json",signal:e},h=yield(0,K.A)(t.parsedUrl.path,a);h.ssl&&(t.url=null===(i=t.url)||void 0===i?void 0:i.replace(/^http:/i,"https:")),t.sourceJSON=h.data,t.read(h.data,{origin:"service",url:t.parsedUrl})})()}get hasOverriddenFetchTile(){return!this.fetchTile[o]}};(0,n._)([(0,c.MZ)({readOnly:!0})],s.prototype,"capabilities",void 0),(0,n._)([(0,C.w)("service","capabilities",["capabilities"])],s.prototype,"readCapabilities",null),(0,n._)([(0,c.MZ)({json:{read:{source:"copyrightText"}}})],s.prototype,"copyright",void 0),(0,n._)([(0,c.MZ)({readOnly:!0,type:$.A})],s.prototype,"heightModelInfo",void 0),(0,n._)([(0,c.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],s.prototype,"path",void 0),(0,n._)([(0,c.MZ)({type:["show","hide"]})],s.prototype,"listMode",void 0),(0,n._)([(0,c.MZ)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],s.prototype,"minScale",void 0),(0,n._)([(0,c.MZ)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],s.prototype,"maxScale",void 0),(0,n._)([(0,c.MZ)({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],s.prototype,"opacity",void 0),(0,n._)([(0,c.MZ)({type:["ArcGISTiledElevationServiceLayer"]})],s.prototype,"operationalLayerType",void 0),(0,n._)([(0,c.MZ)()],s.prototype,"sourceJSON",void 0),(0,n._)([(0,c.MZ)({json:{read:!1},value:"elevation",readOnly:!0})],s.prototype,"type",void 0),(0,n._)([(0,c.MZ)(I.OZ)],s.prototype,"url",void 0),(0,n._)([(0,c.MZ)()],s.prototype,"version",void 0),(0,n._)([(0,C.w)("version",["currentVersion"])],s.prototype,"readVersion",null),s=(0,n._)([(0,W.$)("esri.layers.ElevationLayer")],s);const o=Symbol("default-fetch-tile");s.prototype.fetchTile[o]=!0;const l=s},85551:(x,B,r)=>{r.d(B,{A:()=>R});var v=r(10467),n=r(8189),K=r(23098),P=r(77469),V=r(89563),U=r(89447),O=r(5922),L=r(35150),c=r(11432),E=r(56492),S=r(45272),D=r(85211),$=(r(3248),r(40707),r(17221)),u=r(76576),p=r(50305),d=r(58443),m=r(73874),A=r(46577),I=r(52606),T=r(69927);const R=j=>{let f=class extends j{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,c.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(s){s!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",s))}readPortalItem(s,o,l){if(o.itemId)return new A.default({id:o.itemId,portal:null==l?void 0:l.portal})}writePortalItem(s,o){null!=s&&s.id&&(o.itemId=s.id)}loadFromPortal(s,o){var l=this;return(0,v.A)(function*(){var e;if(null!==(e=l.portalItem)&&void 0!==e&&e.id)try{const{load:t}=yield Promise.all([r.e(5565),r.e(2076),r.e(6180)]).then(r.bind(r,56180));return(0,E.Te)(o),yield t({instance:l,supportedTypes:s.supportedTypes,validateItem:s.validateItem,supportsData:s.supportsData,layerModuleTypeMap:s.layerModuleTypeMap},o)}catch(t){throw(0,E.zf)(t)||L.A.getLogger(l).warn(`Failed to load layer (${l.title}, ${l.id}) portal item (${l.portalItem.id})\n  ${t}`),t}})()}finishLoadEditablePortalLayer(s){var o=this;return(0,v.A)(function*(){o._set("userHasEditingPrivileges",yield o._fetchUserHasEditingPrivileges(s).catch(l=>((0,E.QP)(l),!0)))})()}setUserPrivileges(s,o){var l=this;return(0,v.A)(function*(){if(!K.A.userPrivilegesApplied)return l.finishLoadEditablePortalLayer(o);if(l.url)try{const{features:{edit:e,fullEdit:t},content:{updateItem:i}}=yield l._fetchUserPrivileges(s,o);l._set("userHasEditingPrivileges",e),l._set("userHasFullEditingPrivileges",t),l._set("userHasUpdateItemPrivileges",i)}catch(e){(0,E.QP)(e)}})()}_fetchUserPrivileges(s,o){var l=this;return(0,v.A)(function*(){let e=l.portalItem;if(!s||!e||!e.loaded||e.sourceUrl)return l._fetchFallbackUserPrivileges(o);const t=s===e.id;if(t&&e.portal.user)return(0,T.It)(e);let i,a;if(t)i=e.portal.url;else try{i=yield(0,d.wI)(l.url,o)}catch(y){(0,E.QP)(y)}if(!i||!(0,S.b8)(i,e.portal.url))return l._fetchFallbackUserPrivileges(o);try{const y=null!=o?o.signal:null;a=yield null==P.id?void 0:P.id.getCredential(`${i}/sharing`,{prompt:!1,signal:y})}catch(y){(0,E.QP)(y)}if(!a)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(t?yield e.reload():(e=new A.default({id:s,portal:{url:i}}),yield e.load(o)),e.portal.user)return(0,T.It)(e)}catch(y){(0,E.QP)(y)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(s){var o=this;return(0,v.A)(function*(){let l=!0;try{l=yield o._fetchUserHasEditingPrivileges(s)}catch(e){(0,E.QP)(e)}return{features:{edit:l,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(s){var o=this;return(0,v.A)(function*(){const l=o.url?null==P.id?void 0:P.id.findCredential(o.url):null;if(!l)return!0;const e=_.credential===l?_.user:yield o._fetchEditingUser(s);return _.credential=l,_.user=e,null==(null==e?void 0:e.privileges)||e.privileges.includes("features:user:edit")})()}_fetchEditingUser(s){var o=this;return(0,v.A)(function*(){var l,e;const t=null===(l=o.portalItem)||void 0===l||null===(l=l.portal)||void 0===l?void 0:l.user;if(t)return t;const i=P.id.findServerInfo(null!==(e=o.url)&&void 0!==e?e:"");if(null==i||!i.owningSystemUrl)return null;const a=`${i.owningSystemUrl}/sharing/rest`,h=m.A.getDefault();if(h&&h.loaded&&(0,S.S8)(h.restUrl)===(0,S.S8)(a))return h.user;const M=`${a}/community/self`,g=null!=s?s.signal:null,y=yield(0,U.Ke)((0,V.A)(M,{authMode:"no-prompt",query:{f:"json"},signal:g}));return y.ok?I.A.fromJSON(y.value.data):null})()}read(s,o){o&&(o.layer=this),super.read(s,o)}write(s,o){var l;const e=null==o?void 0:o.portal,t=(null===(l=this.portalItem)||void 0===l?void 0:l.id)&&(this.portalItem.portal||m.A.getDefault());return e&&t&&!(0,S.ut)(t.restUrl,e.restUrl)?(o.messages&&o.messages.push(new O.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(s,{...o,layer:this})}};return(0,n._)([(0,D.MZ)({type:A.default})],f.prototype,"portalItem",null),(0,n._)([(0,$.w)("web-document","portalItem",["itemId"])],f.prototype,"readPortalItem",null),(0,n._)([(0,p.K)("web-document","portalItem",{itemId:{type:String}})],f.prototype,"writePortalItem",null),(0,n._)([(0,D.MZ)({clonable:!1})],f.prototype,"resourceReferences",void 0),(0,n._)([(0,D.MZ)({type:Boolean,readOnly:!0})],f.prototype,"userHasEditingPrivileges",void 0),(0,n._)([(0,D.MZ)({type:Boolean,readOnly:!0})],f.prototype,"userHasFullEditingPrivileges",void 0),(0,n._)([(0,D.MZ)({type:Boolean,readOnly:!0})],f.prototype,"userHasUpdateItemPrivileges",void 0),f=(0,n._)([(0,u.$)("esri.layers.mixins.PortalLayer")],f),f},_={credential:null,user:null}},69927:(x,B,r)=>{r.d(B,{It:()=>$,LG:()=>O,OM:()=>E,Sm:()=>S,Y:()=>L,bK:()=>c,mm:()=>W,sQ:()=>D});var v=r(10467),n=r(11817),K=r(32034),P=r(55039);function U(){return(U=(0,v.A)(function*(u){const p=u.spatialReference;if(p.isWGS84)return u.clone();if(p.isWebMercator)return(0,P.ci)(u);const d=K.A.WGS84;return yield(0,n.initializeProjection)(p,d),(0,n.project)(u,d)})).apply(this,arguments)}function O(u,p){if(!L(u,p)){const d=u.typeKeywords;d?d.push(p):u.typeKeywords=[p]}}function L(u,p){var d;return!(null===(d=u.typeKeywords)||void 0===d||!d.includes(p))}function c(u){return L(u,W.HOSTED_SERVICE)}function E(u,p){const d=u.typeKeywords;if(d){const m=d.indexOf(p);m>-1&&d.splice(m,1)}}function S(u,p,d){d?O(u,p):E(u,p)}function D(u){return C.apply(this,arguments)}function C(){return C=(0,v.A)(function*(u){const p=u.clone().normalize();let d;if(p.length>1)for(const m of p)d?m.width>d.width&&(d=m):d=m;else d=p[0];return function V(u){return U.apply(this,arguments)}(d)}),C.apply(this,arguments)}const W={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function $(u){var p;const{portal:d,isOrgItem:m,itemControl:A}=u,I=null===(p=d.user)||void 0===p?void 0:p.privileges;let T=!I||I.includes("features:user:edit"),R=!!m&&!(null==I||!I.includes("features:user:fullEdit"));const _="update"===A||"admin"===A;return _?R=T=!0:R&&(T=!0),{features:{edit:T,fullEdit:R},content:{updateItem:_}}}}}]);