"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4320],{33087:(Z,j,t)=>{t.d(j,{q:()=>A});var c=t(60611);class A{constructor(f,p){this._storage=new c.F,this.id="",this.name="",this.size=0,this._storage.maxSize=f,this._storage.register(this),p&&this._storage.registerRemoveFunc("",p)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(f,p,g=1){this._storage.put(this,f,p,g,1)}pop(f){return this._storage.pop(this,f)}get(f){return this._storage.get(this,f)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(f){this._storage.maxSize=f}resetHitRate(){}}},60611:(Z,j,t)=>{t.d(j,{F:()=>g,Mn:()=>p});var f,V,c=t(12438);(V=f||(f={}))[V.ALL=0]="ALL",V[V.SOME=1]="SOME";class p{constructor(a,i,s){this.name=a,this._storage=i,this.id=O+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),s&&(this._storage.registerRemoveFunc(this.id,s),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(a){return this._storage.getSize(this,a)}resetHitRate(){this._hit=this._miss=0}put(a,i,s,o=0){this._storage.put(this,a,i,s,o)}pop(a){const i=this._storage.pop(this,a);return void 0===i?++this._miss:++this._hit,i}get(a){const i=this._storage.get(this,a);return void 0===i?++this._miss:++this._hit,i}peek(a){return this._storage.peek(this,a)}updateSize(a,i,s){this._storage.updateSize(this,a,i,s)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class g{get size(){return this._size}constructor(a=10485760){this._maxSize=a,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new c.A,this._users=new c.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(a){this._users.push(a)}deregister(a){this._users.removeUnordered(a)}registerRemoveFunc(a,i){this._removeFuncs.push([a,i])}deregisterRemoveFunc(a){this._removeFuncs.filterInPlace(i=>i[0]!==a)}get maxSize(){return this._maxSize}set maxSize(a){this._maxSize=Math.max(a,-1),this._checkSize()}getSize(a,i){var s;const o=this._db.get(a.id+i);return null!==(s=null==o?void 0:o.size)&&void 0!==s?s:0}put(a,i,s,o,m){const r=this._db.get(i=a.id+i);if(r&&(this._size-=r.size,a.size-=r.size,this._db.delete(i),r.entry!==s&&this._notifyRemove(i,r.entry,r.size,f.ALL)),o>this._maxSize)return void this._notifyRemove(i,s,o,f.ALL);if(void 0===s)return void console.warn("Refusing to cache undefined entry ");if(!o||o<0)return console.warn(`Refusing to cache entry with size ${o} for key ${i}`),void this._notifyRemove(i,s,0,f.ALL);const u=1+Math.max(m,-4)- -3;this._db.set(i,new R(s,o,u)),this._size+=o,a.size+=o,this._checkSize()}updateSize(a,i,s,o){const m=this._db.get(i=a.id+i);if(m&&m.entry===s){for(this._size-=m.size,a.size-=m.size;o>this._maxSize;){const r=this._notifyRemove(i,s,o,f.SOME);if(!(null!=r&&r>0))return void this._db.delete(i);o=r}m.size=o,this._size+=o,a.size+=o,this._checkSize()}}pop(a,i){const s=this._db.get(i=a.id+i);if(s)return this._size-=s.size,a.size-=s.size,this._db.delete(i),++this._hit,s.entry;++this._miss}get(a,i){const s=this._db.get(i=a.id+i);if(void 0!==s)return this._db.delete(i),s.lives=s.lifetime,this._db.set(i,s),++this._hit,s.entry;++this._miss}peek(a,i){const s=this._db.get(a.id+i);return s?++this._hit:++this._miss,null==s?void 0:s.entry}get performanceInfo(){const a={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},s=new Array;this._db.forEach((r,u)=>{const y=r.lifetime;s[y]=(s[y]||0)+r.size,this._users.forAll(I=>{const{id:D,name:C}=I;u.startsWith(D)&&(i[C]=(i[C]||0)+r.size)})});const o={};this._users.forAll(r=>{const u=r.name;"hitRate"in r&&"number"==typeof r.hitRate&&!isNaN(r.hitRate)&&r.hitRate>0?(i[u]=i[u]||0,o[u]=Math.round(100*r.hitRate)+"%"):o[u]="0%"});const m=Object.keys(i);m.sort((r,u)=>i[u]-i[r]),m.forEach(r=>a[r]=Math.round(i[r]/2**20)+"MB / "+o[r]);for(let r=s.length-1;r>=0;--r){const u=s[r];u&&(a["Priority "+(r+-3-1)]=Math.round(u/this._size*100)+"%")}return a}resetStats(){this._hit=this._miss=0,this._users.forAll(a=>a.resetHitRate())}clear(a){const i=a.id;this._db.forEach((s,o)=>{o.startsWith(i)&&(this._size-=s.size,this._db.delete(o),this._notifyRemove(o,s.entry,s.size,f.ALL))}),a.size=0}clearAll(){this._db.forEach((a,i)=>this._notifyRemove(i,a.entry,a.size,f.ALL)),this._users.forAll(a=>a.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(a,i,s,o){let m;return this._removeFuncs.some(r=>{if(a.startsWith(r[0])){const u=r[1](i,o,s);return"number"==typeof u&&(m=u),!0}return!1}),m}_checkSize(){this._users.forAll(a=>this._checkSizeLimits(a)),this._checkSizeLimits()}_checkSizeLimits(a){const i=null!=a?a:this;if(i.maxSize<0||i.size<=i.maxSize)return;const s=null==a?void 0:a.id;let o=!0;for(;o;){o=!1;for(const[m,r]of this._db)if(0===r.lifetime&&(!s||m.startsWith(s))){if(this._purgeItem(m,r,a),i.size<=.9*i.maxSize)return;o||(o=this._db.has(m))}}for(const[m,r]of this._db)if((!s||m.startsWith(s))&&(this._purgeItem(m,r,a),i.size<=.9*i.maxSize))return}_purgeItem(a,i,s=this._users.find(o=>a.startsWith(o.id))){if(this._db.delete(a),i.lives<=1){this._size-=i.size,s&&(s.size-=i.size);const o=this._notifyRemove(a,i.entry,i.size,f.SOME);null!=o&&o>0&&(this._size+=o,s&&(s.size+=o),i.lives=i.lifetime,i.size=o,this._db.set(a,i))}else--i.lives,this._db.set(a,i)}}let O=0;class R{constructor(a,i,s){this.entry=a,this.size=i,this.lifetime=s,this.lives=s}}},32954:(Z,j,t)=>{function c(){return[1,0,0,0,1,0,0,0,1]}function x(O,R,V,a,i,s,o,m,r){return[O,R,V,a,i,s,o,m,r]}t.d(j,{fA:()=>x,vt:()=>c,zK:()=>p});const p=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:p,clone:function A(O){return[O[0],O[1],O[2],O[3],O[4],O[5],O[6],O[7],O[8]]},create:c,createView:function f(O,R){return new Float64Array(O,R,9)},fromValues:x},Symbol.toStringTag,{value:"Module"}))},40856:(Z,j,t)=>{t.d(j,{X_:()=>f,i1:()=>p,zx:()=>V});var c=t(69287),A=t(82663);const x=96;function f(s,o){const m=o||s.extent,r=s.width,u=(0,A.GA)(null==m?void 0:m.spatialReference);return m&&r?m.width/r*u*A.dy*x:0}function p(s,o){return s/((0,A.GA)(o)*A.dy*x)}function V(s,o,m){return function a(s,o){return 0===o||(0,c.Sp)(s,o)||s<o}(s,o)&&function i(s,o){return 0===o||(0,c.Sp)(s,o)||s>o}(s,m)}},78592:(Z,j,t)=>{t.d(j,{O3:()=>V,PU:()=>O,YW:()=>i,ex:()=>p,hv:()=>a,zp:()=>g});var c=t(69287),A=t(67685),x=t(53781),f=t(89141);const p=2.4;function g(s){return(0,A.PN)(s*p)}function O(s){return(0,A.Lz)(s)/p}function R(s,o,m,r){let{color:u,ratio:y}=o,{color:I,ratio:D}=m;D===y&&(1===D?y-=1e-6:D+=1e-6);const C=(0,c.qE)((r-y)/(D-y),0,1);(0,x.l)(s,u.toArray(),I.toArray(),C)}function V(s){const m=new Uint8ClampedArray(2048);if((s=s.filter(({ratio:D})=>D>=0&&D<=1).sort((D,C)=>D.ratio-C.ratio).map(({color:D,ratio:C})=>({color:D,ratio:Math.max(C,.001)}))).length<1)return m;let r=s[0],u=s[0],y=1;const I=(0,f.vt)();for(let D=0;D<512;D++){const C=(D+.5)/512;for(;C>u.ratio&&y<s.length;)r=u,u=s[y++];R(I,r,u,C),m.set(I,4*D)}return m}function a(s,o,m){const r=Math.sqrt(s**2+o**2)/m;return r>1?0:3/(Math.PI*m**2)*(1-r**2)**2}function i(s){return"function"==typeof s?s:s?o=>+o[s]:()=>1}},29459:(Z,j,t)=>{t.d(j,{e:()=>ut});var r,c=t(8189),A=t(31178),x=t(5605),f=t(5922),p=t(48900),g=t(85211),a=(t(3248),t(35150),t(40707),t(76576)),i=t(40856),s=t(88766),o=t(60746),m=t(66727);let u=r=class extends m.A{constructor(Y){super(Y),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new r({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,c._)([(0,g.MZ)({type:[Number,String],json:{write:!0}})],u.prototype,"left",void 0),(0,c._)([(0,g.MZ)({type:[Number,String],json:{write:!0}})],u.prototype,"right",void 0),(0,c._)([(0,g.MZ)({type:[Number,String],json:{write:!0}})],u.prototype,"top",void 0),(0,c._)([(0,g.MZ)({type:[Number,String],json:{write:!0}})],u.prototype,"bottom",void 0),u=r=(0,c._)([(0,a.$)("esri.views.layers.support.ClipRect")],u);const y=u;var I=t(75644);let D=class extends m.A{constructor(Y){super(Y),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,c._)([(0,g.MZ)({type:[[[Number]]],json:{write:!0}})],D.prototype,"path",void 0),D=(0,c._)([(0,a.$)("esri.views.layers.support.Path")],D);const F=A.A.ofType({key:"type",base:null,typeMap:{rect:y,path:D,geometry:I.A}}),ut=Y=>{let W=class extends Y{constructor(){super(...arguments),this.attached=!1,this.clips=new F,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this.visibleAtCurrentScale=!1,this.highlightOptions=null}initialize(){var P,$,H,J;const mt=null===(P=null===($=this.view)||void 0===$?void 0:$.spatialReferenceLocked)||void 0===P||P;(null===(H=this.view)||void 0===H?void 0:H.spatialReference)&&mt&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new f.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new s.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,p.wB)(()=>this.suspended,z=>{this.container&&(this.container.visible=!z)},p.pc),(0,p.wB)(()=>this.updateSuspended,z=>{this.view&&!z&&this.updateRequested&&this.view.requestUpdate()},p.pc),(0,p.wB)(()=>{var z,X;return null!==(z=null===(X=this.layer)||void 0===X?void 0:X.opacity)&&void 0!==z?z:1},z=>{this.container&&(this.container.opacity=z)},p.pc),(0,p.wB)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",z=>{this.container&&(this.container.blendMode=z)},p.pc),(0,p.wB)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,z=>{this.container&&(this.container.effect=z)},p.pc),(0,p.wB)(()=>this.highlightOptions,z=>this.container.highlightOptions=z,p.pc),(0,p.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},p.pc),(0,p.wB)(()=>{var z;return{scale:null===(z=this.view)||void 0===z?void 0:z.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}},({scale:z})=>{const X=null!=z&&this.isVisibleAtScale(z);X!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",X)},p.pc)],"constructor"),null!==(J=this.view)&&void 0!==J&&J.whenLayerView?this.view.whenLayerView(this.layer).then(z=>{z===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var P;const $=null===(P=this.view)||void 0===P?void 0:P.spatialReference;return null==$||this.supportsSpatialReference($)}get updateSuspended(){return this.suspended}get updating(){var P;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(P=this._updatingHandles)||void 0===P||!P.updating))}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(P){const $=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!$)return!0;const{minScale:H,maxScale:J}=$;return(0,i.zx)(P,H,J)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(P){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",P),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(P))):this.updateRequested=!1}hitTest(P,$){return Promise.resolve(null)}supportsSpatialReference(P){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const P=super.getSuspendInfo(),$=!this.spatialReferenceSupported,H=this.visibleAtCurrentScale;return $&&(P.spatialReferenceNotSupported=$),H&&(P.outsideScaleRange=H),P}addAttachHandles(P){this.addHandles(P,"attach")}};return(0,c._)([(0,g.MZ)()],W.prototype,"attached",void 0),(0,c._)([(0,g.MZ)({type:F,set(P){const $=(0,x.V)(P,this._get("clips"),F);this._set("clips",$)}})],W.prototype,"clips",void 0),(0,c._)([(0,g.MZ)()],W.prototype,"container",void 0),(0,c._)([(0,g.MZ)()],W.prototype,"moving",void 0),(0,c._)([(0,g.MZ)({readOnly:!0})],W.prototype,"spatialReferenceSupported",null),(0,c._)([(0,g.MZ)({readOnly:!0})],W.prototype,"updateParameters",void 0),(0,c._)([(0,g.MZ)()],W.prototype,"updateRequested",void 0),(0,c._)([(0,g.MZ)()],W.prototype,"updateSuspended",null),(0,c._)([(0,g.MZ)()],W.prototype,"updating",null),(0,c._)([(0,g.MZ)()],W.prototype,"view",void 0),(0,c._)([(0,g.MZ)({readOnly:!0})],W.prototype,"visibleAtCurrentScale",void 0),(0,c._)([(0,g.MZ)({type:o.A})],W.prototype,"highlightOptions",void 0),W=(0,c._)([(0,a.$)("esri.views.2d.layers.LayerView2D")],W),W}},67245:(Z,j,t)=>{t.r(j),t.d(j,{default:()=>te});var c=t(10467),A=t(8189),m=(t(21152),t(81098),t(79122),t(70176),t(92089),t(9826),t(15317),t(38582),t(73747),t(13318),t(85718),t(35150)),u=(t(47280),t(31178)),I=(t(3248),t(60797)),D=t(56492),C=t(48900),F=t(85211),Y=(t(40707),t(76576)),W=t(51995),P=t(8190),$=t(62928),H=t(28),J=t(5922),St=(t(3804),t(58272),t(29430),t(23098),t(9015),t(28067)),Dt=(t(68643),t(21870),t(13303),t(55861),t(93615),t(41510),t(58701)),rt=(t(91766),t(47763),t(69630),t(71045),t(82854),t(65264),t(70614),t(88918),t(3691),t(25867),t(39516),t(57249),t(2544),t(34572),t(56854),t(47942),t(53737),t(3688),t(68051),t(65374)),zt=(t(69287),t(47669),t(88532)),Ct=(t(30365),t(91644),t(1684),t(86468),t(40702),t(63888)),Lt=(t(62931),t(42425),t(69473)),nt=(t(82047),t(11242),t(77440),t(50915)),pt=(t(79061),t(92517),t(68165),t(26136)),Tt=(t(83693),t(9599),t(74847),t(88258),t(97550),t(55900),t(52321),t(54e3),t(20904),t(6115),t(89563),t(45272),t(55912),t(64559),t(63367),t(38730),t(28291),t(41396),t(93093),t(14356),t(20047),t(67399),t(80745),t(92405),t(2296),t(12225)),Ut=(t(20914),t(32034),t(47258),t(77469),t(18800),t(89447),t(43431),t(54290),t(67347)),xt=t(77031),It=t(40611),yt=t(11432),Bt=t(10249),jt=t(32954),Vt=t(83953),Wt=t(45475),$t=t(70418),ft=t(32788),Kt=t(4931),Ht=t(45513);const b=(0,jt.vt)(),Gt={none:rt.fu.None,loop:rt.fu.Loop,oscillate:rt.fu.Oscillate};class Ft extends Ct.q{constructor(l){super(),this.elementView=l,this.isWrapAround=!1,this.perspectiveTransform=(0,Wt.vt)(),this._playHandle=null,this._vertices=new Float32Array(20),this._handles=[],this._handles.push((0,C.wB)(()=>this.elementView.element.opacity,h=>this.opacity=h,C.Vh),(0,C.wB)(()=>[this.elementView.coords],()=>{this.requestRender()},C.Vh),(0,C.wB)(()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions],()=>{var h;null!==(h=this._playHandle)&&void 0!==h&&h.remove(),this.texture=(0,yt.WD)(this.texture),this.requestRender()},C.Vh),(0,C.z7)(()=>this.elementView.element.loaded,()=>{const h=this.elementView.element;this.ready(),"video"===h.type&&null!=h.content&&this._handles.push((0,It.on)(h.content,"play",()=>this.requestRender()))},C.Vh)),l.element.load().catch(h=>{m.A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new J.A("element-load-error","Element cannot be displayed",{element:l,error:h}))})}getMesh(l){throw new Error("Method not implemented.")}destroy(){var l;null!==(l=this._playHandle)&&void 0!==l&&l.remove(),this._handles.forEach(h=>h.remove()),this.texture=(0,yt.WD)(this.texture)}get dvsMat3(){return this.parent.dvsMat3}beforeRender(l){const{context:h}=l,v=this.elementView.element.content;if(null!=v){const E=v instanceof HTMLImageElement,M=v instanceof HTMLVideoElement,B=E?v.naturalWidth:M?v.videoWidth:v.width,T=E?v.naturalHeight:M?v.videoHeight:v.height;if(this._updatePerspectiveTransform(B,T),this.texture)M&&!v.paused&&(this.texture.setData(v),this.requestRender(),this.texture.generateMipmap());else{const U=new Kt.R;if(U.wrapMode=nt.pF.CLAMP_TO_EDGE,U.preMultiplyAlpha=!0,U.width=B,U.height=T,"getFrame"in v){const S=L=>{this.texture?this.texture.setData(L):this.texture=new pt.g(h,U,L),this.requestRender()};"animationOptions"in this.elementView.element&&(this._playHandle=(0,$t.ZH)(v,function Zt(d){return d?{...d,playAnimation:d.playing,repeatType:d.repeatType?Gt[d.repeatType]:void 0}:{}}(this.elementView.element.animationOptions),null,S))}else this.texture=new pt.g(h,U,v);this.texture.generateMipmap(),M&&!v.paused&&this.requestRender()}}super.beforeRender(l)}_createTransforms(){return null}updateDrawCoords(l,h){const v=this.elementView.coords;if(null==v)return;const[E,M,B,T]=v.rings[0],U=this._vertices,{x:S,y:L}=l,N=0!==h;U.set(N?[M[0]-S,M[1]-L,E[0]-S,E[1]-L,B[0]-S,B[1]-L,T[0]-S,T[1]-L,T[0]-S,T[1]-L,M[0]+h-S,M[1]-L,M[0]+h-S,M[1]-L,E[0]+h-S,E[1]-L,B[0]+h-S,B[1]-L,T[0]+h-S,T[1]-L]:[M[0]-S,M[1]-L,E[0]-S,E[1]-L,B[0]-S,B[1]-L,T[0]-S,T[1]-L]),this.isWrapAround=N}getVAO(l,h,v){if(null==this.elementView.coords)return null;const E=this._vertices;if(this._vao)this._geometryVbo.setData(E);else{this._geometryVbo=ft.g.createVertex(l,nt._U.DYNAMIC_DRAW,E);const M=ft.g.createVertex(l,nt._U.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new Ht.Z(l,v,h,{geometry:this._geometryVbo,tex:M})}return this._vao}_updatePerspectiveTransform(l,h){const v=this._vertices;(0,Bt.O)(b,[0,0,l,0,0,h,l,h],[v[0],v[1],v[4],v[5],v[2],v[3],v[6],v[7]]),(0,Vt.hZ)(this.perspectiveTransform,b[6]/b[8]*l,b[7]/b[8]*h)}}var Nt=t(67685),_=t(31610),Qt=t(12273),Yt=t(77098),Jt=t(6126),Xt=t(12173),wt=t(54382);class bt extends wt.A{constructor(){super(...arguments),this._localOrigin=(0,Nt.tc)(0,0),this._viewStateId=-1,this._dvsMat3=(0,Qt.vt)()}get dvsMat3(){return this._dvsMat3}beforeRender(l){this._updateMatrices(l),this._updateOverlays(l,this.children);for(const h of this.children)h.beforeRender(l)}prepareRenderPasses(l){const h=l.registerRenderPass({name:"overlay",brushes:[Xt.d.overlay],target:()=>this.children,drawPhase:Lt.S5.MAP});return[...super.prepareRenderPasses(l),h]}_updateMatrices(l){const{state:h}=l,{id:v,size:E,pixelRatio:M,resolution:B,rotation:T,viewpoint:U,displayMat3:S}=h;if(this._viewStateId===v)return;const L=Math.PI/180*T,N=M*E[0],w=M*E[1],{x:ot,y:tt}=U.targetGeometry,at=(0,Yt.mT)(ot,h.spatialReference);this._localOrigin.x=at,this._localOrigin.y=tt;const lt=B*N,et=B*w,K=(0,_.D_)(this._dvsMat3);(0,_.lw)(K,K,S),(0,_.Tl)(K,K,(0,zt.fA)(N/2,w/2)),(0,_.hs)(K,K,(0,Tt.fA)(N/lt,-w/et,1)),(0,_.e$)(K,K,-L),this._viewStateId=v}_updateOverlays(l,h){const{state:v}=l,{rotation:E,spatialReference:M,worldScreenWidth:B,size:T,viewpoint:U}=v,S=this._localOrigin;let L=0;const N=(0,Dt.Vp)(M);if(N&&M.isWrappable){const w=T[0],ot=T[1],tt=180/Math.PI*E,at=Math.abs(Math.cos(tt)),lt=Math.abs(Math.sin(tt)),et=Math.round(w*at+ot*lt),[K,ht]=N.valid,Q=(0,Jt.FT)(M),{x:Et,y:ee}=U.targetGeometry,dt=[0,0];v.toScreen(dt,[Et,ee]);const st=[0,0];let vt;vt=et>B?.5*B:.5*et;const Mt=Math.floor((Et+.5*Q)/Q),ie=K+Mt*Q,re=ht+Mt*Q,ct=[dt[0]+vt,0];v.toMap(st,ct),st[0]>re&&(L=Q),ct[0]=dt[0]-vt,v.toMap(st,ct),st[0]<ie&&(L=-Q);for(const it of h){const Rt=it.elementView.bounds;if(null==Rt)continue;const[Pt,,At]=Rt;it.updateDrawCoords(S,Pt<K&&At>K?Q:At>ht&&Pt<ht?-Q:L)}}else for(const w of h)w.updateDrawCoords(S,L)}}var _t=t(29459),kt=t(41474);let k=class extends((0,_t.e)(kt.A)){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this.layer=null,this.elements=new u.A}attach(){this.addAttachHandles([(0,C.on)(()=>this.layer.effectiveSource,"refresh",()=>{this._tileStrategy.refresh(d=>this._updateTile(d)),this.requestUpdate()}),(0,C.on)(()=>this.layer.effectiveSource,"change",({element:d})=>this._elementUpdateHandler(d))]),this._overlayContainer=new bt,this.container.addChild(this._overlayContainer),this._fetchQueue=new Ut.A({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(d,l)=>this._queryElements(d,l)}),this._tileStrategy=new xt.A({cachePolicy:"purge",resampling:!0,acquireTile:d=>this._acquireTile(d),releaseTile:d=>this._releaseTile(d),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){var d;this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),null===(d=this._debugGraphicsView)||void 0===d||d.destroy()}supportsSpatialReference(d){return!0}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(d){var l;this._tileStrategy.update(d),null===(l=this._debugGraphicsView)||void 0===l||l.update(d)}hitTest(d,l){var h=this;return(0,c.A)(function*(){const v=[],E=d.normalize(),M=[E.x,E.y];for(const{projectedElement:{normalizedCoords:B,element:T}}of h._elementReferences.values())null!=B&&(0,P.t1)(B.rings,M)&&v.push({type:"media",element:T,layer:h.layer,mapPoint:d,sourcePoint:T.toSource(d)});return v.reverse()})()}canResume(){return null!=this.layer.source&&super.canResume()}doRefresh(){var d=this;return(0,c.A)(function*(){d._fetchQueue.reset(),d._tileStrategy.refresh(l=>d._updateTile(l))})()}_acquireTile(d){const l=new qt(d.clone());return this._updateTile(l),l}_updateTile(d){this._updatingHandles.addPromise(this._fetchQueue.push(d.key).then(l=>{const[h,v]=d.setElements(l);this._referenceElements(d,h),this._dereferenceElements(d,v),this.requestUpdate()},l=>{(0,D.zf)(l)||m.A.getLogger(this).error(l)}))}_releaseTile(d){this._fetchQueue.abort(d.key.id),d.elements&&this._dereferenceElements(d,d.elements),this.requestUpdate()}_queryElements(d,l){var h=this;return(0,c.A)(function*(){const v=h.layer.effectiveSource;if(null==v)return[];h.view.featuresTilingScheme.getTileBounds(G,d,!0);const E=new St.A({xmin:G[0],ymin:G[1],xmax:G[2],ymax:G[3],spatialReference:h.view.spatialReference});return v.queryElements(E,l)})()}_referenceElements(d,l){if(null!=this.layer.source)for(const h of l)this._referenceElement(d,h)}_referenceElement(d,l){(0,I.tE)(this._elementReferences,l.uid,()=>{const h=new H._({element:l,spatialReference:this.view.spatialReference}),v=new Ft(h);return this._overlayContainer.addChild(v),this.elements.add(l),{tiles:new Set,projectedElement:h,overlay:v,debugGraphic:null}}).tiles.add(d)}_dereferenceElements(d,l){for(const h of l)this._dereferenceElement(d,h)}_dereferenceElement(d,l){var h;const v=this._elementReferences.get(l.uid);v.tiles.delete(d),v.tiles.size||(this._overlayContainer.removeChild(v.overlay),v.overlay.destroy(),v.projectedElement.destroy(),this._elementReferences.delete(l.uid),this.elements.remove(l),null===(h=this._debugGraphicsView)||void 0===h||h.graphics.remove(v.debugGraphic))}_elementUpdateHandler(d){let l=this._elementReferences.get(d.uid);if(l){var h,v;const M=l.projectedElement.normalizedCoords;if(null==M)return this._overlayContainer.removeChild(l.overlay),l.overlay.destroy(),l.projectedElement.destroy(),this._elementReferences.delete(d.uid),this.elements.remove(d),void(null===(h=this._debugGraphicsView)||void 0===h||h.graphics.remove(l.debugGraphic));const B=[],T=[];for(const U of this._tileStrategy.tiles){const S=gt(this.view.featuresTilingScheme,U,M);l.tiles.has(U)?S||T.push(U):S&&B.push(U)}for(const U of B)this._referenceElement(U,d);for(const U of T)this._dereferenceElement(U,d);return l=this._elementReferences.get(d.uid),void((null===(v=l)||void 0===v?void 0:v.debugGraphic)&&(l.debugGraphic.geometry=l.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:l.debugGraphic,property:"geometry"})))}const E=new H._({element:d,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=E)for(const M of this._tileStrategy.tiles)gt(this.view.featuresTilingScheme,M,E)&&this._referenceElement(M,d)}};(0,A._)([(0,F.MZ)()],k.prototype,"layer",void 0),(0,A._)([(0,F.MZ)({readOnly:!0})],k.prototype,"elements",void 0),k=(0,A._)([(0,Y.$)("esri.views.2d.layers.MediaLayerView2D")],k);const G=(0,W.vt)(),q={xmin:0,ymin:0,xmax:0,ymax:0};function gt(d,l,h){return d.getTileBounds(G,l.key,!0),q.xmin=G[0],q.ymin=G[1],q.xmax=G[2],q.ymax=G[3],(0,$.fA)(q,h)}class qt{constructor(l){this.key=l,this.elements=null,this.isReady=!1,this.visible=!0}setElements(l){const h=[],v=new Set(this.elements);this.elements=l;for(const E of l)v.has(E)?v.delete(E):h.push(E);return this.isReady=!0,[h,Array.from(v)]}destroy(){}}const te=k},41474:(Z,j,t)=>{t.d(j,{A:()=>m});var c=t(8189),A=t(98877),x=t(42425),f=t(3046),p=t(35150),g=t(11432),O=t(64261),R=t(85211),i=(t(3248),t(40707),t(76576)),s=t(56985);let o=class extends((0,f.sA)((0,O.g)(x.A.EventedMixin(A.A)))){constructor(r){super(r),this._updatingHandles=new s.U,this.layer=null,this.parent=null}initialize(){this.when().catch(r=>{if("layerview:create-error"!==r.name){var u;const y=this.layer&&this.layer.id||"no id",I=(null===(u=this.layer)||void 0===u?void 0:u.title)||"no title";p.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${I}', id: '${y}')`,r)}})}destroy(){this._updatingHandles=(0,g.pR)(this._updatingHandles)}get fullOpacity(){var r,u,y,I;return(null!==(r=null===(u=this.layer)||void 0===u?void 0:u.opacity)&&void 0!==r?r:1)*(null!==(y=null===(I=this.parent)||void 0===I?void 0:I.fullOpacity)&&void 0!==y?y:1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var r;return!this.suspended&&!0===(null===(r=this.layer)||void 0===r?void 0:r.legendEnabled)}get updating(){var r;return!!(null!==(r=this._updatingHandles)&&void 0!==r&&r.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var r;return!0===(null===(r=this.layer)||void 0===r?void 0:r.visible)}set visible(r){this._overrideIfSome("visible",r)}canResume(){var r,u,y;return this.visible&&(null===(r=this.layer)||void 0===r?void 0:r.loaded)&&!(null!==(u=this.parent)&&void 0!==u&&u.suspended)&&(null===(y=this.view)||void 0===y?void 0:y.ready)||!1}getSuspendInfo(){var r,u;const y=null!==(r=this.parent)&&void 0!==r&&r.suspended?this.parent.suspendInfo:{};return null!==(u=this.view)&&void 0!==u&&u.ready||(y.viewNotReady=!0),this.layer&&this.layer.loaded||(y.layerNotLoaded=!0),this.visible||(y.layerInvisible=!0),y}isUpdating(){return!1}};(0,c._)([(0,R.MZ)()],o.prototype,"fullOpacity",null),(0,c._)([(0,R.MZ)()],o.prototype,"layer",void 0),(0,c._)([(0,R.MZ)()],o.prototype,"parent",void 0),(0,c._)([(0,R.MZ)({readOnly:!0})],o.prototype,"suspended",null),(0,c._)([(0,R.MZ)({readOnly:!0})],o.prototype,"suspendInfo",null),(0,c._)([(0,R.MZ)({readOnly:!0})],o.prototype,"legendEnabled",null),(0,c._)([(0,R.MZ)({type:Boolean,readOnly:!0})],o.prototype,"updating",null),(0,c._)([(0,R.MZ)({readOnly:!0})],o.prototype,"updatingProgress",null),(0,c._)([(0,R.MZ)()],o.prototype,"visible",null),(0,c._)([(0,R.MZ)()],o.prototype,"view",void 0),o=(0,c._)([(0,i.$)("esri.views.layers.LayerView")],o);const m=o},66727:(Z,j,t)=>{t.d(j,{A:()=>V});var c=t(8189),A=t(71065),x=t(85211),O=(t(3248),t(35150),t(40707),t(76576));let R=class extends A.oY{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,c._)([(0,x.MZ)({readOnly:!0})],R.prototype,"version",null),R=(0,c._)([(0,O.$)("esri.views.layers.support.ClipArea")],R);const V=R},75644:(Z,j,t)=>{t.d(j,{A:()=>u});var o,c=t(8189),x=(t(21152),t(85211)),O=(t(3248),t(35150),t(40707),t(76576)),R=t(68643),V=t(61320),a=t(66727),i=t(28067),s=t(55861);const m={base:R.A,key:"type",typeMap:{extent:i.A,polygon:s.A}};let r=o=class extends a.A{constructor(y){super(y),this.type="geometry",this.geometry=null}clone(){var y,I;return new o({geometry:null!==(y=null===(I=this.geometry)||void 0===I?void 0:I.clone())&&void 0!==y?y:null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,c._)([(0,x.MZ)({types:m,json:{read:V.rS,write:!0}})],r.prototype,"geometry",void 0),r=o=(0,c._)([(0,O.$)("esri.views.layers.support.Geometry")],r);const u=r}}]);