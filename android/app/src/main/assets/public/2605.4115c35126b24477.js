"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2605,9927],{39693:(H,T,e)=>{e.d(T,{P:()=>d,L:()=>c});var h=e(8189),y=e(98877),B=e(29529),I=e(77806),p=e(26514);class L{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(p.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(r){const t=new L,s=this._originStores[p.Gr.DEFAULTS];s&&s.forEach((n,_)=>{t.set(_,(0,I.o8)(n),p.Gr.DEFAULTS)});for(let n=p.Gr.SERVICE;n<p.AU;n++){const _=this._originStores[n];_&&_.forEach((O,E)=>{r&&r.has(E)||t.set(E,(0,I.o8)(O),n)})}return t}get(r,t){const s=void 0===t?this._values:this._originStores[t];return s?s.get(r):void 0}keys(r){const t=null==r?this._values:this._originStores[r];return t?[...t.keys()]:[]}set(r,t,s=p.Gr.USER){let n=this._originStores[s];if(n||(n=new Map,this._originStores[s]=n),n.set(r,t),!this._values.has(r)||this._propertyOriginMap.get(r)<=s){const _=this._values.get(r);return this._values.set(r,t),this._propertyOriginMap.set(r,s),_!==t}return!1}delete(r,t=p.Gr.USER){const s=this._originStores[t];if(!s)return;const n=s.get(r);if(s.delete(r),this._values.has(r)&&this._propertyOriginMap.get(r)===t){this._values.delete(r);for(let _=t-1;_>=0;_--){const O=this._originStores[_];if(O&&O.has(r)){this._values.set(r,O.get(r)),this._propertyOriginMap.set(r,_);break}}}return n}has(r,t){const s=void 0===t?this._values:this._originStores[t];return!!s&&s.has(r)}revert(r,t){for(;t>0&&!this.has(r,t);)--t;const s=this._originStores[t],n=null==s?void 0:s.get(r),_=this._values.get(r);return this._values.set(r,n),this._propertyOriginMap.set(r,t),_!==n}originOf(r){return this._propertyOriginMap.get(r)||p.Gr.DEFAULTS}forEach(r){this._values.forEach(r)}}var K=e(34813),D=e(74220),U=e(76576);const P=v=>{let r=class extends v{constructor(...t){super(...t);const s=(0,D.oY)(this),n=s.store,_=new L;s.store=_,(0,B.k)(s,n,_)}read(t,s){(0,K.L)(this,t,s)}getAtOrigin(t,s){const n=A(this),_=(0,p.aB)(s);if("string"==typeof t)return n.get(t,_);const O={};return t.forEach(E=>{O[E]=n.get(E,_)}),O}originOf(t){return(0,p.OL)(this.originIdOf(t))}originIdOf(t){return A(this).originOf(t)}revert(t,s){const n=A(this),_=(0,p.aB)(s),O=(0,D.oY)(this);let E;E="string"==typeof t?"*"===t?n.keys(_):[t]:t,E.forEach(a=>{O.invalidate(a),n.revert(a,_),O.commit(a)})}};return r=(0,h._)([(0,U.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],r),r};function A(v){return(0,D.oY)(v).store}let g=class extends(P(y.A)){};g=(0,h._)([(0,U.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],g);var C=e(92073),M=e(56558);const S=v=>{let r=class extends v{constructor(...t){super(...t)}clear(t,s="user"){return l(this).delete(t,(0,p.aB)(s))}write(t,s){return(0,M.M)(this,t=t||{},s),t}setAtOrigin(t,s,n){(0,D.oY)(this).setAtOrigin(t,s,(0,p.aB)(n))}removeOrigin(t){const s=l(this),n=(0,p.aB)(t),_=s.keys(n);for(const O of _)s.originOf(O)===n&&s.set(O,s.get(O,n),p.Gr.USER)}updateOrigin(t,s){const n=l(this),_=(0,p.aB)(s),O=(0,C.Jt)(this,t);for(let E=_+1;E<p.AU;++E)n.delete(t,E);n.set(t,O,_)}toJSON(t){return this.write({},t)}};return r=(0,h._)([(0,U.$)("esri.core.WriteableMultiOriginJSONSupport")],r),r.prototype.toJSON.isDefaultToJSON=!0,r};function l(v){return(0,D.oY)(v).store}const d=v=>{let r=class extends(S(P(v))){constructor(...t){super(...t)}};return r=(0,h._)([(0,U.$)("esri.core.MultiOriginJSONSupport")],r),r};let c=class extends(d(y.A)){};c=(0,h._)([(0,U.$)("esri.core.MultiOriginJSONSupport")],c)},42605:(H,T,e)=>{e.r(T),e.d(T,{default:()=>C});var h=e(8189),y=e(5922),B=e(39693),I=e(3804),p=e(85211),U=(e(3248),e(35150),e(40707),e(76576)),P=e(95478),A=e(85551);let g=class extends((0,A.A)((0,B.P)(P.A))){constructor(M){super(M),this.resourceInfo=null,this.persistenceEnabled=!0,this.type="unsupported"}initialize(){this.addResolvingPromise(new Promise((M,S)=>{(0,I._)(()=>{const l=this.resourceInfo&&(this.resourceInfo.layerType||this.resourceInfo.type);let d="Unsupported layer type";l&&(d+=" "+l),S(new y.A("layer:unsupported-layer-type",d,{layerType:l}))})}))}read(M,S){const l={resourceInfo:M};null!=M.id&&(l.id=M.id),null!=M.title&&(l.title=M.title),super.read(l,S)}write(M,S){return Object.assign(M||{},this.resourceInfo,{id:this.id})}};(0,h._)([(0,p.MZ)({readOnly:!0})],g.prototype,"resourceInfo",void 0),(0,h._)([(0,p.MZ)({type:["show","hide"]})],g.prototype,"listMode",void 0),(0,h._)([(0,p.MZ)({type:Boolean,readOnly:!1})],g.prototype,"persistenceEnabled",void 0),(0,h._)([(0,p.MZ)({json:{read:!1},readOnly:!0,value:"unsupported"})],g.prototype,"type",void 0),g=(0,h._)([(0,U.$)("esri.layers.UnsupportedLayer")],g);const C=g},85551:(H,T,e)=>{e.d(T,{A:()=>n});var h=e(10467),y=e(8189),B=e(23098),I=e(77469),p=e(89563),L=e(89447),K=e(5922),D=e(35150),U=e(11432),P=e(56492),A=e(45272),g=e(85211),S=(e(3248),e(40707),e(17221)),l=e(76576),d=e(50305),c=e(58443),v=e(73874),r=e(46577),t=e(52606),s=e(69927);const n=O=>{let E=class extends O{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,U.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(a){a!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",a))}readPortalItem(a,o,i){if(o.itemId)return new r.default({id:o.itemId,portal:null==i?void 0:i.portal})}writePortalItem(a,o){null!=a&&a.id&&(o.itemId=a.id)}loadFromPortal(a,o){var i=this;return(0,h.A)(function*(){var u;if(null!==(u=i.portalItem)&&void 0!==u&&u.id)try{const{load:f}=yield Promise.all([e.e(5565),e.e(2076),e.e(6180)]).then(e.bind(e,56180));return(0,P.Te)(o),yield f({instance:i,supportedTypes:a.supportedTypes,validateItem:a.validateItem,supportsData:a.supportsData,layerModuleTypeMap:a.layerModuleTypeMap},o)}catch(f){throw(0,P.zf)(f)||D.A.getLogger(i).warn(`Failed to load layer (${i.title}, ${i.id}) portal item (${i.portalItem.id})\n  ${f}`),f}})()}finishLoadEditablePortalLayer(a){var o=this;return(0,h.A)(function*(){o._set("userHasEditingPrivileges",yield o._fetchUserHasEditingPrivileges(a).catch(i=>((0,P.QP)(i),!0)))})()}setUserPrivileges(a,o){var i=this;return(0,h.A)(function*(){if(!B.A.userPrivilegesApplied)return i.finishLoadEditablePortalLayer(o);if(i.url)try{const{features:{edit:u,fullEdit:f},content:{updateItem:m}}=yield i._fetchUserPrivileges(a,o);i._set("userHasEditingPrivileges",u),i._set("userHasFullEditingPrivileges",f),i._set("userHasUpdateItemPrivileges",m)}catch(u){(0,P.QP)(u)}})()}_fetchUserPrivileges(a,o){var i=this;return(0,h.A)(function*(){let u=i.portalItem;if(!a||!u||!u.loaded||u.sourceUrl)return i._fetchFallbackUserPrivileges(o);const f=a===u.id;if(f&&u.portal.user)return(0,s.It)(u);let m,W;if(f)m=u.portal.url;else try{m=yield(0,c.wI)(i.url,o)}catch(R){(0,P.QP)(R)}if(!m||!(0,A.b8)(m,u.portal.url))return i._fetchFallbackUserPrivileges(o);try{const R=null!=o?o.signal:null;W=yield null==I.id?void 0:I.id.getCredential(`${m}/sharing`,{prompt:!1,signal:R})}catch(R){(0,P.QP)(R)}if(!W)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(f?yield u.reload():(u=new r.default({id:a,portal:{url:m}}),yield u.load(o)),u.portal.user)return(0,s.It)(u)}catch(R){(0,P.QP)(R)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(a){var o=this;return(0,h.A)(function*(){let i=!0;try{i=yield o._fetchUserHasEditingPrivileges(a)}catch(u){(0,P.QP)(u)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(a){var o=this;return(0,h.A)(function*(){const i=o.url?null==I.id?void 0:I.id.findCredential(o.url):null;if(!i)return!0;const u=_.credential===i?_.user:yield o._fetchEditingUser(a);return _.credential=i,_.user=u,null==(null==u?void 0:u.privileges)||u.privileges.includes("features:user:edit")})()}_fetchEditingUser(a){var o=this;return(0,h.A)(function*(){var i,u;const f=null===(i=o.portalItem)||void 0===i||null===(i=i.portal)||void 0===i?void 0:i.user;if(f)return f;const m=I.id.findServerInfo(null!==(u=o.url)&&void 0!==u?u:"");if(null==m||!m.owningSystemUrl)return null;const W=`${m.owningSystemUrl}/sharing/rest`,j=v.A.getDefault();if(j&&j.loaded&&(0,A.S8)(j.restUrl)===(0,A.S8)(W))return j.user;const $=`${W}/community/self`,G=null!=a?a.signal:null,R=yield(0,L.Ke)((0,p.A)($,{authMode:"no-prompt",query:{f:"json"},signal:G}));return R.ok?t.A.fromJSON(R.value.data):null})()}read(a,o){o&&(o.layer=this),super.read(a,o)}write(a,o){var i;const u=null==o?void 0:o.portal,f=(null===(i=this.portalItem)||void 0===i?void 0:i.id)&&(this.portalItem.portal||v.A.getDefault());return u&&f&&!(0,A.ut)(f.restUrl,u.restUrl)?(o.messages&&o.messages.push(new K.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(a,{...o,layer:this})}};return(0,y._)([(0,g.MZ)({type:r.default})],E.prototype,"portalItem",null),(0,y._)([(0,S.w)("web-document","portalItem",["itemId"])],E.prototype,"readPortalItem",null),(0,y._)([(0,d.K)("web-document","portalItem",{itemId:{type:String}})],E.prototype,"writePortalItem",null),(0,y._)([(0,g.MZ)({clonable:!1})],E.prototype,"resourceReferences",void 0),(0,y._)([(0,g.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasEditingPrivileges",void 0),(0,y._)([(0,g.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasFullEditingPrivileges",void 0),(0,y._)([(0,g.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasUpdateItemPrivileges",void 0),E=(0,y._)([(0,l.$)("esri.layers.mixins.PortalLayer")],E),E},_={credential:null,user:null}},69927:(H,T,e)=>{e.d(T,{It:()=>S,LG:()=>K,OM:()=>P,Sm:()=>A,Y:()=>D,bK:()=>U,mm:()=>M,sQ:()=>g});var h=e(10467),y=e(11817),B=e(32034),I=e(55039);function L(){return(L=(0,h.A)(function*(l){const d=l.spatialReference;if(d.isWGS84)return l.clone();if(d.isWebMercator)return(0,I.ci)(l);const c=B.A.WGS84;return yield(0,y.initializeProjection)(d,c),(0,y.project)(l,c)})).apply(this,arguments)}function K(l,d){if(!D(l,d)){const c=l.typeKeywords;c?c.push(d):l.typeKeywords=[d]}}function D(l,d){var c;return!(null===(c=l.typeKeywords)||void 0===c||!c.includes(d))}function U(l){return D(l,M.HOSTED_SERVICE)}function P(l,d){const c=l.typeKeywords;if(c){const v=c.indexOf(d);v>-1&&c.splice(v,1)}}function A(l,d,c){c?K(l,d):P(l,d)}function g(l){return C.apply(this,arguments)}function C(){return C=(0,h.A)(function*(l){const d=l.clone().normalize();let c;if(d.length>1)for(const v of d)c?v.width>c.width&&(c=v):c=v;else c=d[0];return function p(l){return L.apply(this,arguments)}(c)}),C.apply(this,arguments)}const M={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function S(l){var d;const{portal:c,isOrgItem:v,itemControl:r}=l,t=null===(d=c.user)||void 0===d?void 0:d.privileges;let s=!t||t.includes("features:user:edit"),n=!!v&&!(null==t||!t.includes("features:user:fullEdit"));const _="update"===r||"admin"===r;return _?n=s=!0:n&&(s=!0),{features:{edit:s,fullEdit:n},content:{updateItem:_}}}}}]);