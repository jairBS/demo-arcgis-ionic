"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9555],{50501:(ae,k,d)=>{d.d(k,{K:()=>h});const h=(w=>["operational-layers","basemap","ground"])()},86468:(ae,k,d)=>{d.d(k,{T:()=>J,U:()=>w});var h=d(69287);function w(N,G,X=0){const Y=(0,h.qE)(N,0,T);for(let z=0;z<4;z++)G[X+z]=Math.floor(256*I(Y*V[z]))}function J(N,G=0){let X=0;for(let Y=0;Y<4;Y++)X+=N[G+Y]*P[Y];return X}const V=[1,256,65536,16777216],P=[1/256,1/65536,1/16777216,1/4294967296],T=J(new Uint8ClampedArray([255,255,255,255]));function I(N){return N-Math.floor(N)}},40856:(ae,k,d)=>{d.d(k,{X_:()=>V,i1:()=>P,zx:()=>G});var h=d(69287),w=d(82663);const J=96;function V(z,F){const B=F||z.extent,y=z.width,S=(0,w.GA)(null==B?void 0:B.spatialReference);return B&&y?B.width/y*S*w.dy*J:0}function P(z,F){return z/((0,w.GA)(F)*w.dy*J)}function G(z,F,B){return function X(z,F){return 0===F||(0,h.Sp)(z,F)||z<F}(z,F)&&function Y(z,F){return 0===F||(0,h.Sp)(z,F)||z>F}(z,B)}},72211:(ae,k,d)=>{d.d(k,{LF:()=>P,M9:()=>T,zu:()=>X});var h=d(5922),w=d(89221),J=d(79845),V=d(26073);function P(F,B,y){try{return function N(F){if(!F||0===F.length)return null;if(function G(F){const B=F[0];return!!B&&"scale"in B}(F)){const B=[];for(const y of F)B.push({scale:y.scale,value:X(y.value)});return B}return X(F)}(F)}catch(L){var S;null==y||null===(S=y.messages)||void 0===S||S.push(L)}return null}function T(F,B,y,S){try{const L=function I(F){const B=(0,J.q)(F);return B?(0,V.dw)(B)?B.map(y=>y.toJSON()):B.map(({scale:y,effects:S})=>({scale:y,value:S.map(L=>L.toJSON())})):null}(F);(0,w.sM)(y,L,B)}catch(L){S.messages&&S.messages.push(L)}}function X(F){if(null==F||!F.length)return"";const B=[];for(const y of F){let S=[];switch(y.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":S=[Y(y,"amount")];break;case"blur":S=[Y(y,"radius","pt")];break;case"hue-rotate":S=[Y(y,"angle","deg")];break;case"drop-shadow":S=[Y(y,"xoffset","pt"),Y(y,"yoffset","pt"),Y(y,"blurRadius","pt"),z(y,"color")];break;case"bloom":S=[Y(y,"strength"),Y(y,"radius","pt"),Y(y,"threshold")]}const L=`${y.type}(${S.filter(Boolean).join(" ")})`;(0,J.q)(L),B.push(L)}return B.join(" ")}function Y(F,B,y){if(null==F[B])throw new h.A("effect:missing-parameter",`Missing parameter '${B}' in ${F.type} effect`,{effect:F});return y?F[B]+y:""+F[B]}function z(F,B){if(null==F[B])throw new h.A("effect:missing-parameter",`Missing parameter '${B}' in ${F.type} effect`,{effect:F});const y=F[B];return`rgba(${y[0]||0}, ${y[1]||0}, ${y[2]||0}, ${y[3]/255||0})`}},66722:(ae,k,d)=>{d.d(k,{A:()=>L});var z,h=d(8189),w=d(5922),J=d(71065),V=d(89221),P=d(85211),G=(d(3248),d(35150),d(40707),d(76576)),X=d(72211),Y=d(95877);const F={read:{reader:X.LF},write:{writer:X.M9,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},B={read:{reader:X.LF},write:{writer:X.M9,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},y={name:"showExcludedLabels",default:!0};let S=z=class extends J.oY{constructor(O){super(O),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(O,m){const v=super.write(O,m);if(null!=m&&m.origin){var _;if(v.filter){var D;const f=Object.keys(v.filter);if(f.length>1||"where"!==f[0])return null!==(D=m.messages)&&void 0!==D&&D.push(new w.A("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:m.layer,effect:this})),null}if("showExcludedLabels"in v)return null!==(_=m.messages)&&void 0!==_&&_.push(new w.A("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:m.layer,effect:this})),null}return v}clone(){return new z({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,h._)([(0,P.MZ)({type:Y.A,json:{write:{allowNull:!0,writer(O,m,v,_){const D=null==O?void 0:O.write({},_);D&&0!==Object.keys(D).length?(0,V.sM)(v,D,m):(0,V.sM)(v,null,m)}}}})],S.prototype,"filter",void 0),(0,h._)([(0,P.MZ)({json:{write:!0,origins:{"web-map":F,"portal-item":F}}})],S.prototype,"includedEffect",void 0),(0,h._)([(0,P.MZ)({json:{write:!0,origins:{"web-map":B,"portal-item":B}}})],S.prototype,"excludedEffect",void 0),(0,h._)([(0,P.MZ)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":y,"portal-item":y}}})],S.prototype,"excludedLabelsVisible",void 0),S=z=(0,h._)([(0,G.$)("esri.layers.support.FeatureEffect")],S);const L=S},95877:(ae,k,d)=>{d.d(k,{A:()=>S});var z,h=d(8189),w=d(21152),J=d(12849),V=d(49976),P=d(71065),T=d(77806),I=d(85211),X=(d(3248),d(35150),d(76576)),Y=d(87086);const F=new V.J({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),B=new V.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let y=z=class extends P.oY{constructor(L){super(L),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(L={}){const{where:O,geometry:m,spatialRelationship:v,timeExtent:_,objectIds:D,units:f,distance:A}=this;return new Y.A({geometry:(0,T.o8)(m),objectIds:(0,T.o8)(D),spatialRelationship:v,timeExtent:(0,T.o8)(_),where:O,units:f,distance:A,...L})}clone(){const{where:L,geometry:O,spatialRelationship:m,timeExtent:v,objectIds:_,units:D,distance:f}=this;return new z({geometry:(0,T.o8)(O),objectIds:(0,T.o8)(_),spatialRelationship:m,timeExtent:(0,T.o8)(v),where:L,units:D,distance:f})}};(0,h._)([(0,I.MZ)({type:String,json:{write:!0}})],y.prototype,"where",void 0),(0,h._)([(0,I.MZ)({types:w.yR,json:{write:!0}})],y.prototype,"geometry",void 0),(0,h._)([(0,I.MZ)({type:F.apiValues,json:{name:"spatialRel",read:{reader:F.read},write:{allowNull:!1,writer:F.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],y.prototype,"spatialRelationship",void 0),(0,h._)([(0,I.MZ)({type:Number,json:{write:{overridePolicy(L){return{enabled:null!=L&&null!=this.geometry}}}}})],y.prototype,"distance",void 0),(0,h._)([(0,I.MZ)({type:[Number],json:{write:!0}})],y.prototype,"objectIds",void 0),(0,h._)([(0,I.MZ)({type:B.apiValues,json:{read:B.read,write:{writer:B.write,overridePolicy(L){return{enabled:null!=L&&null!=this.geometry}}}}})],y.prototype,"units",void 0),(0,h._)([(0,I.MZ)({type:J.A,json:{write:!0}})],y.prototype,"timeExtent",void 0),y=z=(0,h._)([(0,X.$)("esri.layers.support.FeatureFilter")],y);const S=y},20329:(ae,k,d)=>{d.d(k,{A:()=>j});var y,h=d(8189),w=d(47280),J=d(49976),V=d(71065),P=d(77806),T=d(67685),I=d(85211),X=(d(3248),d(35150),d(17221)),Y=d(76576),z=d(50305),B=(d(40707),d(4858));let S=y=class extends V.oY{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(U,C){return C.value?(0,B.mX)(C.value):U}writeExpression(U,C,H){null!=this.value&&(U=(0,B.mX)(this.value)),null!=U&&(C[H]=U)}clone(){return new y({expression:this.expression,title:this.title,value:this.value})}};(0,h._)([(0,I.MZ)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],S.prototype,"expression",void 0),(0,h._)([(0,X.w)("expression",["expression","value"])],S.prototype,"readExpression",null),(0,h._)([(0,z.K)("expression")],S.prototype,"writeExpression",null),(0,h._)([(0,I.MZ)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],S.prototype,"title",void 0),(0,h._)([(0,I.MZ)({json:{read:!1,write:!1}})],S.prototype,"value",void 0),S=y=(0,h._)([(0,Y.$)("esri.layers.support.LabelExpressionInfo")],S);const L=S;var _,O=d(58443),m=d(91644),v=d(35564);const D=new J.J({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function f(U,C,H){return{enabled:!(0,O.TU)(null==H?void 0:H.layer)}}function A(U){var C;return!U||"service"!==U.origin&&"map-image"!==(null===(C=U.layer)||void 0===C?void 0:C.type)}function R(U){var C;return!!function M(U){return"map-image"===(null==U?void 0:U.type)}(U)&&!(null===(C=U.capabilities)||void 0===C||null===(C=C.exportMap)||void 0===C||!C.supportsArcadeExpressionForLabeling)}let K=_=class extends V.oY{static evaluateWhere(U,C){const H=(Q,q,ne)=>{switch(q){case"=":return Q==ne;case"<>":return Q!=ne;case">":return Q>ne;case">=":return Q>=ne;case"<":return Q<ne;case"<=":return Q<=ne}return!1};try{if(null==U)return!0;const Q=U.split(" ");if(3===Q.length)return H(C[Q[0]],Q[1],Q[2]);if(7===Q.length){const q=H(C[Q[0]],Q[1],Q[2]),ne=Q[3],pe=H(C[Q[4]],Q[5],Q[6]);switch(ne){case"AND":return q&&pe;case"OR":return q||pe}}return!1}catch{console.log("Error.: can't parse = "+U)}}constructor(U){super(U),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=m.Hk,this.useCodedValues=void 0,this.where=null}readLabelExpression(U,C){const H=C.labelExpressionInfo;if(!H||!H.value&&!H.expression)return U}writeLabelExpression(U,C,H){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)U=(0,B.D3)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const Q=(0,B.tH)(this.labelExpressionInfo.expression);Q&&(U="["+Q+"]")}null!=U&&(C[H]=U)}writeLabelExpressionInfo(U,C,H,Q){if(null==U&&null!=this.labelExpression&&A(Q))U=new L({expression:this.getLabelExpressionArcade()});else if(!U)return;const q=U.toJSON(Q);q.expression&&(C[H]=q)}writeMaxScale(U,C){(U||this.minScale)&&(C.maxScale=U)}writeMinScale(U,C){(U||this.maxScale)&&(C.minScale=U)}getLabelExpression(){return(0,B.XJ)(this)}getLabelExpressionArcade(){return(0,B.BI)(this)}getLabelExpressionSingleField(){return(0,B.rU)(this)}hash(){return JSON.stringify(this)}clone(){return new _({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,P.o8)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,P.o8)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,h._)([(0,I.MZ)({type:String,json:{write:!0}})],K.prototype,"name",void 0),(0,h._)([(0,I.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:f}}}}})],K.prototype,"allowOverrun",void 0),(0,h._)([(0,I.MZ)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:f}}}}})],K.prototype,"deconflictionStrategy",void 0),(0,h._)([(0,I.MZ)({type:String,json:{write:{overridePolicy(U,C,H){return this.labelExpressionInfo&&"service"===(null==H?void 0:H.origin)&&R(H.layer)?{enabled:!1}:{allowNull:!0}}}}})],K.prototype,"labelExpression",void 0),(0,h._)([(0,X.w)("labelExpression")],K.prototype,"readLabelExpression",null),(0,h._)([(0,z.K)("labelExpression")],K.prototype,"writeLabelExpression",null),(0,h._)([(0,I.MZ)({type:L,json:{write:{overridePolicy:(U,C,H)=>function W(U){return A(U)||R(null==U?void 0:U.layer)}(H)?{allowNull:!0}:{enabled:!1}}}})],K.prototype,"labelExpressionInfo",void 0),(0,h._)([(0,z.K)("labelExpressionInfo")],K.prototype,"writeLabelExpressionInfo",null),(0,h._)([(0,I.MZ)({type:D.apiValues,json:{type:D.jsonValues,read:D.read,write:D.write}})],K.prototype,"labelPlacement",void 0),(0,h._)([(0,I.MZ)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],K.prototype,"labelPosition",void 0),(0,h._)([(0,I.MZ)({type:Number})],K.prototype,"maxScale",void 0),(0,h._)([(0,z.K)("maxScale")],K.prototype,"writeMaxScale",null),(0,h._)([(0,I.MZ)({type:Number})],K.prototype,"minScale",void 0),(0,h._)([(0,z.K)("minScale")],K.prototype,"writeMinScale",null),(0,h._)([(0,I.MZ)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:f}}}}})],K.prototype,"repeatLabel",void 0),(0,h._)([(0,I.MZ)({type:Number,cast:T.cr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:f}}}}})],K.prototype,"repeatLabelDistance",void 0),(0,h._)([(0,I.MZ)({types:w.em,json:{origins:{"web-scene":{types:w.Rv,write:v.oO,default:null}},write:v.oO,default:null}})],K.prototype,"symbol",void 0),(0,h._)([(0,I.MZ)({type:Boolean,json:{write:!0}})],K.prototype,"useCodedValues",void 0),(0,h._)([(0,I.MZ)({type:String,json:{write:!0}})],K.prototype,"where",void 0),K=_=(0,h._)([(0,Y.$)("esri.layers.support.LabelClass")],K);const j=K},15848:(ae,k,d)=>{d.d(k,{A:()=>z});var G,h=d(8189),w=d(49976),J=d(71065),V=d(85211),N=(d(3248),d(35150),d(40707),d(76576));const X=new w.J({asc:"ascending",desc:"descending"});let Y=G=class extends J.oY{constructor(F){super(F),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new G({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,h._)([(0,V.MZ)({type:String,json:{write:!0}})],Y.prototype,"field",void 0),(0,h._)([(0,V.MZ)({type:String,json:{write:!0}})],Y.prototype,"valueExpression",void 0),(0,h._)([(0,V.MZ)({type:X.apiValues,json:{read:X.read,write:X.write}})],Y.prototype,"order",void 0),Y=G=(0,h._)([(0,N.$)("esri.layers.support.OrderByInfo")],Y);const z=Y},81687:(ae,k,d)=>{d.d(k,{ui:()=>Q,Yj:()=>K,id:()=>ne,kF:()=>M,fV:()=>W,C1:()=>ye,hG:()=>Te,hn:()=>pe,ke:()=>C,Ih:()=>H,M6:()=>A,Qo:()=>j,Fm:()=>q,PY:()=>f,OZ:()=>R});var h=d(12849),w=d(50501),J=d(28067),V=d(32034),P=d(88135),N=(d(89952),d(77806),d(97442)),_=d(88485),D=d(46873);const f={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:w.K}}},A={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(ie,ee)=>!ee.disablePopup},write:{enabled:!0,writer(ie,ee,re){ee[re]=!ie}}}},M={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:w.K}}},R={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:P.w}}},W={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:w.K}}},K={value:null,type:_.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:w.K}}};function j(ie){return{type:ie,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const U={write:{enabled:!0,layerContainerTypes:w.K},read:!0},C={type:Number,json:{origins:{"web-document":U,"portal-item":{write:!0}}}},H={...C,json:{...C.json,origins:{"web-document":{...U,write:{enabled:!0,layerContainerTypes:w.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(ie,ee,re)=>{var oe;return re&&"service"!==re.origin||!ee.drawingInfo||void 0===ee.drawingInfo.transparency?null!==(oe=ee.layerDefinition)&&void 0!==oe&&oe.drawingInfo&&void 0!==ee.layerDefinition.drawingInfo.transparency?(0,D.D)(ee.layerDefinition.drawingInfo.transparency):void 0:(0,D.D)(ee.drawingInfo.transparency)}}}},Q={type:h.A,readOnly:!0,get(){var ie,ee,re;const oe=null!=(null===(ie=this.layer)||void 0===ie?void 0:ie.timeInfo)?this.layer:null!=(null===(ee=this.i3slayer)||void 0===ee?void 0:ee.timeInfo)?this.i3slayer:null;if(null==oe)return null;const{datesInUnknownTimezone:ue,timeOffset:ve,useViewTime:Ee}=oe,Pe=null===(re=this.view)||void 0===re?void 0:re.timeExtent;let Ce=oe.timeExtent;ue&&(Ce=function v(ie){if(!ie)return ie;const{start:ee,end:re}=ie;return new h.A({start:null!=ee?(0,N.S1)(ee,ee.getTimezoneOffset(),"minutes"):ee,end:null!=re?(0,N.S1)(re,re.getTimezoneOffset(),"minutes"):re})}(Ce));let xe=Ee?Pe&&Ce?Pe.intersection(Ce):Pe||Ce:Ce;if(!xe||xe.isEmpty||xe.isAllTime)return xe;ve&&(xe=xe.offset(-ve.value,ve.unit)),ue&&(xe=function m(ie){if(!ie)return ie;const{start:ee,end:re}=ie;return new h.A({start:null!=ee?(0,N.S1)(ee,-ee.getTimezoneOffset(),"minutes"):ee,end:null!=re?(0,N.S1)(re,-re.getTimezoneOffset(),"minutes"):re})}(xe));const ce=this._get("timeExtent");return xe.equals(ce)?ce:xe}},q={type:J.A,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(ie,ee)=>{const re=J.A.fromJSON(ie);return null!=ee.spatialReference&&"object"==typeof ee.spatialReference&&(re.spatialReference=V.A.fromJSON(ee.spatialReference)),re}}}},read:!1}},ne={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},pe={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:w.K}}},name:"layerDefinition.minScale",write:!0}},Te={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:w.K}}},name:"layerDefinition.maxScale",write:!0}},ye={json:{write:{ignoreOrigin:!0,layerContainerTypes:w.K},origins:{"web-map":{read:!1,write:!1}}}}},14916:(ae,k,d)=>{function h(V){var P;const T=V.layer;return"floorInfo"in T&&null!==(P=T.floorInfo)&&void 0!==P&&P.floorField&&"floors"in V.view?J(V.view.floors,T.floorInfo.floorField):null}function w(V,P){var T;return"floorInfo"in P&&null!==(T=P.floorInfo)&&void 0!==T&&T.floorField?J(V,P.floorInfo.floorField):null}function J(V,P){if(null==V||!V.length)return null;const T=V.filter(I=>""!==I).map(I=>`'${I}'`);return T.push("''"),`${P} IN (${T.join(",")}) OR ${P} IS NULL`}d.d(k,{E:()=>h,f:()=>w})},73975:(ae,k,d)=>{d.d(k,{w:()=>I,z:()=>X});var h=d(5922),w=d(77806),J=d(35150),V=d(20329);const P=()=>J.A.getLogger("esri.layers.support.labelingInfo"),T=/\[([^\[\]]+)\]/gi;function I(z,F,B){return z?z.map(y=>{const S=new V.A;if(S.read(y,B),S.labelExpression){var L;const O=F.fields||(null===(L=F.layerDefinition)||void 0===L?void 0:L.fields)||this.fields;S.labelExpression=S.labelExpression.replaceAll(T,(m,v)=>`[${function N(z,F){if(!F)return z;const B=z.toLowerCase();for(let y=0;y<F.length;y++){const S=F[y].name;if(S.toLowerCase()===B)return S}return z}(v,O)}]`)}return S}):null}const G={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function X(z,F){const B=(0,w.o8)(z);return B.some(y=>function Y(z,F){const B=z.labelPlacement,y=G[F];if(!z.symbol)return P().warn("No ILabelClass symbol specified."),!0;if(!y)return P().error(new h.A("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${F}' is not supported`)),!0;if(!y.includes(B)){const S=y[0];B&&P().warn(`Found invalid label placement type ${B} for ${F}. Defaulting to ${S}`),z.labelPlacement=S}return!1}(y,F))?[]:B}},78592:(ae,k,d)=>{d.d(k,{O3:()=>G,PU:()=>I,YW:()=>Y,ex:()=>P,hv:()=>X,zp:()=>T});var h=d(69287),w=d(67685),J=d(53781),V=d(89141);const P=2.4;function T(z){return(0,w.PN)(z*P)}function I(z){return(0,w.Lz)(z)/P}function N(z,F,B,y){let{color:S,ratio:L}=F,{color:O,ratio:m}=B;m===L&&(1===m?L-=1e-6:m+=1e-6);const v=(0,h.qE)((y-L)/(m-L),0,1);(0,J.l)(z,S.toArray(),O.toArray(),v)}function G(z){const B=new Uint8ClampedArray(2048);if((z=z.filter(({ratio:m})=>m>=0&&m<=1).sort((m,v)=>m.ratio-v.ratio).map(({color:m,ratio:v})=>({color:m,ratio:Math.max(v,.001)}))).length<1)return B;let y=z[0],S=z[0],L=1;const O=(0,V.vt)();for(let m=0;m<512;m++){const v=(m+.5)/512;for(;v>S.ratio&&L<z.length;)y=S,S=z[L++];N(O,y,S,v),B.set(O,4*m)}return B}function X(z,F,B){const y=Math.sqrt(z**2+F**2)/B;return y>1?0:3/(Math.PI*B**2)*(1-y**2)**2}function Y(z){return"function"==typeof z?z:z?F=>+F[z]:()=>1}},64765:(ae,k,d)=>{var h,w,I;function J(I){return I&&"esri.renderers.visualVariables.SizeVariable"===I.declaredClass}function V(I){return null!=I&&!isNaN(I)&&isFinite(I)}function P(I){return I.valueExpression?h.Expression:I.field&&"string"==typeof I.field?h.Field:h.Unknown}function T(I,N){return(N||P(I))===h.Unknown?w.Constant:I.stops?w.Stops:null!=I.minSize&&null!=I.maxSize&&null!=I.minDataValue&&null!=I.maxDataValue?w.ClampedLinear:"unknown"===(I.valueUnit||"unknown")?null!=I.minSize&&null!=I.minDataValue?I.minSize&&I.minDataValue?w.Proportional:w.Additive:w.Identity:w.RealWorldSize}d.d(k,{KZ:()=>T,Yf:()=>h,_w:()=>w,eh:()=>P,gf:()=>V,of:()=>J}),(I=h||(h={})).Unknown="unknown",I.Expression="expression",I.Field="field",function(I){I.Unknown="unknown",I.Stops="stops",I.ClampedLinear="clamped-linear",I.Proportional="proportional",I.Additive="additive",I.Constant="constant",I.Identity="identity",I.RealWorldSize="real-world-size"}(w||(w={}))},93327:(ae,k,d)=>{d.d(k,{A:()=>m});var S,h=d(8189),w=d(21152),J=d(81098),V=d(49976),P=d(71065),T=d(77806),I=d(85211),X=(d(3248),d(35150),d(17221)),Y=d(76576),z=d(50305),F=d(32034),B=d(61320),y=d(29141);const L=new V.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let O=S=class extends P.oY{constructor(v){super(v),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(v,_){const D=F.A.fromJSON(_.spatialReference),f=[];for(let M=0;M<v.length;M++){var A;const R=v[M],W=J.A.fromJSON(R),K=null===(A=R.geometry)||void 0===A?void 0:A.spatialReference;null==W.geometry||K||(W.geometry.spatialReference=D);const j=R.aggregateGeometries,U=W.aggregateGeometries;if(j&&null!=U)for(const C in U){const H=U[C],Q=j[C];null==H||(null==Q?void 0:Q.spatialReference)||(H.spatialReference=D)}f.push(W)}return f}writeGeometryType(v,_,D,f){if(v)return void L.write(v,_,D,f);const{features:A}=this;if(A)for(const M of A)if(null!=(null==M?void 0:M.geometry))return void L.write(M.geometry.type,_,D,f)}readQueryGeometry(v,_){if(!v)return null;const D=!!v.spatialReference,f=(0,B.rS)(v);return f&&!D&&_.spatialReference&&(f.spatialReference=F.A.fromJSON(_.spatialReference)),f}writeSpatialReference(v,_){if(v)return void(_.spatialReference=v.toJSON());const{features:D}=this;if(D)for(const f of D)if(f&&null!=f.geometry&&f.geometry.spatialReference)return void(_.spatialReference=f.geometry.spatialReference.toJSON())}clone(){return new S(this.cloneProperties())}cloneProperties(){return(0,T.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(v){const _=this.write();if(_.features&&Array.isArray(v)&&v.length>0)for(let D=0;D<_.features.length;D++){const f=_.features[D];if(f.geometry){const A=null==v?void 0:v[D];f.geometry=(null==A?void 0:A.toJSON())||f.geometry}}return _}quantize(v){const{scale:[_,D],translate:[f,A]}=v,W=this.features,K=this._getQuantizationFunction(this.geometryType,j=>Math.round((j-f)/_),j=>Math.round((A-j)/D));for(let j=0,U=W.length;j<U;j++)null!=K&&K(W[j].geometry)||(W.splice(j,1),j--,U--);return this.transform=v,this}unquantize(){var v,_;const{geometryType:D,features:f,transform:A}=this;if(!A)return this;const{translate:[M,R],scale:[W,K]}=A;let C=null,H=null;if(this.hasZ&&null!=(null==A||null===(v=A.scale)||void 0===v?void 0:v[2])){const{translate:[,,q],scale:[,,ne]}=A;C=pe=>pe*ne+q}if(this.hasM&&null!=(null==A||null===(_=A.scale)||void 0===_?void 0:_[3])){const{translate:[,,,q],scale:[,,,ne]}=A;H=pe=>null==pe?pe:pe*ne+q}const Q=this._getHydrationFunction(D,q=>q*W+M,q=>R-q*K,C,H);for(const{geometry:q}of f)null!=q&&Q&&Q(q);return this.transform=null,this}_quantizePoints(v,_,D){let f,A;const M=[];for(let R=0,W=v.length;R<W;R++){const K=v[R];if(R>0){const j=_(K[0]),U=D(K[1]);j===f&&U===A||(M.push([j-f,U-A]),f=j,A=U)}else f=_(K[0]),A=D(K[1]),M.push([f,A])}return M.length>0?M:null}_getQuantizationFunction(v,_,D){return"point"===v?f=>(f.x=_(f.x),f.y=D(f.y),f):"polyline"===v||"polygon"===v?f=>{const A=(0,B.Bi)(f)?f.rings:f.paths,M=[];for(let R=0,W=A.length;R<W;R++){const j=this._quantizePoints(A[R],_,D);j&&M.push(j)}return M.length>0?((0,B.Bi)(f)?f.rings=M:f.paths=M,f):null}:"multipoint"===v?f=>{const A=this._quantizePoints(f.points,_,D);return A&&A.length>0?(f.points=A,f):null}:"extent"===v?f=>f:null}_getHydrationFunction(v,_,D,f,A){return"point"===v?M=>{M.x=_(M.x),M.y=D(M.y),f&&(M.z=f(M.z))}:"polyline"===v||"polygon"===v?M=>{const R=(0,B.Bi)(M)?M.rings:M.paths;let W,K;for(let j=0,U=R.length;j<U;j++){const C=R[j];for(let H=0,Q=C.length;H<Q;H++){const q=C[H];H>0?(W+=q[0],K+=q[1]):(W=q[0],K=q[1]),q[0]=_(W),q[1]=D(K)}}if(f&&A)for(let j=0,U=R.length;j<U;j++){const C=R[j];for(let H=0,Q=C.length;H<Q;H++){const q=C[H];q[2]=f(q[2]),q[3]=A(q[3])}}else if(f)for(let j=0,U=R.length;j<U;j++){const C=R[j];for(let H=0,Q=C.length;H<Q;H++){const q=C[H];q[2]=f(q[2])}}else if(A)for(let j=0,U=R.length;j<U;j++){const C=R[j];for(let H=0,Q=C.length;H<Q;H++){const q=C[H];q[2]=A(q[2])}}}:"extent"===v?M=>{M.xmin=_(M.xmin),M.ymin=D(M.ymin),M.xmax=_(M.xmax),M.ymax=D(M.ymax),f&&null!=M.zmax&&null!=M.zmin&&(M.zmax=f(M.zmax),M.zmin=f(M.zmin)),A&&null!=M.mmax&&null!=M.mmin&&(M.mmax=A(M.mmax),M.mmin=A(M.mmin))}:"multipoint"===v?M=>{const R=M.points;let W,K;for(let j=0,U=R.length;j<U;j++){const C=R[j];j>0?(W+=C[0],K+=C[1]):(W=C[0],K=C[1]),C[0]=_(W),C[1]=D(K)}if(f&&A)for(let j=0,U=R.length;j<U;j++){const C=R[j];C[2]=f(C[2]),C[3]=A(C[3])}else if(f)for(let j=0,U=R.length;j<U;j++){const C=R[j];C[2]=f(C[2])}else if(A)for(let j=0,U=R.length;j<U;j++){const C=R[j];C[2]=A(C[2])}}:null}};(0,h._)([(0,I.MZ)({type:String,json:{write:!0}})],O.prototype,"displayFieldName",void 0),(0,h._)([(0,I.MZ)({type:Boolean,json:{write:{overridePolicy:v=>({enabled:v})}}})],O.prototype,"exceededTransferLimit",void 0),(0,h._)([(0,I.MZ)({type:[J.A],json:{write:!0}})],O.prototype,"features",void 0),(0,h._)([(0,X.w)("features")],O.prototype,"readFeatures",null),(0,h._)([(0,I.MZ)({type:[y.A],json:{write:!0}})],O.prototype,"fields",void 0),(0,h._)([(0,I.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:L.read}}})],O.prototype,"geometryType",void 0),(0,h._)([(0,z.K)("geometryType")],O.prototype,"writeGeometryType",null),(0,h._)([(0,I.MZ)({type:Boolean,json:{write:{overridePolicy:v=>({enabled:v})}}})],O.prototype,"hasM",void 0),(0,h._)([(0,I.MZ)({type:Boolean,json:{write:{overridePolicy:v=>({enabled:v})}}})],O.prototype,"hasZ",void 0),(0,h._)([(0,I.MZ)({types:w.yR,json:{write:!0}})],O.prototype,"queryGeometry",void 0),(0,h._)([(0,X.w)("queryGeometry")],O.prototype,"readQueryGeometry",null),(0,h._)([(0,I.MZ)({type:F.A,json:{write:!0}})],O.prototype,"spatialReference",void 0),(0,h._)([(0,z.K)("spatialReference")],O.prototype,"writeSpatialReference",null),(0,h._)([(0,I.MZ)({json:{write:!0}})],O.prototype,"transform",void 0),O=S=(0,h._)([(0,Y.$)("esri.rest.support.FeatureSet")],O),O.prototype.toJSON.isDefaultToJSON=!0;const m=O},54935:(ae,k,d)=>{d.d(k,{Fj:()=>X,Z7:()=>G,ce:()=>Y,eR:()=>P});var h=d(86468),w=d(61320),J=d(9792),V=d(47669);function P(y){switch(y.type){case"CIMPointSymbol":{const L=y.symbolLayers;if(!L||1!==L.length)return null;const O=L[0];return"CIMVectorMarker"!==O.type?null:P(O)}case"CIMVectorMarker":{var S;const L=y.markerGraphics;if(!L||1!==L.length)return null;const O=L[0];if(!O)return null;const m=O.geometry;if(!m)return null;const v=O.symbol;return!v||"CIMPolygonSymbol"!==v.type&&"CIMLineSymbol"!==v.type||null!==(S=v.symbolLayers)&&void 0!==S&&S.some(_=>!!_.effects)?null:{type:"sdf",geom:m,asFill:"CIMPolygonSymbol"===v.type}}}}function N(y){let S=1/0,L=-1/0,O=1/0,m=-1/0;for(const v of y)for(const _ of v)_[0]<S&&(S=_[0]),_[0]>L&&(L=_[0]),_[1]<O&&(O=_[1]),_[1]>m&&(m=_[1]);return[S,O,L,m]}function G(y){return y?y.rings?N(y.rings):y.paths?N(y.paths):(0,w.ZC)(y)?[y.xmin,y.ymin,y.xmax,y.ymax]:null:null}function X(y,S,L,O,m){const[v,_,D,f]=y;if(D<v||f<_)return[0,0,0,1];const A=D-v,M=f-_,W=V.hM,K=Math.floor(.5*(64-W)),j=(128-2*(K+W))/Math.max(A,M),U=Math.round(A*j)+2*K,C=Math.round(M*j)+2*K;let H=1;S&&(H=C/j/(S.ymax-S.ymin));let Q=0,q=0,ne=1;O&&(m?S&&L&&S.ymax-S.ymin>0&&(ne=(S.xmax-S.xmin)/(S.ymax-S.ymin),Q=O.x/(L*ne),q=O.y/L):(Q=O.x,q=O.y)),S&&(Q=.5*(S.xmax+S.xmin)+Q*(S.xmax-S.xmin),q=.5*(S.ymax+S.ymin)+q*(S.ymax-S.ymin)),Q-=v,q-=_,Q*=j,q*=j,Q+=K,q+=K;let pe=Q/U-.5,Te=q/C-.5;return m&&L&&(pe*=L*ne,Te*=L),[H,pe,Te,ne]}function Y(y){const S=function T(y){return y?y.rings?y.rings:y.paths?y.paths:void 0!==y.xmin&&void 0!==y.ymin&&void 0!==y.xmax&&void 0!==y.ymax?[[[y.xmin,y.ymin],[y.xmin,y.ymax],[y.xmax,y.ymax],[y.xmax,y.ymin],[y.xmin,y.ymin]]]:null:null}(y.geom),L=function I(y){let S=1/0,L=-1/0,O=1/0,m=-1/0;for(const v of y)for(const _ of v)_[0]<S&&(S=_[0]),_[0]>L&&(L=_[0]),_[1]<O&&(O=_[1]),_[1]>m&&(m=_[1]);return new J.A(S,O,L-S,m-O)}(S),m=V.hM,v=Math.floor(.5*(64-m)),_=(128-2*(v+m))/Math.max(L.width,L.height),D=Math.round(L.width*_)+2*v,f=Math.round(L.height*_)+2*v,A=[];for(const R of S)if(R&&R.length>1){const W=[];for(const K of R){let[j,U]=K;j-=L.x,U-=L.y,j*=_,U*=_,j+=v-.5,U+=v-.5,W.push(y.asFill?[j,U]:[Math.round(j),Math.round(U)])}if(y.asFill){const K=W.length-1;W[0][0]===W[K][0]&&W[0][1]===W[K][1]||W.push(W[0])}A.push(W)}const M=function z(y,S,L,O){const m=S*L,v=new Array(m),_=O*O+1;for(let D=0;D<m;++D)v[D]=_;for(const D of y){const f=D.length;for(let A=1;A<f;++A){const M=D[A-1],R=D[A];let W,K,j,U;M[0]<R[0]?(W=M[0],K=R[0]):(W=R[0],K=M[0]),M[1]<R[1]?(j=M[1],U=R[1]):(j=R[1],U=M[1]);let C=Math.floor(W)-O,H=Math.floor(K)+O,Q=Math.floor(j)-O,q=Math.floor(U)+O;C<0&&(C=0),H>S&&(H=S),Q<0&&(Q=0),q>L&&(q=L);const ne=R[0]-M[0],pe=R[1]-M[1],Te=ne*ne+pe*pe;for(let ye=C;ye<H;ye++)for(let ie=Q;ie<q;ie++){let ee,re,oe=(ye-M[0])*ne+(ie-M[1])*pe;oe<0?(ee=M[0],re=M[1]):oe>Te?(ee=R[0],re=R[1]):(oe/=Te,ee=M[0]+oe*ne,re=M[1]+oe*pe);const ue=(ye-ee)*(ye-ee)+(ie-re)*(ie-re),ve=(L-ie-1)*S+ye;ue<v[ve]&&(v[ve]=ue)}}}for(let D=0;D<m;++D)v[D]=Math.sqrt(v[D]);return v}(A,D,f,v);return y.asFill&&function F(y,S,L,O,m){for(const v of y){const _=v.length;for(let D=1;D<_;++D){const f=v[D-1],A=v[D];let M,R,W,K;f[0]<A[0]?(M=f[0],R=A[0]):(M=A[0],R=f[0]),f[1]<A[1]?(W=f[1],K=A[1]):(W=A[1],K=f[1]);let j=Math.floor(M),U=Math.floor(R)+1,C=Math.floor(W),H=Math.floor(K)+1;j<O&&(j=O),U>S-O&&(U=S-O),C<O&&(C=O),H>L-O&&(H=L-O);for(let Q=C;Q<H;++Q){if(f[1]>Q==A[1]>Q)continue;const q=(L-Q-1)*S;for(let ne=j;ne<U;++ne)ne<(A[0]-f[0])*(Q-f[1])/(A[1]-f[1])+f[0]&&(m[q+ne]=-m[q+ne]);for(let ne=O;ne<j;++ne)m[q+ne]=-m[q+ne]}}}}(A,D,f,v,M),[B(M,v),D,f]}function B(y,S){const L=2*S,O=y.length,m=new Uint8Array(4*O);for(let v=0;v<O;++v)(0,h.U)(.5-y[v]/L,m,4*v);return m}},88485:(ae,k,d)=>{d.d(k,{A:()=>D});var B,h=d(8189),w=d(49976),J=d(71065),V=d(11432),P=d(85211),G=(d(3248),d(35150),d(40707),d(17221)),X=d(76576),Y=d(50305),z=d(10467),F=d(86300);let y=B=class extends J.oY{constructor(f){super(f)}collectRequiredFields(f,A){var M=this;return(0,z.A)(function*(){return(0,F.Dx)(f,A,M.expression)})()}clone(){return new B({expression:this.expression,title:this.title})}equals(f){return this.expression===f.expression&&this.title===f.title}};(0,h._)([(0,P.MZ)({type:String,json:{write:!0}})],y.prototype,"expression",void 0),(0,h._)([(0,P.MZ)({type:String,json:{write:!0}})],y.prototype,"title",void 0),y=B=(0,h._)([(0,X.$)("esri.layers.support.FeatureExpressionInfo")],y);const S=y;var O,L=d(82575);const m=(0,w.O)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),v=new w.J({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let _=O=class extends J.oY{constructor(f){super(f),this.offset=null}readFeatureExpressionInfo(f,A){return null!=f?f:A.featureExpression&&0===A.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(f,A,M,R){A[M]=f.write({},R),"0"===f.expression&&(A.featureExpression={value:0})}get mode(){const{offset:f,featureExpressionInfo:A}=this;return this._isOverridden("mode")?this._get("mode"):null!=f||A?"relative-to-ground":"on-the-ground"}set mode(f){this._override("mode",f)}set unit(f){this._set("unit",f)}write(f,A){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(f,A):null}clone(){return new O({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(f){return this.mode===f.mode&&this.offset===f.offset&&this.unit===f.unit&&(0,V.CM)(this.featureExpressionInfo,f.featureExpressionInfo)}};(0,h._)([(0,P.MZ)({type:S,json:{write:!0}})],_.prototype,"featureExpressionInfo",void 0),(0,h._)([(0,G.w)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],_.prototype,"readFeatureExpressionInfo",null),(0,h._)([(0,Y.K)("featureExpressionInfo",{featureExpressionInfo:{type:S},"featureExpression.value":{type:[0]}})],_.prototype,"writeFeatureExpressionInfo",null),(0,h._)([(0,P.MZ)({type:m.apiValues,nonNullable:!0,json:{type:m.jsonValues,read:m.read,write:{writer:m.write,isRequired:!0}}})],_.prototype,"mode",null),(0,h._)([(0,P.MZ)({type:Number,json:{write:!0}})],_.prototype,"offset",void 0),(0,h._)([(0,P.MZ)({type:L.KQ,json:{type:String,read:v.read,write:v.write}})],_.prototype,"unit",null),_=O=(0,h._)([(0,X.$)("esri.layers.support.ElevationInfo")],_);const D=_},35564:(ae,k,d)=>{d.d(k,{rS:()=>D,M9:()=>O,oO:()=>m});var h=d(47280),w=d(5922),J=d(58443),V=d(32713),P=d(75549),T=d(25613),I=d(55417),N=d(18399),G=d(46602),X=d(65824),Y=d(88521),z=d(64484),F=d(27093),B=d(47705),y=d(6241);const S={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function O(f,A,M,R){const W=_(f,{},{context:R,isLabelSymbol:!1});null!=W&&(A[M]=W)}function m(f,A,M,R){const W=_(f,{},{context:R,isLabelSymbol:!0});null!=W&&(A[M]=W)}function v(f){return f instanceof V.A||f instanceof P.A}function _(f,A,M){if(null==f)return null;const{context:R,isLabelSymbol:W}=M,K=null==R?void 0:R.origin,j=null==R?void 0:R.messages;if("web-scene"===K&&!v(f)){const U=function L(f,A=S){if(!f)return{symbol:null};const{retainId:M=S.retainId,ignoreDrivers:R=S.ignoreDrivers,hasLabelingContext:W=S.hasLabelingContext,retainCIM:K=S.retainCIM}=A;let j=null;if((0,h.wk)(f)||f instanceof P.A)j=f.clone();else if("cim"===f.type){var U;const C=null===(U=f.data)||void 0===U||null===(U=U.symbol)||void 0===U?void 0:U.type;if("CIMPointSymbol"!==C)return{error:new w.A("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${C||"unknown"}' is unsupported in 3D`,{symbol:f})};j=K?f.clone():T.A.fromCIMSymbol(f)}else if(f instanceof I.A)j=N.A.fromSimpleLineSymbol(f);else if(f instanceof G.A)j=T.A.fromSimpleMarkerSymbol(f);else if(f instanceof X.A)j=T.A.fromPictureMarkerSymbol(f);else if(f instanceof Y.A)j=A.geometryType&&"mesh"===A.geometryType?z.A.fromSimpleFillSymbol(f):F.A.fromSimpleFillSymbol(f);else{if(!(f instanceof B.A))return{error:new w.A("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${f.type||f.declaredClass}' is unsupported in 3D`,{symbol:f})};j=W?y.A.fromTextSymbol(f):T.A.fromTextSymbol(f)}return M&&j&&"cim"!==j.type&&(j.id=f.id),R&&(0,h.wk)(j)&&j.symbolLayers.forEach(C=>C.ignoreDrivers=!0),{symbol:j}}(f,{retainCIM:!0,hasLabelingContext:W});return null!=U.symbol?U.symbol.write(A,R):(null!=j&&j.push(new w.A("symbol:unsupported",`Symbols of type '${f.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:f,context:R,error:U.error})),null)}return("web-map"===K||"portal-item"===K&&!(0,J.TU)(null==R?void 0:R.layer))&&v(f)?(null!=j&&j.push(new w.A("symbol:unsupported",`Symbols of type '${f.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:f,context:R})),null):f.write(A,R)}function D(f,A){return(0,h.Bu)(f,null,A)}},82575:(ae,k,d)=>{d.d(k,{Ao:()=>J,KQ:()=>P});var h=d(48716);function J(T){return 1/(h.j[T]||1)}const P=function V(){const T=Object.keys(h.j);return T.sort(),T}()},66803:(ae,k,d)=>{d.d(k,{j:()=>L});var h=d(10467),w=d(5922),J=d(3248),V=d(35150),P=d(56492),T=d(47669),I=d(53212),N=d(24370),G=d(50915),X=d(79061),Y=d(26136),z=d(4931);class B{constructor(m,v,_){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:D,pixelType:f,textureOnly:A}=m,M=(0,N.Qz)(f);this.blockIndex=_,this.pixelType=f,this.size=v,this.textureOnly=A,A||(this.data=new M(D)),this._resetRange()}destroy(){var m;null===(m=this._texture)||void 0===m||m.dispose();for(const v in this._fbos){const _=this._fbos[v];_&&("0"===v&&_.detachColorTexture(),_.dispose()),this._fbos[v]=null}this._texture=null}get _textureDesc(){const m=new z.R;return m.wrapMode=G.pF.CLAMP_TO_EDGE,m.samplingMode=G.Cj.NEAREST,m.dataType=this.pixelType,m.width=this.size,m.height=this.size,m}setData(m,v,_){const D=(0,I.Q4)(m),f=this.data,A=D*this.texelSize+v;!f||A>=f.length||(f[A]=_,this.dirtyStart=Math.min(this.dirtyStart,D),this.dirtyEnd=Math.max(this.dirtyEnd,D))}getData(m,v){if(null==this.data)return null;const _=(0,I.Q4)(m)*this.texelSize+v;return!this.data||_>=this.data.length?null:this.data[_]}getTexture(m){var v;return null!==(v=this._texture)&&void 0!==v?v:this._initTexture(m)}getFBO(m,v=0){if(!this._fbos[v]){const _=0===v?this.getTexture(m):this._textureDesc;this._fbos[v]=new X.H(m,_)}return this._fbos[v]}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(m,v){try{const _=this.dirtyStart,D=this.dirtyEnd;if(!this.hasDirty)return;(0,J.A)("esri-2d-update-debug")&&console.debug(`Version[${v}] AttributeStoreView.updateTexture`,{start:_,end:D,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const f=this.data.buffer,A=this.getTexture(m),M=4,R=(_-_%this.size)/this.size,K=R,U=(D-D%this.size)/this.size,C=R*this.size*M,H=(this.size+U*this.size)*M-C,Q=(0,N.Qz)(this.pixelType),q=new Q(f,C*Q.BYTES_PER_ELEMENT,H),ne=this.size,pe=U-K+1;if(pe>this.size)return void V.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new w.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));A.updateData(0,0,K,ne,pe,q)}catch{}}update(m){const{data:v,start:_,end:D}=m;if(null!=v&&null!=this.data){const f=this.data,A=_*this.texelSize;for(let M=0;M<v.length;M++)m.layout&1<<M%this.texelSize&&(f[A+M]=v[M])}this.dirtyStart=Math.min(this.dirtyStart,_),this.dirtyEnd=Math.max(this.dirtyEnd,D)}resize(m,v){const _=this.size;if(this.size=v,this.textureOnly)return void(_!==this.size&&(this._lastTexture=this._texture,this._texture=null));const D=(0,N.Qz)(this.pixelType);this.destroy(),this.data=new D(m.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(m){var v;const _=new Y.g(m,this._textureDesc,null!==(v=this.data)&&void 0!==v?v:void 0);if(null!=this._lastTexture&&this._fbos[0]){const D=this._lastTexture.descriptor.width,f=this._lastTexture.descriptor.height,A=this._lastTexture.descriptor.dataType,M=this._lastTexture.descriptor.pixelFormat,R=this.getFBO(m),W=(0,N.AV)(A),K=new((0,N.Qz)(A))(new ArrayBuffer(D*f*W*this.texelSize)),j=m.getBoundFramebufferObject(),{x:U,y:C,width:H,height:Q}=m.getViewport();m.bindFramebuffer(R),R.readPixels(0,0,D,f,M,A,K),_.updateData(0,0,0,2*D,f/2,K),m.setViewport(U,C,H,Q),m.bindFramebuffer(j)}return this.destroy(),this._texture=_,this._texture}}class y{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(m){if(!m)throw new Error("InternalError: initArgs must be defined");const v=m.blockDescriptors;if(this.size=m.blockSize,(0,J.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:m}),null==this._data)this._data=v.map((_,D)=>null!=_?new B(_,this.size,D):null);else for(let _=0;_<this._data.length;_++){const D=this._data[_],f=v[_];null!=f&&(null==D?this._data[_]=new B(f,this.size,_):D.resize(f,this.size))}}destroy(){var m;for(const _ of null!==(v=this._data)&&void 0!==v?v:[]){var v;null==_||_.destroy()}null===(m=this._defaultTexture)||void 0===m||m.dispose();for(const{resolver:_}of this._pendingAttributeUpdates)_.reject("AttributeStore destroyed");this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(m){return null==this._data?null:this._data[m]}setLabelMinZoom(m,v){this.setData(m,0,1,v)}getLabelMinZoom(m){return this.getData(m,0,1,255)}getFilterFlags(m){return this.getData(m,0,0,0)}getVVSize(m){return this.getData(m,T.dV.VV,0,0)}getData(m,v,_,D){if(!this._data)return 0;const f=this._data[v];if(null==f)return 0;const A=f.getData(m,_);return null!=A?A:D}setData(m,v,_,D){this._data[v].setData(m,_,D)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(m){var v=this;return(0,h.A)(function*(){const _=(0,P.Tw)();_.promise=_.promise.catch(D=>{(0,J.A)("esri-2d-update-debug")&&console.error("AttributeStoreView.requestUpdate rejected",D)}),v._version=m.version,v._pendingAttributeUpdates.push({inner:m,resolver:_}),(0,J.A)("esri-2d-update-debug")&&console.debug(`Version[${v._version}] AttributeStoreView.requestUpdate`,{message:m})})()}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const m=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const{inner:v,resolver:_}of m){const{blockData:D,initArgs:f,sendUpdateEpoch:A,version:M}=v;(0,J.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${A}] AttributeStoreView.applyUpdate`),this._version=M,this._epoch=A,null!=f&&this._initialize(f);const R=this._data;for(let W=0;W<D.length;W++){const K=D[W],j=R[W];null!=j&&null!=K&&((0,J.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${W}] AttributeStoreView.update`,{block:K}),j.update(K))}_.resolve()}}getUniforms(m){return{filterFlags:{texture:this._getTexture(m,T.dV.FilterFlags),unit:T.uM},animation:{texture:this._getTexture(m,T.dV.Animation),unit:T.z2},gpgpu:{texture:this._getTexture(m,T.dV.GPGPU),unit:T.Sr},visualVariableData:{texture:this._getTexture(m,T.dV.VV),unit:T.nM},dataDriven0:{texture:this._getTexture(m,T.dV.DD0),unit:T.lL},dataDriven1:{texture:this._getTexture(m,T.dV.DD1),unit:T.sn},dataDriven2:{texture:this._getTexture(m,T.dV.DD2),unit:T.n9},size:this.size}}_getTexture(m,v){var _;const D=null===(_=this._data)||void 0===_?void 0:_[v];return D?(D.updateTexture(m,this._version),D.getTexture(m)):this._getDefaultTexture(m)}_getDefaultTexture(m){if(null==this._defaultTexture){const v=new z.R;v.wrapMode=G.pF.CLAMP_TO_EDGE,v.samplingMode=G.Cj.NEAREST,v.width=1,v.height=1,this._defaultTexture=new Y.g(m,v,new Uint8Array(4))}return this._defaultTexture}}var S=d(37188);class L extends S.A{constructor(m){super(m),this._statisticsByLevel=new Map,this.attributeView=new y}destroy(){this.children.forEach(m=>m.destroy()),this.removeAllChildren(),this.attributeView.destroy()}doRender(m){m.context.capabilities.enable("textureFloat"),super.doRender(m)}createRenderParams(m){const v=super.createRenderParams(m);return v.attributeView=this.attributeView,v.instanceStore=this._instanceStore,v.statisticsByLevel=this._statisticsByLevel,v}}},37188:(ae,k,d)=>{d.d(k,{A:()=>I});var h=d(3248),w=d(69473),J=d(54382),V=d(89298),P=d(99065);const T=(N,G)=>N.key.level-G.key.level!=0?N.key.level-G.key.level:N.key.row-G.key.row!=0?N.key.row-G.key.row:N.key.col-G.key.col;class I extends J.A{constructor(G){super(),this._tileInfoView=G}renderChildren(G){this.sortChildren(T),this.setStencilReference(G),super.renderChildren(G)}createRenderParams(G){const{state:X}=G,Y=super.createRenderParams(G);return Y.requiredLevel=this._tileInfoView.getClosestInfoForScale(X.scale).level,Y.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(X.scale),Y}prepareRenderPasses(G){const X=super.prepareRenderPasses(G);return X.push(G.registerRenderPass({name:"stencil",brushes:[V.A],drawPhase:w.S5.DEBUG|w.S5.MAP|w.S5.HIGHLIGHT|w.S5.LABEL,target:()=>this.getStencilTarget()})),(0,h.A)("esri-tiles-debug")&&X.push(G.registerRenderPass({name:"tileInfo",brushes:[P.A],drawPhase:w.S5.DEBUG,target:()=>this.children})),X}getStencilTarget(){return this.children}setStencilReference(G){let X=1;for(const Y of this.children)Y.stencilRef=X++}}},87250:(ae,k,d)=>{d.d(k,{O:()=>w});var h=d(69522);class w{constructor(V,P,T,I,N){this._instanceId=V,this.techniqueRef=P,this._meshWriterName=T,this._input=I,this.optionalAttributes=N}get instanceId(){return(0,h.P)(this._instanceId)}createMeshInfo(V){return{id:this._instanceId,meshWriterName:this._meshWriterName,options:V,optionalAttributes:this.optionalAttributes}}getInput(){return this._input}setInput(V){this._input=V}}},39555:(ae,k,d)=>{d.r(k),d.d(k,{default:()=>mr});var h=d(10467),w=d(8189),J=d(81098),V=d(85211),P=d(3248),T=d(35150),N=(d(40707),d(76576));let G=class extends J.A{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(l=!1){var s;if(this.popupTemplate)return this.popupTemplate;const o=null===(s=this.sourceLayer)||void 0===s?void 0:s.featureReduction;return o&&"popupTemplate"in o&&o.popupEnabled?o.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};(0,w._)([(0,V.MZ)({type:Boolean})],G.prototype,"isAggregate",void 0),G=(0,w._)([(0,N.$)("esri.AggregateGraphic")],G);const X=G;d(21152);var z=d(89952),F=d(31178),B=d(69690),y=d(5922),S=d(17715),L=d(11432),O=d(56492),m=d(48900),v=d(48237),_=d(98877),D=d(40702);let f=class extends _.A{constructor(l){super(l),this._filter=null,this.duration=(0,P.A)("mapview-transitions-duration"),this._excludedEffectView=new D.$B(l),this._includedEffectView=new D.$B(l)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(l){this._get("featureEffect")!==l&&this._transitionTo(l)}get filter(){var l;return this._filter||(null===(l=this.featureEffect)||void 0===l?void 0:l.filter)||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(l){this._set("scale",l),this._excludedEffectView.scale=l,this._includedEffectView.scale=l}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(l,s){this._set("scale",s),this.transitioning?(this._includedEffectView.transitionStep(l,s),this._excludedEffectView.transitionStep(l,s),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=s,this._includedEffectView.scale=s)}endTransitions(){this._includedEffectView.endTransitions(),this._excludedEffectView.endTransitions(),this._filter=null}_transitionTo(l){const s=this._get("featureEffect"),o=l,a=null==o?void 0:o.includedEffect,u=null==o?void 0:o.excludedEffect,c=this._includedEffectView.canTransitionTo(a)&&this._excludedEffectView.canTransitionTo(u);this._includedEffectView.effect=a,this._excludedEffectView.effect=u,this._set("featureEffect",o),this._filter=(null==o?void 0:o.filter)||(null==s?void 0:s.filter)||null,c||this.endTransitions()}};(0,w._)([(0,V.MZ)()],f.prototype,"_filter",void 0),(0,w._)([(0,V.MZ)()],f.prototype,"_excludedEffectView",void 0),(0,w._)([(0,V.MZ)()],f.prototype,"_includedEffectView",void 0),(0,w._)([(0,V.MZ)()],f.prototype,"duration",void 0),(0,w._)([(0,V.MZ)()],f.prototype,"excludedEffects",null),(0,w._)([(0,V.MZ)()],f.prototype,"featureEffect",null),(0,w._)([(0,V.MZ)()],f.prototype,"filter",null),(0,w._)([(0,V.MZ)()],f.prototype,"hasEffects",null),(0,w._)([(0,V.MZ)()],f.prototype,"includedEffects",null),(0,w._)([(0,V.MZ)({value:0})],f.prototype,"scale",null),(0,w._)([(0,V.MZ)()],f.prototype,"transitioning",null),f=(0,w._)([(0,N.$)("esri.layers.effects.FeatureEffectView")],f);const A=f;var M=d(95877),R=d(86300),W=d(58443),K=d(17221),j=d(93327),U=d(32034);let C=class extends j.A{constructor(){super(...arguments),this.features=[]}readFeatures(l,s){const o=U.A.fromJSON(s.spatialReference),a=[];for(let c=0;c<l.length;c++){var u;const p=l[c],g=X.fromJSON(p),E=null===(u=p.geometry)||void 0===u?void 0:u.spatialReference;null==g.geometry||E||(g.geometry.spatialReference=o);const b=p.aggregateGeometries,x=g.aggregateGeometries;if(b&&null!=x)for(const $ in x){const Z=x[$],te=b[$];null==Z||(null==te?void 0:te.spatialReference)||(Z.spatialReference=o)}a.push(g)}return a}};(0,w._)([(0,V.MZ)({type:[X],json:{write:!0}})],C.prototype,"features",void 0),(0,w._)([(0,K.w)("features")],C.prototype,"readFeatures",null),C=(0,w._)([(0,N.$)("esri.rest.support.AggregateFeatureSet")],C);const H=C;var Q=d(87086),q=d(25735),ne=d(29459),pe=d(56985),Te=d(66803),ye=d(69473),ie=d(1119),ee=d(87250),re=d(69522);class oe{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}updateStart(){this._instanceByIdNext=new Map}updateEnd(){if(!this._instanceByIdNext)throw new Error("InternalError: Found updateEnd call without corresponding updateStart");for(const s of this._instanceById.keys())this._instanceByIdNext.has(s)||this._instanceById.delete(s);for(const[s,o]of this._instanceByIdNext.entries()){const a=this._instanceById.get(s);a?a.setInput(o.getInput()):this._instanceById.set(s,o)}this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(s,o,a){let u=`${s.registryName}`;for(const p in o){const g=o[p];if("object"==typeof g&&"geometry"===p)for(const E in g)u+=`.${p}.${E}.${null!=g[E]}`;else u+=`.${p}.${null!=o[p]}`}if(null!=a)for(const p in a)a[p]&&(u+=`-${p}`);const c=(0,ie.Wm)(u);if(this._instanceByIdNext){const p=new ee.O((0,re.U)(c),s,s.meshWriter.name,o,a);return this._instanceByIdNext.set(c,p),p}if(!this._instanceById.has(c)){const p=new ee.O((0,re.U)(c),s,s.meshWriter.name,o,a);this._instanceById.set(c,p)}return this._instanceById.get(c)}getInstance(s){return this._instanceById.get(s)}}var ue=d(51995),Ee=(d(54290),d(74847)),xe=(d(67347),d(77031),d(81406)),ce=d(36952);class Ae{constructor(s,o,a){this.getStage=s,this.version=o,this._tileInfoView=a,this._tiles=new Map,this._pendingUpdates=[],this._locked=!1}destroy(){}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(s){this._tiles.clear();for(const o of s)this._tiles.set(o.key.id,o)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1;for(const s of this._pendingUpdates)this.updateTile(s);this._pendingUpdates=[]}updateTile(s){if(this._locked)return void this._pendingUpdates.push(s);if((0,P.A)("esri-2d-update-debug")){var o,a;const g=null!==(o=null===(a=s.debugInfo)||void 0===a?void 0:a.chunkId)&&void 0!==o?o:"<EnsureEnd>";console.debug(`Version[${s.version}] Tile[${s.id}] Chunk[${g}] RenderState.updateTile [${s.type}]`,s)}const u=this._ensureTile(s.id);if("update"===s.type){const[g,...E]=s.modify;u.onMessage({type:"update",modify:g,remove:s.remove,end:s.end,attributeEpoch:s.attributeEpoch});for(const b of E){const x=this._tiles.get(b.tileId);x&&x.onMessage({type:"update",modify:b,remove:s.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null})}return}if(null==s.append)return void u.onMessage({type:"append",clear:s.clear,debugInfo:s.debugInfo,end:s.end,attributeEpoch:s.attributeEpoch});const[c,...p]=s.append;u.onMessage({type:"append",clear:s.clear,append:c,debugInfo:s.debugInfo,end:s.end,attributeEpoch:s.attributeEpoch});for(const g of p){const E=this._tiles.get(g.tileId);E&&E.onMessage({type:"update",modify:g,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}removeTile(s){const o=this._tiles.get(s);(0,P.A)("esri-2d-update-debug")&&console.debug(`Tile[${s}] RenderState.removeTile`),null!=o&&o.destroy(),this._tiles.delete(s)}isTileDone(s){const o=this._tiles.get(s.id);return!!o&&o.isReady}_ensureTile(s){if(!this._tiles.has(s)){const o=this._createTile(s);this._copyPixelBufferedEntitiesInto(o),this._tiles.set(s,o)}return this._tiles.get(s)}_createTile(s){(0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${this.version}] Tile[${s}] RenderState.createTile`);const o=new Ee.A(s),a=this._tileInfoView.getTileBounds((0,ue.vt)(),o),u=this._tileInfoView.getTileResolution(o.level),c=new xe.R(o,u,a[0],a[3],!0);if(c.stage=this.getStage(),!c.stage){const p=new y.A("featurelayerview:webgl","Cannot create tile with empty stage");T.A.getLogger("esri.views.2d.layers.features.RenderState").error(p)}return c}_copyPixelBufferedEntitiesInto(s){let o=7;for(let a=-1;a<=1;a++)for(let u=-1;u<=1;u++){if(0===a&&0===u)continue;const p=(0,ce.K)(s.key,u,a,this._tileInfoView.tileInfo.isWrappable).id,g=this._tiles.get(p);null!=g&&s.copyPixelBufferedEntitesFrom(g,1<<o,u,a),o--}}}var Xe=d(62931);class pt{constructor(s,o){this.id=s,this.version=o,this._resolver=(0,O.Tw)(),this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve(),this._done=!0}destroy(){this._resolver.reject()}}class Ht extends Te.j{constructor(s){super(s.view.featuresTilingScheme),this.updatingHandles=new pe.U,this._hitTestsRequests=[],this._store=new oe,this._visibleTiles=new Set,this._subscriptions=new Map,this._updateStatisticsRequests=[],this._lockStatisticUpdates=!1,this._layerView=s}renderChildren(s){if(this.attributeView.update(),this._renderState){const o=Array.from(this._renderState.tiles()).filter(a=>a.needsUpload);o.length&&(o[Math.floor(Math.random()*o.length)].upload(),o.length>=2&&this.requestRender());for(const a of this._renderState.tiles())a.tryReady(this.attributeView.currentEpoch)&&(this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this.requestRender())}for(const o of this.children)o.setTransform(s.state);switch(this.hasAnimation&&s.painter.effects.integrate.draw(s,s.attributeView),super.renderChildren(s),s.drawPhase){case ye.S5.MAP:return this._renderMapPhase(s);case ye.S5.HIGHLIGHT:return this._renderHighlightPhase(s);case ye.S5.LABEL:return this._renderLabelPhase(s)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return this._layerView.labelingCollisionInfos.length>0}get hasHighlight(){return this._layerView.hasHighlight()}get _layer(){return this._layerView.layer}_getExclusivePostprocessingInstance({drawPhase:s}){if(null==this._instanceStore)return null;let o=0,a=null;for(const u of this._instanceStore.values())u.techniqueRef.drawPhase&s&&(o++,u.techniqueRef.postProcessingEnabled&&(a=u));return o>1?null:a}_getOverrideStencilRef({drawPhase:s}){if(null==this._instanceStore)return null;let o=null;for(const a of this._instanceStore.values()){if(!(a.techniqueRef.drawPhase&s))continue;const{overrideStencilRef:u}=a.techniqueRef;if(null==o)o=u;else if(o!==u){o=null;break}}return o}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter(s=>this._visibleTiles.has(s.key.id)):[]}updateAttributeView(s){var o=this;return(0,h.A)(function*(){o.requestRender(),yield o.updatingHandles.addPromise(o.attributeView.requestUpdate(s)),o.hasLabels&&o._layerView.view.labelManager.requestUpdate()})()}updateSubscriptions(s){for(const{tileId:o,version:a}of s.subscribe)if(this._subscriptions.has(o))this._subscriptions.get(o).version=a;else{const u=new pt(o,a);this._subscriptions.set(o,u),this.updatingHandles.addPromise(u.promise)}for(const o of s.unsubscribe){const a=this._subscriptions.get(o);null!=a&&a.destroy(),this._subscriptions.delete(o),this.removeTile(o)}}isDone(s){return!!this._renderState&&this._renderState.isTileDone(s)}updateRenderState(s){var o=this;return(0,h.A)(function*(){(0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${s}] FeatureContainer.updateRenderState`),o._renderStateNext=new Ae(()=>o._stage,s,o._tileInfoView)})()}getDisplayStatistics(s,o){const a=this._statisticsByLevel.get(s);return a?a.get(o):null}updateStatistics(s,o){if(this._lockStatisticUpdates)return void this._updateStatisticsRequests.push({level:s,statistics:o});let a=this._statisticsByLevel.get(s);a||(a=new Map,this._statisticsByLevel.set(s,a));for(const u of o)a.set(u.fieldName,{minValue:u.minValue,maxValue:u.maxValue})}editStart(){var s;null!==(s=this._renderState)&&void 0!==s&&s.lockUploads(),this.attributeView.lockTextureUploads(),this._lockStatisticUpdates=!0}editEnd(){var s;null!==(s=this._renderState)&&void 0!==s&&s.unlockUploads(),this.attributeView.unlockTextureUploads(),this._lockStatisticUpdates=!1;for(const o of this._updateStatisticsRequests)this.updateStatistics(o.level,o.statistics);this._updateStatisticsRequests=[],this.requestRender()}swapRenderState(){var s;if(this._renderStateNext&&((0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`),null!==(s=this._renderState)&&void 0!==s&&s.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null),this._renderState)for(const o of this._renderState.tiles())o.upload();this.requestRender()}setVisibleTiles(s){this._visibleTiles=s}onMessage(s,o){var a=this;return(0,h.A)(function*(){var u;if((0,O.Te)(o),!a._subscriptions.has(s.id))return;const c=a._subscriptions.get(s.id);if(c.version!==s.subscriptionVesrion)return void((0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${s.subscriptionVesrion} != ${c.version}] Tile[${s.id}] FeatureContainer - Dropping message, outdated version]`,s));const p=null!==(u=a._renderStateNext)&&void 0!==u?u:a._renderState;if(!p)throw new Error("InternalError: No renderState defined");p.version!==s.version&&console.error(`InternalError: Version mismatch. [renderState: ${p.version}, message: ${s.version}]`),p.updateTile(s),s.end&&a._subscriptions.get(s.id).end(),a.requestRender(),a._layerView.view.labelManager.requestUpdate(),a._layerView.requestUpdate()})()}removeTile(s){(this._renderState||this._renderStateNext)&&(this._renderState&&this._renderState.removeTile(s),this._renderStateNext&&this._renderStateNext.removeTile(s))}hitTest(s){let o=this._hitTestsRequests.find(({x:u,y:c})=>u===s.x&&c===s.y);const a=(0,O.Tw)();return o?o.resolvers.push(a):(o={x:s.x,y:s.y,resolvers:[a]},this._hitTestsRequests.push(o)),this.requestRender(),a.promise}getSortKeys(s){const o=new Set(s),a=new Map;for(const u of this.children)if(u.getSortKeys(o).forEach((c,p)=>a.set(p,c)),a.size===o.size)break;return a}get hasAnimation(){return this.hasLabels}updateTransitionProperties(s,o){super.updateTransitionProperties(s,o),this._layerView.featureEffectView.transitionStep(s,o),this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(s){const{minScale:o,maxScale:a}=this._layer.effectiveScaleRange,u=s.state.scale;u<=(o||1/0)&&u>=a&&super.doRender(s)}afterRender(s){super.afterRender(s),this._hitTestsRequests.length&&this.requestRender()}setStencilReference(s){const o=this._getOverrideStencilRef(s);if(null==o)super.setStencilReference(s);else for(const a of this.children)a.stencilRef=o(a)}_renderMapPhase(s){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(s),this._renderInsideEffect(s)):this._renderFeatures(s,ye.RI.All),this._hitTestsRequests.length>0&&this._renderHittest(s)}_renderHighlightPhase(s){this.hasHighlight&&(0,Xe.lB)(s,!1,o=>{this._renderFeatures(o,ye.RI.Highlight)})}_renderLabelPhase(s){this._renderFeatures(s,ye.RI.All)}_renderInsideEffect(s){const o=s.painter.effects.insideEffect;o.bind(s),this._renderFeatures(s,ye.RI.InsideEffect),o.draw(s,this._layerView.featureEffectView.includedEffects),o.unbind()}_renderOutsideEffect(s){const o=s.painter.effects.outsideEffect;o.bind(s),this._renderFeatures(s,ye.RI.OutsideEffect),o.draw(s,this._layerView.featureEffectView.excludedEffects),o.unbind()}_renderHittest(s){const{context:o}=s,a=s.painter.effects.hittest,u=o.getBoundFramebufferObject(),c=o.getViewport(),p=s.passOptions;a.bind(s),s.passOptions=a.createOptions(s,this._hitTestsRequests),this._renderFeatures(s,ye.RI.All),a.draw(s),a.unbind(),o.bindFramebuffer(u),o.restoreViewport(c),s.passOptions=p}_renderFeatures(s,o){for(const u of this.children){if(!u.visible)continue;const c=(0,P.A)("featurelayer-force-marker-text-draw-order")?ye.ch.STRICT_MARKERS_AND_TEXT:ye.ch.BATCHING,p=u.getDisplayList(s.drawPhase,this._instanceStore,c);s.selection=o,null==p||p.render(s)}const a=this._getExclusivePostprocessingInstance(s);null!=a&&a.techniqueRef.postProcess(s,a)}}var Qt=d(19284);function ht(){return(ht=(0,h.A)(function*(l){const s=yield(0,Qt.ho)("FeaturePipelineWorker",{client:l,strategy:"dedicated"});return new Xt(s)})).apply(this,arguments)}class Xt{constructor(s){this._connection=s,this.pipeline=this._connection.createInvokeProxy(),this.features=this._connection.createInvokeProxy("features"),this.aggregates=this._connection.createInvokeProxy("aggregates"),this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}var kt=d(42425),qt=d(12619);let De=class extends _.A{constructor(){super(...arguments),this.events=new kt.A,this._updatingStrategy=!0,this._tileToEvent=new qt.A,this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){var l,s;return this._hasAllData()&&null!==(l=null===(s=this._strategyInfo)||void 0===s?void 0:s.willQueryAllFeatures)&&void 0!==l&&l}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){var l,s;return this._hasAllData()&&null!==(l=null===(s=this._strategyInfo)||void 0===s?void 0:s.willQueryFullResolutionGeometry)&&void 0!==l&&l}onEvent(l){switch(l.type){case"subscribe":case"unsubscribe":case"loaded":case"error":this._handleTileEvent(l);break;case"updateStrategyStart":this._updatingStrategy=!0,this._fetchStatus={done:0,outstanding:0},this._strategyInfo=l.about;break;case"updateStrategyEnd":this._updatingStrategy=!1;break;case"updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case"updateFieldsEnd":break;case"updateFieldsError":this.events.emit("error",l);break;case"fetchStart":this._fetchStatus.outstanding+=1,this.events.emit("status",this._fetchStatus);break;case"fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),l.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const l of this._tileToEvent.values())if("loaded"!==l[l.length-1].type)return!1;return!0}_handleTileEvent(l){switch(l.type){case"subscribe":this._tileToEvent.set(l.tile,[l]);break;case"unsubscribe":this._tileToEvent.delete(l.tile);break;case"loaded":{const s=this._tileToEvent.get(l.tile);if(!s)return;s.push(l),this._tileToEvent.set(l.tile,s);break}case"error":{const s=this._tileToEvent.get(l.tile);if(!s)return;s.push(l),this._tileToEvent.set(l.tile,s),this.events.emit("error",l);break}}}};(0,w._)([(0,V.MZ)({readOnly:!0})],De.prototype,"hasAllFeatures",null),(0,w._)([(0,V.MZ)({readOnly:!0})],De.prototype,"hasAllFeaturesInView",null),(0,w._)([(0,V.MZ)({readOnly:!0})],De.prototype,"hasFullGeometries",null),(0,w._)([(0,V.MZ)()],De.prototype,"_updatingStrategy",void 0),(0,w._)([(0,V.MZ)()],De.prototype,"_strategyInfo",void 0),(0,w._)([(0,V.MZ)()],De.prototype,"_tileToEvent",void 0),De=(0,w._)([(0,N.$)("esri.views.2d.layers.features.FeatureSourceEventLog")],De);var ke=d(77806),rt=d(68438);function Fe(l){switch(l.geometryType){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"polygon":case"multipatch":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";default:return null}}var qe=d(67685);function we(l,s){const o=l.featureReduction;return o&&"selection"!==o.type&&(!("maxScale"in o)||!o.maxScale||o.maxScale<s.scale)?o:null}var st=d(69287),ti=d(48716),Ue=d(64765);const ii=Math.PI;function zt(l,s){switch(s.transformationType){case Ue._w.Additive:return function ri(l,s){return l+(Oe(s.minSize,l)||s.minDataValue)}(l,s);case Ue._w.Constant:return function si(l,s){const o=l.stops;let a=(null==o?void 0:o.length)&&o[0].size;return null==a&&(a=l.minSize),Oe(a,s)}(s,l);case Ue._w.ClampedLinear:return function ni(l,s){const o=s.minDataValue,a=s.maxDataValue,u=(l-o)/(a-o),c=Oe(s.minSize,l),p=Oe(s.maxSize,l);return l<=o?c:l>=a?p:c+u*(p-c)}(l,s);case Ue._w.Proportional:return function oi(l,s){const o=l/s.minDataValue,a=Oe(s.minSize,l),u=Oe(s.maxSize,l);let c=null;return c=o*a,(0,st.qE)(c,a,u)}(l,s);case Ue._w.Stops:return function li(l,s){const[o,a,u]=function ui(l,s){if(!s)return;let o=0,a=s.length-1;return s.some((u,c)=>l<u?(a=c,!0):(o=c,!1)),[o,a,(l-s[o])/(s[a]-s[o])]}(l,s.cache.ipData);if(o===a)return Oe(s.stops[o].size,l);{const c=Oe(s.stops[o].size,l);return c+(Oe(s.stops[a].size,l)-c)*u}}(l,s);case Ue._w.RealWorldSize:return function ai(l,s){const o=ti.j[s.valueUnit],a=Oe(s.minSize,l),u=Oe(s.maxSize,l),{valueRepresentation:c}=s;let p=null;return p="area"===c?2*Math.sqrt(l/ii)/o:"radius"===c||"distance"===c?2*l/o:l/o,(0,st.qE)(p,a,u)}(l,s);case Ue._w.Identity:return l;case Ue._w.Unknown:return null}}function Oe(l,s){return"number"==typeof l?l:zt(s,l)}function je(l){var s,o;return null!==(s=l.labelsVisible&&(null===(o=l.labelingInfo)||void 0===o?void 0:o.every(a=>"none"!==a.deconflictionStrategy)))&&void 0!==s&&s}function Ge(l,s){var o;const a=we(l,s);if(null!=a&&a.labelsVisible&&null!==(o=a.labelingInfo)&&void 0!==o&&o.length)return a.labelingInfo.every(u=>"none"!==u.deconflictionStrategy)}function di(l){return s=>(0,qe.Lz)(zt(s,l))}function Ne(l){const s=null!=l&&"visualVariables"in l&&l.visualVariables;if(!s)return null;for(const o of s)if("size"===o.type)return di(o);return null}var nt=d(63484);function Ke(l,s,o,a,u){var c,p,g;const b=(0,nt.m)(s.definitionExpression,null!=s.subtypeCode?`${s.subtypeField} = ${s.subtypeCode}`:null),x=null!==(c=s.customParameters)&&void 0!==c?c:{};return u&&(x.token=u),{type:"feature",mutable:{sourceRefreshVersion:a,availableFields:o.availableFields,dataFilter:{definitionExpression:b,gdbVersion:s.gdbVersion,historicMoment:null===(p=s.historicMoment)||void 0===p?void 0:p.getTime(),outSpatialReference:o.outSpatialReference.toJSON(),timeExtent:null===(g=s.timeExtent)||void 0===g?void 0:g.toJSON(),customParameters:x}},service:l,tileInfoJSON:o.tileInfoJSON}}var ci=d(15848),pi=d(73975),hi=(d(47280),d(78592)),ze=d(26747),Ve=d(65374),fi=d(54935),yi=d(30365);function vi(l,s,o=0){if(null==s)return l[o]=0,l[o+1]=0,l[o+2]=0,void(l[o+3]=0);const{r:a,g:u,b:c,a:p}=s;l[o]=a*p/255,l[o+1]=u*p/255,l[o+2]=c*p/255,l[o+3]=p}d(97550);var ot=d(47669),be=d(28291),lt=d(29822),fe=d(13220),at=d(34155),Be=d(99845),mi=d(88521);function Le(l,s){return ft.apply(this,arguments)}function ft(){return ft=(0,h.A)(function*(l,s){if(!l)return[];switch(l.type){case"simple-fill":return $t(l,s);case"picture-fill":return function Oi(l,s){const{outline:o}=l,{uniforms:a,schemaOptions:u}=s,{store:c}=u,p=[],g=ze.wp.createPictureFillRasterizationParam(l);if(!g)return[];const{width:E,height:b,xoffset:x,yoffset:$,xscale:Z,yscale:te}=l,se={color:[255,255,255,255],sprite:g,height:b,aspectRatio:E/b,offsetX:x,offsetY:$,scaleX:Z,scaleY:te,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,scaleProportionally:!1,effects:null,scaleInfo:null};if("solid"===(null==o?void 0:o.style))return[c.ensureInstance(be.YS.complexOutlineFill,{geometry:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity,visualVariableSizeScaleStops:a.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{...se,...gt(o,!!a.visualVariableSizeOutlineScaleStops)}})];const le=c.ensureInstance(be.YS.complexFill,{geometry:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity}},{zoomRange:!1});return p.push(le.createMeshInfo({params:se})),o&&p.push(...et(o,s,!0)),p}(l,s);case"simple-marker":return function Si(l,s){return mt.apply(this,arguments)}(l,s);case"picture-marker":return function Ei(l,s){const{uniforms:o,schemaOptions:a}=s,{store:u}=a,c=u.ensureInstance(be.YS.marker,{geometry:{visualVariableColor:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity,visualVariableSizeMinMaxValue:o.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:o.visualVariableSizeScaleStops,visualVariableSizeStops:o.visualVariableSizeStops,visualVariableSizeUnitValue:o.visualVariableSizeUnitValue,visualVariableRotation:o.visualVariableRotation}},{zoomRange:!1}),p=ze.wp.createPictureMarkerRasterizationParam(l);return p?[c.createMeshInfo({params:{type:"picture",color:[255,255,255,255],height:l.height,width:l.width,offsetX:l.xoffset,offsetY:l.yoffset,angle:l.angle,alignment:(0,Be.N)(o)?Ve.C1.MAP:Ve.C1.SCREEN,outlineColor:null,outlineSize:0,referenceSize:l.height,sprite:p,overrideOutlineColor:!1,hasSizeVV:(0,Be.I)(o),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,fe.j0)(o)}})]:[]}(l,s);case"simple-line":return et(l,s,!1);case"text":return function Ii(l,s){var o,a,u,c,p,g,E,b;const{uniforms:x,schemaOptions:$}=s,{store:Z}=$;return[Z.ensureInstance(be.YS.text,{geometry:{visualVariableColor:x.visualVariableColor,visualVariableOpacity:x.visualVariableOpacity,visualVariableRotation:x.visualVariableRotation,visualVariableSizeMinMaxValue:x.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:x.visualVariableSizeScaleStops,visualVariableSizeStops:x.visualVariableSizeStops,visualVariableSizeUnitValue:x.visualVariableSizeUnitValue}},{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}).createMeshInfo({params:{boxBackgroundColor:null===(o=l.backgroundColor)||void 0===o?void 0:o.toArray(),boxBorderLineColor:null===(a=l.borderLineColor)||void 0===a?void 0:a.toArray(),boxBorderLineSize:null!==(u=l.borderLineSize)&&void 0!==u?u:0,color:null!==(c=null===(p=l.color)||void 0===p?void 0:p.toArray())&&void 0!==c?c:[0,0,0,0],offsetX:l.xoffset,offsetY:l.yoffset,postAngle:l.angle,fontSize:l.font.size,decoration:l.font.decoration,haloColor:null!==(g=null===(E=l.haloColor)||void 0===E?void 0:E.toArray())&&void 0!==g?g:[0,0,0,0],haloFontSize:null!==(b=l.haloSize)&&void 0!==b?b:0,lineWidth:l.lineWidth,lineHeightRatio:l.lineHeight,horizontalAlignment:l.horizontalAlignment,verticalAlignment:l.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:l.font.toJSON(),textString:l.text,symbol:ze.wp.createCIMTextSymbolfromTextSymbol(l)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:(0,fe.j0)(x),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})]}(l,s);case"label":return function Mi(l,s){var o,a,u,c,p,g,E,b,x,$,Z,te,se;const{schemaOptions:le,uniforms:he}=s,{store:ge}=le,de=l.symbol,{allowOverrun:_e,repeatLabel:Ie,repeatLabelDistance:Me}=l,Re={maxScale:null!==(o=l.maxScale)&&void 0!==o?o:0,minScale:null!==(a=l.minScale)&&void 0!==a?a:0},$e=ge.ensureInstance(be.YS.label,{geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:he.visualVariableRotation,visualVariableSizeMinMaxValue:he.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:he.visualVariableSizeScaleStops,visualVariableSizeStops:he.visualVariableSizeStops,visualVariableSizeUnitValue:he.visualVariableSizeUnitValue}},{zoomRange:!0,clipAngle:!0,referenceSymbol:!0}),Je=l.labelPlacement,[ct,jt]=(0,yi.fO)(Je);return[$e.createMeshInfo({params:{boxBackgroundColor:null===(u=de.backgroundColor)||void 0===u?void 0:u.toArray(),boxBorderLineColor:null===(c=de.borderLineColor)||void 0===c?void 0:c.toArray(),boxBorderLineSize:null!==(p=de.borderLineSize)&&void 0!==p?p:0,color:null!==(g=null===(E=de.color)||void 0===E?void 0:E.toArray())&&void 0!==g?g:[0,0,0,0],offsetX:de.xoffset,offsetY:de.yoffset,postAngle:de.angle,fontSize:de.font.size,decoration:de.font.decoration,haloColor:null!==(b=null===(x=de.haloColor)||void 0===x?void 0:x.toArray())&&void 0!==b?b:[0,0,0,0],haloFontSize:null!==($=de.haloSize)&&void 0!==$?$:0,lineWidth:de.lineWidth,lineHeightRatio:de.lineHeight,horizontalAlignment:ct,verticalAlignment:jt,repeatLabel:Ie,repeatLabelDistance:(0,qe.Lz)(Me),allowOverrun:_e,labelPosition:l.labelPosition,scaleInfo:Re,minPixelBuffer:(0,fe.j0)(he),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:de.font.toJSON(),textString:de.text,symbol:ze.wp.createCIMTextSymbolfromTextSymbol(de),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==(null===(Z=l.labelExpressionInfo)||void 0===Z?void 0:Z.expression),overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:null!==(te=null===(se=l.labelExpressionInfo)||void 0===se?void 0:se.expression)&&void 0!==te?te:l.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1,isLineLabel:!1}})]}(l,s);case"cim":return(0,at.Jk)(l.data,s);case"web-style":{const o=yield l.fetchCIMSymbol();return(0,at.Jk)(o.data,s)}default:throw new Error(`symbol not supported ${l.type}`)}}),ft.apply(this,arguments)}function gi(l,s){return yt.apply(this,arguments)}function yt(){return(yt=(0,h.A)(function*(l,s){const{schemaOptions:o}=s,{store:a}=o,u=new Array(ot.ju),c=new Array(ot.ju/4);for(let b=0;b<ot.ju;b++){const x=b<l.attributes.length?l.attributes[b].color:null;u[b]=[0,0,0,0],vi(u[b],x)}for(let b=0;b<ot.ju/4;b++)c[b]=[0,0,0,0],c[b][0]=4*b<l.attributes.length?1:0,c[b][1]=4*b+1<l.attributes.length?1:0,c[b][2]=4*b+2<l.attributes.length?1:0,c[b][3]=4*b+3<l.attributes.length?1:0;const g=a.ensureInstance(be.YS.dotDensity,{isActive:c,colors:u,dotValue:l.dotValue,dotScale:l.referenceScale,blending:l.dotBlendingEnabled,dotSize:l.dotSize,seed:l.seed},{}).createMeshInfo({params:{effects:null}}),E=[];if(l.backgroundColor){const b=new mi.A({color:l.backgroundColor,outline:null}),x=yield Le(b,s);E.push(...x)}if(E.push(g),l.outline){const b=et(l.outline,s,!0);E.push(...b)}return E})).apply(this,arguments)}function _i(l,s){return vt.apply(this,arguments)}function vt(){return(vt=(0,h.A)(function*(l,s){const{store:o}=s,{radius:a,minDensity:u,maxDensity:c,referenceScale:p,field:g,valueExpression:E,colorStops:b}=l,x=(0,hi.O3)(b);return[o.ensureInstance(be.YS.heatmap,{radius:(0,qe.Lz)(a),minDensity:u,maxDensity:c,referenceScale:p,isFieldActive:!(!g&&!E),gradient:x,gradientHash:x.join(",")},{}).createMeshInfo({params:{effects:null}})]})).apply(this,arguments)}function bi(l,s){var o,a,u,c;const{store:p}=s,g=(null===(o=l.outline)||void 0===o?void 0:o.width)||0,E=(0,fe.K4)(l),b=p.ensureInstance(be.YS.pieChart,{geometry:{outlineWidth:Math.round((0,qe.Lz)(g)),defaultColor:(0,lt.p)(l.defaultColor),outlineColor:(0,lt.p)(null===(a=l.outline)||void 0===a?void 0:a.color),othersColor:(0,lt.p)(null===(u=l.othersCategory)||void 0===u?void 0:u.color),donutRatio:l.holePercentage,sectorThreshold:(null===(c=l.othersCategory)||void 0===c?void 0:c.threshold)||0,colors:l.attributes.map(x=>(0,lt.p)(x.color)),visualVariableOpacity:E.visualVariableOpacity,visualVariableSizeMinMaxValue:E.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:E.visualVariableSizeScaleStops,visualVariableSizeStops:E.visualVariableSizeStops,visualVariableSizeUnitValue:E.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:l.attributes.length},{}).createMeshInfo({params:{size:l.size,outlineWidth:g,effects:null,scaleInfo:null,minPixelBuffer:(0,fe.j0)(E)}});return[...l.backgroundFillSymbol?$t(l.backgroundFillSymbol,{schemaOptions:s,path:"",uniforms:fe.Dk}):[],b]}function Bt(l){if("path"===l.style){if(null==l.path)throw new Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:l.path,asFill:!0}}}const s=ze.wp.fromSimpleMarker(l);if("outline"in l&&l.outline&&"none"!==l.outline.style&&"solid"!==l.outline.style){if(!s||!s.symbolLayers)throw new Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:s.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:(0,fi.eR)(s),overrides:[]}}function mt(){return(mt=(0,h.A)(function*(l,s){var o,a,u,c,p,g;const{uniforms:E,schemaOptions:b}=s,{store:x}=b;if("path"===l.style||l.outline&&"solid"!==l.outline.style&&"none"!==l.outline.style){const _e=ze.wp.fromSimpleMarker(l);if(!_e||!_e.symbolLayers)throw new Error("Error handling marker! ");if(E.visualVariableRotation&&(_e.angleAlignment="Map"),"path"!==l.style){const Ie=_e.symbolLayers[0];if((0,Be.I)(s.uniforms)){const Me=(0,fe.j0)(s.uniforms,0,1);if(Me>Ie.size){var $;const Re=Me/Ie.size;Ie.size=Me;const $e=null===($=Ie.markerGraphics)||void 0===$?void 0:$[0].symbol;($e.symbolLayers&&$e.symbolLayers[0]).width*=Re}}}return(0,at.Jk)({type:"CIMSymbolReference",symbol:_e},s)}const Z=x.ensureInstance(be.YS.marker,{geometry:{visualVariableColor:E.visualVariableColor,visualVariableOpacity:E.visualVariableOpacity,visualVariableSizeMinMaxValue:E.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:E.visualVariableSizeScaleStops,visualVariableSizeStops:E.visualVariableSizeStops,visualVariableSizeUnitValue:E.visualVariableSizeUnitValue,visualVariableRotation:E.visualVariableRotation}},{zoomRange:!1}),te=Bt(l);let se=null!==(o=null===(a=l.color)||void 0===a?void 0:a.toArray())&&void 0!==o?o:[0,0,0,0];"CIMVectorMarker"===te.resource.type&&(se=[255,255,255,255]);const he=l.size,de=null!=E.visualVariableColor&&("cross"===l.style||"x"===l.style);return[Z.createMeshInfo({params:{type:"simple",color:se,height:he,width:he*("triangle"===l.style?124/116:1),offsetX:l.xoffset,offsetY:l.yoffset,angle:l.angle,alignment:(0,Be.N)(E)?Ve.C1.MAP:Ve.C1.SCREEN,outlineColor:null!==(u=null===(c=l.outline)||void 0===c||null===(c=c.color)||void 0===c?void 0:c.toArray())&&void 0!==u?u:[0,0,0,0],outlineSize:null!==(p=null===(g=l.outline)||void 0===g?void 0:g.width)&&void 0!==p?p:1,referenceSize:he,sprite:te,overrideOutlineColor:de,hasSizeVV:(0,Be.I)(E),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,fe.j0)(E)}})]})).apply(this,arguments)}function gt(l,s){var o,a,u;const c=l.width;return{outlineColor:(null===(o=l.color)||void 0===o?void 0:o.toArray())||[0,0,0,1],width:c,referenceWidth:c,capType:null!==(a=l.cap)&&void 0!==a?a:"round",joinType:null!==(u=l.join)&&void 0!==u?u:"round",miterLimit:l.miterLimit,hasSizeVV:s}}function $t(l,s){const{style:o}=l;return o&&"none"!==o&&"solid"!==o?function wi(l,s){var o,a,u,c,p;const{uniforms:g,schemaOptions:E}=s,{store:b}=E,x=null!==(o=null===(a=l.color)||void 0===a?void 0:a.toArray())&&void 0!==o?o:[0,0,0,0],$={type:"sprite-rasterization-param",resource:{type:"fill-style",style:l.style},overrides:[]};if("solid"===(null===(u=l.outline)||void 0===u?void 0:u.style))return[b.ensureInstance(be.YS.patternOutlineFill,{geometry:{visualVariableColor:g.visualVariableColor,visualVariableOpacity:g.visualVariableOpacity,visualVariableSizeScaleStops:g.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{color:x,...gt(l.outline,!!g.visualVariableSizeOutlineScaleStops),sprite:$,scaleInfo:null,effects:null}})];const Z=[],te=b.ensureInstance(be.YS.patternFill,{geometry:{visualVariableColor:g.visualVariableColor,visualVariableOpacity:g.visualVariableOpacity}},{zoomRange:!1}).createMeshInfo({params:{color:null!==(c=null===(p=l.color)||void 0===p?void 0:p.toArray())&&void 0!==c?c:[0,0,0,0],sprite:$,scaleInfo:null,effects:null}});return Z.push(te),l.outline&&Z.push(...et(l.outline,s,!0)),Z}(l,s):function Ai(l,s){var o,a,u;const{uniforms:c,schemaOptions:p}=s,{store:g}=p,E=null!==(o=null===(a=l.color)||void 0===a?void 0:a.toArray())&&void 0!==o?o:[0,0,0,0];if("none"!==l.style&&"solid"===(null===(u=l.outline)||void 0===u?void 0:u.style))return[g.ensureInstance(be.YS.outlineFill,{geometry:{visualVariableColor:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableSizeScaleStops:c.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{color:E,...gt(l.outline,!!c.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null}})];const b=[];if("none"!==l.style){const x=g.ensureInstance(be.YS.fill,{geometry:{visualVariableColor:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity}},{zoomRange:!1}).createMeshInfo({params:{color:E,scaleInfo:null,effects:null}});b.push(x)}return l.outline&&b.push(...et(l.outline,s,!0)),b}(l,s)}function et(l,s,o){var a;const{color:u,style:c,width:p,cap:g,join:E}=l,{schemaOptions:b}=s,{store:x}=b,$=[],Z=o?{...fe.Dk,visualVariableSizeScaleStops:s.uniforms.visualVariableSizeOutlineScaleStops}:s.uniforms,te={geometry:{visualVariableColor:Z.visualVariableColor,visualVariableOpacity:Z.visualVariableOpacity,visualVariableSizeMinMaxValue:Z.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:Z.visualVariableSizeScaleStops,visualVariableSizeStops:Z.visualVariableSizeStops,visualVariableSizeUnitValue:Z.visualVariableSizeUnitValue}},se={color:null!==(a=null==u?void 0:u.toArray())&&void 0!==a?a:[0,0,0,0],width:p,referenceWidth:p,capType:g,joinType:E,miterLimit:l.miterLimit,hasSizeVV:(0,Be.I)(Z),effects:null,scaleInfo:null};if(null==c||"solid"===c){const le=x.ensureInstance(be.YS.line,te,{zoomRange:!1}).createMeshInfo({params:se});$.push(le)}else if("none"!==c){const le=x.ensureInstance(be.YS.texturedLine,te,{zoomRange:!1}).createMeshInfo({params:{...se,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:(0,ze.BW)(c,g),capStyle:(0,ze.ni)(g)},overrides:[]}}});$.push(le)}return null!=l.marker&&$.push(...function xi(l,s,o){var a,u,c,p;const{uniforms:g,schemaOptions:E}=o,{store:b}=E,x=b.ensureInstance(be.YS.marker,{geometry:{visualVariableColor:g.visualVariableColor,visualVariableOpacity:g.visualVariableOpacity,visualVariableSizeMinMaxValue:g.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:g.visualVariableSizeScaleStops,visualVariableSizeStops:g.visualVariableSizeStops,visualVariableSizeUnitValue:g.visualVariableSizeUnitValue,visualVariableRotation:g.visualVariableRotation}},{zoomRange:!1}),$=Bt(l),te=6*s.width,se=te,le=null!==(a=null!==(u=null===(c=l.color)||void 0===c?void 0:c.toArray())&&void 0!==u?u:null===(p=s.color)||void 0===p?void 0:p.toArray())&&void 0!==a?a:[0,0,0,0],he="cross"===l.style||"x"===l.style;let ge;switch(l.placement){case"begin-end":ge=Ve.$2.Both;break;case"begin":ge=Ve.$2.JustBegin;break;case"end":ge=Ve.$2.JustEnd;break;default:ge=Ve.$2.None}const de={type:"cim-marker-placement-info",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:ge,offsetAlongLine:0},overrides:[]};return[x.createMeshInfo({params:{type:"simple",color:le,height:se,width:te,offsetX:0,offsetY:0,angle:0,alignment:(0,Be.N)(g)?Ve.C1.MAP:Ve.C1.SCREEN,outlineColor:le,outlineSize:he?s.width:0,referenceSize:se/6,sprite:$,overrideOutlineColor:he&&null!=g.visualVariableColor,hasSizeVV:(0,Be.I)(g),placement:de,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:(0,fe.j0)(g)}})]}(l.marker,l,s)),$}function tt(l,s,o){return _t.apply(this,arguments)}function _t(){return _t=(0,h.A)(function*(l,s,o){const a=s.labelsVisible&&s.labelingInfo||[],u=Fe(s),c=(0,pi.z)(a,u);return{type:"label",classes:yield Promise.all(c.map((p,g)=>function Ri(l,s,o,a){return bt.apply(this,arguments)}(l,p,g,o)))}}),_t.apply(this,arguments)}function bt(){return(bt=(0,h.A)(function*(l,s,o,a){var u,c;const p=yield Le(s,{path:`${o}`,schemaOptions:l,uniforms:a});return{maxScale:s.maxScale,minScale:s.minScale,expression:null!==(u=null===(c=s.labelExpressionInfo)||void 0===c?void 0:c.expression)&&void 0!==u?u:s.labelExpression,where:s.where,meshes:p}})).apply(this,arguments)}function it(l,s){return St.apply(this,arguments)}function St(){return St=(0,h.A)(function*(l,s){if(!s)return{type:"simple",meshes:[]};switch(s.type){case"simple":return function Pi(l,s){return xt.apply(this,arguments)}(l,s);case"dot-density":return function Vi(l,s){return It.apply(this,arguments)}(l,s);case"class-breaks":return function Ti(l,s){return Mt.apply(this,arguments)}(l,s);case"unique-value":return function Ci(l,s){return wt.apply(this,arguments)}(l,s);case"dictionary":return function Di(l){const s=(0,fe.K4)(l),o=l.scaleExpression;return{type:"dictionary",fieldMap:l.fieldMap,scaleExpression:null!=o&&"1"!==o?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:l.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0,visualVariableUniforms:s}}(s);case"heatmap":return function Fi(l,s){return At.apply(this,arguments)}(l,s);case"pie-chart":return function Li(l,s){return Ot.apply(this,arguments)}(l,s)}}),St.apply(this,arguments)}function xt(){return(xt=(0,h.A)(function*(l,s){const o=s.getSymbols(),a=o.length?o[0]:null,u=(0,fe.K4)(s);return{type:"simple",meshes:yield Le(a,{schemaOptions:l,uniforms:u,path:"renderer.symbol"})}})).apply(this,arguments)}function It(){return(It=(0,h.A)(function*(l,s){const o=(0,fe.K4)(s);return{type:"dot-density",meshes:yield gi(s,{schemaOptions:l,uniforms:o,path:"renderer.symbol"})}})).apply(this,arguments)}function Mt(){return Mt=(0,h.A)(function*(l,s){const o=(0,fe.K4)(s),a=s.backgroundFillSymbol,u=s.normalizationType,c="log"===u?"esriNormalizeByLog":"percent-of-total"===u?"esriNormalizeByPercentOfTotal":"field"===u?"esriNormalizeByField":null,p=s.classBreakInfos.map(function(){var x=(0,h.A)(function*($){return{meshes:yield Le($.symbol,{path:`renderer-stop-${$.minValue}-${$.maxValue}`,schemaOptions:l,uniforms:o}),min:$.minValue,max:$.maxValue}});return function($){return x.apply(this,arguments)}}()),g=(yield Promise.all(p)).sort((x,$)=>x.min-$.min),E=yield Le(a,{schemaOptions:l,path:"renderer.backgroundFill",uniforms:{...fe.Dk,visualVariableSizeOutlineScaleStops:o.visualVariableSizeOutlineScaleStops}}),b=yield Le(s.defaultSymbol,{schemaOptions:l,path:"renderer.defaultSymbol",uniforms:o});return{type:"interval",field:s.field,expression:s.valueExpression,backgroundFill:E,defaultSymbol:b,intervals:g,normalizationField:s.normalizationField,normalizationTotal:s.normalizationTotal,normalizationType:c,isMaxInclusive:s.isMaxInclusive}}),Mt.apply(this,arguments)}function wt(){return(wt=(0,h.A)(function*(l,s){const o=[],a=(0,fe.K4)(s),u=yield Le(s.backgroundFillSymbol,{schemaOptions:l,path:"renderer.backgroundFill",uniforms:{...fe.Dk,visualVariableSizeOutlineScaleStops:a.visualVariableSizeOutlineScaleStops}}),c=yield Le(s.defaultSymbol,{schemaOptions:l,path:"renderer.defaultSymbol",uniforms:a});for(const g of null!==(p=s.uniqueValueInfos)&&void 0!==p?p:[]){var p;const E=yield Le(g.symbol,{path:`renderer-unique-value-${g.value}`,schemaOptions:l,uniforms:a});o.push({value:""+g.value,symbol:E})}return{type:"map",field:s.field,expression:s.valueExpression,field2:s.field2,field3:s.field3,fieldDelimiter:s.fieldDelimiter,backgroundFill:u,defaultSymbol:c,map:o}})).apply(this,arguments)}function At(){return(At=(0,h.A)(function*(l,s){return{type:"heatmap",meshes:yield _i(s,l)}})).apply(this,arguments)}function Ot(){return(Ot=(0,h.A)(function*(l,s){return{type:"pie-chart",meshes:bi(s,l)}})).apply(this,arguments)}var ut=d(84836);function Ui(l,s){return Rt.apply(this,arguments)}function Rt(){return(Rt=(0,h.A)(function*(l,s){const o=s.renderer,a=(0,fe.K4)(o);return{symbology:yield it(l,o),labels:yield tt(l,s,a)}})).apply(this,arguments)}function We(l,s,o,a){return Pt.apply(this,arguments)}function Pt(){return Pt=(0,h.A)(function*(l,s,o,a){const u=o.featureReduction;if(u)switch(u.type){case"binning":return function zi(l,s,o,a,u){return Vt.apply(this,arguments)}(u,l,s,o,a);case"cluster":return function Bi(l,s,o,a,u){return Tt.apply(this,arguments)}(u,l,s,o,a)}const c=function $i(l,s,o){const a=null!=s&&"unique-value"===s.type&&s.orderByClassesEnabled;if("default"!==l||a||(l=[new ci.A({field:o,order:"descending"})]),"default"!==l&&l.length){const u=l[0],c="ascending"===u.order?"asc":"desc";return u.field?{field:u.field,order:c}:u.valueExpression?{expression:u.valueExpression,order:c}:null}return a?{byRenderer:!0,order:"asc"}:null}(o.orderBy,o.renderer,o.objectIdField);return{storage:(0,ut.T9)(o.renderer,s.filters),mesh:{displayRefreshVersion:a,strategy:{type:"feature"},factory:yield Ui(l,o),sortKey:c,timeZone:s.timeZone}}}),Pt.apply(this,arguments)}function Nt(l,s){return l.fields.map(o=>({...o.toJSON(),type:ji(o,s)}))}function ji(l,s){const{onStatisticExpression:o,onStatisticField:a,statisticType:u}=l;switch(u){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(o){const{returnType:p}=o;return p?"string"===p?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"}const c=s.find(p=>p.name===a);return c?c.type:"esriFieldTypeString"}}}function Vt(){return(Vt=(0,h.A)(function*(l,s,o,a,u){const c=Nt(l,a.fields),p=l.renderer,g=yield it(s,p),E=(0,ut.T9)(p,[null,null]),b=(0,fe.K4)(p),x=yield tt(s,{geometryType:"polygon",labelingInfo:l.labelingInfo,labelsVisible:l.labelsVisible},b);return{storage:E,mesh:{displayRefreshVersion:u,strategy:{type:"binning",fields:c,fixedBinLevel:l.fixedBinLevel,featureFilter:o.filters[0]},factory:{labels:x,symbology:g},sortKey:null,timeZone:o.timeZone}}})).apply(this,arguments)}function Tt(){return(Tt=(0,h.A)(function*(l,s,o,a,u){const c=Nt(l,a.fields),p={type:"cluster",feature:yield it(s,l.effectiveFeatureRenderer),cluster:yield it(s,l.effectiveClusterRenderer)},g=(0,fe.K4)(l.effectiveFeatureRenderer),E={type:"cluster",feature:yield tt(s,a,g),cluster:yield tt(s,{geometryType:"point",labelingInfo:l.labelingInfo,labelsVisible:l.labelsVisible},g)};return{storage:(0,ut.T9)(l.effectiveFeatureRenderer,[null,null]),mesh:{displayRefreshVersion:u,strategy:{type:"cluster",fields:c,featureFilter:o.filters[0],clusterRadius:(0,qe.Lz)(l.clusterRadius/2)},factory:{labels:E,symbology:p},sortKey:null,timeZone:o.timeZone}}})).apply(this,arguments)}var Ze=d(79213);class Ni{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){const o=this.layer,a=je(o);return[{vvEvaluators:{0:Ne(o.renderer)},deconflictionEnabled:a}]}createServiceOptions(s){var o=this;return(0,h.A)(function*(){var a,u;const c=o.layer,p=c.parent,g=(0,W.BR)(p),{capabilities:E,editingInfo:b,objectIdField:x,globalIdField:$,datesInUnknownTimezone:Z,orderBy:te,subtypeField:se,parsedUrl:le}=p,he=p.fieldsIndex.toJSON(),ge=Fe(c),de=null===(a=p.timeInfo)||void 0===a?void 0:a.toJSON(),_e=c.spatialReference.toJSON(),Ie=(0,ke.o8)(le);let Me=x;if(null!=te&&te.length){const Re=!te[0].valueExpression&&te[0].field;Re&&(Me=Re)}return{type:"feature-service",source:Ie,isSourceHosted:(0,rt.Wo)(Ie.path),orderByFields:Me,metadata:{timeReferenceUnknownClient:Z,subtypeField:se,globalIdField:$,fieldsIndex:he,geometryType:ge,objectIdField:x,timeInfo:de,spatialReference:_e,subtypes:null,typeIdField:null,types:null},queryMetadata:{capabilities:E,effectiveCapabilities:g,lastEditDate:null==b||null===(u=b.lastEditDate)||void 0===u?void 0:u.getTime(),snapshotInfo:null}}})()}createSourceSchema(s,o,a){const{definitionExpression:u,customParameters:c,timeExtent:p,apiKey:g}=this.layer.parent;return Ke(s,{definitionExpression:u,customParameters:c,timeExtent:p},o,a,g)}createProcessorSchema(s,o,a){const{parent:{fields:u,geometryType:c,orderBy:p,objectIdField:g},renderer:E,labelingInfo:b,labelsVisible:x}=this.layer;return We(s,o,{featureReduction:null,fields:u.map(Z=>Z.toJSON()),geometryType:c,labelingInfo:b,labelsVisible:x,objectIdField:g,orderBy:null!=p?p:"default",renderer:null==E?void 0:E.clone()},a)}get hasRequiredSupport(){return(0,Ze.e)(this.layer.renderer)}getUpdateHashProperties(s){const o=this.layer,{parent:a,parent:{definitionExpression:u,apiKey:c},renderer:p}=o,g=this.layer.labelsVisible?this.layer.labelingInfo:null;return{apiKey:c,customParameters:JSON.stringify(a.customParameters),definitionExpression:u,labelingInfo:g,orderBy:JSON.stringify(a.orderBy),renderer:p}}setGraphicOrigin(s){s.origin={type:"catalog",layer:this.layer}}}function Ct(l,s){const o=l.extent,a=null==s?void 0:s.clone().intersection(o),c=s?s.width*s.height:0,p=0===c?0:(null!=a?a.width*a.height:0)/c,g=(0,P.A)("featurelayer-snapshot-point-coverage");return!isNaN(p)&&p>=g}function He(l,s){return null!=l.floorInfo&&(l.floorInfo.viewAllLevelIds.length>0||s.floors.length>0)}function Dt(l,s,o){var a,u;const c=function Ki(l,s,o){var a,u;if(null==l.floorInfo||null===(a=o.floors)||void 0===a||!a.length)return s;let c=o.floors;const{floorField:p,viewAllLevelIds:g}=l.floorInfo;g.length&&(c=g);const E=c.filter(x=>""!==x).map(x=>"'"+x+"'");if(E.push("''"),null!==(u=s)&&void 0!==u&&u.includes(p)){let x=new RegExp("AND \\("+p+".*NULL\\)","g");s=s.replace(x,""),x=new RegExp("\\("+p+".*NULL\\)","g"),s=(s=s.replace(x,"")).replaceAll(/\s+/g," ").trim()}let b="("+p+" IN ({ids}) OR "+p+" IS NULL)";return b=b.replace("{ids}",E.join(", ")),(0,nt.m)(s,b)}(l,null===(a=s)||void 0===a?void 0:a.where,o);return c&&(null!==(u=s)&&void 0!==u||(s=new M.A),s.where=c),s}class Wi{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){var o;const a=this.layer,u=null!==(o=Ge(a,s))&&void 0!==o?o:je(a);return[{vvEvaluators:{0:Ne(a.renderer)},deconflictionEnabled:u}]}createServiceOptions(s){var o=this;return(0,h.A)(function*(){var a,u,c,p;const g=o.layer,E=(0,W.BR)(g),{capabilities:b,editingInfo:x,objectIdField:$,typeIdField:Z,globalIdField:te,datesInUnknownTimezone:se,orderBy:le,subtypeField:he,refreshInterval:ge}=g,de=g.fieldsIndex.toJSON(),_e=de.fields,Ie=Fe(g),Me=null===(a=g.timeInfo)||void 0===a?void 0:a.toJSON(),Re=g.spatialReference.toJSON(),$e=null===(u=g.types)||void 0===u?void 0:u.map(Ye=>Ye.toJSON()),Je=(0,ke.o8)(o.layer.parsedUrl);o.layer.dynamicDataSource&&(Je.query={layer:JSON.stringify({source:o.layer.dynamicDataSource})});let ct=o.layer.objectIdField;if(null!=le&&le.length){const Ye=!le[0].valueExpression&&le[0].field;Ye&&(ct=Ye)}const jt=null==(null==x?void 0:x.lastEditDate)&&ge>0,Gt=(0,P.A)("featurelayer-snapshot-enabled")&&"point"===g.geometryType&&(null==b?void 0:b.query.supportsPagination)&&!(null!=b&&b.operations.supportsEditing)&&!jt,gr=Gt&&Ct(s,g.fullExtent);return{type:"feature-service",source:Je,isSourceHosted:(0,rt.Wo)(Je.path),orderByFields:ct,metadata:{typeIdField:null!=Z?Z:void 0,types:$e,timeReferenceUnknownClient:se,subtypeField:he,globalIdField:te,fields:_e,fieldsIndex:de,geometryType:Ie,objectIdField:$,timeInfo:Me,spatialReference:Re,subtypes:null===(c=o.layer.subtypes)||void 0===c?void 0:c.map(Ye=>Ye.toJSON())},queryMetadata:{capabilities:b,effectiveCapabilities:E,lastEditDate:null==x||null===(p=x.lastEditDate)||void 0===p?void 0:p.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:Gt,supportsSnapshotMaxThreshold:gr,snapshotCountThresholds:{min:(0,P.A)("featurelayer-snapshot-point-min-threshold"),max:(0,P.A)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(s,o,a){const{definitionExpression:u,customParameters:c,gdbVersion:p,historicMoment:g,subtypeCode:E,subtypeField:b,timeExtent:x,apiKey:$}=this.layer;return Ke(s,{definitionExpression:u,customParameters:c,gdbVersion:p,historicMoment:g,subtypeCode:E,subtypeField:b,timeExtent:x},o,a,$)}createProcessorSchema(s,o,a){const{fields:u,renderer:c,geometryType:p,labelingInfo:g,labelsVisible:E,orderBy:b,objectIdField:x}=this.layer;return We(s,o,{fields:u.map(Z=>Z.toJSON()),renderer:null==c?void 0:c.clone(),featureReduction:we(this.layer,o),geometryType:p,labelingInfo:g,labelsVisible:E,objectIdField:x,orderBy:null!=b?b:"default"},a)}get hasRequiredSupport(){return(0,Ze.e)(this.layer.renderer)}hasFilters(s){return He(this.layer,s)}addFilters(s,o){return Dt(this.layer,s,o)}getUpdateHashProperties(s){var o,a,u;const c=this.layer,{definitionExpression:p,renderer:g,gdbVersion:E,apiKey:b,subtypeCode:x}=c,$=this.layer.labelsVisible?this.layer.labelingInfo:null,Z=null!==(o=null===(a=c.historicMoment)||void 0===a?void 0:a.getTime())&&void 0!==o?o:void 0,te=JSON.stringify(c.customParameters),se=null===(u=we(c,s))||void 0===u?void 0:u.toJSON(),le=JSON.stringify(c.orderBy);return{apiKey:b,customParameters:te,definitionExpression:p,featureReduction:se,floors:He(this.layer,s)?s.floors:null,gdbVersion:E,historicMoment:Z,labelingInfo:$,orderBy:le,renderer:g,subtypeCode:x}}}class Kt{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){var o;const a=this.layer,u=null!==(o=Ge(a,s))&&void 0!==o?o:je(a);return[{vvEvaluators:{0:Ne(a.renderer)},deconflictionEnabled:u}]}createServiceOptions(s){var o=this;return(0,h.A)(function*(){var a;const u=o.layer,c=(0,W.BR)(u),{capabilities:p,objectIdField:g}=u,E=u.fieldsIndex.toJSON(),b=Fe(u),x=null===(a=u.timeInfo)||void 0===a?void 0:a.toJSON(),$=u.spatialReference.toJSON();return function Zi(l){if(!("openPorts"in l))throw new y.A("source-not-supported")}(u.source),{type:"memory",source:yield u.source.openPorts(),orderByFields:g,metadata:{fieldsIndex:E,geometryType:b,objectIdField:g,timeInfo:x,spatialReference:$,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:null},queryMetadata:{capabilities:p,effectiveCapabilities:c,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(s,o,a){const{definitionExpression:u,timeExtent:c}=this.layer;return Ke(s,{definitionExpression:u,timeExtent:c,customParameters:null},o,a,null)}createProcessorSchema(s,o,a){const{fields:u,renderer:c,geometryType:p,labelingInfo:g,labelsVisible:E,orderBy:b,objectIdField:x}=this.layer;return We(s,o,{fields:u.map(Z=>Z.toJSON()),renderer:null==c?void 0:c.clone(),featureReduction:we(this.layer,o),geometryType:p,labelingInfo:g,labelsVisible:E,objectIdField:x,orderBy:null!=b?b:"default"},a)}get hasRequiredSupport(){return(0,Ze.e)(this.layer.renderer)}getUpdateHashProperties(s){var o;const a=this.layer,{definitionExpression:u,renderer:c}=a,p=this.layer.labelsVisible?this.layer.labelingInfo:null,g=null===(o=we(a,s))||void 0===o?void 0:o.toJSON();return{orderBy:JSON.stringify(a.orderBy),definitionExpression:u,renderer:c,labelingInfo:p,featureReduction:g}}}class Ji{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){var o;const a=this.layer,u=null!==(o=Ge(a,s))&&void 0!==o?o:je(a);return[{vvEvaluators:{0:Ne(a.renderer)},deconflictionEnabled:u}]}createServiceOptions(s){var o=this;return(0,h.A)(function*(){const a=o.layer,u=(0,W.BR)(a),{capabilities:c,objectIdField:p}=a,g=a.fieldsIndex.toJSON(),E=Fe(a),b=a.spatialReference.toJSON();return{type:"memory",source:yield a.source.openPorts(),orderByFields:p,metadata:{fieldsIndex:g,geometryType:E,objectIdField:p,spatialReference:b,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{capabilities:c,effectiveCapabilities:u,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(s,o,a){const{definitionExpression:u}=this.layer;return Ke(s,{definitionExpression:u,customParameters:null},o,a,null)}createProcessorSchema(s,o,a){const{fields:u,renderer:c,geometryType:p,labelingInfo:g,labelsVisible:E,objectIdField:b}=this.layer;return We(s,o,{fields:u.map($=>$.toJSON()),renderer:null==c?void 0:c.clone(),featureReduction:we(this.layer,o),geometryType:p,labelingInfo:g,labelsVisible:E,objectIdField:b,orderBy:"default"},a)}get hasRequiredSupport(){return(0,Ze.e)(this.layer.renderer)}getUpdateHashProperties(s){var o;const a=this.layer,{definitionExpression:u,renderer:c}=a;return{definitionExpression:u,renderer:c,labelingInfo:this.layer.labelsVisible?this.layer.labelingInfo:null,featureReduction:null===(o=we(a,s))||void 0===o?void 0:o.toJSON()}}}class Gi{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){var o;const a=this.layer,u=null!==(o=Ge(a,s))&&void 0!==o?o:je(a);return[{vvEvaluators:{0:Ne(a.renderer)},deconflictionEnabled:u}]}createServiceOptions(s){var o=this;return(0,h.A)(function*(){var a;const u=o.layer,c=(0,W.BR)(u),{capabilities:p,objectIdField:g}=u,E=u.fieldsIndex.toJSON(),b=Fe(u),x=null===(a=u.timeInfo)||void 0===a?void 0:a.toJSON(),$=u.spatialReference.toJSON(),Z=u.source.getSource(),te=o.layer.objectIdField,se=(0,ke.o8)(p);return se.query.maxRecordCount=Z.maxRecordCount,{type:"ogc",source:Z,orderByFields:te,metadata:{fieldsIndex:E,geometryType:b,objectIdField:g,timeInfo:x,spatialReference:$,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{capabilities:se,effectiveCapabilities:c,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(s,o,a){const{customParameters:u,timeExtent:c,apiKey:p}=this.layer;return Ke(s,{customParameters:u,timeExtent:c},o,a,p)}createProcessorSchema(s,o,a){const{fields:u,renderer:c,geometryType:p,labelingInfo:g,labelsVisible:E,orderBy:b,objectIdField:x}=this.layer;return We(s,o,{fields:u.map(Z=>Z.toJSON()),renderer:null==c?void 0:c.clone(),featureReduction:we(this.layer,o),geometryType:p,labelingInfo:g,labelsVisible:E,objectIdField:x,orderBy:null!=b?b:"default"},a)}get hasRequiredSupport(){return(0,Ze.e)(this.layer.renderer)}getUpdateHashProperties(s){var o;const a=this.layer,{renderer:u,apiKey:c}=a,p=this.layer.labelsVisible?this.layer.labelingInfo:null;return{apiKey:c,customParameters:JSON.stringify(a.customParameters),featureReduction:null===(o=we(a,s))||void 0===o?void 0:o.toJSON(),labelingInfo:p,orderBy:JSON.stringify(a.orderBy),renderer:u}}}class Hi{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){var o;const a=this.layer,u=null!==(o=Ge(a,s))&&void 0!==o?o:je(a);return[{vvEvaluators:{0:Ne(a.renderer)},deconflictionEnabled:u}]}createServiceOptions(s){var o=this;return(0,h.A)(function*(){var a;const u=o.layer,c=(0,W.BR)(u),{capabilities:p,objectIdField:g,globalIdField:E,orderBy:b,refreshInterval:x}=u,$=u.fieldsIndex.toJSON(),Z=$.fields,te=Fe(u),se=null===(a=u.timeInfo)||void 0===a?void 0:a.toJSON(),le=u.spatialReference.toJSON(),he=(0,ke.o8)(o.layer.parsedUrl);let ge=o.layer.objectIdField;if(null!=b&&b.length){const Me=!b[0].valueExpression&&b[0].field;Me&&(ge=Me)}const de=x>0,_e=(0,P.A)("featurelayer-snapshot-enabled")&&"point"===u.geometryType&&(null==p?void 0:p.query.supportsPagination)&&!(null!=p&&p.operations.supportsEditing)&&!de,Ie=_e&&Ct(s,u.fullExtent);return{type:"feature-service",source:he,isSourceHosted:(0,rt.Wo)(he.path),orderByFields:ge,metadata:{globalIdField:E,fields:Z,fieldsIndex:$,geometryType:te,objectIdField:g,timeInfo:se,spatialReference:le,timeReferenceUnknownClient:!1,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{capabilities:p,effectiveCapabilities:c,lastEditDate:null,snapshotInfo:{supportsSnapshotMinThreshold:_e,supportsSnapshotMaxThreshold:Ie,snapshotCountThresholds:{min:(0,P.A)("featurelayer-snapshot-point-min-threshold"),max:(0,P.A)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(s,o,a){const{definitionExpression:u,customParameters:c,timeExtent:p}=this.layer;return Ke(s,{definitionExpression:u,customParameters:c,timeExtent:p},o,a,null)}createProcessorSchema(s,o,a){const{fields:u,renderer:c,geometryType:p,labelingInfo:g,labelsVisible:E,orderBy:b,objectIdField:x}=this.layer;return We(s,o,{fields:u.map(Z=>Z.toJSON()),renderer:null==c?void 0:c.clone(),featureReduction:we(this.layer,o),geometryType:p,labelingInfo:g,labelsVisible:E,objectIdField:x,orderBy:null!=b?b:"default"},a)}get hasRequiredSupport(){return(0,Ze.e)(this.layer.renderer)}hasFilters(s){return He(this.layer,s)}addFilters(s,o){return Dt(this.layer,s,o)}getUpdateHashProperties(s){var o;const a=this.layer,{definitionExpression:u,renderer:c}=a,p=this.layer.labelsVisible?this.layer.labelingInfo:null,g=JSON.stringify(a.customParameters),E=null===(o=we(a,s))||void 0===o?void 0:o.toJSON();return{orderBy:JSON.stringify(a.orderBy),definitionExpression:u,renderer:c,labelingInfo:p,featureReduction:E,customParameters:g,floors:He(this.layer,s)?s.floors:null}}}class Qi{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){var o;const a=this.layer,u=null!==(o=Ge(a,s))&&void 0!==o?o:je(a);return[{vvEvaluators:{0:Ne(a.renderer)},deconflictionEnabled:u}]}createServiceOptions(s){var o=this;return(0,h.A)(function*(){var a;const u=o.layer,{objectIdField:c}=u,p=Fe(u),g=(null===(a=u.timeInfo)||void 0===a?void 0:a.toJSON())||null,E=u.spatialReference?u.spatialReference.toJSON():null;return{source:o.layer.parsedUrl,metadata:{fieldsIndex:o.layer.fieldsIndex.toJSON(),geometryType:p,objectIdField:c,timeInfo:g,timeReferenceUnknownClient:null,spatialReference:E,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}})()}createSourceSchema(s,o,a){const{definitionExpression:u,geometryDefinition:c,customParameters:p}=this.layer;return{type:"stream",service:s,tileInfoJSON:o.tileInfoJSON,mutable:{sourceRefreshVersion:a,availableFields:o.availableFields,dataFilter:{geometryDefinition:null==c?void 0:c.toJSON(),definitionExpression:u,outSpatialReference:o.outSpatialReference.toJSON(),customParameters:null!=p?p:null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(s,o,a){const{fields:u,renderer:c,geometryType:p,labelingInfo:g,labelsVisible:E,objectIdField:b}=this.layer;return We(s,o,{fields:u.map($=>$.toJSON()),renderer:null==c?void 0:c.clone(),featureReduction:we(this.layer,o),geometryType:p,labelingInfo:g,labelsVisible:E,objectIdField:b,orderBy:"default"},a)}get hasRequiredSupport(){return(0,Ze.e)(this.layer.renderer)}getUpdateHashProperties(s){var o;const a=this.layer,{definitionExpression:u,renderer:c}=a,p=this.layer.labelsVisible?this.layer.labelingInfo:null,g=JSON.stringify(a.customParameters);return{definitionExpression:u,renderer:c,labelingInfo:p,featureReduction:null===(o=we(a,s))||void 0===o?void 0:o.toJSON(),customParameters:g,streamFilter:`${JSON.stringify(a.geometryDefinition)}${a.definitionExpression}`}}}var Yi=d(54551);function Xi(l,s){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,h.A)(function*(l,{subtypeField:s,sublayers:o}){const a=yield Promise.all(o.map(({renderer:u})=>it(l,u)));return{type:"subtype",subtypeField:s,renderers:o.reduce((u,{subtypeCode:c},p)=>({...u,[c]:a[p]}),{})}})).apply(this,arguments)}function ki(l,s){const o=(0,Yi.C)();return{type:"subtype",filters:l.filters,capabilities:{maxTextureSize:o.maxTextureSize},subtypeField:s.subtypeField,target:"feature",bindings:s.sublayers.reduce((a,{renderer:u,subtypeCode:c})=>({...a,[c]:(0,ut.Jz)(u)}),{})}}function qi(l,s){return Lt.apply(this,arguments)}function Lt(){return(Lt=(0,h.A)(function*(l,{subtypeField:s,sublayers:o}){const a=yield Promise.all(o.map(u=>{var c;const p=(0,fe.K4)(u.renderer),g={...u,geometryType:null!==(c=u.geometryType)&&void 0!==c?c:null};return tt(l,g,p)}));return{type:"subtype",subtypeField:s,renderers:o.reduce((u,{subtypeCode:c},p)=>({...u,[c]:a[p]}),{})}})).apply(this,arguments)}function Ut(){return(Ut=(0,h.A)(function*(l,s,o,a){return{storage:ki(s,o),mesh:{displayRefreshVersion:a,strategy:{type:"feature"},factory:{symbology:yield Xi(l,o),labels:yield qi(l,o)},sortKey:null,timeZone:s.timeZone}}})).apply(this,arguments)}class tr{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every(o=>je(o))}]}createServiceOptions(s){var o=this;return(0,h.A)(function*(){var a,u,c;const p=o.layer,g=(0,W.BR)(p),{capabilities:E,datesInUnknownTimezone:b,editingInfo:x,globalIdField:$,objectIdField:Z,refreshInterval:te,subtypeField:se}=p,le=p.fieldsIndex.toJSON(),he=Fe(p),ge=null===(a=p.timeInfo)||void 0===a?void 0:a.toJSON(),de=p.spatialReference.toJSON(),_e=(0,ke.o8)(o.layer.parsedUrl),Ie=Z,Me=null==(null==x?void 0:x.lastEditDate)&&te>0,Re=(0,P.A)("featurelayer-snapshot-enabled")&&"point"===p.geometryType&&(null==E?void 0:E.query.supportsPagination)&&!(null!=E&&E.operations.supportsEditing)&&!Me,$e=Re&&Ct(s,p.fullExtent);return{type:"feature-service",source:_e,isSourceHosted:(0,rt.Wo)(_e.path),orderByFields:Ie,metadata:{timeReferenceUnknownClient:b,subtypeField:se,globalIdField:$,fieldsIndex:le,geometryType:he,objectIdField:Z,timeInfo:ge,spatialReference:de,subtypes:null===(u=o.layer.subtypes)||void 0===u?void 0:u.map(Je=>Je.toJSON()),typeIdField:null,types:null},queryMetadata:{capabilities:E,effectiveCapabilities:g,lastEditDate:null==x||null===(c=x.lastEditDate)||void 0===c?void 0:c.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:Re,supportsSnapshotMaxThreshold:$e,snapshotCountThresholds:{min:(0,P.A)("featurelayer-snapshot-point-min-threshold"),max:(0,P.A)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(s,o,a){const{definitionExpression:u,customParameters:c,gdbVersion:p,historicMoment:g,subtypeField:E,timeExtent:b,apiKey:x}=this.layer,$=this.layer.sublayers.map(se=>se.subtypeCode).join(",");return Ke(s,{definitionExpression:(0,nt.m)(u,this.layer.sublayers.length?`${this.layer.subtypeField} IN (${$})`:"1=2"),customParameters:c,gdbVersion:p,historicMoment:g,subtypeField:E,timeExtent:b},o,a,x)}createProcessorSchema(s,o,a){return function er(l,s,o,a){return Ut.apply(this,arguments)}(s,o,{subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,c=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:c.labelingInfo,labelsVisible:c.labelsVisible,renderer:c.renderer,subtypeCode:c.subtypeCode,orderBy:null}))},a)}hasFilters(s){return He(this.layer,s)||function ir(l,s){return l.sublayers.some(o=>!Wt(o,s))}(this.layer,s)}addFilters(s,o){var a;s=Dt(this.layer,s,o);const u=this.layer.sublayers.filter(p=>!Wt(p,o)).map(p=>p.subtypeCode);if(!u.length)return s;null!==(a=s)&&void 0!==a||(s=new M.A);const c=`NOT ${this.layer.subtypeField} IN (${u.join(",")})`;return s.where=(0,nt.m)(s.where,c),s}get hasRequiredSupport(){return!0}getUpdateHashProperties(s){var o,a;const u=this.layer,{definitionExpression:c,gdbVersion:p,apiKey:g}=u,E=null!==(o=null===(a=u.historicMoment)||void 0===a?void 0:a.getTime())&&void 0!==o?o:void 0,b=JSON.stringify(u.customParameters),x=He(this.layer,s)?s.floors:null;return{gdbVersion:p,definitionExpression:c,historicMoment:E,customParameters:b,apiKey:g,sublayerHash:"sublayers"in this.layer&&this.layer.sublayers.items.reduce(($,Z)=>$+`${Z.visible?1:0}.${JSON.stringify(Z.renderer)}.${Z.labelsVisible}\n.${JSON.stringify(Z.labelingInfo)}`,""),floors:x}}setGraphicOrigin(s){const o=this.layer.fieldsIndex.get(this.layer.subtypeField),a=s.attributes[o.name],u=this.layer.sublayers.find(c=>c.subtypeCode===a);s.layer=s.sourceLayer=u}}function Wt(l,s){return l.visible&&(0===l.minScale||(0,st.Sp)(s.scale,l.minScale)||s.scale<l.minScale)&&(0===l.maxScale||(0,st.Sp)(s.scale,l.maxScale)||s.scale>l.maxScale)}var rr=d(31411),me=d(74238),sr=d(43725);function Qe(l,s){const o=new Set;for(const a of l instanceof Set?l.values():l.keys())s.has(a)||o.add(a);return o}class nr{constructor(s){this.version=s}}class or{constructor(s){this._subscriptions=new Map,this._visible=new Set,this._paused=new Set,this._version=0,this._config=s}destroy(){}get _coverageSet(){const s=this._coverage?Array.from(this._coverage.keys()).map(o=>o.id):[];return new Set(s)}suspend(){this._suspendedOverage=this._coverage,this._coverage=null,this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(s){return this._version=this._version+1%Number.MAX_SAFE_INTEGER,this._updateCoverage(s),this._updateSubscriptions(),new Set(this._visible)}_updateCoverage(s){this._coverage=this._config.tileInfoView.getTileCoverage(s.state,0,!0,"closest")}_updateSubscriptions(){const s=this._coverageSet,o=this._updateVisibility(),a=Qe(o,s),u=Qe(this._subscriptions,o),c=Qe(s,this._subscriptions),p=Qe(u,s),g=Qe(a,p),E=Qe(g,this._paused);this._visible=o;for(const b of c.values())this._subscriptions.set(b,new nr(this._version));for(const b of E.values())this._paused.add(b);for(const b of p.values())this._subscriptions.delete(b),this._paused.delete(b);(c.size||p.size||E.size)&&this._sendUpdateSubscriptions(c,p,E)}_sendUpdateSubscriptions(s,o,a){const u=Array.from(s.values()).map(c=>({tileId:c,version:this._subscriptions.get(c).version}));this._config.updateSubscriptions({subscribe:u,unsubscribe:Array.from(o.values()),pause:Array.from(a.values()),tileInfoJSON:this._config.tileInfoView.tileInfo.toJSON()})}_updateVisibility(){const s=new Set;if(!this._coverage)return s;for(const o of this._coverage.keys())this._config.isDone(o)?s.add(o.id):this._addVisibleParent(s,o)||this._addVisibleChildren(s,o)||s.add(o.id);return s}_addVisibleParent(s,o){let a=!1;for(const u of this._visible.values())new Ee.A(u).containsChild(o)&&(s.add(u),a=!0);return a}_addVisibleChildren(s,o){let a=!1;for(const u of this._visible.values()){const c=new Ee.A(u);o.containsChild(c)&&(s.add(u),a=!0)}return a}}var lr=d(81687),ar=d(66722),Zt=d(14916),ur=d(48218),dt=d(64935);const dr=l=>{let s=class extends l{constructor(...o){super(...o),this._updatingRequiredFieldsPromise=null,this.dataUpdating=!1,this.filter=null,this.timeExtent=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){this.addHandles([(0,m.wB)(()=>{var o;const a=this.layer;return[a&&"elevationInfo"in a?null===(o=a.elevationInfo)||void 0===o?void 0:o.featureExpressionInfo:null,a&&"displayField"in a?a.displayField:null,a&&"timeInfo"in a&&a.timeInfo,a&&"renderer"in a&&a.renderer,a&&"labelingInfo"in a&&a.labelingInfo,a&&"floorInfo"in a&&a.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),m.pc),(0,m.on)(()=>{var o;return null===(o=this.view)||void 0===o?void 0:o.floors},"change",()=>this._handleRequiredFieldsChange()),(0,m.on)(()=>{const o=this.layer;return o&&"sublayers"in o?o.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const{layer:o,layer:{fieldsIndex:a},requiredFields:u}=this;return(0,R.DB)(a,"outFields"in o&&o.outFields?[...(0,R.hL)(a,o.outFields),...u]:u)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(o){this._override("featureEffect",o)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(o){T.A.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(o){throw new Error("missing implementation")}createQuery(){const o={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},a=null!=this.filter?this.filter.createQuery(o):new Q.A(o);if("floorInfo"in this.layer&&this.layer.floorInfo){const u=(0,Zt.E)(this);null!=u&&(a.where=a.where?`(${a.where}) AND (${u})`:u)}return null!=this.timeExtent&&(a.timeExtent=null!=a.timeExtent?a.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),a}createAggregateQuery(){return new Q.A({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(o,a){throw new Error("missing implementation")}queryObjectIds(o,a){throw new Error("missing implementation")}queryFeatureCount(o,a){throw new Error("missing implementation")}queryExtent(o,a){throw new Error("missing implementation")}fetchPopupFeaturesFromGraphics(o,a){var u=this;return(0,h.A)(function*(){return u._validateFetchPopupFeatures(o,a),u._fetchPopupFeatures(o,a)})()}_loadArcadeModules(o){var a;return null!==(a=o.expressionInfos)&&void 0!==a&&a.length||Array.isArray(o.content)&&o.content.some(u=>"expression"===u.type)?(0,ur.lw)():Promise.resolve()}_handleRequiredFieldsChange(){const o=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",o),o.then(()=>{this._updatingRequiredFieldsPromise===o&&this._set("_updatingRequiredFieldsPromise",null)})}_updateRequiredFields(){var o=this;return(0,h.A)(function*(){if(!o.layer||!o.view)return;const a="3d"===o.view.type,{layer:u,layer:{fieldsIndex:c,objectIdField:p}}=o,g="renderer"in u&&u.renderer,E="orderBy"in u&&u.orderBy,b="featureReduction"in u?u.featureReduction:null,x=new Set,$=yield Promise.allSettled([g?g.collectRequiredFields(x,c):null,(0,R.Im)(x,u),a&&"elevationInfo"in u?(0,R.NO)(x,u):null,null!=o.filter?(0,R.o)(x,u,o.filter):null,a||null==o.featureEffect?null:(0,R.o)(x,u,o.featureEffect.filter),!a&&b?(0,R.RP)(x,u,b):null,!a&&E?(0,R.f)(x,u,E):null]);if("timeInfo"in u&&u.timeInfo&&o.timeExtent&&(0,R._w)(x,u.fieldsIndex,[u.timeInfo.startField,u.timeInfo.endField]),"floorInfo"in u&&u.floorInfo&&(0,R._w)(x,u.fieldsIndex,[u.floorInfo.floorField]),"feature"===u.type&&a&&null!=u.infoFor3D&&(null==u.globalIdField&&T.A.getLogger(o).error("globalIdField missing on 3DObjectFeatureLayer"),(0,R._w)(x,u.fieldsIndex,[u.globalIdField])),"subtype-group"===u.type){(0,R.rq)(x,c,u.subtypeField);const te=u.sublayers.map(se=>{var le;return Promise.all([null===(le=se.renderer)||void 0===le?void 0:le.collectRequiredFields(x,c),(0,R.Im)(x,se)])});yield Promise.allSettled(te)}"catalog-footprint"===u.type&&(0,R._w)(x,c,[u.parent.itemSourceField,u.parent.itemTypeField]);for(const te of $)"rejected"===te.status&&T.A.getLogger(o).error(te.reason);(0,R.rq)(x,c,p),a&&"displayField"in u&&u.displayField&&(0,R.rq)(x,c,u.displayField);const Z=Array.from(x).sort();o._set("requiredFields",Z)})()}_validateFetchPopupFeatures(o,a){if(null!=a)for(const u of o){const c=u.origin&&"layer"in u.origin?u.origin.layer:u.layer;if("popupEnabled"in c&&!c.popupEnabled)throw new y.A("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:c});if(u.isAggregate){const p="featureReduction"in c?c.featureReduction:null;if(!(p&&"popupTemplate"in p&&p.popupEnabled&&p.popupTemplate))throw new y.A("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:c})}else if("popupTemplate"in c&&!(0,dt.D8)(c,a))throw new y.A("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:c})}}_popupFeatureHasRequiredFields(o,a){return(0,R.Kl)(a,o)}_fetchPopupFeatures(o,a){var u=this;return(0,h.A)(function*(){const c=new Array(o.length),p=new Map,g=yield u._createPopupQuery(o.map(x=>{var $,Z;return null!==($=null===(Z=x.origin)||void 0===Z?void 0:Z.layer)&&void 0!==$?$:x.layer}),a);for(let x=0;x<o.length;x++){var E,b;const $=o[x];if($.isAggregate){c[x]=$;continue}const Z=null!==(E=null===(b=$.origin)||void 0===b?void 0:b.layer)&&void 0!==E?E:$.layer;if(!Z||!("popupEnabled"in Z))continue;const te=(0,R.hL)(u.layer.fieldsIndex,g.outFields),se=(0,dt.D8)(Z,a);if(null==se)continue;const le=yield u._loadArcadeModules(se);(0,O.Te)(a),le&&le.arcadeUtils.hasGeometryOperations(se)||!u._popupFeatureHasRequiredFields($,te)?p.set($.getObjectId(),{graphic:$,index:x}):c[x]=$}if("stream"===u.layer.type||0===p.size)return c.filter(Boolean);g.objectIds=Array.from(p.keys());try{const x=yield u.layer.queryFeatures(g,a);for(const $ of x.features){const{graphic:{geometry:Z,origin:te},index:se}=p.get($.getObjectId());$.geometry||($.geometry=Z),$.origin=te,c[se]=$}}catch{}return c.filter(Boolean)})()}_createPopupQuery(o,a){var u=this;return(0,h.A)(function*(){const c=u.layer.createQuery(),p=new Set;let g=!1;const E=null!=o?o:[u.layer];for(const b of E){if(!("popupEnabled"in b))continue;const x=(0,dt.D8)(b,a);if(null==x)continue;const $=yield u._loadArcadeModules(x);(0,O.Te)(a);const Z=$&&$.arcadeUtils.hasGeometryOperations(x);g=!("point"!==u.layer.geometryType&&!Z);const te=yield(0,dt.TO)(u.layer,x);(0,O.Te)(a);for(const se of te)p.add(se)}if(c.returnGeometry=g,c.returnZ=g,c.returnM=g,c.outFields=Array.from(p),c.outSpatialReference=u.view.spatialReference,"floorInfo"in u.layer&&u.layer.floorInfo){const b=(0,Zt.E)(u);null!=b&&(c.where=c.where?`(${c.where}) AND (${b})`:b)}return c})()}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){return{createPopupQuery:o=>this._createPopupQuery(void 0,o)}}get test(){return this.getTest()}};return(0,w._)([(0,V.MZ)()],s.prototype,"_updatingRequiredFieldsPromise",void 0),(0,w._)([(0,V.MZ)({readOnly:!0})],s.prototype,"availableFields",null),(0,w._)([(0,V.MZ)({readOnly:!0})],s.prototype,"dataUpdating",void 0),(0,w._)([(0,V.MZ)({type:ar.A})],s.prototype,"featureEffect",null),(0,w._)([(0,V.MZ)({type:M.A})],s.prototype,"filter",void 0),(0,w._)([(0,V.MZ)(lr.ui)],s.prototype,"timeExtent",void 0),(0,w._)([(0,V.MZ)()],s.prototype,"layer",void 0),(0,w._)([(0,V.MZ)({type:Number})],s.prototype,"maximumNumberOfFeatures",null),(0,w._)([(0,V.MZ)({readOnly:!0,type:Boolean})],s.prototype,"maximumNumberOfFeaturesExceeded",null),(0,w._)([(0,V.MZ)({readOnly:!0})],s.prototype,"requiredFields",void 0),(0,w._)([(0,V.MZ)()],s.prototype,"suspended",void 0),(0,w._)([(0,V.MZ)()],s.prototype,"view",void 0),s=(0,w._)([(0,N.$)("esri.views.layers.FeatureLayerView")],s),s};var cr=d(41474),pr=d(96081),hr=d(28067);const Jt=4294967294;let Se=class extends(dr((0,pr.A)((0,ne.e)(cr.A)))){constructor(){var l;super(...arguments),l=this,this._commandsQueue=new rr.A({process:s=>{switch(s.type){case"processed-edit":return this._doEdit(s);case"update":return this._doUpdate()}}}),this._visibilityOverrides=new Set,this._highlightCounter=new sr.t,this._updateHighlight=(0,O.sg)((0,h.A)(function*(){const s=[];for(const o of l._highlightCounter.ids()){const a=l._highlightCounter.getHighestReason(o),u=(0,q.$r)(a);s.push({objectId:o,highlightFlags:u})}l._worker.pipeline.updateHighlight({highlights:s})})),this._lastAvailableFields=[],this.eventLog=new De,this._sourceRefreshVersion=1,this._displayRefreshVersion=1,this._pipelineUpdating=!1,this._fields=null,this.featureEffectView=new A}destroy(){var l;null!==(l=this._worker)&&void 0!==l&&l.destroy(),this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(this._initProxy()),this.featureEffectView.featureEffect=this.featureEffect,this.featureEffectView.endTransitions()}_initProxy(){var l=this;return(0,h.A)(function*(){var s;const o=l.layer;if("isTable"in o&&o.isTable)throw new y.A("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:o});if("mesh"===o.geometryType)throw new y.A("featurelayerview:geometry-type-not-supported",`Geometry type of ${o.geometryType} is not supported`,{layer:o});if(("feature"===o.type||"subtype-group"===o.type)&&!1===(null===(s=(0,W.BR)(o))||void 0===s?void 0:s.operations.supportsQuery))throw new y.A("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:o});l._worker&&l._worker.destroy();const a=l._createClientOptions();l._worker=yield function Yt(l){return ht.apply(this,arguments)}(a)})()}get hasAllFeatures(){return this.layer.visible&&this.eventLog.hasAllFeatures}get hasAllFeaturesInView(){return this.layer.visible&&this.eventLog.hasAllFeaturesInView}get hasFullGeometries(){return this.layer.visible&&this.eventLog.hasFullGeometries}get labelingCollisionInfos(){const l=this.layerAdapter.getLabelingDeconflictionInfo(this.view),s=this.layer.geometryType,o=!this.suspended;return l.map(({vvEvaluators:a,deconflictionEnabled:u})=>({container:this.featureContainer,vvEvaluators:a,deconflictionEnabled:u,geometryType:s,visible:o}))}get layerAdapter(){switch(this.layer.type){case"feature":return"memory"===this.layer.source.type?new Kt(this.layer):new Wi(this.layer);case"geojson":case"csv":case"wfs":return new Kt(this.layer);case"subtype-group":return new tr(this.layer);case"ogc-feature":return new Gi(this.layer);case"stream":return new Qi(this.layer);case"oriented-imagery":return new Hi(this.layer);case"knowledge-graph-sublayer":return new Ji(this.layer);case"catalog-footprint":return new Ni(this.layer);default:(0,B.Xb)(this.layer)}return null}get updateHash(){if(!this.layerAdapter)return null;const{availableFields:l,_displayRefreshVersion:s,timeExtent:o,clips:a,filter:u,featureEffect:c,_sourceRefreshVersion:p,view:{timeZone:g}}=this,E=JSON.stringify(a),b=null==c?void 0:c.toJSON(),x=null==u?void 0:u.toJSON();return JSON.stringify({availableFields:l,clipsHash:E,displayRefreshVersion:s,effectHash:b,filterHash:x,sourceRefreshVersion:p,timeExtent:o,timeZone:g,...this.layerAdapter.getUpdateHashProperties(this.view)})}getDisplayStatistics(l,s){var o;return null===(o=this.featureContainer)||void 0===o?void 0:o.getDisplayStatistics(l,s)}queryHeatmapStatistics(l){var s=this;return(0,h.A)(function*(){return s._worker.pipeline.queryHeatmapStatistics(l)})()}highlight(l,s="highlight"){var o;let a;l instanceof J.A?a=[l.getObjectId()]:"number"==typeof l||"string"==typeof l?a=[l]:F.A.isCollection(l)&&l.length>0?a=l.map(c=>null==c?void 0:c.getObjectId()).toArray():Array.isArray(l)&&l.length>0&&(a="number"==typeof l[0]||"string"==typeof l[0]?l:l.map(c=>null==c?void 0:c.getObjectId()));const u=null===(o=a)||void 0===o?void 0:o.filter(z.Ru);return null!=u&&u.length?(this._addHighlight(u,s),(0,S.hA)(()=>this._removeHighlight(u,s))):(0,S.hA)()}getHighlightIds(){return Array.from(this._highlightCounter.ids())}hasHighlight(){return!this._highlightCounter.empty}hitTest(l,s){var o=this;return(0,h.A)(function*(){const a=yield o.featureContainer.hitTest(s);if(0===a.length)return null;const{features:u,aggregates:c}=yield o._worker.pipeline.getDisplayFeatures(a),p=o.featureContainer.getSortKeys(a),g=({displayId:E},{displayId:b})=>p.has(E)&&p.has(b)?p.get(E)-p.get(b):E-b;return u.sort(g).reverse(),c.sort(g).reverse(),[...c.map(E=>o._createGraphicHit(l,X.fromJSON(E))),...u.map(E=>o._createGraphicHit(l,J.A.fromJSON(E)))]})()}queryStatistics(){return(0,me.E)(this._worker.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})}querySummaryStatistics(l,s,o){const a={...s,scale:this.view.scale},u=this._worker.features.executeQueryForSummaryStatistics(this._cleanUpQuery(l),a,o);return(0,me.E)(u,{})}queryAggregateSummaryStatistics(l,s,o){var a=this;return(0,h.A)(function*(){const u={...s,scale:a.view.scale},c=a._worker.aggregates.executeQueryForSummaryStatistics(a._cleanUpAggregateQuery(l),u,o);return(0,me.E)(c,{})})()}queryUniqueValues(l,s,o){var a=this;return(0,h.A)(function*(){const u={...s,scale:a.view.scale},c=a._worker.features.executeQueryForUniqueValues(a._cleanUpQuery(l),u,o);return(0,me.E)(c,{uniqueValueInfos:[]})})()}queryAggregateUniqueValues(l,s,o){var a=this;return(0,h.A)(function*(){const u={...s,scale:a.view.scale},c=a._worker.aggregates.executeQueryForUniqueValues(a._cleanUpAggregateQuery(l),u,o);return(0,me.E)(c,{uniqueValueInfos:[]})})()}queryClassBreaks(l,s,o){var a=this;return(0,h.A)(function*(){const u={...s,scale:a.view.scale},c=a._worker.features.executeQueryForClassBreaks(a._cleanUpQuery(l),u,o);return(0,me.E)(c,{classBreakInfos:[]})})()}queryAggregateClassBreaks(l,s,o){var a=this;return(0,h.A)(function*(){const u={...s,scale:a.view.scale},c=a._worker.aggregates.executeQueryForClassBreaks(a._cleanUpAggregateQuery(l),u,o);return(0,me.E)(c,{classBreakInfos:[]})})()}queryHistogram(l,s,o){var a=this;return(0,h.A)(function*(){const u={...s,scale:a.view.scale},c=a._worker.features.executeQueryForHistogram(a._cleanUpQuery(l),u,o);return(0,me.E)(c,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})})()}queryAggregateHistogram(l,s,o){var a=this;return(0,h.A)(function*(){const u={...s,scale:a.view.scale},c=a._worker.aggregates.executeQueryForHistogram(a._cleanUpAggregateQuery(l),u,o);return(0,me.E)(c,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})})()}queryFeatures(l,s){return this.queryFeaturesJSON(l,s).then(o=>{const a=j.A.fromJSON(o);return a.features.forEach(u=>this._setLayersForFeature(u)),a})}queryVisibleFeatures(l,s){var o=this;return(0,h.A)(function*(){const a=o._worker.pipeline.queryVisibleFeatures(o._cleanUpQuery(l),s),u=yield(0,me.E)(a,{features:[]}),c=j.A.fromJSON(u);return c.features.forEach(p=>o._setLayersForFeature(p)),c})()}queryAggregates(l,s){var o=this;return(0,h.A)(function*(){const a=o._worker.aggregates.executeQuery(o._cleanUpAggregateQuery(l),s),u=yield(0,me.E)(a,{features:[]}),c=H.fromJSON(u);return c.features.forEach(p=>o._setLayersForFeature(p)),c})()}queryAggregateIds(l,s){const o=this._worker.aggregates.executeQueryForIds(this._cleanUpAggregateQuery(l),s);return(0,me.E)(o,[])}queryAggregateCount(l,s){const o=this._worker.aggregates.executeQueryForCount(this._cleanUpAggregateQuery(l),s);return(0,me.E)(o,0)}queryAggregateJSON(l,s){const o=this._worker.aggregates.executeQuery(this._cleanUpAggregateQuery(l),s);return(0,me.E)(o,{features:[]})}queryFeaturesJSON(l,s){var o=this;return(0,h.A)(function*(){const a=o._worker.features.executeQuery(o._cleanUpQuery(l),s);return(0,me.E)(a,{features:[]})})()}queryObjectIds(l,s){const o=this._worker.features.executeQueryForIds(this._cleanUpQuery(l),s);return(0,me.E)(o,[])}queryFeatureCount(l,s){const o=this._worker.features.executeQueryForCount(this._cleanUpQuery(l),s);return(0,me.E)(o,0)}queryExtent(l,s){var o=this;return(0,h.A)(function*(){const a=o._worker.features.executeQueryForExtent(o._cleanUpQuery(l),s),u=yield(0,me.E)(a,{count:0,extent:null});return{count:u.count,extent:hr.A.fromJSON(u.extent)}})()}getSampleFeatures(l){var s=this;return(0,h.A)(function*(){return s._worker.pipeline.getSampleFeatures(l)})()}setVisibility(l,s){s?this._visibilityOverrides.delete(l):this._visibilityOverrides.add(l),this._update()}update(l){if(!this._subscriptionManager)return;const s=this._subscriptionManager.update(l);this.featureContainer.setVisibleTiles(s)}attach(){(0,P.A)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach"),this.featureContainer=new Ht(this),this.container.addChild(this.featureContainer),this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._subscriptionManager=new or({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:l=>{this.featureContainer.updateSubscriptions(l),this._worker.pipeline.updateSubscriptions(l)},isDone:l=>this.featureContainer.isDone(l)}),this.requestUpdate(),this.addAttachHandles([(0,m.wB)(()=>this.updateHash,()=>this._update(),m.Vh),(0,m.wB)(()=>this.updateSuspended,l=>{l||this._subscriptionManager.resume()})]),"stream"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",l=>this._edit(l)))}detach(){(0,P.A)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach"),this._fields=null,this.featureContainer.destroy(),this._commandsQueue.clear(),this.container.removeAllChildren(),this._subscriptionManager=(0,L.pR)(this._subscriptionManager),this._worker.pipeline.onDetach()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const l="renderer"in this.layer&&null!=this.layer.renderer,s=this._commandsQueue.updateTracking.updating,o=null!=this._updatingRequiredFieldsPromise,a=this.featureContainer.updatingHandles.updating,u=l&&(s||o)||a||this._pipelineUpdating||this.dataUpdating;if((0,P.A)("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${u}\n  -> hasRenderer ${l}\n  -> updatingRequiredFields ${o}\n  -> hasPendingCommand ${s}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${a}\n`);for(const c of this.featureContainer.subscriptions())console.log(`    -> Tile[${c.id}] Done: ${c.done}`)}return u}_createClientOptions(){const l=this;return{get container(){return l.featureContainer},setUpdating:s=>{this._set("_pipelineUpdating",s.pipeline),this._set("dataUpdating",s.data)},emitEvent:s=>{this.emit(s.name,s.event)},get eventLog(){return l.eventLog},fetch:s=>Promise.all(s.map(o=>l.view.stage.painter.textureManager.rasterizeItem(o))),fetchDictionary:s=>Promise.all(s.map(o=>this._fetchDictionaryRequest(o)))}}_fetchDictionaryRequest(l){var s=this;return(0,h.A)(function*(){try{if("subtype-group"===s.layer.type)throw new Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const o=s.layer.renderer;if(!o||"dictionary"!==o.type)throw new Error("InternalError: Expected layer to have a DictionaryRenderer");const a=s._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==a.type)throw new Error("InternalError: Expected schema to be of type 'dictionary'");const u={cimAnalyzer:s.view.stage.cimAnalyzer,cimResourceManager:s.view.stage.painter.textureManager.resourceManager,store:s.featureContainer.instanceStore,scaleExpression:a.scaleExpression};s._fields||(s._fields=s.layer.fields.map(g=>g.toJSON()));const c=a.visualVariableUniforms,p=yield o.getSymbolAsync(l.feature,{fields:s._fields});return p&&p.data?{type:"dictionary-response",meshes:yield(0,at.Jk)(p.data,{uniforms:c,path:"renderer",schemaOptions:u})}:{type:"dictionary-response",meshes:[]}}catch{return{type:"dictionary-response",meshes:[]}}})()}_cleanUpQuery(l){const s=Q.A.from(l)||this.createQuery();return s.outSpatialReference||(s.outSpatialReference=this.view.spatialReference),s.toJSON()}_cleanUpAggregateQuery(l){var s;const o=Q.A.from(l)||this.createAggregateQuery();o.outSpatialReference||(o.outSpatialReference=this.view.spatialReference);const a=null!==(s=o.objectIds)&&void 0!==s?s:[];for(const c of null!==(u=o.aggregateIds)&&void 0!==u?u:[]){var u;a.push(c)}return o.objectIds=a,o.aggregateIds=[],o.toJSON()}_update(){var l=this;return(0,h.A)(function*(){return l._commandsQueue.push({type:"update"})})()}_edit(l){var s=this;return(0,h.A)(function*(){return s.updateSuspended?void s._subscriptionManager.suspend():s._validateEdit(l)?s._commandsQueue.push({type:"edit",edits:l}).catch(O.jH):void 0})()}doRefresh(l){var s=this;return(0,h.A)(function*(){s.attached&&(s.updateSuspended&&l||(l?s.incrementSourceRefreshVersion():s.incrementDisplayRefreshVersion()))})()}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%Jt+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%Jt+1}_validateEdit(l){const s="globalIdField"in this.layer&&this.layer.globalIdField,o=l.deletedFeatures.some(u=>-1===u.objectId||!u.objectId),a=s&&this.availableFields.includes(s);return o&&!a?(T.A.getLogger(this).error(new y.A("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${s} to be included the layer's outFields for updates to be reflected on the map`)),null):l}_doUpdate(){var l=this;return(0,h.A)(function*(){var s;"featureReduction"in l.layer&&l.layer.featureReduction&&l.layer.featureReduction!==l._lastFeatureReduction&&(l.layer.featureReduction=null===(s=l.layer.featureReduction)||void 0===s?void 0:s.clone(),l._lastFeatureReduction=l.layer.featureReduction);try{var o,a,u;if(yield l._updateRequiredFields(),l.destroyed||null===(o=l.layerAdapter)||void 0===o||!o.hasRequiredSupport||!l._subscriptionManager)return;const c=l.featureContainer.instanceStore;l.featureContainer.attributeView.lockTextureUploads(),c.updateStart();const p=l.featureEffect,g={store:c,cimAnalyzer:l.view.stage.cimAnalyzer,cimResourceManager:l.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},E=yield l.layerAdapter.createServiceOptions(l.view),b=l._createViewSchemaConfig(),x={source:l.layerAdapter.createSourceSchema(E,b,l._sourceRefreshVersion),processor:yield l.layerAdapter.createProcessorSchema(g,b,l._displayRefreshVersion)},$=!!(0,v.Ui)(null===(a=l._lastSchema)||void 0===a?void 0:a.source.mutable,x.source.mutable)||!!(0,v.Ui)(null===(u=l._lastSchema)||void 0===u?void 0:u.processor,x.processor);if(!$)return l.featureContainer.requestRender(),l.featureContainer.attributeView.unlockTextureUploads(),c.updateEnd(),void(l.featureEffectView.featureEffect=p);l._lastSchema=x,l._fields=null;const Z=Math.round(performance.now());(0,P.A)("esri-2d-update-debug")&&console.debug(`Id[${l.layer.uid}] Version[${Z}] FeatureLayerView2D._doUpdate`,{changes:$});let te=[];Array.isArray(E.source)&&(te=E.source),yield l._worker.pipeline.updateSchema(x,Z,{transferList:te}),c.updateEnd(),l.featureEffectView.featureEffect=p,l.featureEffectView.endTransitions(),l.featureContainer.attributeView.unlockTextureUploads(),l.featureContainer.swapRenderState(),l.featureContainer.requestRender(),(0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${Z}] FeatureLayerView2D.updateEnd`),l.requestUpdate()}catch(c){(0,P.A)("esri-2d-update-debug")&&console.error("Encountered an error during update",c)}})()}_doEdit(l){var s=this;return(0,h.A)(function*(){try{s.featureContainer.editStart(),yield s._worker.pipeline.onEdits(l),s.featureContainer.editEnd()}catch(o){(0,O.zf)(o)}})()}get hasFilter(){var l,s,o;const a=null!==(l=null===(s=(o=this.layerAdapter).hasFilters)||void 0===s?void 0:s.call(o,this.view))&&void 0!==l&&l;return null!=this.filter||null!=this.timeExtent||this._visibilityOverrides.size>0||a}_getEffectiveAvailableFields(l){const s=function fr(l,s){const o=new Set;return l&&l.forEach(a=>o.add(a)),s&&s.forEach(a=>o.add(a)),o.has("*")?["*"]:Array.from(o)}(this._lastAvailableFields,l);return this._lastAvailableFields=s,(0,R.hW)(this.layer.fieldsIndex,s)}_createViewSchemaConfig(){var l,s;const o=[vr(this.view,this.layerAdapter,this.timeExtent,this._visibilityOverrides,this.filter),null!==(l=null===(s=this.featureEffect)||void 0===s||null===(s=s.filter)||void 0===s?void 0:s.toJSON())&&void 0!==l?l:null];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:o,outSpatialReference:this.view.spatialReference,tileInfoJSON:this.view.featuresTilingScheme.tileInfo.toJSON(),scale:this.view.scale,timeZone:this.view.timeZone}}_addHighlight(l,s){this._highlightCounter.addReason(l,s),this._updateHighlight().catch(o=>{(0,O.zf)(o)||T.A.getLogger(this).error(o)})}_removeHighlight(l,s){this._highlightCounter.deleteReason(l,s),this._updateHighlight().catch(o=>{(0,O.zf)(o)||T.A.getLogger(this).error(o)})}_setLayersForFeature(l){l.layer=l.sourceLayer=this.layer,this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(l)}_createGraphicHit(l,s){return this._setLayersForFeature(s),null!=s.geometry&&(s.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:s,layer:this.layer,mapPoint:l}}};function vr(l,s,o,a,u){var c,p,g,E,b,x;u&&(u=u.clone());const $=null!=u?u.timeExtent:null,Z=null!=o&&null!=$?o.intersection($):o||$;Z&&(null!==(c=u)&&void 0!==c||(u=new M.A),u.timeExtent=Z);let te=null!==(E=null===(b=u=null!==(p=null===(g=s.addFilters)||void 0===g?void 0:g.call(s,u,l))&&void 0!==p?p:u)||void 0===b?void 0:b.toJSON())&&void 0!==E?E:null;return a.size&&(null!==(x=te)&&void 0!==x||(te=(new M.A).toJSON()),te.hiddenIds=Array.from(a)),te}(0,w._)([(0,V.MZ)()],Se.prototype,"_worker",void 0),(0,w._)([(0,V.MZ)()],Se.prototype,"_commandsQueue",void 0),(0,w._)([(0,V.MZ)()],Se.prototype,"_sourceRefreshVersion",void 0),(0,w._)([(0,V.MZ)()],Se.prototype,"_displayRefreshVersion",void 0),(0,w._)([(0,V.MZ)({readOnly:!0})],Se.prototype,"_pipelineUpdating",void 0),(0,w._)([(0,V.MZ)({readOnly:!0})],Se.prototype,"hasAllFeatures",null),(0,w._)([(0,V.MZ)({readOnly:!0})],Se.prototype,"hasAllFeaturesInView",null),(0,w._)([(0,V.MZ)({readOnly:!0})],Se.prototype,"hasFullGeometries",null),(0,w._)([(0,V.MZ)()],Se.prototype,"featureEffectView",void 0),(0,w._)([(0,V.MZ)()],Se.prototype,"labelingCollisionInfos",null),(0,w._)([(0,V.MZ)()],Se.prototype,"layerAdapter",null),(0,w._)([(0,V.MZ)()],Se.prototype,"updateHash",null),(0,w._)([(0,V.MZ)()],Se.prototype,"updating",void 0),Se=(0,w._)([(0,N.$)("esri.views.2d.layers.FeatureLayerView2D")],Se);const mr=Se},29459:(ae,k,d)=>{d.d(k,{e:()=>D});var y,h=d(8189),w=d(31178),J=d(5605),V=d(5922),P=d(48900),T=d(85211),X=(d(3248),d(35150),d(40707),d(76576)),Y=d(40856),z=d(88766),F=d(60746),B=d(66727);let S=y=class extends B.A{constructor(f){super(f),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new y({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,h._)([(0,T.MZ)({type:[Number,String],json:{write:!0}})],S.prototype,"left",void 0),(0,h._)([(0,T.MZ)({type:[Number,String],json:{write:!0}})],S.prototype,"right",void 0),(0,h._)([(0,T.MZ)({type:[Number,String],json:{write:!0}})],S.prototype,"top",void 0),(0,h._)([(0,T.MZ)({type:[Number,String],json:{write:!0}})],S.prototype,"bottom",void 0),S=y=(0,h._)([(0,X.$)("esri.views.layers.support.ClipRect")],S);const L=S;var O=d(75644);let m=class extends B.A{constructor(f){super(f),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,h._)([(0,T.MZ)({type:[[[Number]]],json:{write:!0}})],m.prototype,"path",void 0),m=(0,h._)([(0,X.$)("esri.views.layers.support.Path")],m);const _=w.A.ofType({key:"type",base:null,typeMap:{rect:L,path:m,geometry:O.A}}),D=f=>{let A=class extends f{constructor(){super(...arguments),this.attached=!1,this.clips=new _,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this.visibleAtCurrentScale=!1,this.highlightOptions=null}initialize(){var M,R,W,K;const j=null===(M=null===(R=this.view)||void 0===R?void 0:R.spatialReferenceLocked)||void 0===M||M;(null===(W=this.view)||void 0===W?void 0:W.spatialReference)&&j&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new V.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new z.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,P.wB)(()=>this.suspended,C=>{this.container&&(this.container.visible=!C)},P.pc),(0,P.wB)(()=>this.updateSuspended,C=>{this.view&&!C&&this.updateRequested&&this.view.requestUpdate()},P.pc),(0,P.wB)(()=>{var C,H;return null!==(C=null===(H=this.layer)||void 0===H?void 0:H.opacity)&&void 0!==C?C:1},C=>{this.container&&(this.container.opacity=C)},P.pc),(0,P.wB)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",C=>{this.container&&(this.container.blendMode=C)},P.pc),(0,P.wB)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,C=>{this.container&&(this.container.effect=C)},P.pc),(0,P.wB)(()=>this.highlightOptions,C=>this.container.highlightOptions=C,P.pc),(0,P.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},P.pc),(0,P.wB)(()=>{var C;return{scale:null===(C=this.view)||void 0===C?void 0:C.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}},({scale:C})=>{const H=null!=C&&this.isVisibleAtScale(C);H!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",H)},P.pc)],"constructor"),null!==(K=this.view)&&void 0!==K&&K.whenLayerView?this.view.whenLayerView(this.layer).then(C=>{C===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var M;const R=null===(M=this.view)||void 0===M?void 0:M.spatialReference;return null==R||this.supportsSpatialReference(R)}get updateSuspended(){return this.suspended}get updating(){var M;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(M=this._updatingHandles)||void 0===M||!M.updating))}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(M){const R=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!R)return!0;const{minScale:W,maxScale:K}=R;return(0,Y.zx)(M,W,K)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(M){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",M),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(M))):this.updateRequested=!1}hitTest(M,R){return Promise.resolve(null)}supportsSpatialReference(M){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const M=super.getSuspendInfo(),R=!this.spatialReferenceSupported,W=this.visibleAtCurrentScale;return R&&(M.spatialReferenceNotSupported=R),W&&(M.outsideScaleRange=W),M}addAttachHandles(M){this.addHandles(M,"attach")}};return(0,h._)([(0,T.MZ)()],A.prototype,"attached",void 0),(0,h._)([(0,T.MZ)({type:_,set(M){const R=(0,J.V)(M,this._get("clips"),_);this._set("clips",R)}})],A.prototype,"clips",void 0),(0,h._)([(0,T.MZ)()],A.prototype,"container",void 0),(0,h._)([(0,T.MZ)()],A.prototype,"moving",void 0),(0,h._)([(0,T.MZ)({readOnly:!0})],A.prototype,"spatialReferenceSupported",null),(0,h._)([(0,T.MZ)({readOnly:!0})],A.prototype,"updateParameters",void 0),(0,h._)([(0,T.MZ)()],A.prototype,"updateRequested",void 0),(0,h._)([(0,T.MZ)()],A.prototype,"updateSuspended",null),(0,h._)([(0,T.MZ)()],A.prototype,"updating",null),(0,h._)([(0,T.MZ)()],A.prototype,"view",void 0),(0,h._)([(0,T.MZ)({readOnly:!0})],A.prototype,"visibleAtCurrentScale",void 0),(0,h._)([(0,T.MZ)({type:F.A})],A.prototype,"highlightOptions",void 0),A=(0,h._)([(0,X.$)("esri.views.2d.layers.LayerView2D")],A),A}},36952:(ae,k,d)=>{function h(w,J,V,P){const T=w.clone(),I=1<<T.level,N=T.col+J,G=T.row+V;return P&&N<0?(T.col=N+I,T.world-=1):N>=I?(T.col=N-I,T.world+=1):T.col=N,T.row=G,T}d.d(k,{K:()=>h})},43725:(ae,k,d)=>{d.d(k,{t:()=>w});var h=d(25735);class w{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addReason(V,P){for(const T of V){let I=this._idToCounters.get(T);I||(I=new Map,this._idToCounters.set(T,I)),I.set(P,(I.get(P)||0)+1)}}deleteReason(V,P){for(const T of V){const I=this._idToCounters.get(T);if(!I)continue;let N=I.get(P);if(null==N)return;N--,N>0?I.set(P,N):I.delete(P),0===I.size&&this._idToCounters.delete(T)}}getHighestReason(V){const P=this._idToCounters.get(V);if(!P)return null;let T=null;for(const I of h.M$)P.get(I)&&(T=I);return T||null}ids(){return this._idToCounters.keys()}}},74238:(ae,k,d)=>{d.d(k,{E:()=>w});var h=d(10467);function w(V,P){return J.apply(this,arguments)}function J(){return(J=(0,h.A)(function*(V,P){try{return yield V}catch(T){if("no-queryEngine"!==T.name)throw T;return P}})).apply(this,arguments)}},41474:(ae,k,d)=>{d.d(k,{A:()=>B});var h=d(8189),w=d(98877),J=d(42425),V=d(3046),P=d(35150),T=d(11432),I=d(64261),N=d(85211),Y=(d(3248),d(40707),d(76576)),z=d(56985);let F=class extends((0,V.sA)((0,I.g)(J.A.EventedMixin(w.A)))){constructor(y){super(y),this._updatingHandles=new z.U,this.layer=null,this.parent=null}initialize(){this.when().catch(y=>{if("layerview:create-error"!==y.name){var S;const L=this.layer&&this.layer.id||"no id",O=(null===(S=this.layer)||void 0===S?void 0:S.title)||"no title";P.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${O}', id: '${L}')`,y)}})}destroy(){this._updatingHandles=(0,T.pR)(this._updatingHandles)}get fullOpacity(){var y,S,L,O;return(null!==(y=null===(S=this.layer)||void 0===S?void 0:S.opacity)&&void 0!==y?y:1)*(null!==(L=null===(O=this.parent)||void 0===O?void 0:O.fullOpacity)&&void 0!==L?L:1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var y;return!this.suspended&&!0===(null===(y=this.layer)||void 0===y?void 0:y.legendEnabled)}get updating(){var y;return!!(null!==(y=this._updatingHandles)&&void 0!==y&&y.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var y;return!0===(null===(y=this.layer)||void 0===y?void 0:y.visible)}set visible(y){this._overrideIfSome("visible",y)}canResume(){var y,S,L;return this.visible&&(null===(y=this.layer)||void 0===y?void 0:y.loaded)&&!(null!==(S=this.parent)&&void 0!==S&&S.suspended)&&(null===(L=this.view)||void 0===L?void 0:L.ready)||!1}getSuspendInfo(){var y,S;const L=null!==(y=this.parent)&&void 0!==y&&y.suspended?this.parent.suspendInfo:{};return null!==(S=this.view)&&void 0!==S&&S.ready||(L.viewNotReady=!0),this.layer&&this.layer.loaded||(L.layerNotLoaded=!0),this.visible||(L.layerInvisible=!0),L}isUpdating(){return!1}};(0,h._)([(0,N.MZ)()],F.prototype,"fullOpacity",null),(0,h._)([(0,N.MZ)()],F.prototype,"layer",void 0),(0,h._)([(0,N.MZ)()],F.prototype,"parent",void 0),(0,h._)([(0,N.MZ)({readOnly:!0})],F.prototype,"suspended",null),(0,h._)([(0,N.MZ)({readOnly:!0})],F.prototype,"suspendInfo",null),(0,h._)([(0,N.MZ)({readOnly:!0})],F.prototype,"legendEnabled",null),(0,h._)([(0,N.MZ)({type:Boolean,readOnly:!0})],F.prototype,"updating",null),(0,h._)([(0,N.MZ)({readOnly:!0})],F.prototype,"updatingProgress",null),(0,h._)([(0,N.MZ)()],F.prototype,"visible",null),(0,h._)([(0,N.MZ)()],F.prototype,"view",void 0),F=(0,h._)([(0,Y.$)("esri.views.layers.LayerView")],F);const B=F},96081:(ae,k,d)=>{d.d(k,{A:()=>G});var h=d(8189),w=d(35150),J=d(56492),V=d(48900),N=(d(3248),d(40707),d(5922),d(76576));const G=X=>{let Y=class extends X{initialize(){this.addHandles((0,V.on)(()=>this.layer,"refresh",z=>{this.doRefresh(z.dataChanged).catch(F=>{(0,J.zf)(F)||w.A.getLogger(this).error(F)})}),"RefreshableLayerView")}};return Y=(0,h._)([(0,N.$)("esri.layers.mixins.RefreshableLayerView")],Y),Y}},66727:(ae,k,d)=>{d.d(k,{A:()=>G});var h=d(8189),w=d(71065),J=d(85211),I=(d(3248),d(35150),d(40707),d(76576));let N=class extends w.oY{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,h._)([(0,J.MZ)({readOnly:!0})],N.prototype,"version",null),N=(0,h._)([(0,I.$)("esri.views.layers.support.ClipArea")],N);const G=N},75644:(ae,k,d)=>{d.d(k,{A:()=>S});var F,h=d(8189),J=(d(21152),d(85211)),I=(d(3248),d(35150),d(40707),d(76576)),N=d(68643),G=d(61320),X=d(66727),Y=d(28067),z=d(55861);const B={base:N.A,key:"type",typeMap:{extent:Y.A,polygon:z.A}};let y=F=class extends X.A{constructor(L){super(L),this.type="geometry",this.geometry=null}clone(){var L,O;return new F({geometry:null!==(L=null===(O=this.geometry)||void 0===O?void 0:O.clone())&&void 0!==L?L:null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,h._)([(0,J.MZ)({types:B,json:{read:G.rS,write:!0}})],y.prototype,"geometry",void 0),y=F=(0,h._)([(0,I.$)("esri.views.layers.support.Geometry")],y);const S=y},64935:(ae,k,d)=>{d.d(k,{D8:()=>P,TO:()=>J});var h=d(10467),w=d(86300);function J(I){return V.apply(this,arguments)}function V(){return(V=(0,h.A)(function*(I,N=I.popupTemplate){var G,X;if(null==N)return[];const Y=yield N.getRequiredFields(I.fieldsIndex),{lastEditInfoEnabled:z}=N,{objectIdField:F,typeIdField:B,globalIdField:y,relationships:S}=I;if(Y.includes("*"))return["*"];const L=z?(0,w.eX)(I):[],O=(0,w.DB)(I.fieldsIndex,[...Y,...L]);return B&&O.push(B),O&&F&&null!==(G=I.fieldsIndex)&&void 0!==G&&G.has(F)&&!O.includes(F)&&O.push(F),O&&y&&null!==(X=I.fieldsIndex)&&void 0!==X&&X.has(y)&&!O.includes(y)&&O.push(y),S&&S.forEach(m=>{var v;const{keyField:_}=m;O&&_&&null!==(v=I.fieldsIndex)&&void 0!==v&&v.has(_)&&!O.includes(_)&&O.push(_)}),O})).apply(this,arguments)}function P(I,N){return I.popupTemplate?I.popupTemplate:null!=N&&N.defaultPopupTemplateEnabled&&null!=I.defaultPopupTemplate?I.defaultPopupTemplate:null}}}]);