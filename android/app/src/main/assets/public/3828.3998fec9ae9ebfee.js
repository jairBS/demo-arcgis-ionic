"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3828,1447],{13828:(ae,C,o)=>{o.r(C),o.d(C,{applyEdits:()=>n,checkEditingCapabilities:()=>Q,isFeatureIdentifierArrayWithGlobalId:()=>d,isFeatureIdentifierArrayWithObjectId:()=>w,isFeatureIdentifierWithGlobalId:()=>r,isFeatureIdentifierWithObjectId:()=>O,normalizeCollections:()=>y,normalizeEdits:()=>H,normalizeGeometries:()=>ee,shallowCloneFeature:()=>K,uploadAssets:()=>S});var P=o(10467),x=o(81098),L=o(31178),u=o(5922),z=o(77806),B=o(35150),Z=o(56492),V=o(45272),U=o(43085),R=o(77098),D=o(58701),W=o(58277),E=o(86300),b=o(6829),g=o(58443);function I(e){return null!=(null==e?void 0:e.applyEdits)}function O(e){return"object"==typeof e&&null!=e&&"objectId"in e&&!!e.objectId}function w(e){return e.every(O)}function r(e){return"object"==typeof e&&null!=e&&"globalId"in e&&!!e.globalId}function d(e){return e.every(r)}function n(e,t,a){return f.apply(this,arguments)}function f(){return f=(0,P.A)(function*(e,t,a,i={}){var s;let p;const h=null!==(s=i.gdbVersion)&&void 0!==s?s:"gdbVersion"in e?e.gdbVersion:null;(0,W.Mk)(e)&&e.url?p=(0,W.Zk)(e.url,e.layerId,h,"original-and-current-features"===i.returnServiceEditsOption):(p=(0,Z.Tw)(),p.promise.then(m=>{(m.addedFeatures.length||m.updatedFeatures.length||m.deletedFeatures.length||m.addedAttachments.length||m.updatedAttachments.length||m.deletedAttachments.length)&&e.emit("edits",m)}),e.emit("apply-edits",{result:p.promise}));try{var _;const{results:l,edits:m}=yield function A(e,t,a,i){return M.apply(this,arguments)}(e,t,a,i),v=se=>se.filter(ie=>!ie.error).map(z.o8),re={edits:m,addedFeatures:v(l.addFeatureResults),updatedFeatures:v(l.updateFeatureResults),deletedFeatures:v(l.deleteFeatureResults),addedAttachments:v(l.addAttachmentResults),updatedAttachments:v(l.updateAttachmentResults),deletedAttachments:v(l.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:l.editMoment?new Date(l.editMoment):null,globalIdToObjectId:i.globalIdToObjectId};return null!==(_=l.editedFeatureResults)&&void 0!==_&&_.length&&(re.editedFeatures=l.editedFeatureResults),p.resolve(re),l}catch(l){throw p.reject(l),l}}),f.apply(this,arguments)}function M(){return M=(0,P.A)(function*(e,t,a,i){var s,p,c,h,_,l;if(yield e.load(),!I(t))throw new u.A(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!(0,g.tk)(e))throw new u.A(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:m,options:v}=yield function j(e,t,a){return F.apply(this,arguments)}(e,a,i);return null!==(s=m.addFeatures)&&void 0!==s&&s.length||null!==(p=m.updateFeatures)&&void 0!==p&&p.length||null!==(c=m.deleteFeatures)&&void 0!==c&&c.length||null!==(h=m.addAttachments)&&void 0!==h&&h.length||null!==(_=m.updateAttachments)&&void 0!==_&&_.length||null!==(l=m.deleteAttachments)&&void 0!==l&&l.length?{edits:m,results:yield t.applyEdits(m,v)}:{edits:m,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),M.apply(this,arguments)}function F(){return F=(0,P.A)(function*(e,t,a){const i=(0,g.BR)(e),c=null!=e.infoFor3D;if(Q(t,i,a,!(!t||!(t.addFeatures||t.updateFeatures||t.deleteFeatures)),!(!t||!(t.addAttachments||t.updateAttachments||t.deleteAttachments)),`${e.type}-layer`),!i.data.isVersioned&&null!=a&&a.gdbVersion)throw new u.A(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!i.editing.supportsRollbackOnFailure&&null!=a&&a.rollbackOnFailureEnabled)throw new u.A(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const h={...a};if(null!=h.rollbackOnFailureEnabled||i.editing.supportsRollbackOnFailure||(h.rollbackOnFailureEnabled=!0),h.rollbackOnFailureEnabled||"original-and-current-features"!==h.returnServiceEditsOption||(!1===h.rollbackOnFailureEnabled&&B.A.getLogger("esri.layers.graphics.editingSupport").warn(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),h.rollbackOnFailureEnabled=!0),!i.editing.supportsReturnServiceEditsInSourceSpatialReference&&h.returnServiceEditsInSourceSR)throw new u.A(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(h.returnServiceEditsInSourceSR&&"original-and-current-features"!==h.returnServiceEditsOption)throw new u.A(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const _=H(t,i,`${e.type}-layer`),l=(null==a?void 0:a.globalIdUsed)||c,m=e.fields.filter(v=>"big-integer"===v.type||"oid"===v.type&&(v.length||0)>=8);if(l){const{globalIdField:v}=e;if(null==v)throw new u.A(`${e.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");_.addFeatures.forEach(re=>function ne(e,t){const{attributes:a}=e;null==a[t]&&(a[t]=(0,U.yS)())}(re,v))}return _.addFeatures.forEach(v=>function k(e,t,a,i){$(e,t,a,i),T(e,t)}(v,e,l,m)),_.updateFeatures.forEach(v=>function Y(e,t,a,i){$(e,t,a,i),T(e,t);const s=(0,g.BR)(t);if("geometry"in e&&null!=e.geometry&&(null==s||!s.editing.supportsGeometryUpdate))throw new u.A(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(v,e,l,m)),_.deleteFeatures.forEach(v=>function J(e,t,a,i){$(e,t,a,i)}(v,e,l,m)),_.addAttachments.forEach(v=>G(v,e)),_.updateAttachments.forEach(v=>G(v,e)),c&&(yield function te(e,t){return N.apply(this,arguments)}(_,e)),{edits:yield ee(_),options:h}}),F.apply(this,arguments)}function $(e,t,a,i){if(a){if("attributes"in e&&!e.attributes[t.globalIdField])throw new u.A(`${t.type}-layer:invalid-parameter`,`Feature should have '${t.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in e)&&!e.globalId)throw new u.A(`${t.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(i.length&&"attributes"in e)for(const c of i){const h=e.attributes[c.name];if(void 0!==h&&!(0,E.OG)(c,h))throw new u.A(`${t.type}-layer:invalid-parameter`,`Big-integer field '${c.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:e})}if("geometry"in e&&null!=e.geometry){var s,p;if(e.geometry.hasZ&&!1===(null===(s=t.capabilities)||void 0===s?void 0:s.data.supportsZ))throw new u.A(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===(null===(p=t.capabilities)||void 0===p?void 0:p.data.supportsM))throw new u.A(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function T(e,t){var a;if("geometry"in e&&"mesh"===(null===(a=e.geometry)||void 0===a?void 0:a.type)&&null!=t.infoFor3D&&null!=t.spatialReference){const{geometry:i}=e,{spatialReference:s,vertexSpace:p}=i,c=t.spatialReference,h="local"===p.type,_=(0,D.EA)(c),l=(0,D.aI)(c,s),m=l||(0,D.oT)(c)&&((0,D.oT)(s)||(0,D.K8)(s));if(!(h&&_&&m||!h&&!_&&l))throw new u.A(`${t.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${p.type} vertex space and a spatial reference wkid:${s.wkid} to a layer with a spatial reference wkid:${c.wkid} is not supported.`)}}function G(e,t){var a;const{feature:i,attachment:s}=e;if(!i||"attributes"in i&&!i.attributes[t.globalIdField])throw new u.A(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in i)&&!i.globalId)throw new u.A(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!s.globalId)throw new u.A(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!s.data&&!s.uploadId)throw new u.A(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(s.data instanceof File&&s.data.name||s.name))throw new u.A(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if((null===(a=t.capabilities)||void 0===a||!a.editing.supportsUploadWithItemId)&&s.uploadId)throw new u.A(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof s.data){const p=(0,V.r$)(s.data);if(p&&!p.isBase64)throw new u.A(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function ee(e){return X.apply(this,arguments)}function X(){return(X=(0,P.A)(function*(e){var t,a;const i=null!==(t=e.addFeatures)&&void 0!==t?t:[],s=null!==(a=e.updateFeatures)&&void 0!==a?a:[],p=i.concat(s).map(l=>l.geometry),c=yield(0,R.el)(p),h=i.length,_=s.length;return c.slice(0,h).forEach((l,m)=>i[m].geometry=l),c.slice(h,h+_).forEach((l,m)=>s[m].geometry=l),e})).apply(this,arguments)}function y(e){var t,a;return{addFeatures:Array.from(null!==(t=null==e?void 0:e.addFeatures)&&void 0!==t?t:[]),updateFeatures:Array.from(null!==(a=null==e?void 0:e.updateFeatures)&&void 0!==a?a:[]),deleteFeatures:e&&L.A.isCollection(e.deleteFeatures)?e.deleteFeatures.toArray():e.deleteFeatures||[],addAttachments:e.addAttachments||[],updateAttachments:e.updateAttachments||[],deleteAttachments:e.deleteAttachments||[]}}function H(e,t,a){var i,s,p;const c=y(e);if(null!==(i=c.addFeatures)&&void 0!==i&&i.length&&!t.operations.supportsAdd)throw new u.A(`${a}:unsupported-operation`,"Layer does not support adding features.");if(null!==(s=c.updateFeatures)&&void 0!==s&&s.length&&!t.operations.supportsUpdate)throw new u.A(`${a}:unsupported-operation`,"Layer does not support updating features.");if(null!==(p=c.deleteFeatures)&&void 0!==p&&p.length&&!t.operations.supportsDelete)throw new u.A(`${a}:unsupported-operation`,"Layer does not support deleting features.");return c.addFeatures=c.addFeatures.map(K),c.updateFeatures=c.updateFeatures.map(K),c.addAssetFeatures=[],c}function Q(e,t,a,i,s,p){if(!e||!i&&!s)throw new u.A(`${p}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!t.editing.supportsGlobalId&&null!=a&&a.globalIdUsed)throw new u.A(`${p}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!t.editing.supportsGlobalId&&s)throw new u.A(`${p}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if((null==a||!a.globalIdUsed)&&s)throw new u.A(`${p}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}function K(e){const t=new x.A;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function N(){return(N=(0,P.A)(function*(e,t){var a,i;if(null==t.infoFor3D)return;const{infoFor3D:s}=t,p=null!==(a=(0,b.R_)("model/gltf-binary",s.supportedFormats))&&void 0!==a?a:(0,b.E1)("glb",s.supportedFormats);if(!p||!s.editFormats.includes(p))throw new u.A(`${t.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");null!==(i=e.addAssetFeatures)&&void 0!==i||(e.addAssetFeatures=[]);const{addAssetFeatures:c}=e;for(const l of null!==(h=e.addFeatures)&&void 0!==h?h:[]){var h;q(l)&&c.push(l)}for(const l of null!==(_=e.updateFeatures)&&void 0!==_?_:[]){var _;q(l)&&c.push(l)}})).apply(this,arguments)}function q(e){var t;return"mesh"===(null==e||null===(t=e.geometry)||void 0===t?void 0:t.type)}function S(e,t,a,i){if(!I(t))throw new u.A(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!t.uploadAssets)throw new u.A(`${e.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:e});return t.uploadAssets(a,i)}},58277:(ae,C,o)=>{o.d(C,{Mk:()=>O,Zk:()=>E,w6:()=>d});var P=o(8189),x=o(42425),L=o(77806),u=o(56492),V=(o(35150),o(3248),o(5922),o(76576)),U=o(30448);const R=new x.A.EventEmitter;function E(n,f,A=null,M=!1){const j=(0,u.Tw)();return R.emit("apply-edits",{serviceUrl:n,layerId:f,gdbVersion:A,mayReceiveServiceEdits:M=null==f||M,result:j.promise}),j}const g="esri.layers.mixins.EditBusLayer",I=Symbol(g);function O(n){return null!=n&&"object"==typeof n&&I in n}function w(n){return null!=n&&"object"==typeof n&&"gdbVersion"in n}function r(n,f,A){const M=new URL(n).host,j=U.Z3.get(M),F=$=>!$||$===j;return F(f)&&F(A)||f===A}const d=n=>{var f;let A=class extends n{constructor(...M){super(...M),this[f]=!0,this._applyEditsHandler=j=>{const{serviceUrl:F,layerId:$,gdbVersion:T,mayReceiveServiceEdits:k,result:J}=j,Y=F===this.url,G=null!=$&&null!=this.layerId&&$===this.layerId,ne=w(this),ee=w(this)&&r(F,T,this.gdbVersion);if(!Y||ne&&!ee||!G&&!k)return;const X=J.then(y=>{var H;if(G&&(y.addedFeatures.length||y.updatedFeatures.length||y.deletedFeatures.length||y.addedAttachments.length||y.updatedAttachments.length||y.deletedAttachments.length))return this.emit("edits",(0,L.o8)(y)),y;const Q=null===(H=y.editedFeatures)||void 0===H?void 0:H.find(({layerId:K})=>K===this.layerId);if(Q){const{adds:K,updates:te,deletes:N}=Q.editedFeatures,q={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:K?K.map(({attributes:S})=>({objectId:this.objectIdField&&S[this.objectIdField],globalId:this.globalIdField&&S[this.globalIdField]})):[],deletedFeatures:N?N.map(({attributes:S})=>({objectId:this.objectIdField&&S[this.objectIdField],globalId:this.globalIdField&&S[this.globalIdField]})):[],updatedFeatures:te?te.map(({current:{attributes:S}})=>({objectId:this.objectIdField&&S[this.objectIdField],globalId:this.globalIdField&&S[this.globalIdField]})):[],editedFeatures:(0,L.o8)(y.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,L.o8)(y.historicMoment)};return this.emit("edits",q),q}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,L.o8)(y.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,L.o8)(y.historicMoment)}}).then(y=>("historicMoment"in this&&this.historicMoment!==y.historicMoment&&(0,U.w5)(F,T)&&(this.historicMoment=y.historicMoment),y));this.emit("apply-edits",{result:X})},this._updateMomentHandler=j=>{const{serviceUrl:F,gdbVersion:$,moment:T}=j,k=F===this.url,J=w(this),Y=w(this)&&r(F,$,this.gdbVersion),G=w(this)&&!r(F,this.gdbVersion,null);k&&J&&Y&&G&&"historicMoment"in this&&this.historicMoment!==T&&(this.historicMoment=T)},this.when().then(()=>{this.addHandles(function D(n){return R.on("apply-edits",new WeakRef(n))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function W(n){return R.on("update-moment",new WeakRef(n))}(this._updateMomentHandler))},()=>{})}};return f=I,A=(0,P._)([(0,V.$)(g)],A),A}},6829:(ae,C,o)=>{o.d(C,{E1:()=>Z,Fm:()=>V,JZ:()=>w,R_:()=>B,fu:()=>x,oF:()=>L,rq:()=>U});const P=[["binary","application/octet-stream","bin",""]];function x(r,d){var n;return null!=E(d.name,null!==(n=null==r?void 0:r.supportedFormats)&&void 0!==n?n:[])}function L(r,d){var n;if(!r)return!1;const f=U(d,null!==(n=r.supportedFormats)&&void 0!==n?n:[]);return null!=f&&r.editFormats.includes(f)}function B(r,d){return b(function W(r,d){const n=r.toLowerCase();return R(d).find(f=>g(f)===n)}(r,d))}function Z(r,d){return b(E(r,d))}function V(r,d){return g(function D(r,d){return R(d).find(n=>b(n)===r)}(r,d))}function U(r,d){var n;return null!==(n=Z(r.name,d))&&void 0!==n?n:B(r.type,d)}function R(r){return[...P,...r]}function E(r,d){const n=r.toLowerCase();return R(d).find(f=>function I(r){var d;return null!==(d=null==r?void 0:r[2].split(",").map(n=>n.toLowerCase()))&&void 0!==d?d:[]}(f).some(A=>n.endsWith(A)))}function b(r){return null==r?void 0:r[0]}function g(r){return null==r?void 0:r[1].toLowerCase()}function w(r){var d;return null===(d=r.tables)||void 0===d?void 0:d.find(n=>"assetMaps"===n.role)}},30448:(ae,C,o)=>{o.d(C,{TA:()=>u,We:()=>V,Z3:()=>z,ZJ:()=>R,w5:()=>W});var P=o(10467),x=o(89563);const u=(0,o(43085).vD)(),z=new Map,B=new Map;function V(E,b,g){return U.apply(this,arguments)}function U(){return(U=(0,P.A)(function*(E,b,g){if(!E||!g)return!1;if(!b)return!0;const I=new URL(E).host;let O=z.get(I);if(!O){const w=E.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");O=(yield(0,x.A)(w,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return O===b})).apply(this,arguments)}function R(E,b){return D.apply(this,arguments)}function D(){return(D=(0,P.A)(function*(E,b,g=!1){var I;if(!E||!b)return!0;const O=E.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),w=null===(I=B.get(O))||void 0===I?void 0:I.entries();if(w)for(const[d,n]of w)if(n.name===b){var r;const f=!(null!==(r=n.stack)&&void 0!==r&&r.hasForwardEdits());if(!f&&g){const[{deleteForwardEdits:A},{default:M}]=yield Promise.all([o.e(4570).then(o.bind(o,44570)),o.e(5566).then(o.bind(o,55566))]);return A(O,d,new M({sessionId:u,moment:n.moment}))}return f}return!0})).apply(this,arguments)}function W(E,b){var g;if(!E)return!1;const I=E.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),O=null===(g=B.get(I))||void 0===g?void 0:g.entries();if(O)for(const[w,r]of O)if(r.name===b)return"edit"===r.lockType;return!1}}}]);