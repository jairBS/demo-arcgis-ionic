"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7641],{66803:(U,B,i)=>{i.d(B,{j:()=>F});var z=i(10467),S=i(5922),D=i(3248),E=i(35150),T=i(56492),d=i(47669),M=i(53212),c=i(24370),o=i(50915),A=i(79061),y=i(26136),w=i(4931);class O{constructor(t,e,s){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:a,pixelType:l,textureOnly:h}=t,_=(0,c.Qz)(l);this.blockIndex=s,this.pixelType=l,this.size=e,this.textureOnly=h,h||(this.data=new _(a)),this._resetRange()}destroy(){var t;null===(t=this._texture)||void 0===t||t.dispose();for(const e in this._fbos){const s=this._fbos[e];s&&("0"===e&&s.detachColorTexture(),s.dispose()),this._fbos[e]=null}this._texture=null}get _textureDesc(){const t=new w.R;return t.wrapMode=o.pF.CLAMP_TO_EDGE,t.samplingMode=o.Cj.NEAREST,t.dataType=this.pixelType,t.width=this.size,t.height=this.size,t}setData(t,e,s){const a=(0,M.Q4)(t),l=this.data,h=a*this.texelSize+e;!l||h>=l.length||(l[h]=s,this.dirtyStart=Math.min(this.dirtyStart,a),this.dirtyEnd=Math.max(this.dirtyEnd,a))}getData(t,e){if(null==this.data)return null;const s=(0,M.Q4)(t)*this.texelSize+e;return!this.data||s>=this.data.length?null:this.data[s]}getTexture(t){var e;return null!==(e=this._texture)&&void 0!==e?e:this._initTexture(t)}getFBO(t,e=0){if(!this._fbos[e]){const s=0===e?this.getTexture(t):this._textureDesc;this._fbos[e]=new A.H(t,s)}return this._fbos[e]}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(t,e){try{const s=this.dirtyStart,a=this.dirtyEnd;if(!this.hasDirty)return;(0,D.A)("esri-2d-update-debug")&&console.debug(`Version[${e}] AttributeStoreView.updateTexture`,{start:s,end:a,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const l=this.data.buffer,h=this.getTexture(t),_=4,m=(s-s%this.size)/this.size,n=m,f=(a-a%this.size)/this.size,R=m*this.size*_,p=(this.size+f*this.size)*_-R,v=(0,c.Qz)(this.pixelType),g=new v(l,R*v.BYTES_PER_ELEMENT,p),b=this.size,x=f-n+1;if(x>this.size)return void E.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new S.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));h.updateData(0,0,n,b,x,g)}catch{}}update(t){const{data:e,start:s,end:a}=t;if(null!=e&&null!=this.data){const l=this.data,h=s*this.texelSize;for(let _=0;_<e.length;_++)t.layout&1<<_%this.texelSize&&(l[h+_]=e[_])}this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,a)}resize(t,e){const s=this.size;if(this.size=e,this.textureOnly)return void(s!==this.size&&(this._lastTexture=this._texture,this._texture=null));const a=(0,c.Qz)(this.pixelType);this.destroy(),this.data=new a(t.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(t){var e;const s=new y.g(t,this._textureDesc,null!==(e=this.data)&&void 0!==e?e:void 0);if(null!=this._lastTexture&&this._fbos[0]){const a=this._lastTexture.descriptor.width,l=this._lastTexture.descriptor.height,h=this._lastTexture.descriptor.dataType,_=this._lastTexture.descriptor.pixelFormat,m=this.getFBO(t),r=(0,c.AV)(h),n=new((0,c.Qz)(h))(new ArrayBuffer(a*l*r*this.texelSize)),u=t.getBoundFramebufferObject(),{x:f,y:R,width:p,height:v}=t.getViewport();t.bindFramebuffer(m),m.readPixels(0,0,a,l,_,h,n),s.updateData(0,0,0,2*a,l/2,n),t.setViewport(f,R,p,v),t.bindFramebuffer(u)}return this.destroy(),this._texture=s,this._texture}}class L{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(t){if(!t)throw new Error("InternalError: initArgs must be defined");const e=t.blockDescriptors;if(this.size=t.blockSize,(0,D.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:t}),null==this._data)this._data=e.map((s,a)=>null!=s?new O(s,this.size,a):null);else for(let s=0;s<this._data.length;s++){const a=this._data[s],l=e[s];null!=l&&(null==a?this._data[s]=new O(l,this.size,s):a.resize(l,this.size))}}destroy(){var t;for(const s of null!==(e=this._data)&&void 0!==e?e:[]){var e;null==s||s.destroy()}null===(t=this._defaultTexture)||void 0===t||t.dispose();for(const{resolver:s}of this._pendingAttributeUpdates)s.reject("AttributeStore destroyed");this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(t){return null==this._data?null:this._data[t]}setLabelMinZoom(t,e){this.setData(t,0,1,e)}getLabelMinZoom(t){return this.getData(t,0,1,255)}getFilterFlags(t){return this.getData(t,0,0,0)}getVVSize(t){return this.getData(t,d.dV.VV,0,0)}getData(t,e,s,a){if(!this._data)return 0;const l=this._data[e];if(null==l)return 0;const h=l.getData(t,s);return null!=h?h:a}setData(t,e,s,a){this._data[e].setData(t,s,a)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(t){var e=this;return(0,z.A)(function*(){const s=(0,T.Tw)();s.promise=s.promise.catch(a=>{(0,D.A)("esri-2d-update-debug")&&console.error("AttributeStoreView.requestUpdate rejected",a)}),e._version=t.version,e._pendingAttributeUpdates.push({inner:t,resolver:s}),(0,D.A)("esri-2d-update-debug")&&console.debug(`Version[${e._version}] AttributeStoreView.requestUpdate`,{message:t})})()}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const t=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const{inner:e,resolver:s}of t){const{blockData:a,initArgs:l,sendUpdateEpoch:h,version:_}=e;(0,D.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${h}] AttributeStoreView.applyUpdate`),this._version=_,this._epoch=h,null!=l&&this._initialize(l);const m=this._data;for(let r=0;r<a.length;r++){const n=a[r],u=m[r];null!=u&&null!=n&&((0,D.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${r}] AttributeStoreView.update`,{block:n}),u.update(n))}s.resolve()}}getUniforms(t){return{filterFlags:{texture:this._getTexture(t,d.dV.FilterFlags),unit:d.uM},animation:{texture:this._getTexture(t,d.dV.Animation),unit:d.z2},gpgpu:{texture:this._getTexture(t,d.dV.GPGPU),unit:d.Sr},visualVariableData:{texture:this._getTexture(t,d.dV.VV),unit:d.nM},dataDriven0:{texture:this._getTexture(t,d.dV.DD0),unit:d.lL},dataDriven1:{texture:this._getTexture(t,d.dV.DD1),unit:d.sn},dataDriven2:{texture:this._getTexture(t,d.dV.DD2),unit:d.n9},size:this.size}}_getTexture(t,e){var s;const a=null===(s=this._data)||void 0===s?void 0:s[e];return a?(a.updateTexture(t,this._version),a.getTexture(t)):this._getDefaultTexture(t)}_getDefaultTexture(t){if(null==this._defaultTexture){const e=new w.R;e.wrapMode=o.pF.CLAMP_TO_EDGE,e.samplingMode=o.Cj.NEAREST,e.width=1,e.height=1,this._defaultTexture=new y.g(t,e,new Uint8Array(4))}return this._defaultTexture}}var C=i(37188);class F extends C.A{constructor(t){super(t),this._statisticsByLevel=new Map,this.attributeView=new L}destroy(){this.children.forEach(t=>t.destroy()),this.removeAllChildren(),this.attributeView.destroy()}doRender(t){t.context.capabilities.enable("textureFloat"),super.doRender(t)}createRenderParams(t){const e=super.createRenderParams(t);return e.attributeView=this.attributeView,e.instanceStore=this._instanceStore,e.statisticsByLevel=this._statisticsByLevel,e}}},37188:(U,B,i)=>{i.d(B,{A:()=>M});var z=i(3248),S=i(69473),D=i(54382),E=i(89298),T=i(99065);const d=(c,o)=>c.key.level-o.key.level!=0?c.key.level-o.key.level:c.key.row-o.key.row!=0?c.key.row-o.key.row:c.key.col-o.key.col;class M extends D.A{constructor(o){super(),this._tileInfoView=o}renderChildren(o){this.sortChildren(d),this.setStencilReference(o),super.renderChildren(o)}createRenderParams(o){const{state:A}=o,y=super.createRenderParams(o);return y.requiredLevel=this._tileInfoView.getClosestInfoForScale(A.scale).level,y.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(A.scale),y}prepareRenderPasses(o){const A=super.prepareRenderPasses(o);return A.push(o.registerRenderPass({name:"stencil",brushes:[E.A],drawPhase:S.S5.DEBUG|S.S5.MAP|S.S5.HIGHLIGHT|S.S5.LABEL,target:()=>this.getStencilTarget()})),(0,z.A)("esri-tiles-debug")&&A.push(o.registerRenderPass({name:"tileInfo",brushes:[T.A],drawPhase:S.S5.DEBUG,target:()=>this.children})),A}getStencilTarget(){return this.children}setStencilReference(o){let A=1;for(const y of this.children)y.stencilRef=A++}}},87250:(U,B,i)=>{i.d(B,{O:()=>S});var z=i(69522);class S{constructor(E,T,d,M,c){this._instanceId=E,this.techniqueRef=T,this._meshWriterName=d,this._input=M,this.optionalAttributes=c}get instanceId(){return(0,z.P)(this._instanceId)}createMeshInfo(E){return{id:this._instanceId,meshWriterName:this._meshWriterName,options:E,optionalAttributes:this.optionalAttributes}}getInput(){return this._input}setInput(E){this._input=E}}},57641:(U,B,i)=>{i.d(B,{f:()=>_});var z=i(11432),S=i(66803),D=i(69473),E=i(87250),T=i(28291),d=i(69522);let M=0;function c(m,r,n){return new E.O((0,d.U)(M++),m,m.meshWriter.name,r,n)}const o={geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null}};class A{constructor(){this.instances={fill:c(T.YS.fill,o,{zoomRange:!0}),marker:c(T.YS.marker,o,{zoomRange:!0}),line:c(T.YS.line,o,{zoomRange:!0}),text:c(T.YS.text,o,{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}),complexFill:c(T.YS.complexFill,o,{zoomRange:!0}),texturedLine:c(T.YS.texturedLine,o,{zoomRange:!0})},this._instancesById=Object.values(this.instances).reduce((r,n)=>(r.set(n.instanceId,n),r),new Map)}getInstance(r){return this._instancesById.get(r)}}var y=i(31610),w=i(12273),P=i(88532),O=i(12225),L=i(77098),C=i(63888),F=i(24370),I=i(32788),t=i(50915),e=i(45513);const s=Math.PI/180;class l extends C.q{constructor(r){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,w.vt)(),this._localOrigin={x:0,y:0},this._getBounds=r}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,z.WD)(this._program)}doRender(r){const{context:n}=r,u=this._getBounds();if(u.length<1)return;this._createShaderProgram(n),this._updateMatricesAndLocalOrigin(r),this._updateBufferData(n,u),n.setBlendingEnabled(!0),n.setDepthTestEnabled(!1),n.setStencilWriteMask(0),n.setStencilTestEnabled(!1),n.setBlendFunction(t.dn.ONE,t.dn.ONE_MINUS_SRC_ALPHA),n.setColorMask(!0,!0,!0,!0);const f=this._program;n.bindVAO(this._vao),n.useProgram(f),f.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),n.gl.lineWidth(1),n.drawElements(t.WR.LINES,8*u.length,t.pe.UNSIGNED_INT,0),n.bindVAO()}_createTransforms(){return{displayViewScreenMat3:(0,w.vt)()}}_createShaderProgram(r){this._program||(this._program=r.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",h().attributes))}_updateMatricesAndLocalOrigin(r){const{state:n}=r,{displayMat3:u,size:f,resolution:R,pixelRatio:p,rotation:v,viewpoint:g}=n,b=s*v,{x,y:N}=g.targetGeometry,G=(0,L.mT)(x,n.spatialReference);this._localOrigin.x=G,this._localOrigin.y=N;const W=p*f[0],j=p*f[1],$=R*W,Y=R*j,V=(0,y.D_)(this._dvsMat3);(0,y.lw)(V,V,u),(0,y.Tl)(V,V,(0,P.fA)(W/2,j/2)),(0,y.hs)(V,V,(0,O.fA)(f[0]/$,-j/Y,1)),(0,y.e$)(V,V,-b)}_updateBufferData(r,n){const{x:u,y:f}=this._localOrigin,p=new Float32Array(8*n.length),v=new Uint32Array(8*n.length);let g=0,b=0;for(const x of n)x&&(p[2*g]=x[0]-u,p[2*g+1]=x[1]-f,p[2*g+2]=x[0]-u,p[2*g+3]=x[3]-f,p[2*g+4]=x[2]-u,p[2*g+5]=x[3]-f,p[2*g+6]=x[2]-u,p[2*g+7]=x[1]-f,v[b]=g+0,v[b+1]=g+3,v[b+2]=g+3,v[b+3]=g+2,v[b+4]=g+2,v[b+5]=g+1,v[b+6]=g+1,v[b+7]=g+0,g+=4,b+=8);if(this._vertexBuffer?this._vertexBuffer.setData(p.buffer):this._vertexBuffer=I.g.createVertex(r,t._U.DYNAMIC_DRAW,p.buffer),this._indexBuffer?this._indexBuffer.setData(v):this._indexBuffer=I.g.createIndex(r,t._U.DYNAMIC_DRAW,v),!this._vao){const x=h();this._vao=new e.Z(r,x.attributes,x.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const h=()=>(0,F.ES)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:t.pe.FLOAT}]});class _ extends S.j{constructor(r){super(r),this._instanceStore=new A,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,z.pR)(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(r){this._boundsRenderer=new l(r),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(r,n){r.onMessage(n),this.contains(r)||this.addChild(r),this.requestRender()}_renderChildren(r,n){r.selection=n;for(const u of this.children){if(!u.visible)continue;const f=u.getDisplayList(r.drawPhase,this._instanceStore,D.ch.STRICT_ORDER);null==f||f.render(r)}}}}}]);